{"mappings":"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","sources":["src/app/script/main-embed.ts","src/app/script/polyfills.ts","node_modules/mdn-polyfills/Node.prototype.append.js","node_modules/mdn-polyfills/Node.prototype.prepend.js","node_modules/mdn-polyfills/String.prototype.padStart.js","node_modules/mdn-polyfills/Array.prototype.findIndex.js","src/app/script/app/kl-app.ts","src/app/script/klecks/kl.ts","src/app/script/klecks/history/kl-history.ts","src/app/script/klecks/ui/modals/popup.ts","src/app/script/klecks/ui/modals/modal-count.ts","src/app/script/bb/bb.ts","src/app/script/bb/input/event-listener.ts","src/app/script/bb/base/browser.ts","src/app/script/bb/base/create-canvas.ts","src/app/script/bb/base/base.ts","src/app/script/bb/input/key-listener.ts","src/app/script/bb/input/pointer-listener.ts","src/app/script/bb/math/math.ts","src/app/script/bb/input/event-chain.ts","src/app/script/bb/base/canvas.ts","src/app/script/bb/math/matrix.ts","src/app/script/bb/math/vec2.ts","src/app/script/bb/math/line.ts","src/app/script/bb/color/color.ts","src/app/script/bb/base/ui.ts","src/app/script/bb/base/bb-log.ts","<<jsx-config-pragma.js>>","src/app/script/bb/base/local-storage.ts","node_modules/@parcel/runtime-js/lib/runtime-34832b43d0ebd3bf.js","node_modules/@parcel/runtime-js/lib/runtime-a96f6567e6dac4f3.js","src/app/script/klecks/ui/base-components/checkbox.ts","src/app/script/klecks/ui/base-components/input.ts","src/app/script/klecks/ui/base-components/select.ts","src/app/script/klecks/ui/base-components/image-toggle.ts","src/app/script/klecks/ui/base-components/image-radio-list.ts","src/app/script/klecks/ui/base-components/pen-pressure-toggle.ts","node_modules/@parcel/runtime-js/lib/runtime-065238818b5d6d26.js","src/app/script/klecks/ui/base-components/kl-slider.ts","src/app/script/klecks/ui/base-components/slider-falloff.ts","src/app/script/klecks/ui/base-components/kl-slider-manual-input.ts","src/app/script/klecks/ui/modals/color-slider-hex-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-ce95b2abc71314b0.js","src/app/script/klecks/ui/base-components/kl-color-slider.ts","node_modules/@parcel/runtime-js/lib/runtime-e7bece06ac3b91da.js","src/app/script/klecks/ui/base-components/kl-color-slider-small.ts","src/app/script/klecks/ui/base-components/point-slider.ts","src/app/script/klecks/ui/base-components/color-options.ts","src/app/script/klecks/ui/base-components/options.ts","src/app/script/klecks/ui/components/status-overlay.ts","node_modules/@parcel/runtime-js/lib/runtime-76fc4a9796871f89.js","src/app/script/klecks/ui/modals/export-dialog-deprecated.ts","src/app/script/klecks/ui/components/crop-copy.ts","src/app/script/klecks/ui/modals/clipboard-dialog.ts","src/app/script/klecks/ui/tool-tabs/kl-layer-manager.ts","node_modules/@parcel/runtime-js/lib/runtime-9e9c6514323b50ff.js","node_modules/@parcel/runtime-js/lib/runtime-f141aefb87a862aa.js","node_modules/@parcel/runtime-js/lib/runtime-e93ed5f4a72fe388.js","node_modules/@parcel/runtime-js/lib/runtime-e1e96fa0dcd63695.js","node_modules/@parcel/runtime-js/lib/runtime-2d2417fe7f53ff5b.js","src/app/script/klecks/canvas/kl-canvas.ts","src/app/script/klecks/image-operations/flood-fill.ts","src/app/script/klecks/image-operations/shape-tool.ts","src/app/script/klecks/image-operations/render-text.ts","src/app/script/klecks/canvas/draw-project.ts","src/app/script/klecks/image-operations/gradient-tool.ts","src/app/script/klecks/canvas/translate-blending.ts","src/app/script/klecks/canvas-ui/workspace-svg-overlay.ts","src/app/script/klecks/canvas-ui/kl-canvas-workspace.ts","node_modules/@parcel/runtime-js/lib/runtime-ce6158b179cda36d.js","node_modules/@parcel/runtime-js/lib/runtime-9180b336d2c14eb8.js","node_modules/@parcel/runtime-js/lib/runtime-e98ceba16f4f3e8c.js","node_modules/@parcel/runtime-js/lib/runtime-1c4e2d66dbd3cd26.js","src/app/script/klecks/canvas-ui/canvas-preview.ts","src/app/script/klecks/ui/components/free-transform.ts","node_modules/@parcel/runtime-js/lib/runtime-7b1b46c773a5d5de.js","src/app/script/klecks/ui/components/free-transform-canvas.ts","src/app/script/klecks/ui/components/cropper.ts","src/app/script/klecks/ui/components/layer-preview.ts","src/app/script/klecks/ui/components/fitted-image.ts","src/app/script/klecks/ui/modals/show-import-as-layer-dialog.ts","src/app/script/klecks/ui/components/kl-image-dropper.ts","src/app/script/klecks/ui/components/overlay-toolspace.ts","src/app/script/klecks/ui/components/toolspace-top-row.ts","node_modules/@parcel/runtime-js/lib/runtime-c595ccae60beff87.js","node_modules/@parcel/runtime-js/lib/runtime-e5d7180bbee5b536.js","node_modules/@parcel/runtime-js/lib/runtime-6c52a4e8d76ec49b.js","node_modules/@parcel/runtime-js/lib/runtime-fa73233744fc505c.js","node_modules/@parcel/runtime-js/lib/runtime-b34e92e9fb9b8c68.js","node_modules/@parcel/runtime-js/lib/runtime-8a2022a1c05c8770.js","src/app/script/klecks/ui/components/tool-dropdown.ts","node_modules/@parcel/runtime-js/lib/runtime-760df77bff0950f0.js","node_modules/@parcel/runtime-js/lib/runtime-ff3da4d7dabee86d.js","node_modules/@parcel/runtime-js/lib/runtime-182f547eb7376cf5.js","node_modules/@parcel/runtime-js/lib/runtime-297f8366ec2375c9.js","node_modules/@parcel/runtime-js/lib/runtime-d831990ac91a582d.js","node_modules/@parcel/runtime-js/lib/runtime-621488e8bcab6d4d.js","src/app/script/klecks/ui/components/toolspace-tool-row.ts","node_modules/@parcel/runtime-js/lib/runtime-7355152122a84936.js","node_modules/@parcel/runtime-js/lib/runtime-81519c452bdfbaa9.js","node_modules/@parcel/runtime-js/lib/runtime-3fc59c96423b70ad.js","node_modules/@parcel/runtime-js/lib/runtime-1eef10cb07c9c851.js","src/app/script/klecks/ui/components/toolspace-stabilizer-row.ts","src/app/script/klecks/ui/components/tab-row.ts","node_modules/@parcel/runtime-js/lib/runtime-b9f67aff2ffaa235.js","src/app/script/klecks/ui/tool-tabs/hand-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-4486cf75fca81822.js","src/app/script/klecks/ui/tool-tabs/fill-ui.ts","src/app/script/klecks/ui/tool-tabs/text-ui.ts","src/app/script/klecks/ui/tool-tabs/shape-ui.ts","src/app/script/klecks/ui/modals/new-image-dialog.ts","src/app/script/klecks/ui/components/toolspace-collapser.ts","node_modules/@parcel/runtime-js/lib/runtime-3ca3a85d3436a84f.js","src/app/script/klecks/ui/modals/text-tool-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-47401ec572d2cfcf.js","node_modules/@parcel/runtime-js/lib/runtime-6476cf999a0e75d3.js","node_modules/@parcel/runtime-js/lib/runtime-4ee49cef2a1bfd51.js","node_modules/@parcel/runtime-js/lib/runtime-01d9fe07522d7373.js","node_modules/@parcel/runtime-js/lib/runtime-8450ca7f4e68dde7.js","src/app/script/klecks/ui/modals/show-import-image-dialog.ts","src/app/script/klecks/storage/psd.ts","src/app/script/klecks/storage/indexed-db.ts","src/app/script/klecks/filters/filters.ts","node_modules/@parcel/runtime-js/lib/runtime-08ec85fc3ea564e8.js","node_modules/@parcel/runtime-js/lib/runtime-c105dce751d9b16c.js","node_modules/@parcel/runtime-js/lib/runtime-272cd0cc0051d99c.js","node_modules/@parcel/runtime-js/lib/runtime-d623cec3e031c802.js","node_modules/@parcel/runtime-js/lib/runtime-4aa563d1de55ad17.js","node_modules/@parcel/runtime-js/lib/runtime-acf5209c71eb3497.js","node_modules/@parcel/runtime-js/lib/runtime-726a62492af9f94e.js","node_modules/@parcel/runtime-js/lib/runtime-f1cff4f2714da535.js","node_modules/@parcel/runtime-js/lib/runtime-06b47f2ffca8a188.js","node_modules/@parcel/runtime-js/lib/runtime-866a2902b0cdf580.js","node_modules/@parcel/runtime-js/lib/runtime-3b4878106cdf1b9c.js","node_modules/@parcel/runtime-js/lib/runtime-02847deebefdd0a7.js","node_modules/@parcel/runtime-js/lib/runtime-3dce3f08da564a07.js","node_modules/@parcel/runtime-js/lib/runtime-0e43c74fde652ea0.js","node_modules/@parcel/runtime-js/lib/runtime-2d3b073eae8e5f9b.js","node_modules/@parcel/runtime-js/lib/runtime-679ef653bc7e04ce.js","node_modules/@parcel/runtime-js/lib/runtime-b88d84f511ba7b52.js","node_modules/@parcel/runtime-js/lib/runtime-032418d95d19e88c.js","src/app/script/klecks/brushes/brushes.ts","src/app/script/klecks/brushes/pen-brush.ts","src/app/script/klecks/brushes/brushes-common.ts","src/app/script/klecks/brushes/alphas/brush-alphas.ts","src/app/script/bb/math/perlin.ts","src/app/script/klecks/brushes/blend-brush.ts","src/app/script/klecks/brushes/sketchy-brush.ts","src/app/script/klecks/brushes/pixel-brush.ts","src/app/script/klecks/brushes/eraser-brush.ts","src/app/script/klecks/brushes/smudge-brush.ts","src/app/script/klecks/brushes/chemy-brush.ts","src/app/script/klecks/brushes-ui/brushes-ui.ts","src/app/script/klecks/brushes-ui/pen-brush-ui.ts","src/app/script/klecks/brushes-ui/brushes-consts.ts","node_modules/@parcel/runtime-js/lib/runtime-f5fee83b55dfe524.js","src/app/script/klecks/brushes-ui/blend-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-c1ff462122383f3a.js","src/app/script/klecks/brushes-ui/sketchy-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-c362cafb743e4bf7.js","src/app/script/klecks/brushes-ui/pixel-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-9083363aed84d015.js","src/app/script/klecks/brushes-ui/eraser-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-72d61ca9dbc6379a.js","src/app/script/klecks/brushes-ui/smudge-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-2e54934a27c8b910.js","src/app/script/klecks/brushes-ui/chemy-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-a3466c6b7be08d45.js","src/app/script/klecks/ui/base-components/box-toggle.ts","src/app/script/klecks/ui/modals/show-iframe-popup.ts","src/app/script/klecks/ui/base-components/radio-list.ts","src/app/script/klecks/ui/components/browser-storage-ui.ts","src/app/script/klecks/storage/project-store.ts","src/app/script/klecks/storage/project-converter.ts","src/app/script/klecks/storage/base-64-to-blob.ts","src/app/script/klecks/ui/tool-tabs/file-tab.ts","node_modules/@parcel/runtime-js/lib/runtime-174f5efa9e6f0131.js","src/app/script/klecks/ui/tool-tabs/filter-tab.ts","src/app/script/klecks/ui/modals/imgur-upload.ts","node_modules/@parcel/runtime-js/lib/runtime-257b8f01a8ca9ad6.js","src/app/script/klecks/storage/ag-psd-wrapper.ts","node_modules/@parcel/runtime-js/lib/runtime-5ea32053680ef652.js","src/app/script/klecks/ui/components/save-reminder.ts","src/app/script/klecks/storage/save-to-computer.ts","node_modules/file-saver/src/FileSaver.js","src/app/script/klecks/history/undo-redo-catchup.ts","src/app/script/klecks/brushes-ui/brush-setting-service.ts","src/app/script/klecks/ui/tool-tabs/settings-tab.ts","node_modules/@parcel/runtime-js/lib/runtime-3e3712af4386deba.js","node_modules/@parcel/runtime-js/lib/runtime-050615743b2088cc.js","node_modules/@parcel/runtime-js/lib/runtime-4135c6b241ed0f39.js","src/app/script/klecks/ui/components/toolspace-scroller.ts","src/app/script/klecks/ui/tool-tabs/gradient-ui.ts","src/app/script/embed/toolspace-top-row.ts","src/app/script/klecks/filters/filters-lazy.ts","src/app/script/klecks/filters/filter-brightness-contrast.ts","src/app/script/klecks/filters/filters-consts.ts","src/app/script/klecks/filters/shared-gl-fx.ts","src/app/script-vendor/glfx.ts","src/app/script-vendor/shader-noise.glsl","src/app/script/klecks/filters/filter-crop-extend.ts","src/app/script/klecks/filters/filter-curves.ts","src/app/script/klecks/filters/filter-flip.ts","node_modules/@parcel/runtime-js/lib/runtime-0b614230dd5a2fbc.js","src/app/script/klecks/filters/filter-hue-saturation.ts","src/app/script/klecks/filters/filter-invert.ts","src/app/script/klecks/filters/filter-perspective.ts","src/app/script/klecks/ui/components/two-tabs.ts","src/app/script/klecks/filters/filter-resize.ts","node_modules/@parcel/runtime-js/lib/runtime-c388461235ee692d.js","src/app/script/klecks/filters/filter-rotate.ts","src/app/script/klecks/filters/filter-tilt-shift.ts","src/app/script/klecks/filters/filter-transform.ts","src/app/script/klecks/filters/filter-blur.ts","src/app/script/klecks/filters/filter-unsharp-mask.ts","src/app/script/klecks/filters/filter-to-alpha.ts","src/app/script/klecks/filters/filter-grid.ts","src/app/script/klecks/image-operations/draw-grid.ts","src/app/script/klecks/filters/filter-noise.ts","src/app/script/klecks/filters/filter-pattern.ts","src/app/script/klecks/filters/filter-distort.ts","src/app/script/klecks/filters/filter-vanish-point.ts","src/app/script/klecks/image-operations/draw-vanish-point.ts","src/app/script/klecks/storage/kl-canvas-to-psd-blob.ts","node_modules/@parcel/runtime-js/lib/runtime-fe04d655c2a3180f.js","node_modules/@parcel/runtime-js/lib/runtime-f15ea15a7900b9a3.js"],"sourcesContent":["import './polyfills';\nimport {KlApp} from './app/kl-app';\nimport {IKlProject} from './klecks/kl.types';\nimport {SaveReminder} from './klecks/ui/components/save-reminder';\nimport {klHistory} from './klecks/history/kl-history';\nimport {klPsdToKlProject, readPsd} from './klecks/storage/psd';\nimport {LANG} from './language/language';\n\nexport interface IEmbedParams {\n    project?: IKlProject,\n    psdBlob?: Blob,\n    onSubmit: (onSuccess: () => void, onError: () => void) => void;\n    embedUrl: string;\n    logoImg?: any;\n    bottomBar?: HTMLElement;\n    aboutEl?: HTMLElement;\n}\n\nexport interface IReadPSD {\n    blob: Blob;\n    callback: (k: IKlProject) => void;\n}\n\nexport function Embed(p: IEmbedParams) {\n\n    let isInitialized: boolean = false;\n    let klApp;\n    const psdQueue: IReadPSD[] = []; // queue of psds waiting while ag-psd is loading\n    let agPsd: any | 'error';\n\n    let loadingScreenEl = document.getElementById(\"loading-screen\");\n    let loadingScreenTextEl = document.getElementById(\"loading-screen-text\");\n    if (loadingScreenTextEl) {\n        loadingScreenTextEl.textContent = LANG('embed-init-waiting');\n    }\n\n    function onProjectReady(project: IKlProject) {\n        try {\n            if (isInitialized) {\n                throw new Error('Already called openProject');\n            }\n            isInitialized = true;\n\n            const saveReminder = new SaveReminder(\n                klHistory,\n                false,\n                false,\n                () => {},\n                () => klApp ? klApp.isDrawing() : false,\n                null,\n                null,\n            );\n            klApp = new KlApp(\n                project,\n                {\n                    saveReminder,\n                    bottomBar: p.bottomBar,\n                    aboutEl: p.aboutEl,\n                    embed: {\n                        url: p.embedUrl,\n                        onSubmit: p.onSubmit,\n                    }\n                }\n            );\n            saveReminder.init();\n\n            if (loadingScreenEl && loadingScreenEl.parentNode) {\n                loadingScreenEl.parentNode.removeChild(loadingScreenEl);\n            }\n            loadingScreenEl = null;\n            loadingScreenTextEl = null;\n\n            document.body.appendChild(klApp.getEl());\n        } catch (e) {\n            if (loadingScreenTextEl) {\n                loadingScreenTextEl.textContent = '❌ ' + e;\n            }\n            if (loadingScreenEl) {\n                loadingScreenEl.className += 'loading-screen-error';\n            }\n            console.error(e);\n        }\n    }\n\n    if (p.project) {\n        onProjectReady(p.project);\n    }\n    this.openProject = onProjectReady;\n    this.initError = (error: string) => {\n        if (loadingScreenTextEl) {\n            loadingScreenTextEl.textContent = '❌ ' + error;\n        }\n        if (loadingScreenEl) {\n            loadingScreenEl.className += 'loading-screen-error';\n        }\n    };\n    this.getPNG = (): Blob => {\n        if (!klApp) {\n            throw new Error('App not initialized');\n        }\n        return klApp.getPNG();\n    };\n    this.getPSD = async (): Promise<Blob> => {\n        if (!klApp) {\n            throw new Error('App not initialized');\n        }\n        return await klApp.getPSD();\n    };\n    this.readPSDs = (psds: IReadPSD[]) => {\n        if (psds.length === 0) {\n            return;\n        }\n\n        const readItem = (item: IReadPSD) => {\n            try {\n                const psd = agPsd.readPsd(item.blob);\n                const project = klPsdToKlProject(readPsd(psd));\n                item.callback(project);\n            } catch (e) {\n                console.error('failed to read psd', e);\n                item.callback(null);\n            }\n        };\n\n        if (!agPsd) {\n            if (psdQueue.length === 0) {\n                // load ag-psd\n                (async () => {\n                    try {\n                        agPsd = await import('ag-psd');\n                    } catch (e) {\n                        agPsd = 'error';\n                    }\n                    while (psdQueue.length) {\n                        readItem(psdQueue.shift());\n                    }\n                })();\n            }\n            psds.forEach(item => {\n                psdQueue.push(item);\n            });\n        } else {\n            psds.forEach(readItem);\n        }\n    };\n}","// import 'core-js';\nimport 'mdn-polyfills/Node.prototype.append';\nimport 'mdn-polyfills/Node.prototype.prepend';\nimport 'mdn-polyfills/String.prototype.padStart';\nimport 'mdn-polyfills/Array.prototype.findIndex';\n\nif (!('scrollTo' in Element.prototype)) {\n    Object.defineProperty(Element.prototype, 'scrollTo', {\n        value: function (x, y) {\n            this.scrollLeft = x;\n            this.scrollTop = y;\n        }\n    });\n}\n\nif (!('scrollBy' in Element.prototype)) {\n    Object.defineProperty(Element.prototype, 'scrollBy', {\n        value: function (x, y) {\n            this.scrollLeft += x;\n            this.scrollTop += y;\n        }\n    });\n}\n\n// sometimes Android WebView has no localStorage\nif (!('localStorage' in window)) {\n    try {\n        window['localStorage'] = {\n            getItem: () => null,\n            setItem: () => {},\n            removeItem: () => {},\n        } as any;\n    } catch (e) {\n        // maybe it doesn't let me set this\n    }\n}","!function(){function t(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.appendChild(n)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty(\"append\")||Object.defineProperty(e,\"append\",{configurable:!0,enumerable:!0,writable:!0,value:t})})}();\n","!function(){function t(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.insertBefore(n,this.firstChild)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty(\"prepend\")||Object.defineProperty(e,\"prepend\",{configurable:!0,enumerable:!0,writable:!0,value:t})})}();\n","String.prototype.padStart||(String.prototype.padStart=function(t,n){return t>>=0,n=String(n||\" \"),this.length>t?String(this):((t-=this.length)>n.length&&(n+=n.repeat(t/n.length)),n.slice(0,t)+String(this))});\n","Array.prototype.findIndex||Object.defineProperty(Array.prototype,\"findIndex\",{value:function(r){if(null==this)throw new TypeError('\"this\" is null or not defined');var e=Object(this),t=e.length>>>0;if(\"function\"!=typeof r)throw new TypeError(\"predicate must be a function\");for(var n=arguments[1],o=0;o<t;){var i=e[o];if(r.call(n,i,o,e))return o;o++}return-1}});\n","import {KL} from '../klecks/kl';\nimport {klHistory} from '../klecks/history/kl-history';\nimport {BB} from '../bb/bb';\nimport {showIframePopup} from '../klecks/ui/modals/show-iframe-popup';\n// @ts-ignore\nimport newImageImg from 'url:~/src/app/img/ui/new-image.svg';\n// @ts-ignore\nimport exportImg from 'url:~/src/app/img/ui/export.svg';\n// @ts-ignore\nimport shareImg from 'url:~/src/app/img/ui/share.svg';\n// @ts-ignore\nimport uploadImg from 'url:~/src/app/img/ui/upload.svg';\n// @ts-ignore\nimport importImg from 'url:~/src/app/img/ui/import.svg';\nimport {exportType} from '../klecks/ui/tool-tabs/file-tab';\nimport {ToolspaceTopRow} from \"../embed/toolspace-top-row\";\nimport {IGradient, IInitState, IKlProject, IKlPsd} from '../klecks/kl.types';\nimport {importFilters} from '../klecks/filters/filters-lazy';\nimport {base64ToBlob} from '../klecks/storage/base-64-to-blob';\nimport {klCanvasToPsdBlob} from '../klecks/storage/kl-canvas-to-psd-blob';\nimport {ProjectStore} from '../klecks/storage/project-store';\nimport {SaveReminder} from \"../klecks/ui/components/save-reminder\";\nimport {KlCanvasWorkspace} from '../klecks/canvas-ui/kl-canvas-workspace';\nimport {KlCanvas} from '../klecks/canvas/kl-canvas';\nimport {LANG} from '../language/language';\n// @ts-ignore\nimport toolPaintImg from 'url:~/src/app/img/ui/tool-paint.svg';\n// @ts-ignore\nimport toolHandImg from 'url:~/src/app/img/ui/tool-hand.svg';\n// @ts-ignore\nimport toolFillImg from 'url:~/src/app/img/ui/tool-fill.svg';\n// @ts-ignore\nimport toolGradientImg from 'url:~/src/app/img/ui/tool-gradient.svg';\n// @ts-ignore\nimport toolTextImg from 'url:~/src/app/img/ui/tool-text.svg';\n// @ts-ignore\nimport toolShapeImg from 'url:~/src/app/img/ui/tool-shape.svg';\n// @ts-ignore\nimport tabSettingsImg from 'url:~/src/app/img/ui/tab-settings.svg';\n// @ts-ignore\nimport tabLayersImg from 'url:~/src/app/img/ui/tab-layers.svg';\nimport {LocalStorage} from '../bb/base/local-storage';\n\n\ninterface IKlAppOptions {\n    saveReminder?: SaveReminder;\n    projectStore?: ProjectStore;\n    logoImg?: any; // app logo\n    bottomBar?: HTMLElement; // row at bottom of toolspace\n    embed?: {\n        url: string;\n        onSubmit: (onSuccess: () => void, onError: () => void) => void;\n    };\n    app?: {\n        filenameBase?: string; // part of filename when downloading drawing\n        imgurKey?: string; // for imgur uploads\n    };\n    aboutEl?: HTMLElement; // replaces info about Klecks in settings tab\n}\n\nimportFilters();\n\nexport function KlApp(pProject: IKlProject | null, pOptions: IKlAppOptions) {\n    // default 2048, unless your screen is bigger than that (that computer then probably has the horsepower for that)\n    // but not larger than 4096 - a fairly arbitrary decision\n    let klMaxCanvasSize = Math.min(4096, Math.max(2048, Math.max(window.screen.width, window.screen.height)));\n    let collapseThreshold = 820;\n    let uiState: 'left' | 'right' = (pOptions.embed ? 'left' : (LocalStorage.getItem('uiState') ? LocalStorage.getItem('uiState') : 'right')) as any;\n    const filenameBase = pOptions.app?.filenameBase ? pOptions.app.filenameBase : 'Klecks';\n    const projectStore = pOptions.projectStore;\n    let klRootEl = document.createElement(\"div\");\n    klRootEl.className = 'g-root';\n    let uiWidth: number = Math.max(0, window.innerWidth);\n    let uiHeight: number = Math.max(0, window.innerHeight);\n    const toolWidth = 271;\n    let exportType: exportType = 'png';\n    let klCanvas: KlCanvas = new KL.KlCanvas(\n        pProject ? {\n            projectObj: pProject\n        } : {\n            width: Math.max(10, Math.min(klMaxCanvasSize, window.innerWidth < collapseThreshold ? uiWidth : uiWidth - toolWidth)),\n            height: Math.max(10, Math.min(klMaxCanvasSize, uiHeight)),\n        }, pOptions.embed ? -1 : 0);\n    klCanvas.setHistory(klHistory);\n    let initState: IInitState = null;\n    let mainTabRow;\n\n    if (!pOptions.saveReminder) {\n        pOptions.saveReminder = {init: () => {}, reset: () => {}} as SaveReminder;\n    }\n\n    function translateSmoothing(s: number): number {\n        if (s == 1) {\n            return 1 - 0.5;\n        }\n        if (s == 2) {\n            return 1 - 0.16;\n        }\n        if (s == 3) {\n            return 1 - 0.035;\n        }\n        if (s == 4) {\n            return 1 - 0.0175;\n        }\n        if (s == 5) {\n            return 1 - 0.00875;\n        }\n        return s;\n    }\n\n    let isFirstImage = true;\n\n    if (pProject) {\n        pProject.layers.forEach(layer => {\n            layer.image = null;\n        });\n        pProject = null;\n    } else {\n        klHistory.pause(true);\n        klCanvas.addLayer();\n        klCanvas.layerFill(0, { r: 255, g: 255, b: 255});\n        klHistory.pause(false);\n    }\n    try {\n        initState = {\n            canvas: new KL.KlCanvas({copy: klCanvas}, pOptions.embed ? -1 : 0),\n            focus: klCanvas.getLayerCount() - 1,\n            brushes: {},\n        };\n    } catch (e) {\n        if (e.message === 'kl-create-canvas-error') {\n            klCanvas.destroy();\n        }\n        throw e;\n    }\n    for (let b in KL.brushes) {\n        if (KL.brushes.hasOwnProperty(b)) {\n            initState.brushes[b] = new KL.brushes[b]();\n            if (initState.canvas) {\n                initState.brushes[b].setContext(initState.canvas.getLayerContext(initState.focus));\n            }\n        }\n    }\n\n\n    let currentColor = new BB.RGB(0, 0, 0);\n    let currentBrush;\n    let currentBrushId: string;\n    let lastNonEraserBrushId: string;\n    let currentLayerCtx = klCanvas.getLayerContext(klCanvas.getLayerCount() - 1);\n\n    // when cycling through brushes you need to know the next non-eraser brush\n    function getNextBrushId(): string {\n        if (currentBrushId === 'eraserBrush') {\n            return lastNonEraserBrushId;\n        }\n        const keyArr = Object.keys(brushUiObj).filter(item => item !== 'eraserBrush');\n        const i = keyArr.findIndex(item => item === currentBrushId);\n        return keyArr[(i + 1) % keyArr.length];\n    }\n\n    function sizeWatcher(val) {\n        brushSettingService.emitSize(val);\n        if (klCanvasWorkspace) {\n            klCanvasWorkspace.setCursorSize(val * 2);\n        }\n    }\n\n    const brushSettingService = new KL.BrushSettingService(\n        (color) => {\n            klColorSlider.setColor(color);\n            currentBrush.setColor(color);\n            currentColor = BB.copyObj(color);\n        },\n        (size) => {\n            currentBrush.setSize(size);\n            klCanvasWorkspace.setCursorSize(size * 2);\n        },\n        (opacity) => {\n            currentBrush.setOpacity(opacity);\n        },\n        () => klColorSlider.getColor(),\n        () => brushUiObj[currentBrushId].getSize(),\n        () => brushUiObj[currentBrushId].getOpacity(),\n        () => {\n            return {\n                sizeSlider: KL.brushesUI[currentBrushId].sizeSlider,\n                opacitySlider: KL.brushesUI[currentBrushId].opacitySlider,\n            };\n        }\n    );\n\n    let lineSmoothing = new BB.EventChain.LineSmoothing({\n        smoothing: translateSmoothing(1),\n    });\n    let lineSanitizer = new BB.EventChain.LineSanitizer();\n\n    let drawEventChain = new BB.EventChain.EventChain({\n        chainArr: [\n            lineSanitizer,\n            lineSmoothing\n        ],\n    });\n\n    drawEventChain.setChainOut(function(event) {\n        if (event.type === 'down') {\n            toolspace.style.pointerEvents = 'none';\n            currentBrush.startLine(event.x, event.y, event.pressure);\n            klCanvasWorkspace.requestFrame();\n        }\n        if (event.type === 'move') {\n            currentBrush.goLine(event.x, event.y, event.pressure, false, event.isCoalesced)\n            klCanvasWorkspace.setLastDrawEvent(event.x, event.y, event.pressure);\n            klCanvasWorkspace.requestFrame();\n        }\n        if (event.type === 'up') {\n            toolspace.style.pointerEvents = '';\n            currentBrush.endLine();\n            klCanvasWorkspace.requestFrame();\n        }\n        if (event.type === 'line') {\n            currentBrush.getBrush().drawLineSegment(event.x0, event.y0, event.x1, event.y1);\n            klCanvasWorkspace.requestFrame();\n        }\n    });\n\n    let textToolSettings = {\n        size: 20,\n        align: 'left' as ('left' | 'center' | 'right'),\n        isBold: false,\n        isItalic: false,\n        font: 'sans-serif' as ('serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy'),\n        opacity: 1\n    };\n\n    const klCanvasWorkspace: KlCanvasWorkspace = new KL.KlCanvasWorkspace({\n        klCanvas: klCanvas,\n        width: Math.max(0, uiWidth - toolWidth),\n        height: uiHeight,\n        onDraw: drawEventChain.chainIn,\n        onPick: function(rgbObj, isDragDone) {\n            brushSettingService.setColor(rgbObj);\n            if (isDragDone) {\n                klColorSlider.pickingDone();\n                klCanvasWorkspace.setMode(toolspaceToolRow.getActive());\n            }\n        },\n        onFill: function(canvasX, canvasY) {\n            let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\n            klCanvas.floodFill(\n                layerIndex,\n                canvasX,\n                canvasY,\n                fillUi.getIsEraser() ? null : klColorSlider.getColor(),\n                fillUi.getOpacity(),\n                fillUi.getTolerance(),\n                fillUi.getSample(),\n                fillUi.getGrow(),\n                fillUi.getContiguous()\n            );\n            klCanvasWorkspace.requestFrame();\n        },\n        onGradient: function(typeStr, canvasX, canvasY, angleRad) {\n            if (typeStr === 'down') {\n                gradientTool.onDown(canvasX, canvasY, angleRad);\n            }\n            if (typeStr === 'move') {\n                gradientTool.onMove(canvasX, canvasY);\n            }\n            if (typeStr === 'up') {\n                gradientTool.onUp(canvasX, canvasY);\n            }\n        },\n        onText: function(canvasX, canvasY, angleRad) {\n            if (KL.dialogCounter.get() > 0) {\n                return;\n            }\n\n            KL.textToolDialog({\n                klCanvas: klCanvas,\n                layerIndex: klCanvas.getLayerIndex(currentLayerCtx.canvas),\n                x: canvasX,\n                y: canvasY,\n                angleRad: angleRad,\n                color: klColorSlider.getColor(),\n                secondaryColor: klColorSlider.getSecondaryRGB(),\n                size: textToolSettings.size,\n                align: textToolSettings.align,\n                isBold: textToolSettings.isBold,\n                isItalic: textToolSettings.isItalic,\n                font: textToolSettings.font,\n                opacity: textToolSettings.opacity,\n                onConfirm: function(val) {\n\n                    let colorRGBA = val.color;\n                    colorRGBA.a = val.opacity;\n\n                    textToolSettings.size = val.size;\n                    textToolSettings.align = val.align;\n                    textToolSettings.isBold = val.isBold;\n                    textToolSettings.isItalic = val.isItalic;\n                    textToolSettings.font = val.font;\n                    textToolSettings.opacity = val.opacity;\n\n                    let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\n                    klCanvas.text(layerIndex, {\n                        textStr: val.textStr,\n                        x: val.x,\n                        y: val.y,\n                        size: val.size,\n                        font: val.font,\n                        align: val.align,\n                        isBold: val.isBold,\n                        isItalic: val.isItalic,\n                        angleRad: angleRad,\n                        color: BB.ColorConverter.toRgbaStr(colorRGBA)\n                    });\n                    klCanvasWorkspace.requestFrame();\n                }\n            });\n\n        },\n        onShape: function(typeStr, canvasX, canvasY, angleRad) {\n            if (typeStr === 'down') {\n                shapeTool.onDown(canvasX, canvasY, angleRad);\n            }\n            if (typeStr === 'move') {\n                shapeTool.onMove(canvasX, canvasY);\n            }\n            if (typeStr === 'up') {\n                shapeTool.onUp(canvasX, canvasY);\n            }\n        },\n\n        onViewChange: function(viewChangeObj) {\n\n            if (viewChangeObj.changed.includes('scale')) {\n                statusOverlay.out({\n                    type: 'transform',\n                    scale: viewChangeObj.scale,\n                    angleDeg: viewChangeObj.angle * 180 / Math.PI\n                });\n            }\n\n            toolspaceToolRow.setEnableZoomIn(viewChangeObj.scale !== klCanvasWorkspace.getMaxScale());\n            toolspaceToolRow.setEnableZoomOut(viewChangeObj.scale !== klCanvasWorkspace.getMinScale());\n\n            handUi.update(viewChangeObj.scale, viewChangeObj.angle * 180 / Math.PI);\n        },\n        onUndo: function() {\n            if (klHistory.canUndo()) {\n                if (undoRedoCatchup.undo()) {\n                    statusOverlay.out(LANG('undo'), true);\n                }\n            }\n        },\n        onRedo: function() {\n            if (klHistory.canRedo()) {\n                if (undoRedoCatchup.redo()) {\n                    statusOverlay.out(LANG('redo'), true);\n                }\n            }\n        },\n    });\n    let keyListener = new BB.KeyListener({\n        onDown: function(keyStr, event, comboStr) {\n            if (KL.dialogCounter.get() > 0 || BB.isInputFocused(true)) {\n                return;\n            }\n\n            let isDrawing = lineSanitizer.getIsDrawing() || klCanvasWorkspace.getIsDrawing();\n            if (isDrawing) {\n                return;\n            }\n\n            if (comboStr === 'plus') {\n                klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? 1/8 : 1/2);\n            }\n            if (comboStr === 'minus') {\n                klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? -1/8 : -1/2);\n            }\n            if (comboStr === 'home') {\n                klCanvasWorkspace.fitView();\n            }\n            if (comboStr === 'end') {\n                klCanvasWorkspace.resetView(true);\n            }\n            if (['ctrl+z', 'cmd+z'].includes(comboStr)) {\n                event.preventDefault();\n                undoRedoCatchup.undo();\n            }\n            if (\n                ['ctrl+y', 'cmd+y'].includes(comboStr) ||\n                (\n                    (\n                        BB.sameKeys('ctrl+shift+z', comboStr) ||\n                        BB.sameKeys('cmd+shift+z', comboStr)\n                    ) && keyStr === 'z'\n                )\n            ) {\n                event.preventDefault();\n                undoRedoCatchup.redo();\n            }\n            if (!pOptions.embed) {\n                if (['ctrl+s', 'cmd+s'].includes(comboStr)) {\n                    event.preventDefault();\n                    saveToComputer.save();\n                }\n                if (['ctrl+shift+s', 'cmd+shift+s'].includes(comboStr)) {\n                    event.preventDefault();\n\n                    (async () => {\n                        let success = true;\n                        try {\n                            await projectStore.store(klCanvas.getProject());\n                        } catch (e) {\n                            success = false;\n                            setTimeout(() => {\n                                throw new Error('keyboard-shortcut: failed to store browser storage, ' + e);\n                            }, 0);\n                            statusOverlay.out('❌ ' + LANG('file-storage-failed'), true);\n                        }\n                        if (success) {\n                            pOptions.saveReminder.reset();\n                            statusOverlay.out(LANG('file-storage-stored'), true);\n                        }\n                    })();\n                }\n                if (['ctrl+c', 'cmd+c'].includes(comboStr)) {\n                    event.preventDefault();\n                    copyToClipboard(true);\n                }\n            }\n            if (['ctrl+a', 'cmd+a'].includes(comboStr)) {\n                event.preventDefault();\n            }\n\n\n            if (keyListener.comboOnlyContains(['left', 'right', 'up', 'down'])) {\n                if (keyStr === 'left') {\n                    klCanvasWorkspace.translateView(1, 0);\n                }\n                if (keyStr === 'right') {\n                    klCanvasWorkspace.translateView(-1, 0);\n                }\n                if (keyStr === 'up') {\n                    klCanvasWorkspace.translateView(0, 1);\n                }\n                if (keyStr === 'down') {\n                    klCanvasWorkspace.translateView(0, -1);\n                }\n            }\n\n\n            if (['r+left','r+right'].includes(comboStr)) {\n                if (keyStr === 'left') {\n                    klCanvasWorkspace.setAngle(-15, true);\n                    handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\n                }\n                if (keyStr === 'right') {\n                    klCanvasWorkspace.setAngle(15, true);\n                    handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\n                }\n            }\n            if (['r+up'].includes(comboStr)) {\n                klCanvasWorkspace.setAngle(0);\n                handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\n            }\n\n\n            if (comboStr === 'sqbr_open') {\n                currentBrush.decreaseSize(0.03 / klCanvasWorkspace.getScale());\n            }\n            if (comboStr === 'sqbr_close') {\n                currentBrush.increaseSize(0.03 / klCanvasWorkspace.getScale());\n            }\n            if (comboStr === 'enter') {\n                klCanvas.layerFill(klCanvas.getLayerIndex(currentLayerCtx.canvas), klColorSlider.getColor());\n                statusOverlay.out(LANG('filled'), true);\n            }\n            if (['delete', 'backspace'].includes(comboStr)) {\n                let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\n                if (layerIndex === 0 && !brushUiObj.eraserBrush.getIsTransparentBg()) {\n                    klCanvas.layerFill(layerIndex, {r: 255, g: 255, b: 255}, 'source-in');\n                } else {\n                    klCanvas.clearLayer(layerIndex);\n                }\n                statusOverlay.out(LANG('cleared-layer'), true);\n            }\n            if (comboStr === 'e') {\n                event.preventDefault();\n                klCanvasWorkspace.setMode('draw');\n                toolspaceToolRow.setActive('draw');\n                mainTabRow.open('draw');\n                updateMainTabVisibility();\n                brushTabRow.open('eraserBrush');\n            }\n            if (comboStr === 'b') {\n                event.preventDefault();\n                const prevMode = klCanvasWorkspace.getMode();\n                klCanvasWorkspace.setMode('draw');\n                toolspaceToolRow.setActive('draw');\n                mainTabRow.open('draw');\n                updateMainTabVisibility();\n                brushTabRow.open(prevMode === 'draw' ? getNextBrushId() : currentBrushId);\n            }\n            if (comboStr === 'g') {\n                event.preventDefault();\n                const newMode = klCanvasWorkspace.getMode() === 'fill' ? 'gradient' : 'fill';\n                klCanvasWorkspace.setMode(newMode);\n                toolspaceToolRow.setActive(newMode);\n                mainTabRow.open(newMode);\n                updateMainTabVisibility();\n            }\n            if (comboStr === 't') {\n                event.preventDefault();\n                klCanvasWorkspace.setMode('text');\n                toolspaceToolRow.setActive('text');\n                mainTabRow.open('text');\n                updateMainTabVisibility();\n            }\n            if (comboStr === 'u') {\n                event.preventDefault();\n                klCanvasWorkspace.setMode('shape');\n                toolspaceToolRow.setActive('shape');\n                mainTabRow.open('shape');\n                updateMainTabVisibility();\n            }\n            if (comboStr === 'x') {\n                event.preventDefault();\n                klColorSlider.swapColors();\n            }\n\n\n        },\n        onUp: function(keyStr, event) {\n        }\n    });\n\n    /**\n     *\n     * @param importedImage - convertedPsd | {type: 'image', width: number, height: number, canvas: image | canvas}\n     * @param filename - string e.g. 'drawing.psd'\n     * @param optionStr? - 'default' | 'layer' | 'image'\n     */\n    function importFinishedLoading(\n        importedImage: IKlPsd | {\n            type: 'image';\n            width: number;\n            height: number;\n            canvas: HTMLCanvasElement | HTMLImageElement;\n        },\n        filename: string,\n        optionStr: 'default' | 'layer' | 'image',\n    ) {\n        if (!importedImage || isNaN(importedImage.width) || isNaN(importedImage.height) || importedImage.width <= 0 || importedImage.height <= 0) {\n            KL.popup({\n                target: klRootEl,\n                type: \"error\",\n                message: LANG('import-broken-file'),\n                buttons: [\"Ok\"],\n            });\n            return;\n        }\n\n        function getResizedDimensions(width, height) {\n            let w = parseInt(width);\n            let h = parseInt(height);\n            if (w > klMaxCanvasSize) {\n                h = klMaxCanvasSize / w * h;\n                w = klMaxCanvasSize;\n            }\n            if (h > klMaxCanvasSize) {\n                w = klMaxCanvasSize / h * w;\n                h = klMaxCanvasSize;\n            }\n            w = parseInt('' + w);\n            h = parseInt('' + h);\n            return {\n                width: w,\n                height: h\n            }\n        }\n\n        function importAsImage(canvas) {\n            let resizedDimensions = getResizedDimensions(canvas.width, canvas.height);\n\n            //resize first\n            let tempCanvas = BB.canvas(canvas.width, canvas.height);\n            let tempCanvasCtx = tempCanvas.getContext('2d');\n            tempCanvasCtx.drawImage(canvas, 0, 0);\n\n            BB.resizeCanvas(tempCanvas, resizedDimensions.width, resizedDimensions.height);\n\n            klCanvas.reset({\n                width: resizedDimensions.width,\n                height: resizedDimensions.height,\n                image: tempCanvas,\n                layerName: filename\n            });\n\n            layerManager.update(0);\n            setCurrentLayer(klCanvas.getLayer(0));\n            klCanvasWorkspace.resetView();\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\n\n            isFirstImage = false;\n        }\n\n        /**\n         *\n         * @param convertedPsdObj - if flattened then without layers\n         * @param cropObj? - {x: number, y: number, width: number, height: number}\n         */\n        function importAsImagePsd(convertedPsdObj: IKlPsd, cropObj?) {\n\n            // crop\n            function crop(targetCanvas, cropCanvas, cropObj) {\n                cropCanvas.width = cropCanvas.width;\n                cropCanvas.getContext('2d').drawImage(targetCanvas, -cropObj.x, -cropObj.y);\n                targetCanvas.width = cropObj.width;\n                targetCanvas.height = cropObj.height;\n                targetCanvas.getContext('2d').drawImage(cropCanvas, 0, 0);\n            }\n            if (cropObj && (cropObj.width !== convertedPsdObj.width ||cropObj.height !== convertedPsdObj.height)) {\n                let cropCanvas = BB.canvas(cropObj.width, cropObj.height);\n                convertedPsdObj.width = cropObj.width;\n                convertedPsdObj.height = cropObj.height;\n\n                if (!convertedPsdObj.layers) {\n                    crop(convertedPsdObj.canvas, cropCanvas, cropObj);\n                }\n                if (convertedPsdObj.layers) {\n                    for (let i = 0; i < convertedPsdObj.layers.length; i++) {\n                        let item = convertedPsdObj.layers[i];\n                        crop(item.image, cropCanvas, cropObj);\n                    }\n                }\n            }\n\n            // resize\n            let resizedDimensions = getResizedDimensions(convertedPsdObj.width, convertedPsdObj.height);\n            convertedPsdObj.width = resizedDimensions.width;\n            convertedPsdObj.height = resizedDimensions.height;\n            if (!convertedPsdObj.layers) {\n                BB.resizeCanvas(convertedPsdObj.canvas, convertedPsdObj.width, convertedPsdObj.height);\n            }\n            if (convertedPsdObj.layers) {\n                for (let i = 0; i < convertedPsdObj.layers.length; i++) {\n                    let item = convertedPsdObj.layers[i];\n                    BB.resizeCanvas(item.image, convertedPsdObj.width, convertedPsdObj.height);\n                }\n            }\n\n            let layerIndex;\n            if (convertedPsdObj.layers) {\n                layerIndex = klCanvas.reset({\n                    width: convertedPsdObj.width,\n                    height: convertedPsdObj.height,\n                    layers: convertedPsdObj.layers\n                });\n            } else {\n                layerIndex = klCanvas.reset({\n                    width: convertedPsdObj.width,\n                    height: convertedPsdObj.height,\n                    image: convertedPsdObj.canvas\n                });\n            }\n            layerManager.update(layerIndex);\n            setCurrentLayer(klCanvas.getLayer(layerIndex));\n            klCanvasWorkspace.resetView();\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\n\n            isFirstImage = false;\n        }\n\n        function importAsLayer(canvas) {\n            KL.showImportAsLayerDialog({\n                target: klRootEl,\n                klCanvas: klCanvas,\n                importImage: canvas,\n                callback: function(transformObj, isPixelated: boolean) {\n                    if (!transformObj) {\n                        return;\n                    }\n\n                    klHistory.pause(true);\n                    klCanvas.addLayer();\n                    let layers = klCanvas.getLayers();\n                    let activeLayerIndex = layers.length - 1;\n                    if (filename) {\n                        klCanvas.renameLayer(activeLayerIndex, filename);\n                    }\n                    let activeLayerContext = klCanvas.getLayerContext(activeLayerIndex);\n                    BB.drawTransformedImageWithBounds(activeLayerContext, canvas, transformObj, null, isPixelated);\n                    setCurrentLayer(klCanvas.getLayer(activeLayerIndex));\n                    layerManager.update(activeLayerIndex);\n\n                    klHistory.pause(false);\n\n                    klHistory.push({\n                        tool: [\"misc\"],\n                        action: \"importImage\",\n                        params: [BB.copyCanvas(activeLayerContext.canvas), filename]\n                    });\n                }\n            });\n        }\n\n\n        if (optionStr === 'default' || !optionStr) {\n            KL.showImportImageDialog({\n                image: importedImage,\n                target: klRootEl,\n                maxSize: klMaxCanvasSize,\n                callback: function(res) {\n                    if (res.type === 'as-image') {\n                        importAsImage(res.image);\n                    } else if (res.type === 'as-image-psd') {\n                        importAsImagePsd(res.image, res.cropObj);\n                    } else if (res.type === 'as-layer') {\n                        importAsLayer(res.image);\n                    } else if (res.type === 'cancel') {\n                        // nothing to do\n                    }\n                }\n            });\n        }\n\n        if (optionStr === 'layer') {\n            importAsLayer(importedImage.canvas);\n        }\n        if (optionStr === 'image') {\n            if (importedImage.type === 'psd') {\n                importAsImagePsd(importedImage);\n            } else {\n                importAsImage(importedImage.canvas);\n            }\n        }\n\n    }\n\n    function onPaste(e) {\n        if (KL.dialogCounter.get() > 0) {\n            return;\n        }\n\n        function retrieveImageFromClipboardAsBlob(pasteEvent, callback) {\n            if (pasteEvent.clipboardData == false) {\n                if (typeof (callback) == \"function\") {\n                    callback(undefined);\n                }\n            }\n\n            let items = pasteEvent.clipboardData.items;\n\n            if (items == undefined) {\n                if (typeof (callback) == \"function\") {\n                    callback(undefined);\n                }\n            } else {\n                for (let i = 0; i < items.length; i++) {\n                    if (items[i].type.indexOf(\"image\") == -1) {\n                        continue;\n                    }\n                    let blob = items[i].getAsFile();\n\n                    if (typeof (callback) == \"function\") {\n                        callback(blob);\n                    }\n                }\n            }\n\n        }\n\n        e.stopPropagation();\n        e.preventDefault();\n\n        if (e.clipboardData.files[0]) {\n            retrieveImageFromClipboardAsBlob(e, function (imageBlob) {\n                // If there's an image, display it in the canvas\n                if (imageBlob) {\n                    let img = new Image();\n                    img.onload = function () {\n                        URL.revokeObjectURL(img.src);\n                        importFinishedLoading({\n                            type: 'image',\n                            width: img.width,\n                            height: img.height,\n                            canvas: img\n                        }, null, 'default');\n                    };\n                    let URLObj = window.URL || window.webkitURL;\n                    img.src = URLObj.createObjectURL(imageBlob);\n                }\n            });\n        } else if (e.clipboardData.items[0]) {\n            e.clipboardData.items[0].getAsString(function(pasteStr) {\n                pasteStr = pasteStr.trim();\n                if (pasteStr.match(/^https?/)) {\n                    // url\n                    let img = new Image();\n                    img.onload = function () {\n                        importFinishedLoading({\n                            type: 'image',\n                            width: img.width,\n                            height: img.height,\n                            canvas: img\n                        }, null, 'default');\n                    };\n                    img.onerror = function (e) {\n                        console.log('error loading', e);\n                    };\n                    img.crossOrigin = 'Anonymous';\n                    img.src = pasteStr;\n\n                } else if (pasteStr.match(/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/)) {\n                    // url\n                    let rgbObj = BB.ColorConverter.hexToRGB(pasteStr.replace('#', ''));\n                    brushSettingService.setColor(rgbObj);\n                }\n            });\n\n        }\n    }\n\n    function handleFileSelect(files, optionStr) {\n\n        function showWarningPsdFlattened() {\n            KL.popup({\n                target: klRootEl,\n                type: \"warning\",\n                message: LANG('import-psd-unsupported') + \"<br /><br />\",\n                buttons: [\"Ok\"],\n            });\n        }\n\n        let hasUnsupportedFile = false;\n        for (let i = 0, file; file = files[i]; i++) {\n            let extension = file.name.split(\".\");\n            extension = extension[extension.length - 1].toLowerCase();\n            if (extension === \"psd\") {\n\n                (function(f) {\n                    let loaderSizeBytes = 1024 * 1024 * 25; // 25mb\n                    let maxSizeBytes = 1024 * 1024 * 1024; // 1gb\n                    let maxResolution = 4096;\n\n                    if (f.size >= maxSizeBytes) { // pretty likely to break stuff\n                        KL.popup({\n                            target: klRootEl,\n                            type: \"error\",\n                            message: \"File too big. Unable to import.<br /><br />\",\n                            buttons: [\"Ok\"],\n                        });\n                        return;\n                    }\n\n                    let doShowLoader = files.length === 1 && f.size >= loaderSizeBytes;\n                    let loaderIsOpen = true;\n                    let closeLoader;\n\n                    if (doShowLoader) {\n                        KL.popup({\n                            target: klRootEl,\n                            message: LANG('import-opening'),\n                            callback: function (result) {\n                                loaderIsOpen = false;\n                                closeLoader = null;\n                            },\n                            closefunc: function (f) {\n                                closeLoader = f;\n                            }\n                        });\n                    }\n\n\n                    let reader = new FileReader();\n                    reader.onload = function (readerResult) {\n\n                        KL.loadAgPsd().then(function(agPsdLazy) {\n\n                            if (doShowLoader && !loaderIsOpen) {\n                                return;\n                            }\n\n                            try {\n                                let psd;\n\n                                // first pass, only read metadata\n                                psd = agPsdLazy.readPsd(\n                                    (readerResult.target.result as any),\n                                    {\n                                        skipLayerImageData: true,\n                                        skipThumbnail: true,\n                                        skipCompositeImageData: true\n                                    });\n                                if (psd.width > maxResolution || psd.height > maxResolution) {\n                                    if (closeLoader) {\n                                        closeLoader();\n                                    }\n                                    KL.popup({\n                                        target: klRootEl,\n                                        type: \"error\",\n                                        //message: \"Image exceeds maximum dimensions of \" + maxResolution + \" x \" + maxResolution + \" pixels. Unable to import.\"\n                                        message: LANG('import-psd-too-large').replace(/{x}/g, '' + maxResolution)\n                                            + \"<br /><br />\"\n                                            + LANG('import-psd-size') + \": \" + psd.width + \" x \" + psd.height + ' pixels'\n                                            + \"<br /><br />\"\n                                        ,\n                                        buttons: [\"Ok\"],\n                                    });\n                                    return;\n                                }\n\n\n                                // second pass, now load actual data.\n                                psd = null;\n\n                                try {\n                                    psd = agPsdLazy.readPsd((readerResult.target.result as any));\n                                } catch (e) {\n                                    //console.log('failed regular psd import', e);\n                                }\n                                if (psd) {\n                                    //console.log('psd', psd);\n                                    let convertedPsd = KL.PSD.readPsd(psd);\n                                    //console.log('converted', convertedPsd);\n                                    if (optionStr === 'image' && convertedPsd.error) {\n                                        showWarningPsdFlattened();\n                                    }\n\n                                    if (closeLoader) {\n                                        closeLoader();\n                                    }\n                                    importFinishedLoading(convertedPsd, f.name, optionStr);\n                                } else {\n                                    psd = agPsdLazy.readPsd((readerResult.target.result as any), { skipLayerImageData: true, skipThumbnail: true });\n                                    if (optionStr === 'image') {\n                                        showWarningPsdFlattened();\n                                    }\n\n                                    if (closeLoader) {\n                                        closeLoader();\n                                    }\n                                    importFinishedLoading({\n                                        type: 'psd',\n                                        width: psd.width,\n                                        height: psd.height,\n                                        canvas: psd.canvas,\n                                        error: true\n                                    }, f.name, optionStr);\n                                }\n\n\n                            } catch (e) {\n                                if (closeLoader) {\n                                    closeLoader();\n                                }\n                                KL.popup({\n                                    target: klRootEl,\n                                    type: \"error\",\n                                    message: \"Failed to load PSD.<br /><br />\",\n                                    buttons: [\"Ok\"],\n                                });\n                            }\n                        }).catch(() => {\n                            closeLoader();\n                            alert('Error: failed to load PSD library');\n                        });\n\n                    };\n                    reader.readAsArrayBuffer(f);\n                })(file);\n\n            } else if (file.type.match('image.*')) {\n                (function (f) {\n                    window.URL = window.URL || window.webkitURL;\n                    let url = window.URL.createObjectURL(f);\n                    let im = new Image();\n                    im.src = url;\n                    BB.loadImage(im, function () {\n                        importFinishedLoading({\n                            type: 'image',\n                            width: im.width,\n                            height: im.height,\n                            canvas: im\n                        }, f.name, optionStr);\n                    });\n                })(file);\n            } else {\n                hasUnsupportedFile = true;\n            }\n        }\n        if (hasUnsupportedFile) {\n            KL.popup({\n                target: klRootEl,\n                message: LANG('import-unsupported-file'),\n                type: 'error',\n                buttons: ['OK'],\n            });\n        }\n    }\n\n    if (!pOptions.embed) {\n        new KL.KlImageDropper({\n            target: document.body,\n            onDrop: function(files, optionStr) {\n                if (KL.dialogCounter.get() > 0) {\n                    return;\n                }\n                handleFileSelect(files, optionStr);\n            },\n            enabledTest: function() {\n                return KL.dialogCounter.get() === 0;\n            }\n        });\n\n        BB.addEventListener(window, 'paste', onPaste, false);\n    }\n\n    const brushUiObj: any = {};\n\n    // create brush UIs\n    for (let b in KL.brushesUI) {\n        if (KL.brushesUI.hasOwnProperty(b)) {\n            let ui = new KL.brushesUI[b].Ui({\n                onSizeChange: sizeWatcher,\n                onOpacityChange: function(opacity) {\n                    brushSettingService.emitOpacity(opacity);\n                },\n                onConfigChange: () => {\n                    brushSettingService.emitSliderConfig({\n                        sizeSlider: KL.brushesUI[currentBrushId].sizeSlider,\n                        opacitySlider: KL.brushesUI[currentBrushId].opacitySlider\n                    });\n                }\n            });\n            brushUiObj[b] = ui;\n            ui.getElement().style.padding = 10 + 'px';\n        }\n    }\n\n\n    BB.css(klRootEl, {\n        position: 'absolute',\n        left: '0',\n        top: '0',\n        right: '0',\n        bottom: '0'\n    });\n\n    let statusOverlay = new KL.StatusOverlay();\n\n    const toolspace = BB.el({});\n    const toolspaceInner = BB.el({\n        parent: toolspace,\n    });\n    toolspace.oncontextmenu = function () {\n        return false;\n    };\n    toolspace.onclick = BB.handleClick;\n\n\n    let toolspaceCollapser = new KL.ToolspaceCollapser({\n        onChange: function() {\n            updateCollapse();\n        }\n    });\n    function updateCollapse() {\n\n        //collapser\n        if (uiWidth < collapseThreshold) {\n            toolspaceCollapser.getElement().style.display = 'block';\n\n            toolspaceCollapser.setDirection(uiState);\n            if (toolspaceCollapser.isOpen()) {\n                if (uiState === 'left') {\n                    BB.css(toolspaceCollapser.getElement(), {\n                        left: '271px',\n                        right: '',\n                    });\n                    BB.css(klCanvasWorkspace.getElement(), {\n                        left: '271px'\n                    });\n                } else {\n                    BB.css(toolspaceCollapser.getElement(), {\n                        left: '',\n                        right: '271px'\n                    });\n                    BB.css(klCanvasWorkspace.getElement(), {\n                        left: '0'\n                    });\n                }\n                toolspace.style.display = 'block';\n                klCanvasWorkspace.setSize(Math.max(0, uiWidth - toolWidth), uiHeight);\n                statusOverlay.setWide(false);\n\n            } else {\n                if (uiState === 'left') {\n                    BB.css(toolspaceCollapser.getElement(), {\n                        left: '0',\n                        right: '',\n                    });\n                    BB.css(klCanvasWorkspace.getElement(), {\n                        left: '0'\n                    });\n                } else {\n                    BB.css(toolspaceCollapser.getElement(), {\n                        left: '',\n                        right: '0'\n                    });\n                    BB.css(klCanvasWorkspace.getElement(), {\n                        left: '0'\n                    });\n                }\n                toolspace.style.display = 'none';\n                klCanvasWorkspace.setSize(Math.max(0, uiWidth), uiHeight);\n                statusOverlay.setWide(true);\n\n            }\n\n        } else {\n            toolspaceCollapser.getElement().style.display = 'none';\n            if (uiState === 'left') {\n                BB.css(klCanvasWorkspace.getElement(), {\n                    left: '271px'\n                });\n            } else {\n                BB.css(klCanvasWorkspace.getElement(), {\n                    left: '0'\n                });\n            }\n            toolspace.style.display = 'block';\n            klCanvasWorkspace.setSize(Math.max(0, uiWidth - toolWidth), uiHeight);\n            statusOverlay.setWide(false);\n\n        }\n    }\n    updateCollapse();\n\n    function updateUi() {\n        if (uiState === 'left') {\n            BB.css(toolspace, {\n                left: '0',\n                right: '',\n                borderLeft: 'none',\n                borderRight: '1px solid rgb(135, 135, 135)'\n            });\n            BB.css(klCanvasWorkspace.getElement(), {\n                left: '271px'\n            });\n        } else {\n            BB.css(toolspace, {\n                left: '',\n                right: '0',\n                borderLeft: '1px solid rgb(135, 135, 135)',\n                borderRight: 'none'\n            });\n            BB.css(klCanvasWorkspace.getElement(), {\n                left: '0'\n            });\n        }\n        statusOverlay.setUiState(uiState);\n        layerPreview.setUiState('' + uiState);\n        layerManager.setUiState('' + uiState);\n        updateCollapse();\n        toolspaceScroller.updateUiState(uiState);\n    }\n\n\n\n    let overlayToolspace;\n    setTimeout(function() {\n        overlayToolspace = new KL.OverlayToolspace({\n            enabledTest: function() {\n                return KL.dialogCounter.get() === 0 && !lineSanitizer.getIsDrawing();\n            },\n            brushSettingService,\n        });\n        klRootEl.appendChild(overlayToolspace.getElement());\n    }, 0);\n\n    BB.append(klRootEl, [klCanvasWorkspace.getElement(), toolspace, toolspaceCollapser.getElement()]);\n\n    BB.css(toolspace, {\n        position: \"absolute\",\n        right: '0',\n        top: '0',\n        bottom: '0',\n        width: (toolWidth - 1) + \"px\",\n\n        overflow: \"hidden\",\n        backgroundColor: \"#ddd\",\n        borderLeft: \"1px solid rgb(135, 135, 135)\",\n        userSelect: 'none',\n        touchAction: 'none'\n    });\n\n    let toolspaceTopRow;\n    if (pOptions.embed) {\n        toolspaceTopRow = new ToolspaceTopRow({\n            onHelp: () => {\n                showIframePopup(pOptions.embed.url + '/help.html', !!pOptions.embed);\n            },\n            onSubmit: () => {\n                KL.popup({\n                    target: klRootEl,\n                    message: LANG('submit-prompt'),\n                    buttons: [LANG('submit'), 'Cancel'],\n                    callback: async (result) => {\n                        if (result !== LANG('submit')) {\n                            return;\n                        }\n\n                        let overlay = BB.el({\n                            parent: klRootEl,\n                            className: 'upload-overlay',\n                            content: '<div class=\"spinner\"></div> ' + LANG('submit-submitting'),\n                        });\n\n                        pOptions.embed.onSubmit(\n                            () => {\n                                pOptions.saveReminder.reset();\n                                klRootEl.removeChild(overlay);\n                            },\n                            () => {\n                                klRootEl.removeChild(overlay);\n                            });\n                    }\n                });\n            },\n            onLeftRight: () => {\n                uiState = uiState === 'left' ? 'right' : 'left';\n                updateUi();\n            },\n            onImport: () => {\n                fileTab.triggerImport();\n            },\n        });\n    } else {\n        toolspaceTopRow = new KL.ToolspaceTopRow({\n            logoImg: pOptions.logoImg,\n            onLogo: function() {\n                showIframePopup('./home/', !!pOptions.embed);\n            },\n            onNew: function() {\n                showNewImageDialog();\n            },\n            onImport: function() {\n                fileTab.triggerImport();\n            },\n            onSave: function() {\n                saveToComputer.save();\n            },\n            onShare: function() {\n                shareImage();\n            },\n            onHelp: function() {\n                showIframePopup('./help/', !!pOptions.embed);\n            },\n        });\n    }\n    toolspaceTopRow.getElement().classList.add('toolspace-row-shadow');\n    toolspaceTopRow.getElement().style.marginBottom = '10px';\n    toolspaceInner.appendChild(toolspaceTopRow.getElement());\n\n    let toolspaceToolRow = new KL.ToolspaceToolRow({\n        onActivate: function(activeStr) {\n            if (activeStr === 'draw') {\n                klCanvasWorkspace.setMode('draw');\n            } else if (activeStr === 'hand') {\n                klCanvasWorkspace.setMode('hand');\n            } else if (activeStr === 'fill') {\n                klCanvasWorkspace.setMode('fill');\n            } else if (activeStr === 'gradient') {\n                klCanvasWorkspace.setMode('gradient');\n            } else if (activeStr === 'text') {\n                klCanvasWorkspace.setMode('text');\n            } else if (activeStr === 'shape') {\n                klCanvasWorkspace.setMode('shape');\n            } else {\n                throw new Error('unknown activeStr');\n            }\n            mainTabRow.open(activeStr);\n            updateMainTabVisibility();\n            klColorSlider.pickingDone();\n        },\n        onZoomIn: function() {\n            klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? 1/8 : 1/2);\n        },\n        onZoomOut: function() {\n            klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? -1/8 : -1/2);\n        },\n        onUndo: function() {\n            undoRedoCatchup.undo();\n        },\n        onRedo: function() {\n            undoRedoCatchup.redo();\n        }\n    });\n    toolspaceToolRow.setIsSmall(uiHeight < 540);\n    klHistory.addListener(function() {\n        toolspaceToolRow.setEnableUndo(klHistory.canUndo());\n        toolspaceToolRow.setEnableRedo(klHistory.canRedo());\n    });\n    toolspaceToolRow.getElement().classList.add('toolspace-row-shadow');\n    toolspaceInner.appendChild(toolspaceToolRow.getElement());\n\n    let klColorSlider;\n\n    function setCurrentBrush(brushId) {\n        if (brushId !== 'eraserBrush') {\n            lastNonEraserBrushId = brushId;\n        }\n\n        if (klColorSlider) {\n            if (brushId === 'eraserBrush') {\n                klColorSlider.enable(false);\n            } else {\n                klColorSlider.enable(true);\n            }\n        }\n\n        currentBrushId = brushId;\n        currentBrush = brushUiObj[brushId];\n        currentBrush.setColor(currentColor);\n        currentBrush.setContext(currentLayerCtx);\n        klCanvasWorkspace.setMode('draw');\n        toolspaceToolRow.setActive('draw');\n        updateMainTabVisibility();\n    }\n\n    function setCurrentLayer(layer) { //BrushContext(p_context) {\n        currentLayerCtx = layer.context;\n        currentBrush.setContext(layer.context);\n        layerPreview.setLayer(layer);\n    }\n\n    function setBrushColor(p_color) {\n        currentColor = p_color;\n        currentBrush.setColor(p_color);\n        brushSettingService.emitColor(p_color);\n        klColorSlider.pickingDone();\n    }\n\n    klColorSlider = new KL.KlColorSlider({\n        width: 250,\n        height: 30,\n        svHeight: 100,\n        startValue: new BB.RGB(0, 0, 0),\n        onPick: setBrushColor\n    });\n    klColorSlider.setHeight(Math.max(163, Math.min(400, uiHeight - 505)));\n    klColorSlider.setPickCallback(function (doPick) {\n\n        if (doPick) {\n            klCanvasWorkspace.setMode('pick');\n        } else {\n            klCanvasWorkspace.setMode(toolspaceToolRow.getActive());\n            updateMainTabVisibility();\n        }\n\n    });\n    let brushDiv = document.createElement(\"div\");\n    let colorDiv = document.createElement(\"div\");\n    BB.css(colorDiv, {\n        margin: '10px',\n        display: 'flex',\n        flexWrap: 'wrap',\n        justifyContent: 'space-between',\n        alignItems: 'flex-end'\n    });\n    let toolspaceStabilizerRow = new KL.ToolspaceStabilizerRow({\n        smoothing: 1,\n        onSelect: function(v) {\n            lineSmoothing.setSmoothing(translateSmoothing(v));\n        }\n    });\n\n\n    brushDiv.appendChild(colorDiv);\n    BB.append(\n        colorDiv,\n        [klColorSlider.getElement(), klColorSlider.getOutputElement(), toolspaceStabilizerRow.getElement()]\n    );\n\n    let brushTabRow = new KL.TabRow({\n        initialId: 'penBrush',\n        useAccent: true,\n        tabArr: (function () {\n            let result = [];\n\n            function createTab(keyStr) {\n                return {\n                    id: keyStr,\n                    image: KL.brushesUI[keyStr].image,\n                    title: KL.brushesUI[keyStr].tooltip,\n                    onOpen: function() {\n                        brushUiObj[keyStr].getElement().style.display = 'block';\n                        setCurrentBrush(keyStr);\n                        klColorSlider.pickingDone();\n                        brushSettingService.emitSliderConfig({\n                            sizeSlider: KL.brushesUI[keyStr].sizeSlider,\n                            opacitySlider: KL.brushesUI[keyStr].opacitySlider\n                        });\n                        sizeWatcher(brushUiObj[keyStr].getSize());\n                        brushSettingService.emitOpacity(brushUiObj[keyStr].getOpacity());\n                    },\n                    onClose: function() {\n                        brushUiObj[keyStr].getElement().style.display = 'none';\n                    }\n                };\n            }\n\n            let keyArr = Object.keys(brushUiObj);\n            for (let i = 0; i < keyArr.length; i++) {\n                result.push(createTab(keyArr[i]));\n            }\n            return result;\n        })()\n    });\n    brushDiv.appendChild(brushTabRow.getElement());\n    for (let b in KL.brushesUI) {\n        if (KL.brushesUI.hasOwnProperty(b)) {\n            brushDiv.appendChild(brushUiObj[b].getElement());\n        }\n    }\n\n    const handUi = new KL.HandUi({\n        scale: 1,\n        angleDeg: 0,\n        onReset: function() {\n            klCanvasWorkspace.resetView(true);\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\n        },\n        onFit: function() {\n            klCanvasWorkspace.fitView();\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\n        },\n        onAngleChange: function(angleDeg, isRelative) {\n            klCanvasWorkspace.setAngle(angleDeg, isRelative);\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\n        },\n    });\n\n    let fillUi = new KL.FillUi({\n        colorSlider: klColorSlider\n    });\n\n    let gradientUi = new KL.GradientUi({\n        colorSlider: klColorSlider\n    });\n\n    let textUi = new KL.TextUi({\n        colorSlider: klColorSlider\n    });\n\n    let shapeUi = new KL.ShapeUi({\n        colorSlider: klColorSlider\n    });\n\n    const gradientTool = new KL.GradientTool({\n        onGradient: (isDone, x1, y1, x2, y2, angleRad) => {\n            const layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\n            const settings = gradientUi.getSettings();\n            const gradientObj: IGradient = {\n                type: settings.type,\n                color1: klColorSlider.getColor(),\n                isReversed: settings.isReversed,\n                opacity: settings.opacity,\n                doLockAlpha: settings.doLockAlpha,\n                isEraser: settings.isEraser,\n                doSnap: keyListener.isPressed('shift') || settings.doSnap,\n                x1,\n                y1,\n                x2,\n                y2,\n                angleRad,\n            };\n\n            if (isDone) {\n                klCanvas.setComposite(layerIndex, null);\n                klCanvas.drawGradient(layerIndex, gradientObj);\n            } else {\n                klCanvas.setComposite(layerIndex, {\n                    draw: function(ctx) {\n                        KL.drawGradient(ctx, gradientObj);\n                    }\n                });\n            }\n            klCanvasWorkspace.requestFrame();\n        }\n    });\n\n    let shapeTool = new KL.ShapeTool({\n        onShape: function(isDone, x1, y1, x2, y2, angleRad) {\n\n            let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\n\n            let shapeObj: any = {\n                type: shapeUi.getShape(),\n                x1: x1,\n                y1: y1,\n                x2: x2,\n                y2: y2,\n                angleRad: angleRad,\n                isOutwards: shapeUi.getIsOutwards(),\n                opacity: shapeUi.getOpacity(),\n                isEraser: shapeUi.getIsEraser(),\n                doLockAlpha: shapeUi.getDoLockAlpha(),\n            };\n            if (shapeUi.getShape() === 'line') {\n                shapeObj.strokeRgb = klColorSlider.getColor();\n                shapeObj.lineWidth = shapeUi.getLineWidth();\n                shapeObj.isAngleSnap = shapeUi.getIsSnap() || keyListener.isPressed('shift');\n            } else {\n                shapeObj.isFixedRatio = shapeUi.getIsFixed() || keyListener.isPressed('shift');\n                if (shapeUi.getMode() === 'stroke') {\n                    shapeObj.strokeRgb = klColorSlider.getColor();\n                    shapeObj.lineWidth = shapeUi.getLineWidth();\n                } else {\n                    shapeObj.fillRgb = klColorSlider.getColor();\n                }\n            }\n\n            if (isDone) {\n                klCanvas.setComposite(layerIndex, null);\n                klCanvas.drawShape(layerIndex, shapeObj);\n            } else {\n                klCanvas.setComposite(layerIndex, {\n                    draw: function(ctx) {\n                        KL.drawShape(ctx, shapeObj);\n                    }\n                });\n            }\n            klCanvasWorkspace.requestFrame();\n\n        }\n    });\n\n    const layerManager = KL.klLayerManager(klCanvas, function (val) {\n        setCurrentLayer(klCanvas.getLayer(val));\n        klHistory.push({\n            tool: [\"misc\"],\n            action: \"focusLayer\",\n            params: [val]\n        });\n    }, klRootEl) as any;\n    const layerPreview = new KL.LayerPreview({\n        klRootEl: klRootEl,\n        onClick: function () {\n            mainTabRow.open('layers');\n        }\n    });\n    layerPreview.setIsVisible(uiHeight >= 579);\n    layerPreview.setLayer(klCanvas.getLayer(klCanvas.getLayerIndex(currentLayerCtx.canvas)));\n\n    const filterTab = new KL.FilterTab(\n        klRootEl,\n        klColorSlider,\n        layerManager,\n        // setCurrentLayer,\n        klCanvasWorkspace,\n        handUi,\n        () => { //get current color\n            return currentColor;\n        },\n        () => { // get max canvas size\n            return klMaxCanvasSize;\n        },\n        () => { // get kl canvas\n            return klCanvas;\n        },\n        () => { // get current layer ctx\n            return currentLayerCtx;\n        },\n        !!pOptions.embed,\n        statusOverlay,\n    );\n\n    const undoRedoCatchup = new KL.UndoRedoCatchup(\n        brushUiObj,\n        layerPreview,\n        layerManager,\n        handUi,\n        klCanvasWorkspace,\n        () => {\n            if (!initState) {\n                throw new Error('initState not initialized');\n            }\n            return initState;\n        },\n        () => klCanvas,\n        () => currentLayerCtx,\n        (clctx) => {\n            currentLayerCtx = clctx;\n        },\n        () => currentBrush,\n    );\n    klHistory.addListener((p) => {\n        undoRedoCatchup.catchup(p);\n    });\n\n    function showNewImageDialog() {\n        KL.newImageDialog({\n            currentColor: currentColor,\n            secondaryColor: klColorSlider.getSecondaryRGB(),\n            maxCanvasSize: klMaxCanvasSize,\n            canvasWidth: klCanvas.getWidth(),\n            canvasHeight: klCanvas.getHeight(),\n            workspaceWidth: window.innerWidth < collapseThreshold ? uiWidth : uiWidth - toolWidth,\n            workspaceHeight: uiHeight,\n            onConfirm: function(width, height, color) {\n                klCanvas.reset({\n                    width: width,\n                    height: height,\n                    color: color.a === 1 ? color : null\n                });\n\n                layerManager.update(0);\n                setCurrentLayer(klCanvas.getLayer(0));\n                klCanvasWorkspace.resetView();\n                handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\n\n                isFirstImage = false;\n            },\n            onCancel: function() {}\n        });\n    }\n\n    function shareImage(callback?) {\n        BB.shareCanvas({\n            canvas: klCanvas.getCompleteCanvas(1),\n            fileName: BB.getDate() + filenameBase + '.png',\n            title: BB.getDate() + filenameBase + '.png',\n            callback: callback ? callback : function() {}\n        });\n    }\n\n    const saveToComputer = new KL.SaveToComputer(\n        pOptions.saveReminder,\n        klRootEl,\n        () => exportType,\n        () => klCanvas,\n        filenameBase,\n    );\n\n    const fileTab = pOptions.embed ? null : new KL.FileTab(\n        klRootEl,\n        projectStore,\n        () => klCanvas.getProject(),\n        exportType,\n        (type) => {\n            exportType = type;\n        },\n        handleFileSelect,\n        () => {\n            saveToComputer.save();\n        },\n        showNewImageDialog,\n        shareImage,\n        () => { // on upload\n            KL.imgurUpload(klCanvas, klRootEl, pOptions.saveReminder, pOptions.app && pOptions.app.imgurKey ? pOptions.app.imgurKey : null, );\n        },\n        copyToClipboard,\n        pOptions.saveReminder,\n    );\n\n    const settingsTab = new KL.SettingsTab(\n        () => {\n            uiState = uiState === 'left' ? 'right' : 'left';\n            updateUi();\n            if (!pOptions.embed) {\n                LocalStorage.setItem('uiState', uiState);\n            }\n        },\n        pOptions.aboutEl\n    );\n\n    mainTabRow = new KL.TabRow({\n        initialId: 'draw',\n        tabArr: [\n            {\n                id: 'draw',\n                title: LANG('tool-brush'),\n                image: toolPaintImg,\n                onOpen: function() {\n                    if (currentBrushId === 'eraserBrush') {\n                        klColorSlider.enable(false);\n                    }\n                    BB.append(\n                        colorDiv,\n                        [klColorSlider.getElement(), klColorSlider.getOutputElement(), toolspaceStabilizerRow.getElement()]\n                    );\n                    brushDiv.style.display = 'block';\n                },\n                onClose: function() {\n                    brushDiv.style.display = 'none';\n                },\n                css: {\n                    minWidth: '45px',\n                }\n            },\n            {\n                id: 'hand',\n                title: LANG('tool-hand'),\n                image: toolHandImg,\n                isVisible: false,\n                onOpen: function() {\n                    handUi.setIsVisible(true);\n                },\n                onClose: function() {\n                    handUi.setIsVisible(false);\n                },\n                css: {\n                    minWidth: '45px',\n                }\n            },\n            {\n                id: 'fill',\n                title: LANG('tool-paint-bucket'),\n                image: toolFillImg,\n                isVisible: false,\n                onOpen: function() {\n                    klColorSlider.enable(true);\n                    fillUi.setIsVisible(true);\n                },\n                onClose: function() {\n                    fillUi.setIsVisible(false);\n                },\n                css: {\n                    minWidth: '45px',\n                }\n            },\n            {\n                id: 'gradient',\n                title: LANG('tool-gradient'),\n                image: toolGradientImg,\n                isVisible: false,\n                onOpen: function() {\n                    klColorSlider.enable(true);\n                    gradientUi.setIsVisible(true);\n                },\n                onClose: function() {\n                    gradientUi.setIsVisible(false);\n                },\n                css: {\n                    minWidth: '45px',\n                }\n            },\n            {\n                id: 'text',\n                title: LANG('tool-text'),\n                image: toolTextImg,\n                isVisible: false,\n                onOpen: function() {\n                    klColorSlider.enable(true);\n                    textUi.setIsVisible(true);\n                },\n                onClose: function() {\n                    textUi.setIsVisible(false);\n                },\n                css: {\n                    minWidth: '45px',\n                }\n            },\n            {\n                id: 'shape',\n                title: LANG('tool-shape'),\n                image: toolShapeImg,\n                isVisible: false,\n                onOpen: function() {\n                    klColorSlider.enable(true);\n                    shapeUi.setIsVisible(true);\n                },\n                onClose: function() {\n                    shapeUi.setIsVisible(false);\n                },\n                css: {\n                    minWidth: '45px',\n                }\n            },\n            {\n                id: 'layers',\n                title: LANG('tab-layers'),\n                image: tabLayersImg,\n                onOpen: function() {\n                    layerManager.update();\n                    layerManager.style.display = 'block';\n                },\n                onClose: function() {\n                    layerManager.style.display = 'none';\n                },\n                css: {\n                    minWidth: '45px',\n                }\n            },\n            {\n                id: 'edit',\n                label: LANG('tab-edit'),\n                onOpen: function() {\n                    filterTab.show();\n                },\n                onClose: function() {\n                    filterTab.hide();\n                },\n                css: {\n                    padding: '0 7px',\n                },\n            },\n            {\n                id: 'file',\n                label: LANG('tab-file'),\n                isVisible: !!fileTab,\n                onOpen: function() {\n                    if (!fileTab) {\n                        return;\n                    }\n                    fileTab.getElement().style.display = 'block';\n                    fileTab.setIsVisible(true);\n                },\n                onClose: function() {\n                    if (!fileTab) {\n                        return;\n                    }\n                    fileTab.getElement().style.display = 'none';\n                    fileTab.setIsVisible(false);\n                },\n                css: {\n                    padding: '0 7px',\n                },\n            },\n            {\n                id: 'settings',\n                title: LANG('tab-settings'),\n                image: tabSettingsImg,\n                onOpen: function() {\n                    settingsTab.getElement().style.display = 'block';\n                    // settingsTab.setIsVisible(true);\n                },\n                onClose: function() {\n                    settingsTab.getElement().style.display = 'none';\n                    // settingsTab.setIsVisible(false);\n                },\n                css: {\n                    minWidth: '45px',\n                }\n            }\n        ]\n    });\n    function updateMainTabVisibility() {\n        if (!mainTabRow) {\n            return;\n        }\n\n        let toolObj = {\n            'draw': {},\n            'hand': {},\n            'fill': {},\n            'gradient': {},\n            'text': {},\n            'shape': {}\n        };\n\n        let activeStr = toolspaceToolRow.getActive();\n        let oldTabId = mainTabRow.getOpenedTabId();\n\n        let keysArr = Object.keys(toolObj);\n        for (let i = 0; i < keysArr.length; i++) {\n            if (activeStr === keysArr[i]) {\n                mainTabRow.setIsVisible(keysArr[i], true);\n            } else {\n                mainTabRow.setIsVisible(keysArr[i], false);\n                if (oldTabId === keysArr[i]) {\n                    mainTabRow.open(activeStr);\n                }\n            }\n        }\n\n    }\n\n    function copyToClipboard(showCrop?) {\n        KL.clipboardDialog(klRootEl, klCanvas.getCompleteCanvas(1), function (inputObj) {\n            if (inputObj.left === 0 && inputObj.right === 0 && inputObj.top === 0 && inputObj.bottom === 0) {\n                return;\n            }\n            //do a crop\n            KL.filterLib.cropExtend.apply({\n                context: currentLayerCtx,\n                klCanvas: klCanvas,\n                input: inputObj, //{left,right,top,bottom}\n                history: klHistory\n            });\n            layerManager.update();\n            klCanvasWorkspace.resetView();\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\n        }, statusOverlay, showCrop);\n    }\n\n    const bottomBarWrapper = BB.el({\n        css: {\n            width: \"270px\",\n            position: \"absolute\",\n            bottom: '0',\n            left: '0'\n        },\n    });\n    if (pOptions.bottomBar) {\n        bottomBarWrapper.append(pOptions.bottomBar);\n        const observer = new MutationObserver(() => updateBottomBar());\n        observer.observe(\n            toolspaceInner,\n            {\n                attributes: true,\n                childList: true,\n                subtree: true,\n            }\n        );\n    }\n    function updateBottomBar() {\n        if (!pOptions.bottomBar) {\n            return;\n        }\n        const threshold = 617; //590\n        const isVisible = (\n            threshold < window.innerHeight &&\n            toolspaceInner.scrollHeight + 50 < window.innerHeight\n        );\n        bottomBarWrapper.style.display = isVisible ? '' : 'none';\n    }\n\n\n\n    BB.append(toolspaceInner, [\n        layerPreview.getElement(),\n        mainTabRow.getElement(),\n        brushDiv,\n        handUi.getElement(),\n        fillUi.getElement(),\n        gradientUi.getElement(),\n        textUi.getElement(),\n        shapeUi.getElement(),\n        layerManager,\n        filterTab.getElement(),\n        fileTab ? fileTab.getElement() : null,\n        settingsTab.getElement(),\n        BB.el({\n            css: {\n                height: '10px', // a bit of spacing at the bottom\n            }\n        }),\n        bottomBarWrapper ? bottomBarWrapper : null\n    ]);\n\n    const toolspaceScroller = new KL.ToolspaceScroller({\n        toolspace,\n        uiState,\n    });\n\n    // --- interface ---\n\n    this.getEl = () => {\n        return klRootEl;\n    };\n\n    this.resize = (w, h) => {\n\n        // iPad scrolls down when increasing text zoom\n        if (window.scrollY > 0) {\n            window.scrollTo(0, 0);\n        }\n\n        if (uiWidth === Math.max(0, w) && uiHeight === Math.max(0, h)) {\n            return;\n        }\n\n        uiWidth = Math.max(0, w);\n        uiHeight = Math.max(0, h);\n\n        updateCollapse();\n        updateBottomBar();\n\n        layerPreview.setIsVisible(uiHeight >= 579);\n        klColorSlider.setHeight(Math.max(163, Math.min(400, uiHeight - 505)));\n        toolspaceToolRow.setIsSmall(uiHeight < 540);\n    };\n\n    this.out = (msg) => {\n        statusOverlay.out(msg);\n    };\n\n    this.getPNG = function(): Blob {\n        return base64ToBlob(klCanvas.getCompleteCanvas(1).toDataURL('image/png'));\n    };\n\n    this.getPSD = async function() {\n        return await klCanvasToPsdBlob(klCanvas);\n    };\n\n    this.getProject = () => klCanvas.getProject();\n\n    this.swapUiLeftRight = () => {\n        uiState = uiState === 'left' ? 'right' : 'left';\n        if (!pOptions.embed) {\n            LocalStorage.setItem('uiState', uiState);\n        }\n        updateUi();\n    };\n\n    this.saveAsPsd = () => {\n        saveToComputer.save('psd');\n    };\n\n    this.isDrawing = () => {\n        return lineSanitizer.getIsDrawing() || klCanvasWorkspace.getIsDrawing();\n    };\n\n    // --- end interface ---\n\n    this.resize(uiWidth, uiHeight);\n    updateUi();\n\n    {\n        BB.addEventListener(window, 'resize', () => {\n            this.resize(window.innerWidth, window.innerHeight);\n        });\n        BB.addEventListener(window, 'orientationchange', () => {\n            this.resize(window.innerWidth, window.innerHeight);\n        });\n\n        // iPad doesn't trigger 'resize' event when using text zoom, although it's resizing the window.\n        // Workaround: place a div in the body that fills the window, and use a ResizeObserver\n        const windowResizeWatcher = BB.el({\n            parent: document.body,\n            css: {\n                position: 'fixed',\n                left: '0',\n                top: '0',\n                right: '0',\n                bottom: '0',\n                pointerEvents: 'none',\n                zIndex: '-1',\n                userSelect: 'none',\n            }\n        });\n        try {\n            // Not all browsers support ResizeObserver. Not critical though.\n            const observer = new ResizeObserver(() => this.resize(window.innerWidth, window.innerHeight));\n            observer.observe(windowResizeWatcher);\n        } catch (e) {\n            windowResizeWatcher.parentNode.removeChild(windowResizeWatcher);\n        }\n\n        // prevent ctrl scroll -> zooming page\n        BB.addEventListener(klRootEl, 'wheel', (event) => {\n            if (keyListener.isPressed('ctrl')) {\n                event.preventDefault();\n            }\n        });\n        //maybe prevent zooming on safari mac os - todo still needed?\n        const prevent = (e) => {\n            e.preventDefault();\n        }\n        window.addEventListener('gesturestart', prevent);\n        window.addEventListener('gesturechange', prevent);\n        window.addEventListener('gestureend', prevent);\n    }\n}","import {DecoyKlHistory, klHistory} from './history/kl-history';\nimport {Popup, popup} from './ui/modals/popup';\nimport {dialogCounter} from './ui/modals/modal-count';\nimport {Checkbox} from './ui/base-components/checkbox';\nimport {input} from './ui/base-components/input';\nimport {Select} from './ui/base-components/select';\nimport {ImageToggle} from './ui/base-components/image-toggle';\nimport {ImageRadioList} from './ui/base-components/image-radio-list';\nimport {penPressureToggle} from './ui/base-components/pen-pressure-toggle';\nimport {KlSlider} from './ui/base-components/kl-slider';\nimport {calcSliderFalloffFactor} from './ui/base-components/slider-falloff';\nimport {HexColorDialog} from './ui/modals/color-slider-hex-dialog';\nimport {KlColorSlider} from './ui/base-components/kl-color-slider';\nimport {KlSmallColorSlider} from './ui/base-components/kl-color-slider-small';\nimport {PointSlider} from './ui/base-components/point-slider';\nimport {ColorOptions} from './ui/base-components/color-options';\nimport {Options} from './ui/base-components/options';\nimport {StatusOverlay} from './ui/components/status-overlay';\nimport {exportDialog} from './ui/modals/export-dialog-deprecated';\nimport {CropCopy} from './ui/components/crop-copy';\nimport {clipboardDialog} from './ui/modals/clipboard-dialog';\nimport {klLayerManager} from './ui/tool-tabs/kl-layer-manager';\nimport {WorkspaceSvgOverlay} from './canvas-ui/workspace-svg-overlay';\nimport {KlCanvasWorkspace} from './canvas-ui/kl-canvas-workspace';\nimport {KlCanvasPreview} from './canvas-ui/canvas-preview';\nimport {FreeTransform} from './ui/components/free-transform';\nimport {FreeTransformCanvas} from './ui/components/free-transform-canvas';\nimport {Cropper} from './ui/components/cropper';\nimport {LayerPreview} from './ui/components/layer-preview';\nimport {FittedImage} from './ui/components/fitted-image';\nimport {showImportAsLayerDialog} from './ui/modals/show-import-as-layer-dialog';\nimport {KlImageDropper} from './ui/components/kl-image-dropper';\nimport {OverlayToolspace} from './ui/components/overlay-toolspace';\nimport {ToolspaceTopRow} from './ui/components/toolspace-top-row';\nimport {ToolDropdown} from './ui/components/tool-dropdown';\nimport {ToolspaceToolRow} from './ui/components/toolspace-tool-row';\nimport {ToolspaceStabilizerRow} from './ui/components/toolspace-stabilizer-row';\nimport {TabRow} from './ui/components/tab-row';\nimport {HandUi} from './ui/tool-tabs/hand-ui';\nimport {FillUi} from './ui/tool-tabs/fill-ui';\nimport {TextUi} from './ui/tool-tabs/text-ui';\nimport {ShapeUi} from './ui/tool-tabs/shape-ui';\nimport {newImageDialog} from './ui/modals/new-image-dialog';\nimport {ToolspaceCollapser} from './ui/components/toolspace-collapser';\nimport {renderText} from './image-operations/render-text';\nimport {textToolDialog} from './ui/modals/text-tool-dialog';\nimport {showImportImageDialog} from './ui/modals/show-import-image-dialog';\nimport {floodFillBits} from './image-operations/flood-fill';\nimport * as PSD from './storage/psd';\nimport {drawShape, ShapeTool} from './image-operations/shape-tool';\nimport {KlCanvas} from './canvas/kl-canvas';\nimport * as indexedDb from './storage/indexed-db';\nimport {filterLib, filterLibStatus} from './filters/filters';\nimport {brushes} from './brushes/brushes';\nimport {brushesUI} from './brushes-ui/brushes-ui';\nimport {showIframePopup} from './ui/modals/show-iframe-popup';\nimport {RadioList} from './ui/base-components/radio-list';\nimport {BrowserStorageUi} from './ui/components/browser-storage-ui';\nimport {drawProject} from './canvas/draw-project';\nimport {ProjectStore} from './storage/project-store';\nimport {FileTab} from \"./ui/tool-tabs/file-tab\";\nimport {FilterTab} from \"./ui/tool-tabs/filter-tab\";\nimport {imgurUpload} from \"./ui/modals/imgur-upload\";\nimport {loadAgPsd} from \"./storage/ag-psd-wrapper\";\nimport {SaveReminder} from \"./ui/components/save-reminder\";\nimport {SaveToComputer} from \"./storage/save-to-computer\";\nimport {UndoRedoCatchup} from \"./history/undo-redo-catchup\";\nimport {setDbName} from './storage/indexed-db';\nimport {BrushSettingService} from './brushes-ui/brush-setting-service';\nimport {BoxToggle} from './ui/base-components/box-toggle';\nimport {SettingsTab} from './ui/tool-tabs/settings-tab';\nimport {ToolspaceScroller} from './ui/components/toolspace-scroller';\nimport {GradientUi} from './ui/tool-tabs/gradient-ui';\nimport {drawGradient, GradientTool} from './image-operations/gradient-tool';\n\n/**\n * paint tool functionality\n */\nexport const KL = {\n\n    // --- brushes ---\n    brushes,\n    brushesUI,\n    BrushSettingService,\n\n    // --- canvas ---\n    KlCanvas,\n    drawProject,\n\n    // --- canvas ui ---\n    WorkspaceSvgOverlay,\n    KlCanvasWorkspace,\n    KlCanvasPreview,\n\n    // --- filters ---\n    filterLibStatus,\n    filterLib,\n\n    // --- history ---\n    UndoRedoCatchup,\n\n    // --- image operations ---\n    renderText,\n    floodFillBits,\n    ShapeTool,\n    drawShape,\n    GradientTool,\n    drawGradient,\n\n    // --- storage ---\n    PSD,\n    setDbName,\n    indexedDb,\n    ProjectStore,\n    loadAgPsd,\n    SaveToComputer,\n\n    // --- ui - base components ---\n    calcSliderFalloffFactor,\n    Checkbox,\n    input,\n    Select,\n    ImageToggle,\n    ImageRadioList,\n    RadioList,\n    penPressureToggle,\n    KlSlider,\n    HexColorDialog,\n    KlColorSlider,\n    KlSmallColorSlider,\n    PointSlider,\n    ColorOptions,\n    Options,\n    BoxToggle,\n\n    // --- ui - components ---\n    StatusOverlay,\n    CropCopy,\n    FreeTransform,\n    FreeTransformCanvas,\n    Cropper,\n    LayerPreview,\n    FittedImage,\n    KlImageDropper,\n    OverlayToolspace,\n    ToolspaceTopRow,\n    ToolDropdown,\n    ToolspaceToolRow,\n    ToolspaceStabilizerRow,\n    TabRow,\n    ToolspaceCollapser,\n    BrowserStorageUi,\n    SaveReminder,\n    ToolspaceScroller,\n\n    // --- ui - modals ---\n    dialogCounter,\n    popup,\n    Popup,\n    exportDialog,\n    clipboardDialog,\n    showImportAsLayerDialog,\n    newImageDialog,\n    textToolDialog,\n    showImportImageDialog,\n    showIframePopup,\n    imgurUpload,\n\n    // --- ui - tool tabs ---\n    HandUi,\n    FillUi,\n    GradientUi,\n    TextUi,\n    ShapeUi,\n    FileTab,\n    FilterTab,\n    SettingsTab,\n    klLayerManager,\n\n\n    klHistory,\n    DecoyKlHistory,\n};","\nexport interface IHistoryEntry {\n    tool: string[];\n    action?: string;\n    params?: any[];\n\n    actions?: {\n        action: string;\n        params: any[];\n    }[]\n}\n\nexport interface IHistoryBroadcast {\n    bufferUpdate: IHistoryEntry;\n}\n\nexport type IHistoryListener = (p: IHistoryBroadcast | null) => void;\n\nlet historyInstance: boolean = false;\n\nexport interface KlHistoryInterface {\n    pause (b: boolean): void;\n    addListener (l: IHistoryListener): void;\n    push (e: IHistoryEntry): void;\n    undo (): (IHistoryEntry | null)[];\n    redo (): (IHistoryEntry | null)[];\n    getAll (): (IHistoryEntry | null)[];\n    canRedo (): boolean;\n    canUndo (): boolean;\n    getState (): number;\n    getActionNumber (): number;\n}\n\nexport class DecoyKlHistory implements KlHistoryInterface {\n    pause (b: boolean): void {}\n    addListener (l: IHistoryListener): void {}\n    push (e: IHistoryEntry): void {}\n    undo (): (IHistoryEntry | null)[] { return []; }\n    redo (): (IHistoryEntry | null)[] { return []; }\n    getAll (): (IHistoryEntry | null)[] { return []; }\n    canRedo (): boolean { return false; }\n    canUndo (): boolean { return false; }\n    getState (): number { return 0; }\n    getActionNumber (): number { return 0; }\n}\n\nexport class KlHistory implements KlHistoryInterface {\n\n    private state: number; // on .push state increments by one\n    private dataArr: (IHistoryEntry | null)[]; // null if beyond max undo to trigger garbage collection\n    private listeners: IHistoryListener[];\n    private pauseStack: number; // how often paused without unpause\n    private readonly max: number = 20; // max number undo steps\n    private maxState: number; // can't go backwards -> max state is the buffer image(klCanvas)\n    private actionNumber: number; // current action the user is on. untouched document = -1 because dataArr.length is 0\n    \n    private broadcast (p: IHistoryBroadcast | null): void {\n        setTimeout(() => {\n            for (let i = 0; i < this.listeners.length; i++) {\n                this.listeners[i](p);\n            }\n            this.state++;\n        }, 1);\n    }\n    \n    // ---- public ----\n    \n    constructor () {\n        if (historyInstance) {\n            throw new Error('klHistory already instantiated');\n        }\n        historyInstance = true;\n        this.state = 0;\n        this.dataArr = [];\n        this.listeners = [];\n        this.pauseStack = 0;\n        this.maxState = -1;\n        this.actionNumber = -1;\n    }\n\n    /**\n     * you need pause because there are sometimes actions that would cause other\n     * undo steps\n     * for example a filter that does something crazy with two layers and then merges them\n     * you want that to be one undo step, and prevent merging from causing its undo step.\n     * so while that filter is doing its magic you should pause possible undo steps that\n     * are caused by a part of its code(in this example: merging layers)\n     *\n     * @param b\n     */\n    pause (b: boolean): void {\n        if (b === false) {\n            this.pauseStack = Math.max(0, this.pauseStack - 1);\n        } else {\n            this.pauseStack++;\n        }\n    }\n\n    addListener (l: IHistoryListener): void {\n        this.listeners.push(l);\n    }\n\n    push (e: IHistoryEntry): void {\n        if (this.pauseStack > 0) {\n            return;\n        }\n        while (this.actionNumber < this.dataArr.length - 1) {\n            this.dataArr.pop();\n        }\n\n        //taking care of actions that shouldn't cause a new undo step\n        const top = this.dataArr[this.dataArr.length - 1];\n        if (e.action === 'layerOpacity' && top && top.action === 'layerOpacity' && top.params[0] === e.params[0]) {\n            this.dataArr[this.dataArr.length - 1] = e;\n            this.state++; //still needs to increment because something changed\n            return;\n        }\n        if (e.action === 'focusLayer' && top && top.action === 'focusLayer') {\n            this.dataArr[this.dataArr.length - 1] = e;\n            this.state++;\n            return;\n        }\n\n\n        this.dataArr[this.dataArr.length] = e;\n        this.actionNumber = this.dataArr.length - 1;\n        const maxBefore = this.maxState;\n        this.maxState = Math.max(this.maxState, this.actionNumber - this.max);\n        if (maxBefore < this.maxState) {\n            this.broadcast({bufferUpdate: this.dataArr[this.maxState]});\n        } else {\n            this.broadcast(null);\n        }\n        if (this.maxState >= 0) {\n            this.dataArr[this.maxState] = null; //to free some memory...imported images take a lot of space\n        }\n    }\n\n    undo (): (IHistoryEntry | null)[] {\n        let result;\n        if (this.canUndo()) {\n            result = [];\n            for (let i = this.maxState + 1; i < this.actionNumber; i++) {\n                result.push(this.dataArr[i]);\n            }\n            this.actionNumber--;\n            this.broadcast(null);\n        }\n\n        return result;\n    }\n\n    redo (): (IHistoryEntry | null)[] {\n        const result = [];\n        if (this.canRedo()) {\n            this.actionNumber++;\n            result.push(this.dataArr[this.actionNumber]);\n            this.broadcast(null);\n        }\n        return result;\n    }\n\n    getAll (): (IHistoryEntry | null)[] {\n        return [].concat(this.dataArr);\n    }\n\n    canRedo (): boolean {\n        return this.actionNumber < this.dataArr.length - 1;\n    }\n\n    canUndo (): boolean {\n        return this.actionNumber > this.maxState;\n    }\n\n    getState (): number {\n        return this.state;\n    }\n\n    /**\n     * actionNumber - number of undo-able actions a user has done (e.g. if drawn 5 lines total -> 5)\n     */\n    getActionNumber (): number {\n        return (this.actionNumber + 1);\n    }\n    \n}\n\nexport const klHistory = new KlHistory();\n","import {dialogCounter} from './modal-count';\nimport {BB} from '../../../bb/bb';\n// @ts-ignore\nimport checkImg from 'url:~/src/app/img/ui/check.svg';\n// @ts-ignore\nimport cancelImg from 'url:~/src/app/img/ui/cancel.svg';\nimport {LANG} from '../../../language/language';\nimport {IKeyString} from '../../../bb/bb.types';\n\nwindow.onscroll = (e) => {\n    e.preventDefault();\n}\n\nexport function popup (\n    p: {\n        target: HTMLElement;\n        div?: HTMLElement; // node with content\n        message: string; // can be html\n        callback?: (result: string) => void;\n        buttons?: string[]; // \"Ok\", and \"Cancel\" will be automatically translated\n        primaries?: string[];\n        type?: 'error' | 'warning' | 'upload' | 'ok'; // todo\n        closefunc?: (f: () => void) => void; // returns a function you can call to close (Cancel) the dialog\n        style?: IKeyString;\n        clickOnEnter?: string; // name of button - will be clicked if enter key pressed\n        autoFocus?: false | string; // name of  to automatically focus - default 'Ok' - false -> none\n        ignoreBackground?: boolean; // deafult false; if true clicking on background doesn't close\n    }\n): void {\n    dialogCounter.increase();\n    let isClosed = false;\n\n\n    // need this extra layer because chrome mobile otherwise scrolls the page and then glitches as the address bar goes away\n    const rootRootEl = BB.el({\n        parent: document.body,\n        css: {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n            right: '0',\n            bottom: '0',\n            overflow: 'hidden',\n        }\n    });\n    const rootEl = BB.el({\n        parent: rootRootEl,\n        className: 'kl-popup',\n    });\n\n    const scrollContent = BB.el({\n        parent: rootEl,\n        css: {\n            width: '100%',\n            minHeight: '100%',\n            // padding: '10px 0',\n            position: 'relative',\n            display: 'flex',\n            flexDirection: 'column',\n            justifyContent: 'center',\n            alignItems: 'center',\n        }\n    });\n\n    const bgEl = BB.el({\n        parent: scrollContent,\n        onClick: () => {\n            if (p.ignoreBackground) {\n                return;\n            }\n            close('Cancel');\n        },\n        css: {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n            zIndex: '0',\n            width: '100%',\n            height: '100%',\n        }\n    });\n\n    const titleHeight = 40;\n    const xButton = BB.el({\n        tagName: 'button',\n        className: 'popup-x',\n        content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\n        title: LANG('modal-close'),\n        onClick: () => {\n            close('Cancel');\n        },\n        css: {\n            width: titleHeight + 'px',\n            height: titleHeight + 'px',\n            lineHeight: titleHeight + 'px',\n            position: 'absolute',\n            right: '0',\n            top: '0',\n            background: 'none',\n            boxShadow: 'none',\n        }\n    });\n\n    const boxClasses = ['kl-popup-box'];\n    boxClasses.push('kl-popup-box--sm');\n    const boxEl = BB.el({\n        content: [\n            xButton,\n            BB.el({\n                content:p.message,\n                css: {\n                    marginBottom: p.div ? '10px' : null,\n                    marginRight: '15px',\n                }\n            }),\n            p.div,\n        ],\n        className: boxClasses.join(' '),\n        css: p.style ? p.style : null,\n    });\n\n    scrollContent.append(\n        BB.el({\n            css: {\n                flex: '0.5',\n            }\n        }),\n        boxEl,\n        BB.el({\n            css: {\n                flex: '1',\n            }\n        })\n    );\n\n    if (p.type === 'error') {\n        boxEl.classList.add('poperror');\n    }\n    if (p.type === 'ok') {\n        boxEl.classList.add('popok');\n    }\n    if (p.type === 'warning') {\n        boxEl.classList.add('popwarning');\n    }\n    if (p.type === 'upload') {\n        boxEl.classList.add('popupload');\n    }\n\n    const keyListener = new BB.KeyListener({\n        onDown: function(keyStr, e, comboStr) {\n            if (isClosed) {\n                return;\n            }\n            if (clickOnEnterBtn && comboStr === 'enter' && !BB.isInputFocused()) {\n                e.stopPropagation();\n                setTimeout(function() {\n                    clickOnEnterBtn.click();\n                }, 10);\n            }\n            if (comboStr === 'esc') {\n                e.stopPropagation();\n                close('Cancel');\n            }\n        }\n    });\n    // prevent ctrl scroll -> zooming page\n    const wheelPrevent = (event) => {\n        if (keyListener.isPressed('ctrl')) {\n            event.preventDefault();\n        }\n    };\n    BB.addEventListener(rootEl, 'wheel', wheelPrevent);\n    rootEl.onclick = BB.handleClick;\n\n    let autoFocus = null;\n    if (p.autoFocus) {\n        autoFocus = p.autoFocus;\n    } else if (p.autoFocus === false) {\n        autoFocus = null;\n    } else {\n        autoFocus = 'Ok';\n    }\n\n    const buttonRowEl = p.buttons && p.buttons.length > 0 ? BB.el({\n        parent: boxEl,\n        css: {\n            display: 'flex',\n            flexWrap: 'wrap',\n            justifyContent: 'flex-end',\n            marginTop: '12px', // 8px already via buttons\n            marginLeft: '-8px',\n        }\n    }) : null;\n    let clickOnEnterBtn;\n    const btnElArr = [];\n    if (p.buttons) {\n        p.buttons.forEach(buttonName => {\n            const btnClasses = ['kl-popup__btn'];\n            if (buttonName === 'Ok' || (p.primaries && p.primaries.includes(buttonName))) {\n                btnClasses.push('kl-button-primary');\n            }\n            let iconUrl;\n            let label = buttonName;\n            if (buttonName === 'Ok') {\n                label = LANG('modal-ok');\n                iconUrl = checkImg;\n            }\n            if (buttonName === 'Cancel') {\n                label = LANG('modal-cancel');\n                iconUrl = cancelImg;\n            }\n            let iconImg = null;\n            if (iconUrl) {\n                iconImg = BB.el({\n                    tagName: 'img',\n                    custom: {\n                        src: iconUrl,\n                        height: '17',\n                    }\n                });\n            }\n            const btn = BB.el({\n                parent: buttonRowEl,\n                tagName: 'button',\n                className: btnClasses.join(' '),\n                content: [iconImg, label],\n                onClick: () => {\n                    close(buttonName);\n                },\n            });\n            btnElArr.push(btn);\n            if (autoFocus === buttonName) {\n                setTimeout(() => {\n                    btn.focus();\n                    rootEl.scrollTo(0, 0);\n                }, 10);\n                setTimeout(() => {\n                    // safari needs a separate timeout\n                    rootEl.scrollTo(0, 0);\n                }, 20);\n            }\n            if (buttonName === p.clickOnEnter) {\n                clickOnEnterBtn = btn;\n            }\n        });\n    }\n\n    function close (value: string) {\n        if (isClosed) {\n            return;\n        }\n\n        isClosed = true;\n        BB.clearSelection();\n        BB.unfocusAnyInput();\n        document.body.removeChild(rootRootEl);\n        dialogCounter.decrease();\n        BB.destroyEl(xButton);\n        BB.destroyEl(bgEl);\n        keyListener.destroy();\n        BB.removeEventListener(rootEl, 'wheel', wheelPrevent);\n        rootEl.onclick = null;\n        btnElArr.forEach(item => {\n            BB.destroyEl(item);\n        });\n        btnElArr.splice(0, btnElArr.length);\n\n        if (p.callback) {\n            p.callback(value);\n        }\n    }\n\n    if (p.closefunc) {\n        p.closefunc(function () {\n            close('Cancel');\n        });\n    }\n\n}\n\n\n/**\n * popups that fill whole height, with some padding.\n * currently only used for iframe popups.\n *\n * p = {\n *      title: DOM Element | string, // optional (todo allow string)\n *      icon: 'ok', // optional todo\n *      content: DOM Element, // optional\n *      buttonArr: [ // optional todo\n *          'Ok',\n *          'Cancel'\n *      ],\n *      autoFocus: string | false, //todo\n *      clickOnEnter: string, //todo\n *      onClose: function(result: string), // optional (todo result)\n *\n *      //size and position\n *      width: 500,\n *      isMaxHeight: boolean //todo, currently always true\n * }\n *\n * @param p\n * @constructor\n */\nexport const Popup = function(p) {\n    dialogCounter.increase();\n    const parent = document.body;\n    const div = BB.el({\n        parent: parent,\n        className: 'g-root',\n        css: {\n            position: 'fixed',\n            left: '0',\n            top: '0',\n            bottom: '0',\n            right: '0',\n            background: 'rgba(0, 0, 0, 0.45)',\n            overflow: 'auto',\n            animationName: 'consoleIn',\n            animationDuration: '0.3s',\n            animationTimingFunction: 'ease-out'\n        }\n    });\n    div.onclick = BB.handleClick;\n\n    let updateInterval;\n\n    function close() {\n        dialogCounter.decrease();\n        div.onclick = null;\n        parent.removeChild(div);\n        clearInterval(updateInterval);\n        window.removeEventListener('resize', updatePos);\n        keyListener.destroy();\n        BB.destroyEl(xButton);\n        BB.destroyEl(bgEl);\n        if (p.onClose) {\n            p.onClose();\n        }\n    }\n\n    //background element registering clicks\n    const bgEl = BB.el({\n        parent: div,\n        css: {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n            bottom: '0',\n            right: '0'\n        },\n        onClick: close\n    });\n\n    //the actual popup box\n    const popupEl = BB.el({\n        parent: div,\n        css: {\n            position: 'absolute',\n            width: (BB.isCssMinMaxSupported() ?\n                'min(calc(100% - 40px), ' + (p.width ? p.width : 400) + 'px)' :\n                (p.width ? p.width : 400) + 'px'),\n            height: 'calc(100% - 40px)',\n            background: '#eee',\n            borderRadius: '10px',\n            overflow: 'hidden',\n            boxShadow: 'rgba(0, 0, 0, 0.25) 0px 5px 60px'\n        }\n    });\n\n    //x and y position via script. flex not powerful enough imo\n    function updatePos() {\n        const elW = popupEl.offsetWidth;\n        const elH = popupEl.offsetHeight;\n\n        BB.css(popupEl, {\n            left: Math.max(0, (window.innerWidth - elW) / 2) + 'px',\n            top: Math.max(20, (window.innerHeight - elH) / 2 - (elH * 0.20)) + 'px'\n        });\n    }\n    //todo also update when popup changes size - resizeobserver and fallback\n    //updateInterval = setInterval(updatePos, 100);\n    updatePos();\n    window.addEventListener('resize', updatePos);\n\n    //title row in popup\n    const titleHeight = 40;\n    const titleEl = BB.el({\n        parent: popupEl,\n        css: {\n            height: titleHeight + 'px',\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'center',\n            paddingLeft: (titleHeight / 2) + 'px'\n        }\n    });\n    if (p.title) {\n        titleEl.appendChild(p.title);\n    }\n    const xButton = BB.el({\n        parent: titleEl,\n        tagName: 'button',\n        className: 'popup-x',\n        content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\n        title: LANG('modal-close'),\n        onClick: close,\n        css: {\n            width: titleHeight + 'px',\n            height: titleHeight + 'px',\n            lineHeight: titleHeight + 'px',\n            background: 'none',\n            boxShadow: 'none',\n        },\n        custom: {\n            tabindex: '0',\n        }\n    });\n\n    const contentEl = BB.el({\n        parent: popupEl,\n        css: {\n            height: 'calc(100% - ' + titleHeight + 'px)'\n        }\n    });\n    if (p.content) {\n        contentEl.appendChild(p.content);\n    }\n\n    const keyListener = new BB.KeyListener({\n        onDown: function(keyStr, e) {\n            if (keyStr === 'esc') {\n                e.stopPropagation();\n                close();\n            }\n        }\n    });\n\n\n    // --- interface ---\n    this.close = function() {\n        close();\n    };\n};","\n// not the best\n\n/**\n * how many modals are open\n */\n\nexport class DialogCounter {\n    private listeners: ((v: number) => void)[] = [];\n    private count = 0;\n\n    private emit (): void {\n        this.listeners.forEach(item => {\n            item(this.count);\n        });\n    }\n\n    increase (v?: number): void {\n        if (v !== undefined) {\n            this.count += v;\n        } else {\n            this.count++;\n        }\n        this.emit();\n    }\n    decrease (v?: number): void {\n        if (v !== undefined) {\n            this.count -= v;\n        } else {\n            this.count--;\n        }\n        this.emit();\n    }\n    get (): number {\n        return this.count;\n    }\n    subscribe (listener: (v: number) => void): void {\n        this.listeners.push(listener);\n    }\n}\n\nexport const dialogCounter = new DialogCounter();\n","import * as BBEventListener from './input/event-listener';\nimport {\n    append, centerWithin, copyObj, createSvg,\n    css, dateDayDifference, decToFraction,\n    fitInto, gcd, getDate,\n    handleClick, imageBlobToUrl,\n    insertAfter, loadImage,\n    reduce,\n    setAttributes, shareCanvas\n} from './base/base';\nimport {\n    canShareFiles,\n    eventUsesHighResTimeStamp,\n    getVisitor,\n    hasPointerEvents,\n    hasWebGl,\n    isCssMinMaxSupported,\n    mouseEventHasMovement\n} from './base/browser';\nimport {KeyListener, sameKeys} from './input/key-listener';\nimport {PointerListener} from './input/pointer-listener';\nimport * as EventChain from './input/event-chain';\nimport {\n    canvasBounds,\n    convertToAlphaChannelCanvas,\n    copyCanvas,\n    createCheckerCanvas, createCheckerDataUrl,\n    drawTransformedImageOnCanvas,\n    drawTransformedImageWithBounds, freeCanvas, resizeCanvas, testShouldPixelate\n} from './base/canvas';\nimport {Matrix} from './math/matrix';\nimport {Vec2} from './math/vec2';\nimport {BezierLine, PointLine, projectPointOnLine, quadraticSplineInput, SplineInterpolator} from './math/line';\nimport {CMYK, ColorConverter, HSV, RGB, testIsWhiteBestContrast} from './color/color';\nimport {\n    appendTextDiv,\n    clearSelection,\n    destroyEl,\n    el,\n    isInputFocused,\n    makeUnfocusable,\n    unfocusAnyInput\n} from './base/ui';\nimport {\n    pointsToAngleDeg,\n    clamp,\n    dist,\n    mix,\n    pointsToAngleRad,\n    rotate,\n    rotateAround,\n    intDxy,\n    roundEven, roundUneven, distSquared, lenSquared, updateBounds, boundsInArea, round, isInsideRect\n} from './math/math';\nimport {createCanvas} from './base/create-canvas';\nimport {BbLog} from './base/bb-log';\nimport {LocalStorage} from './base/local-storage';\n\nexport const BB = {\n\n    // ---- browser ----\n    eventUsesHighResTimeStamp,\n    mouseEventHasMovement,\n    hasPointerEvents,\n    hasWebGl,\n    getVisitor,\n    isCssMinMaxSupported,\n    canShareFiles,\n\n    // ---- base ----\n    insertAfter,\n    loadImage,\n    css,\n    setAttributes,\n    append,\n    fitInto,\n    centerWithin,\n    getDate,\n    gcd,\n    reduce,\n    decToFraction,\n    imageBlobToUrl,\n    dateDayDifference,\n    copyObj,\n    shareCanvas,\n    handleClick,\n    createSvg,\n    BbLog,\n    LocalStorage,\n\n    // ---- math ----\n    mix,\n    dist,\n    distSquared,\n    lenSquared,\n    pointsToAngleRad,\n    pointsToAngleDeg,\n    isInsideRect,\n    clamp,\n    rotate,\n    rotateAround,\n    Matrix,\n    Vec2,\n    intDxy,\n    roundEven,\n    roundUneven,\n    round,\n    updateBounds,\n    boundsInArea,\n\n    // ---- line ----\n    projectPointOnLine,\n    PointLine,\n    BezierLine,\n    SplineInterpolator,\n    quadraticSplineInput,\n\n    // ---- canvas ----\n    canvas: createCanvas,\n    copyCanvas,\n    testShouldPixelate,\n    drawTransformedImageWithBounds,\n    drawTransformedImageOnCanvas,\n    createCheckerCanvas,\n    createCheckerDataUrl,\n    resizeCanvas,\n    convertToAlphaChannelCanvas,\n    freeCanvas,\n    canvasBounds,\n\n    // ---- color ----\n    HSV,\n    RGB,\n    CMYK,\n    ColorConverter,\n    testIsWhiteBestContrast,\n\n    // ---- UI ----\n    appendTextDiv,\n    clearSelection,\n    makeUnfocusable,\n    el,\n    destroyEl,\n    isInputFocused,\n    unfocusAnyInput,\n\n\n    // ---- events / input ----\n\n    addEventListener: BBEventListener.addEventListener,\n    removeEventListener: BBEventListener.removeEventListener,\n    setEventListener: BBEventListener.setEventListener,\n\n    KeyListener,\n    PointerListener,\n    sameKeys,\n\n    EventChain,\n\n};\n","import {hasPointerEvents} from '../base/browser';\n\nconst listenerFuncObj = {}; // for debugging\n\nexport const setEventListener = function (DomEl, type, listener) {\n    if (!hasPointerEvents) {\n        type = type.replace('pointer', 'mouse');\n    }\n    DomEl[type] = listener;\n};\n\nexport const addEventListener = function (DomEl, type, listener, options?) {\n    if (!hasPointerEvents) {\n        type = type.replace('pointer', 'mouse');\n    }\n    /*if (!(type in listenerFuncObj)) {\n        listenerFuncObj[type] = [];\n    }\n    listenerFuncObj[type].push(listener);*/\n    DomEl.addEventListener(type, listener, options);\n};\n\nexport const removeEventListener = function (DomEl, type, listener, options?) {\n    if (!hasPointerEvents) {\n        type = type.replace('pointer', 'mouse');\n    }\n    /*if (type in listenerFuncObj) {\n        for (let i = 0; i < listenerFuncObj[type].length; i++) {\n            if (listenerFuncObj[type][i] === listener) {\n                listenerFuncObj[type].splice(i, 1);\n                i--;\n            }\n        }\n    }*/\n    DomEl.removeEventListener(type, listener, options);\n};","import {createCanvas} from './create-canvas';\n\nexport const isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\n\nexport const eventUsesHighResTimeStamp = (function() {\n\n    let eventUsesHighResTimeStamp: boolean | null = null;\n    if (document.body) {\n        (function() {\n            const event = new Event('');\n            eventUsesHighResTimeStamp = event.timeStamp < 1000 * 60 * 60;\n        })();\n    } else {\n        window.addEventListener('DOMContentLoaded', function(event) {\n            eventUsesHighResTimeStamp = event.timeStamp < 1000 * 60 * 60;\n        });\n    }\n\n    return function(): boolean {\n        if (eventUsesHighResTimeStamp === null) {\n            throw 'eventUsesHighResTimeStamp not initialized';\n        }\n        return eventUsesHighResTimeStamp;\n    }\n})();\n\nexport const mouseEventHasMovement = (() => {\n\n    // no support: IE, Safari, Safari iOS\n    // supported but broken: Firefox\n\n    if (!('MouseEvent' in window)) {\n        return false;\n    }\n    let mouseEvent;\n    try {\n        mouseEvent = new MouseEvent('mousemove'); // browsers not supporting the constructor don't have it\n    } catch (e) {\n        return false;\n    }\n    if (!('movementX' in mouseEvent)) {\n        return false; // likely safari\n    }\n    return !isFirefox;\n})();\n\nexport const hasPointerEvents = !!window.PointerEvent;\n\nexport const hasWebGl = (function() {\n\n    const hasWebgl = (function() {\n        const canvas = createCanvas();\n        try {\n            canvas.getContext('experimental-webgl', { premultipliedAlpha: false });\n            return true;\n        } catch (e) {\n            return false;\n        }\n    })();\n\n    return function() {\n        return hasWebgl;\n    }\n})();\n\nexport const getVisitor = (function () {\n    const visitor = {\n        chrome: false,\n        gl: false\n    };\n    //Chrome\n    if ((window as any).chrome && (window as any).chrome.app) {\n        visitor.chrome = true;\n    }\n    //WebGL\n    visitor.gl = hasWebGl();\n    return function () {\n        return JSON.parse(JSON.stringify(visitor));\n    }\n})();\n\nexport const isCssMinMaxSupported = (function() {\n    let result: boolean | null = null;\n\n    function test() {\n        const div = document.createElement('div');\n        div.style.position = 'absolute';\n        div.style.top = '0';\n        div.style.left = 'max(0px, 25px)';\n        document.body.appendChild(div);\n        setTimeout(function() {\n            result = div.offsetLeft === 25;\n            document.body.removeChild(div);\n        }, 25);\n    }\n\n    if (document.body) {\n        test();\n    } else {\n        window.addEventListener('DOMContentLoaded', function() {\n            test();\n        });\n    }\n\n    return function(): boolean {\n        if (result === null) {\n            throw new Error('isCssMinMaxSupported not initialized');\n        }\n        return result;\n    };\n})();\n\nexport const canShareFiles = function(): boolean {\n    return 'share' in navigator && 'canShare' in navigator;\n};","/*window['canvases'] = [];\n\nwindow['printCanvases'] = () => {\n    let total = 0;\n\n    console.log(window['canvases'].map(item => {\n        total += item.width * item.height;\n        return {w: item.width, h: item.height};\n    }));\n\n    console.log('total: ' + (total * 4 / 1000 / 1000) + 'mb');\n};*/\n\nexport function createCanvas(w?: number, h?: number): HTMLCanvasElement {\n    const result = document.createElement('canvas');\n    if (w && h) {\n        result.width = w;\n        result.height = h;\n    }\n    // window['canvases'].push(result);\n    return result;\n}","import {IKeyString, ISize2D, ISVG, IVector2D} from '../BB.types';\n\nexport function insertAfter (referenceNode: Element, newNode: Element): void {\n    if (referenceNode.parentNode) {\n        referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\n    }\n}\n\nexport function loadImage (im: HTMLImageElement, callback: () => void): void {\n    let counter = 0;\n\n    function check() {\n        if (counter === 1000) {\n            alert(\"couldn't load\");\n            return;\n        }\n        if (im.complete) {\n            counter++;\n            callback();\n        } else {\n            setTimeout(check, 1);\n        }\n    }\n\n    check();\n}\n\nexport function css (el: HTMLElement | SVGElement, styleObj: IKeyString): void {\n    const keyArr = Object.keys(styleObj);\n    let keyStr: string;\n    const style = (el.style as unknown) as IKeyString;\n    for (let i = 0; i < keyArr.length; i++) {\n        keyStr = keyArr[i];\n        style[keyStr] = styleObj[keyStr];\n        style.alignContent = 'true';\n        if (keyStr === 'userSelect') {\n            style.webkitUserSelect = styleObj[keyStr]; // safari\n        }\n    }\n}\n\nexport function setAttributes (el: HTMLElement, attrObj: IKeyString): void {\n    const keyArr = Object.keys(attrObj);\n    let keyStr;\n    for (let i = 0; i < keyArr.length; i++) {\n        keyStr = keyArr[i];\n        el.setAttribute(keyStr, attrObj[keyStr]);\n    }\n}\n\n/**\n * appendChild with an array\n * @param target\n * @param els\n */\nexport function append(target: HTMLElement, els: (HTMLElement | string | null)[]) {\n    const fragment = document.createDocumentFragment();\n    els.forEach(item => item ? fragment.append(item) : null);\n    target.append(fragment);\n}\n\n/**\n * a needs to fit into b\n * @param aw\n * @param ah\n * @param bw\n * @param bh\n * @param min\n */\nexport function fitInto (aw: number, ah: number, bw: number, bh: number, min?: number): ISize2D {\n    let width = aw * bw, height = ah * bw;\n    if (width > bw) {\n        height = bw / width * height;\n        width = bw;\n    }\n    if (height > bh) {\n        width = bh / height * width;\n        height = bh;\n    }\n    if (min) {\n        width = Math.max(min, width);\n        height = Math.max(min, height);\n    }\n    return {width, height};\n}\n\n/**\n * center b in a\n * @param aw\n * @param ah\n * @param bw\n * @param bh\n */\nexport function centerWithin (aw: number, ah: number, bw: number, bh: number): IVector2D {\n    return {\n        x: aw / 2 - bw / 2,\n        y: ah / 2 - bh / 2\n    };\n}\n\nexport function getDate (): string {\n    const date = new Date();\n    const year = date.getFullYear();\n    const month = (date.getMonth() + 1).toString().padStart(2, '0');\n    const day = date.getDate().toString().padStart(2, '0');\n    const minutes = (date.getHours() * 60 + date.getMinutes()).toString(36).padStart(3, '0');\n\n    return year + '_' + month + '_' + day + '_' + minutes + '_';\n}\n\nexport function gcd (a: number, b: number): number {\n    return b ? gcd(b, a % b) : a;\n}\n\nexport function reduce (numerator: number, denominator: number): [number, number] {\n    const g = gcd(numerator, denominator);\n    return [numerator / g, denominator / g];\n}\n\nexport function decToFraction (decimalNumber: number): [number, number] {\n    const len = decimalNumber.toString().length - 2;\n    const denominator = Math.pow(10, len);\n    const numerator = decimalNumber * denominator;\n    return reduce(numerator, denominator);\n}\n\n/**\n * blobObj isn't always a Blob, but rather an object, because Blob doesn't exist.\n * @param blobObj\n * @returns {string}\n */\nexport function imageBlobToUrl(blobObj: Blob): string {\n    if (!blobObj) {\n        throw new Error('blobObj is undefined or null');\n    }\n    if (window.Blob && blobObj instanceof Blob) {\n        return URL.createObjectURL(blobObj); // object url\n    } else if (blobObj.constructor.name === 'Object') {\n        const fauxBlob = (blobObj as unknown) as {type: string, encoding: string, data: string};\n        return 'data:' + fauxBlob.type + ';' + fauxBlob.encoding + ',' + fauxBlob.data; // data url\n    } else {\n        throw new Error('unknown blob format');\n    }\n}\n\nexport function dateDayDifference (dateA: string | Date, dateB: string | Date): number {\n    dateA = new Date(dateA);\n    dateB = new Date(dateB);\n    dateA.setHours(0, 0, 0, 0);\n    dateB.setHours(0, 0, 0, 0);\n    return (dateB.getTime() - dateA.getTime()) / (1000 * 60 * 60 * 24);\n}\n\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\nexport function copyObj (obj: any): any {\n    return JSON.parse(JSON.stringify(obj));\n}\n\n/**\n * triggers Web Share API - share feature on mobile devices\n * Only works if they support file sharing - e.g. Safari can't do this yet\n * only call if BB.canShareFiles() -> true\n *\n * p = {\n *     canvas: Canvas,\n *     fileName: string,\n *     title: string\n * }\n *\n * @param p\n */\nexport function shareCanvas (p: {canvas: HTMLCanvasElement, fileName:string, title: string, callback: () => void}): void {\n    const mimetype = 'image/png';\n    const err = () => alert('sharing not supported');\n    p.canvas.toBlob(function(blob) {\n        if (blob === null) {\n            err();\n            p.callback();\n            return;\n        }\n        try {\n            const filesArray = [new File([blob], p.fileName, {type: mimetype})];\n            navigator.share({\n                title: p.title,\n                files: filesArray,\n            } as any)\n                .then(r => {\n\n                })\n                .catch(e => {\n                    err();\n            });\n        } catch(e) {\n            err();\n        }\n        p.callback();\n    }, mimetype);\n}\n\n/**\n * Prevent ipad from zooming in when double tapping. iPadOS 13 bug.\n * Give it your click event\n *\n * @param clickEvent\n * @returns {boolean}\n */\nexport function handleClick (clickEvent: MouseEvent): boolean {\n    const target: HTMLElement | null = clickEvent.target as HTMLElement;\n    if (!target) {\n        return false;\n    }\n    if (['A', 'LABEL', 'INPUT'].includes(target.tagName) || (target as any).allowClick) {\n        return true;\n    }\n    clickEvent.preventDefault();\n    return false;\n}\n\n\n/**\n * @param el {elementType: string, childrenArr: []el, ...svg attributes...}\n * @returns svg element tree\n */\nexport function createSvg (el: ISVG): SVGElement {\n    const result = document.createElementNS('http://www.w3.org/2000/svg', el.elementType);\n    const keyArr = Object.keys(el);\n    let keyStr;\n    for (let i = 0; i < keyArr.length; i++) {\n        keyStr = keyArr[i];\n        if (keyStr === 'childrenArr') {\n            for (let e = 0; e < el.childrenArr.length; e++) {\n                result.appendChild(createSvg(el.childrenArr[e]));\n            }\n        } else if (keyStr !== 'elementType') {\n            result.setAttribute(keyStr, el[keyStr] as string);\n        }\n    }\n    return result;\n}","import {addEventListener, removeEventListener} from './event-listener';\n\n\nconst globalKey = (() => {\n\n    const keyStrToKeyObj = { // keyStr not to contain a '+', because that's used for the comboStr\n        'space': [' ', 'Spacebar'], // Spacebar in IE\n        'alt': ['Alt', 'AltGraph'],\n        'shift': 'Shift',\n        'ctrl': 'Control',\n        'cmd': ['Meta', 'MetaLeft', 'MetaRight'],\n        'enter': 'Enter',\n        'esc': 'Escape',\n        'backspace': 'Backspace',\n        'delete': 'Delete',\n        'sqbr_open': '[',\n        'sqbr_close': ']',\n        'a': ['a', 'A'],\n        'b': ['b', 'B'],\n        'c': ['c', 'C'],\n        'e': ['e', 'E'],\n        'f': ['f', 'F'],\n        'g': ['g', 'G'],\n        'r': ['r', 'R'], // when holding shift\n        's': ['s', 'S'],\n        't': ['t', 'T'],\n        'u': ['u', 'U'],\n        'x': ['x', 'X'],\n        'y': ['y', 'Y'],\n        'z': ['z', 'Z'],\n        'plus': '+',\n        'minus': '-',\n        'left': 'ArrowLeft',\n        'right': 'ArrowRight',\n        'up': 'ArrowUp',\n        'down': 'ArrowDown',\n        'home': 'Home',\n        'end': 'End'\n    };\n    const keyToKeyStrArr = Object.keys(keyStrToKeyObj);\n    const isDownObj = {};\n    const keyToKeyStrObj = {}; // event.key to keyStr { ArrowLeft: 'left', ... }\n    let comboArr = [];\n    //a physical key's \"key\" can change as other keys get pressed. to keep track, need to also track the code\n    let codeIsDownObj = {}; // { KeyE: 'e', KeyF: null } - null not down, string, the associated keyStr\n    const listenerArr = [];\n\n    for (let i = 0; i < keyToKeyStrArr.length; i++) {\n        isDownObj[keyToKeyStrArr[i]] = false;\n\n        const code = keyStrToKeyObj[keyToKeyStrArr[i]];\n        if (typeof code === 'string') {\n            keyToKeyStrObj[keyStrToKeyObj[keyToKeyStrArr[i]]] = keyToKeyStrArr[i];\n        } else {\n            for (let e = 0; e < code.length; e++) {\n                keyToKeyStrObj[code[e]] = keyToKeyStrArr[i];\n            }\n        }\n    }\n\n    function emitDown(a, b, c, d?) {\n        listenerArr.forEach(item => {\n            if (!item[0]) {\n                return;\n            }\n            item[0](a, b, c, d);\n        });\n    }\n\n    function emitUp(a, b, c) {\n        listenerArr.forEach(item => {\n            if (!item[1]) {\n                return;\n            }\n            item[1](a, b, c);\n        });\n    }\n\n    function emitBlur() {\n        listenerArr.forEach(item => {\n            if (!item[2]) {\n                return;\n            }\n            item[2]();\n        });\n    }\n\n    function keyDown(e) {\n        const key = e.key;\n        const code = 'code' in e ? e.code : e.keyCode; // ie doesn't have code\n\n        if (key in keyToKeyStrObj) {\n            const keyStr = keyToKeyStrObj[key];\n            if (isDownObj[keyStr]) {\n                emitDown(keyStr, e, comboArr.join('+'), true);\n                return;\n            }\n            isDownObj[keyStr] = true;\n            codeIsDownObj[code] = keyStr;\n\n            //add to combo\n            comboArr.push(keyStr);\n\n            emitDown(keyStr, e, comboArr.join('+'));\n        }\n    }\n\n\n    function keyUp(e) {\n        const key = e.key;\n        const code = 'code' in e ? e.code : e.keyCode; // ie doesn't have code\n        const oldComboStr = comboArr.join('+');\n\n        // because of a macOS bug: when meta key is down, keyup of other keys does not fire.\n        // https://stackoverflow.com/questions/25438608/javascript-keyup-isnt-called-when-command-and-another-is-pressed\n        if ([\n            'Meta', 'MetaLeft', 'MetaRight',\n            'OSLeft', 'OSRight', // Firefox\n        ].includes(code)) {\n            blur(null);\n            return;\n        }\n\n        if (code in codeIsDownObj && codeIsDownObj[code] !== null) {\n            const keyStr = codeIsDownObj[code];\n            isDownObj[keyStr] = false;\n            codeIsDownObj[code] = null;\n\n            //remove from combo\n            for (let i = 0; i < comboArr.length; i++) {\n                if (comboArr[i] == keyStr) {\n                    comboArr.splice(i, 1);\n                    i--;\n                }\n            }\n\n            emitUp(keyStr, e, oldComboStr);\n        }\n    }\n\n    function blur(event) {\n        const oldComboStr = comboArr.join('+');\n        comboArr = [];\n        codeIsDownObj = {};\n\n        const eventArr = [];\n        for (let i = 0; i < keyToKeyStrArr.length; i++) {\n            if (isDownObj[keyToKeyStrArr[i]]) {\n                isDownObj[keyToKeyStrArr[i]] = false;\n                eventArr.push(keyToKeyStrArr[i]);\n            }\n        }\n        for (let i = 0; i < eventArr.length; i++) {\n            emitUp(\n                eventArr[i],\n                {\n                    preventDefault: function () {},\n                    stopPropagation: function () {},\n                },\n                oldComboStr,\n            );\n        }\n        emitBlur();\n    }\n\n\n\n    return {\n        add: (keyListener) => {\n            if (listenerArr.includes(keyListener)) {\n                return;\n            }\n            const first = listenerArr.length === 0;\n            listenerArr.push(keyListener);\n\n            if (first) {\n                addEventListener(document, 'keydown', keyDown);\n                addEventListener(document, 'keyup', keyUp);\n                addEventListener(window, 'blur', blur);\n            }\n        },\n        remove: (keyListener) => {\n            if (!listenerArr.includes(keyListener)) {\n                return;\n            }\n            const last = listenerArr.length === 1;\n            for (let i = 0; i < listenerArr.length; i++) {\n                if (listenerArr[i] === keyListener) {\n                    listenerArr.splice(i, 1);\n                    break;\n                }\n            }\n            if (last) {\n                removeEventListener(document, 'keydown', keyDown);\n                removeEventListener(document, 'keyup', keyUp);\n                removeEventListener(window, 'blur', blur);\n            }\n        },\n        getIsDown: () => {\n            return isDownObj;\n        },\n        getCombo: () => {\n            return comboArr;\n        },\n    };\n})();\n\n\n\n/**\n * Listens to key events in window. Makes combos easier - e.g. ctrl + z\n *\n * keyStr - see in implementation - my representation of a key. e.g. 'r' can be 'r' and 'R'\n * comboStr - string joins currently pressed keyStr with a +\n *              e.g. 'ctrl+z'\n *\n */\nexport class KeyListener {\n\n    private readonly onDown;\n    private readonly onUp;\n    private readonly onBlur;\n    private readonly ref;\n\n    constructor (\n        p: {\n            onDown?: (keyStr: string, e: KeyboardEvent, comboStr: string, isRepeat?: boolean) => void;\n            onUp?: (keyStr: string, e: KeyboardEvent, oldComboStr: string) => void;\n            onBlur?: () => void;\n        },\n    ) {\n        this.onDown = p.onDown;\n        this.onUp = p.onUp;\n        this.onBlur = p.onBlur;\n        this.ref = [this.onDown, this.onUp, this.onBlur];\n        globalKey.add(this.ref);\n    }\n\n    isPressed (keyStr: string): boolean {\n        if (!(keyStr in globalKey.getIsDown())) {\n            throw 'key \"' + keyStr + '\" not found';\n        }\n        return globalKey.getIsDown()[keyStr];\n    }\n\n    getComboStr (): string {\n        return globalKey.getCombo().join('+');\n    }\n\n    comboOnlyContains (keyStrArr: string[]): boolean {\n        for (let i = 0; i < globalKey.getCombo().length; i++) {\n            if (!keyStrArr.includes(globalKey.getCombo()[i])) {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    destroy (): void {\n        globalKey.remove(this.ref);\n    }\n}\n\nexport function sameKeys(comboAStr: string, comboBStr: string): boolean {\n    return comboAStr.split('+').sort().join('+')=== comboBStr.split('+').sort().join('+');\n}","import {addEventListener, removeEventListener} from './event-listener';\n\n\n/**\n * Filters wheel events. removes swipe scrolling and pinch scrolling that trackpads do. (as best as it can)\n * Normalizes regular scrolls.\n *\n * Why:\n * - trackpad scrolling is different from old school mouse scrolling\n * - but there is not way to learn from the browser if it's trackpad scrolling\n * - browsers don't even give access to the raw swiping or pinching movement, but some abstraction on top, making the scrolling\n *      continue an arbitrary amount, at an arbitrary scale\n * - each browser does this differently. So you can't offer a coherent experience\n *\n * - also trackpads are painful to draw with. So supporting a trackpad-based workflow makes not much sense.\n *\n * @param callback - func({deltaY: number, pageX: number, pageY: number, clientX: number, clientY: number}\n * @constructor\n */\nimport {eventUsesHighResTimeStamp, hasPointerEvents, isFirefox} from '../base/browser';\nimport {mix} from '../math/math';\n\nconst WheelCleaner = function (callback) {\n    const sequenceTimeoutMs = 200;\n\n    const knownUnitArr = [100];\n    let sequenceLength = 0;\n    let sequenceUnit = null;\n    let endSequenceTimeout;\n    let toEmitDelta = null;\n    let position = null;\n\n\n    function emit(delta) {\n        callback({\n            deltaY: Math.round(delta / sequenceUnit),\n            pageX: position.pageX,\n            pageY: position.pageY,\n            clientX: position.clientX,\n            clientY: position.clientY,\n        });\n    }\n\n    function endSequence() {\n        if (toEmitDelta !== null) {\n            emit(toEmitDelta);\n            toEmitDelta = null;\n        }\n        if (sequenceUnit !== null && !(knownUnitArr.includes(sequenceUnit))) {\n            knownUnitArr.push(sequenceUnit);\n        }\n        sequenceLength = 0;\n        sequenceUnit = null;\n    }\n\n    // --- interface ---\n    this.process = function (event) {\n\n        position = {\n            pageX: event.pageX,\n            pageY: event.pageY,\n            clientX: event.clientX,\n            clientY: event.clientY,\n        };\n\n        clearTimeout(endSequenceTimeout);\n        endSequenceTimeout = setTimeout(endSequence, sequenceTimeoutMs);\n\n        //prep delta\n        let delta = event.deltaY;\n        if ('deltaMode' in event && event.deltaMode === 1) {\n            delta *= 100 / 3;\n        }\n        const absDelta = Math.abs(delta);\n\n\n        if (sequenceLength > 0 && sequenceUnit === null) {\n            //previously determined dirty sequence\n            toEmitDelta = null;\n            return;\n        }\n\n        //sequence begins\n        if (sequenceLength === 0) {\n            sequenceLength++;\n            if (absDelta < 50) {\n                //dirty - probably a swipe scroll or pinch scroll on trackpad\n                return;\n            }\n\n            sequenceUnit = absDelta;\n            if (knownUnitArr.includes(sequenceUnit)) {\n                //we know this unit - emit right away\n                emit(delta);\n            } else {\n                //unknown unit - wait until next event or sequence end, to have more certainty that it's clean\n                toEmitDelta = delta;\n            }\n            return;\n        }\n\n        //sequence continues\n        if (absDelta === 0) {\n            //ignore zero scroll\n            return;\n        }\n        if (\n            absDelta === sequenceUnit ||\n            (absDelta / sequenceUnit) % 1 < 0.0001// a multiple\n        ) {\n            //fine\n        } else if ((sequenceUnit / absDelta) % 1 < 0.0001) {\n            //unit was actually a multiple - update it\n            sequenceUnit = absDelta;\n\n        } else if (absDelta !== sequenceUnit) {\n            //not clean - delta is varying - probably a swipe scroll or pinch scroll on trackpad\n            sequenceUnit = null;\n            toEmitDelta = null;\n            return;\n        }\n\n\n        if (toEmitDelta !== null) {\n            emit(toEmitDelta);\n            toEmitDelta = null;\n        }\n        emit(delta);\n    };\n};\n\n\n/**\n * PointerListener - for pointer events, wheel events. uses fallbacks. ideally consistent behavior across browsers\n * Has some workarounds for browser specific bugs. As browsers get better, this constructor should get smaller\n *\n * p = {\n *     target: DOM element,\n *     onPointer: func (pointerEvent), //optional\n *     onWheel: func (wheelEvent), //optional\n *     onEnterLeave: func (isOver: boolean), //optional\n *     maxPointers: int (1 - n), //default is 1\n *     fixScribble: boolean, // fix ipad scribble issue\n * }\n *\n * pointerEvent = {\n *     type: 'pointerdown'|'pointermove'|'pointerup',\n *     pointerId: long,\n *     pointerType: 'touch'|'mouse'|'pen',\n *     pageX: number,\n *     pageY: number,\n *     clientX: number,\n *     clientY: number,\n *     relX: number, //position relative to top left of target\n *     relY: number,\n *     dX: number, //movementX not supported by safari on iOS, so need my own\n *     dY: number,\n *     downPageX: number, //where was pointer when down-event occurred - set for down|move|up\n *     downPageY: number,\n *     coalescedArr: Array of {\n *         pageX: number,\n *         pageY: number,\n *         clientX: number,\n *         clientY: number,\n *         relX: number, //position relative to top left of target\n *         relY: number,\n *         dX: number,\n *         dY: number,\n *         time: number// same timescale as performance.now() - might be exact same number as in parent\n *     },\n *     time: number, // same timescale as performance.now()\n *     button: 'left'|'middle'|'right',\n *     pressure: number (0-1), // always 1 for touch and mouse\n *     eventPreventDefault: function(),\n *     eventStopPropagation: function(),\n * }\n *\n * wheelEvent = {\n *     deltaY: number, // increments of 1\n *     pageX: number,\n *     pageY: number,\n *     relX: number,\n *     relY: number,\n * }\n *\n * isOver(): boolean - if pointer over the target\n *\n * @param p\n */\nexport const PointerListener = (function () {\n\n    //keeping track of pointers for movement fallback\n    const pointerArr = [];\n\n    function addPointer(event) {\n        const pointerObj = {\n            pointerId: event.pointerId,\n            lastPageX: null,\n            lastPageY: null\n        };\n        pointerArr.push(pointerObj);\n\n        if (pointerArr.length > 15) {\n            pointerArr.shift();\n        }\n\n        return pointerObj;\n    }\n\n    function getPointer(event) {\n        for (let i = pointerArr.length - 1; i >= 0; i--) {\n            if (event.pointerId === pointerArr[i].pointerId) {\n                return pointerArr[i];\n            }\n        }\n        return null;\n    }\n\n\n    let pressureNormalizeAvgCount = 0;\n    let pressureNormalizeAvgPressure = null;\n    let pressureNormalizeIsComplete = false;\n    let pressureNormalizeFactor = 1;\n\n    return function (p) {\n        const targetElement = p.target;\n        const onPointerCallback = p.onPointer;\n        const onWheelCallback = p.onWheel;\n        const onEnterLeaveCallback = p.onEnterLeave;\n        const maxPointers = 'maxPointers' in p ? p.maxPointers : 1;\n        const buttonsToStr = { // translation\n            '1': 'left',\n            '2': 'right',\n            '4': 'middle'\n        };\n        const wheelCleaner = new WheelCleaner(function (wheelEvent) {\n            if (isDestroyed) {\n                return;\n            }\n            if (onWheelCallback) {\n                const bounds = targetElement.getBoundingClientRect();\n                wheelEvent.relX = wheelEvent.clientX - bounds.left + targetElement.scrollLeft;\n                wheelEvent.relY = wheelEvent.clientY - bounds.top + targetElement.scrollTop;\n                onWheelCallback(wheelEvent);\n            }\n        });\n        let isDestroyed = false;\n\n        const timeStampOffset = eventUsesHighResTimeStamp() ? 0 : -performance.timing.navigationStart;\n\n\n        //to circumvent a chrome input glitch\n        let lastPointerType = '';\n        let didSkip = false;\n\n\n        /*\n        pointers that are pressing a button\n        dragObj = {\n            pointerId: long,\n            pointerType: 'mouse'|'pen'|'touch',\n            downPageX: number, //where was pointer when down-event occurred\n            downPageY: number,\n            button: long,\n            lastPageX: number, //pageX in previous event - only for touch events, because they don't have movementX/Y\n            lastPageY: number,\n            lastTimeStamp: number\n        }\n         */\n        const dragObjArr = [];\n        const dragPointerIdArr = [];\n\n        function getDragObj(pointerId) {\n            for (let i = 0; i < dragObjArr.length; i++) {\n                if (pointerId === dragObjArr[i].pointerId) {\n                    return dragObjArr[i];\n                }\n            }\n            return null;\n        }\n\n        function removeDragObj(pointerId) {\n            let removedDragObj = null;\n            for (let i = 0; i < dragPointerIdArr.length; i++) {\n                if (dragPointerIdArr[i] === pointerId) {\n                    removedDragObj = dragObjArr[i];\n                    dragObjArr.splice(i, 1);\n                    dragPointerIdArr.splice(i, 1);\n                    i--;\n                }\n            }\n            return removedDragObj;\n        }\n\n\n        function normalizePressure(pressure, type?) {\n            if (pressure === 0 || pressure === 1) {\n                return pressure;\n            }\n\n            // was this there to prevent some glitch?\n            /*if (pressureNormalizeIsComplete && type === 'pointerdown' && pressure !== 1) {\n                pressure *= 0.004;\n            }*/\n\n            if (pressureNormalizeAvgCount < 60) {\n                if (pressureNormalizeAvgCount === 0) {\n                    pressureNormalizeAvgPressure = pressure;\n                } else {\n                    pressureNormalizeAvgPressure = mix(pressure, pressureNormalizeAvgPressure, 0.95);\n                }\n                pressureNormalizeAvgCount++;\n            } else if (!pressureNormalizeIsComplete) {\n                pressureNormalizeIsComplete = true;\n                //BB.throwOut('avg pressure decision!' + pressureNormalizeAvgPressure);\n                if (pressureNormalizeAvgPressure < 0.13) { // absurd pressure needed\n                    pressureNormalizeFactor = 2.3;\n                }\n            }\n\n\n            return Math.pow(pressure, 1 / pressureNormalizeFactor);\n        }\n\n\n        /**\n         *\n         * More trustworthy pointer attributes. that behave the same across browsers.\n         * returns a new object. this object also gets attached to the orig event. -> event.corrected\n         *\n         * @param event\n         * @returns {{pointerId: number, timeStamp: number, button, buttons, pointerType: (string|string|any), movementY: number, movementX: number, pressure, coalescedArr: [], pageY, pageX, clientX, clientY, eventPreventDefault: func, eventStopPropagation: func}\n         */\n        function correctPointerEvent(event) {\n            if (event.corrected) {\n                return event.corrected;\n            }\n\n            /*if (event.type === 'pointermove' && !window.hidePressureOut) {\n                if (event.type === 'pointermove') {\n                    BB.throwOut(event.pressure + ' ' + event.pointerType);\n                }\n            }*/\n\n            const correctedObj = {\n                pointerId: event.pointerId,\n                pointerType: event.pointerType,\n                pageX: event.pageX,\n                pageY: event.pageY,\n                clientX: event.clientX,\n                clientY: event.clientY,\n                movementX: event.movementX,\n                movementY: event.movementY,\n                timeStamp: event.timeStamp + timeStampOffset,\n                pressure: normalizePressure(event.pressure, event.type),\n                buttons: event.buttons,\n                button: event.button,\n                coalescedArr: [],\n                eventPreventDefault: function () {\n                    event.preventDefault();\n                },\n                eventStopPropagation: function () {\n                    event.stopPropagation();\n                }\n            };\n            event.corrected = correctedObj;\n\n            let customPressure = null;\n            if ('pointerId' in event) {\n                if ('pressure' in event && event.buttons !== 0 && (['mouse'].includes(event.pointerType) || (event.pointerType === 'touch' && event.pressure === 0))) {\n                    correctedObj.pressure = 1;\n                    customPressure = 1;\n                }\n            } else {\n                correctedObj.pointerId = 0;\n                correctedObj.pointerType = 'mouse';\n                correctedObj.pressure = event.buttons !== 0 ? 1 : 0;\n                customPressure = correctedObj.pressure;\n            }\n\n            if (isFirefox && event.pointerType != 'mouse' && event.type === 'pointermove' && event.buttons === 0) { // once again firefox\n                correctedObj.buttons = 1; //todo wrong if no buttons actually pressed\n            }\n\n            let coalescedEventArr = [];\n            if ('getCoalescedEvents' in event) {\n                coalescedEventArr = event.getCoalescedEvents();\n            }\n\n            // chrome somehow movementX not same scale as pageX. todo: only chrome?\n            // so make my own\n\n            let pointerObj = getPointer(correctedObj);\n            if (pointerObj === null) {\n                pointerObj = addPointer(correctedObj);\n            }\n\n            const totalLastX = pointerObj.lastPageX;\n            const totalLastY = pointerObj.lastPageY;\n\n            for (let i = 0; i < coalescedEventArr.length; i++) {\n                const eventItem = coalescedEventArr[i];\n\n                correctedObj.coalescedArr.push({\n                    pageX: eventItem.pageX,\n                    pageY: eventItem.pageY,\n                    clientX: eventItem.clientX,\n                    clientY: eventItem.clientY,\n                    movementX: pointerObj.lastPageX === null ? 0 : eventItem.pageX - pointerObj.lastPageX,\n                    movementY: pointerObj.lastPageY === null ? 0 : eventItem.pageY - pointerObj.lastPageY,\n                    timeStamp: eventItem.timeStamp === 0 ? correctedObj.timeStamp : (eventItem.timeStamp + timeStampOffset), // 0 in firefox\n                    pressure: customPressure === null ? normalizePressure(eventItem.pressure) : customPressure\n                });\n\n                pointerObj.lastPageX = eventItem.pageX;\n                pointerObj.lastPageY = eventItem.pageY;\n            }\n\n            pointerObj.lastPageX = correctedObj.pageX;\n            pointerObj.lastPageY = correctedObj.pageY;\n            correctedObj.movementX = totalLastX === null ? 0 : pointerObj.lastPageX - totalLastX;\n            correctedObj.movementY = totalLastY === null ? 0 : pointerObj.lastPageY - totalLastY;\n\n            return correctedObj;\n\n        }\n\n        /**\n         * creates a value for onPointer, from a pointer event handler\n         *\n         * @param typeStr string - 'pointerdown'|'pointermove'|'pointerup'\n         * @param correctedEvent - corrected pointer event from correctPointerEvent()\n         * @param custom - object for setting custom attributes\n         * @returns {{pointerId: number, pointerType: *, dX: (*), relY: number, dY: (*), relX: number, type: *, event: *, pageY: *, pageX: *}}\n         */\n        function createPointerOutEvent(typeStr, correctedEvent, custom?) {\n\n            const bounds = targetElement.getBoundingClientRect();\n            const result: any = {\n                type: typeStr,\n                pointerId: correctedEvent.pointerId,\n                pointerType: correctedEvent.pointerType,\n                pageX: correctedEvent.pageX,\n                pageY: correctedEvent.pageY,\n                clientX: correctedEvent.clientX,\n                clientY: correctedEvent.clientY,\n                relX: correctedEvent.clientX - bounds.left + targetElement.scrollLeft,\n                relY: correctedEvent.clientY - bounds.top + targetElement.scrollTop,\n                dX: correctedEvent.movementX,\n                dY: correctedEvent.movementY,\n                time: correctedEvent.timeStamp,\n                eventPreventDefault: correctedEvent.eventPreventDefault,\n                eventStopPropagation: correctedEvent.eventStopPropagation\n            };\n\n            if (typeStr === 'pointermove') {\n                result.coalescedArr = [];\n                if (correctedEvent.coalescedArr.length > 1) {\n                    let coalescedItem;\n                    for (let i = 0; i < correctedEvent.coalescedArr.length; i++) {\n                        coalescedItem = correctedEvent.coalescedArr[i];\n                        result.coalescedArr.push({\n                            pageX: coalescedItem.pageX,\n                            pageY: coalescedItem.pageY,\n                            clientX: coalescedItem.clientX,\n                            clientY: coalescedItem.clientY,\n                            relX: coalescedItem.clientX - bounds.left + targetElement.scrollLeft,\n                            relY: coalescedItem.clientY - bounds.top + targetElement.scrollTop,\n                            dX: coalescedItem.movementX,\n                            dY: coalescedItem.movementY,\n                            time: coalescedItem.timeStamp\n                        });\n                    }\n                }\n            }\n\n            if (custom) {\n                const keyArr = Object.keys(custom);\n                for (let i = 0; i < keyArr.length; i++) {\n                    result[keyArr[i]] = custom[keyArr[i]];\n                }\n            }\n\n            return result;\n        }\n\n        /**\n         * creates a value for onPointer, from a fallback touch event handler\n         *\n         * @param typeStr string - 'pointerdown'|'pointermove'|'pointerup'\n         * @param touchListItem - element from changed touch list\n         * @param touchEvent - touch event\n         * @param custom - object for setting custom attributes\n         * @returns {{pointerId: number, pointerType: string, relY: number, relX: number, type: *, event: *, pageY: *, pageX: *}}\n         */\n        function createTouchOutEvent(typeStr, touchListItem, touchEvent, custom) {\n            const bounds = targetElement.getBoundingClientRect();\n            const result: any = {\n                type: typeStr,\n                pointerId: touchListItem.identifier,\n                pointerType: 'touch',\n                pageX: touchListItem.pageX,\n                pageY: touchListItem.pageY,\n                clientX: touchListItem.clientX,\n                clientY: touchListItem.clientY,\n                relX: touchListItem.pageX - bounds.left + targetElement.scrollLeft,\n                relY: touchListItem.pageY - bounds.top + targetElement.scrollTop,\n                time: touchEvent.timeStamp + timeStampOffset,\n                eventPreventDefault: function() { touchEvent.preventDefault(); },\n                eventStopPropagation: function() { touchEvent.stopPropagation(); }\n            };\n\n            if (typeStr === 'pointermove') {\n                result.coalescedArr = [];\n            }\n\n            const keyArr = Object.keys(custom);\n            for (let i = 0; i < keyArr.length; i++) {\n                result[keyArr[i]] = custom[keyArr[i]];\n            }\n\n            return result;\n        }\n\n        function setupDocumentListeners() {\n            addEventListener(document, 'pointermove', onGlobalPointerMove);\n            addEventListener(document, 'pointerup', onGlobalPointerUp);\n            addEventListener(document, 'pointerleave', onGlobalPointerLeave);\n        }\n\n        function destroyDocumentListeners() {\n            removeEventListener(document, 'pointermove', onGlobalPointerMove);\n            removeEventListener(document, 'pointerup', onGlobalPointerUp);\n            removeEventListener(document, 'pointerleave', onGlobalPointerLeave);\n        }\n\n        let isOverCounter = 0; // might be multiple pointers\n        function onPointerEnter() {\n            isOverCounter++;\n            if (onEnterLeaveCallback) {\n                onEnterLeaveCallback(true);\n            }\n        }\n\n        function onPointerLeave() {\n            isOverCounter--;\n            if (onEnterLeaveCallback) {\n                onEnterLeaveCallback(false);\n            }\n        }\n\n        function onPointermove(event) {\n            event = correctPointerEvent(event);\n\n            const tempLastPointerType = lastPointerType;\n            lastPointerType = event.pointerType;\n\n            if (dragPointerIdArr.includes(event.pointerId) || dragPointerIdArr.length === maxPointers || event.pointerType === 'touch') {\n                didSkip = false;\n                return;\n            }\n\n            // chrome input glitch workaround - throws in a random mouse event with the wrong position when using a stylus\n            if (!didSkip && event.pointerType === 'mouse' && tempLastPointerType === 'pen') {\n                didSkip = true;\n                return;\n            }\n            didSkip = false;\n\n            const outEvent = createPointerOutEvent('pointermove', event);\n            onPointerCallback(outEvent);\n\n        }\n\n        function onPointerdown(event) {\n            //BB.throwOut('pointerdown ' + event.pointerId + ' | ' + dragPointerIdArr.length);\n            event = correctPointerEvent(event);\n            ////console.log('debug: ' + event.pointerId + ' pointerdown');\n            if (dragPointerIdArr.includes(event.pointerId) || dragPointerIdArr.length === maxPointers || !([1, 2, 4].includes(event.buttons))) {\n                //BB.throwOut('pointerdown ignored');\n                return;\n            }\n\n\n            //set up global listeners\n            if (dragObjArr.length === 0) {\n                setupDocumentListeners();\n            }\n            const dragObj = {\n                pointerId: event.pointerId,\n                pointerType: event.pointerType,\n                downPageX: event.pageX,\n                downPageY: event.pageY,\n                buttons: event.buttons,\n                lastPageX: event.pageX,\n                lastPageY: event.pageY,\n                lastTimeStamp: event.timeStamp\n            };\n            dragObjArr.push(dragObj);\n            setTouchTimeout(dragObj);\n            dragPointerIdArr.push(event.pointerId);\n\n            const outEvent = createPointerOutEvent('pointerdown', event, {\n                downPageX: event.pageX,\n                downPageY: event.pageY,\n                button: buttonsToStr[event.buttons],\n                pressure: event.pressure\n            });\n\n            onPointerCallback(outEvent);\n        }\n\n\n        function onGlobalPointerMove(event) {\n            //BB.throwOut('pointermove ' + event.pointerId);\n            event = correctPointerEvent(event);\n            ////console.log('debug: ' + event.pointerId + ' GLOBALpointermove');\n            if (!(dragPointerIdArr.includes(event.pointerId))) {\n                return;\n            }\n\n            const dragObj = getDragObj(event.pointerId);\n            clearTouchTimeout(dragObj);\n\n            //if pointer changes button its pressing -> turn into pointerup\n            if (event.buttons !== dragObj.buttons) {\n                //pointer up\n\n                //remove listener\n                if (dragObjArr.length === 1) {\n                    destroyDocumentListeners();\n                }\n                removeDragObj(event.pointerId);\n\n                const outEvent = createPointerOutEvent('pointerup', event, {\n                    downPageX: dragObj.downPageX,\n                    downPageY: dragObj.downPageY\n                });\n                onPointerCallback(outEvent);\n                return;\n\n            }\n\n            setTouchTimeout(dragObj);\n\n            // ipad likes to do this\n            if (\n                event.pointerType === 'pen' &&\n                event.pageX === dragObj.lastPageX &&\n                event.pageY === dragObj.lastPageY &&\n                event.timeStamp === dragObj.lastTimeStamp\n            ) {\n                //ignore\n                return;\n            }\n\n            const outEvent = createPointerOutEvent('pointermove', event, {\n                downPageX: dragObj.downPageX,\n                downPageY: dragObj.downPageY,\n                button: buttonsToStr[event.buttons],\n                pressure: event.pressure\n            });\n\n            dragObj.lastPageX = event.pageX;\n            dragObj.lastPageY = event.pageY;\n            dragObj.lastTimeStamp = event.timeStamp;\n\n            onPointerCallback(outEvent);\n\n        }\n\n        function onGlobalPointerUp(event) {\n            //BB.throwOut('pointerup ' + event.pointerId);\n            event = correctPointerEvent(event);\n            ////console.log('debug: ' + event.pointerId + ' GLOBALpointerup');\n            if (!(dragPointerIdArr.includes(event.pointerId))) {\n                return;\n            }\n\n            //remove listener\n            if (dragObjArr.length === 1) {\n                destroyDocumentListeners();\n            }\n            const dragObj = removeDragObj(event.pointerId);\n            clearTouchTimeout(dragObj);\n\n            const outEvent = createPointerOutEvent('pointerup', event, {\n                downPageX: dragObj.downPageX,\n                downPageY: dragObj.downPageY\n            });\n            onPointerCallback(outEvent);\n\n        }\n\n        function onGlobalPointerLeave(event) {\n            //BB.throwOut('pointerleave ' + event.pointerId);\n            event = correctPointerEvent(event);\n            ////console.log('debug: ' + event.pointerId + ' onGlobalPointerLeave', event);\n            if (!(dragPointerIdArr.includes(event.pointerId))) { //} || event.target !== document) {\n                return;\n            }\n\n            //remove listener\n            if (dragObjArr.length === 1) {\n                destroyDocumentListeners();\n            }\n            const dragObj = removeDragObj(event.pointerId);\n            clearTouchTimeout(dragObj);\n\n            const outEvent = createPointerOutEvent('pointerup', event, {\n                downPageX: dragObj.downPageX,\n                downPageY: dragObj.downPageY\n            });\n            onPointerCallback(outEvent);\n        }\n\n\n        /*\n        --- ipad pointer event glitch damage control ---\n\n        ipad pointer events are glitchy. doesn't always fire pointerup.\n        - when two fingers get really close to each other\n        - when finger moves out and back in bottom\n\n        This artificially fires a pointerup\n        */\n        function onTouchTimeout(dragObj) {\n\n            //create fake event\n            const fakeEvent = {\n                pointerId: dragObj.pointerId,\n                pointerType: dragObj.pointerType,\n                type: 'pointerup',\n                timeStamp: performance.now(),\n                pageX: 0,\n                pageY: 0,\n                clientX: 0,\n                clientY: 0,\n                preventDefault: function () {\n                },\n                stopPropagation: function () {\n                }\n            };\n\n            //call onGlobalPointerUp with it\n            onGlobalPointerUp(fakeEvent);\n        }\n\n        function setTouchTimeout(dragObj) {\n            if (dragObj.pointerType !== 'touch') {\n                return;\n            }\n            dragObj.touchTimeout = setTimeout(function () {\n                onTouchTimeout(dragObj);\n            }, 2500); // 2.5 seconds\n        }\n\n        function clearTouchTimeout(dragObj) {\n            if (!dragObj.touchTimeout) {\n                return;\n            }\n            clearTimeout(dragObj.touchTimeout);\n            dragObj.touchTimeout = null;\n        }\n\n\n        if (onEnterLeaveCallback) {\n            addEventListener(targetElement, 'pointerenter', onPointerEnter);\n            addEventListener(targetElement, 'pointerleave', onPointerLeave);\n        }\n        if (onPointerCallback) {\n            addEventListener(targetElement, 'pointermove', onPointermove);\n            addEventListener(targetElement, 'pointerdown', onPointerdown);\n        }\n        if (onWheelCallback) {\n            addEventListener(targetElement, 'wheel', wheelCleaner.process);\n        }\n\n\n        let onTouchstart;\n        let onTouchmove;\n        let onTouchend;\n\n        // --- touch fallback ---\n        if (!(hasPointerEvents)) {\n\n            onTouchstart = function (event) {\n                ////console.log('onTouchstart', event, event.changedTouches.length);\n                event.preventDefault(); // needs to stay, otherwise page scrolls on iOS12\n\n                const touchArr = event.changedTouches;\n                for (let i = 0; i < touchArr.length && dragObjArr.length < maxPointers; i++) {\n                    const touchObj = touchArr[i];\n\n                    //set up global listeners\n                    if (dragObjArr.length === 0) {\n                        addEventListener(document, 'touchmove', onTouchmove);\n                        addEventListener(document, 'touchend', onTouchend);\n                        addEventListener(document, 'touchcancel', onTouchend);\n                    }\n                    dragObjArr.push({\n                        pointerId: touchObj.identifier,\n                        downPageX: touchObj.pageX,\n                        downPageY: touchObj.pageY,\n                        buttons: 1,\n                        lastPageX: touchObj.pageX,\n                        lastPageY: touchObj.pageY,\n                    });\n                    dragPointerIdArr.push(touchObj.identifier);\n\n                    const outEvent = createTouchOutEvent('pointerdown', touchObj, event, {\n                        dX: 0,\n                        dY: 0,\n                        downPageX: touchObj.downPageX,\n                        downPageY: touchObj.downPageY,\n                        button: 'left',\n                        pressure: 1\n                    });\n                    onPointerCallback(outEvent);\n                }\n\n            }\n\n            onTouchmove = function (event) {\n                event.preventDefault(); // needs to stay, otherwise page scrolls on iOS12\n\n\n                const touchArr = event.changedTouches;\n                for (let i = 0; i < touchArr.length; i++) {\n                    const touchObj = touchArr[i];\n\n                    if (!(dragPointerIdArr.includes(touchObj.identifier))) {\n                        continue;\n                    }\n                    const dragObj = getDragObj(touchObj.identifier);\n\n                    const outEvent = createTouchOutEvent('pointermove', touchObj, event, {\n                        dX: touchObj.pageX - dragObj.lastPageX,\n                        dY: touchObj.pageY - dragObj.lastPageY,\n                        downPageX: dragObj.downPageX,\n                        downPageY: dragObj.downPageY,\n                        button: 'left',\n                        isCoalesced: false,\n                        pressure: 1\n                    });\n                    dragObj.lastPageX = touchObj.pageX;\n                    dragObj.lastPageY = touchObj.pageY;\n                    onPointerCallback(outEvent);\n\n                }\n\n            }\n\n            onTouchend = function (event) {\n                if (event.type !== 'touchcancel') {\n                    event.preventDefault(); // needs to stay, otherwise page scrolls on iOS12\n                }\n\n\n                const touchArr = event.changedTouches;\n                for (let i = 0; i < touchArr.length; i++) {\n                    const touchObj = touchArr[i];\n\n                    if (!(dragPointerIdArr.includes(touchObj.identifier))) {\n                        continue;\n                    }\n\n                    //remove listener\n                    if (dragObjArr.length === 1) {\n                        removeEventListener(document, 'touchmove', onTouchmove);\n                        removeEventListener(document, 'touchend', onTouchend);\n                        removeEventListener(document, 'touchcancel', onTouchend);\n                    }\n                    const dragObj = removeDragObj(touchObj.identifier);\n\n                    const outEvent = createTouchOutEvent('pointerup', touchObj, event, {\n                        dX: touchObj.pageX - dragObj.lastPageX,\n                        dY: touchObj.pageY - dragObj.lastPageY,\n                        downPageX: dragObj.downPageX,\n                        downPageY: dragObj.downPageY,\n                    });\n\n                    onPointerCallback(outEvent);\n                }\n\n            }\n\n            if (onPointerCallback) {\n                addEventListener(targetElement, 'touchstart', onTouchstart);\n            }\n\n        } else if (p.fixScribble) {\n            //ipad scribble workaround https://developer.apple.com/forums/thread/662874\n            onTouchmove = function(e) {\n                e.preventDefault();\n            }\n            addEventListener(targetElement, 'touchmove', onTouchmove);\n\n        }\n\n\n        // --- interface ---\n\n        this.isOver = function () {\n            return isOverCounter > 0;\n        };\n\n        this.destroy = function () {\n            if (isDestroyed) {\n                return;\n            }\n            isDestroyed = true;\n            removeEventListener(targetElement, 'pointerenter', onPointerEnter);\n            removeEventListener(targetElement, 'pointerleave', onPointerLeave);\n            removeEventListener(targetElement, 'pointermove', onPointermove);\n            removeEventListener(targetElement, 'pointerdown', onPointerdown);\n            removeEventListener(targetElement, 'wheel', wheelCleaner.process);\n            if (dragObjArr.length > 0) {\n                destroyDocumentListeners();\n            }\n\n            if (!(hasPointerEvents)) {\n                removeEventListener(targetElement, 'touchstart', onTouchstart);\n                if (dragObjArr.length > 0) {\n                    removeEventListener(document, 'touchmove', onTouchmove);\n                    removeEventListener(document, 'touchend', onTouchend);\n                    removeEventListener(document, 'touchcancel', onTouchend);\n                }\n            } else {\n                removeEventListener(targetElement, 'touchmove', onTouchmove);\n            }\n        };\n\n    }\n})();","import {IBounds, IRect, IVector2D} from '../BB.types';\n\nexport function mix (a: number, b: number, f: number): number {\n    return a * (1 - f) + b * f;\n}\n\nexport function dist (ax: number, ay: number, bx: number, by: number): number {\n    return Math.sqrt(Math.pow(ax - bx, 2) + Math.pow(ay - by, 2));\n}\n\nexport function distSquared (ax: number, ay: number, bx: number, by: number): number {\n    // faster because no square-root\n    return Math.pow(ax - bx, 2) + Math.pow(ay - by, 2);\n}\n\nexport function lenSquared (x: number, y: number): number {\n    // faster because no square-root\n    return x * x + y * y;\n}\n\nexport function pointsToAngleRad (p1: IVector2D, p2: IVector2D): number {\n    return Math.atan2(p2.y - p1.y, p2.x - p1.x);\n}\n\nexport function pointsToAngleDeg (p1: IVector2D, p2: IVector2D): number {\n    return pointsToAngleRad(p1, p2) * 180 / Math.PI;\n}\n\nexport function isInsideRect(p: IVector2D, rect: IRect): boolean {\n    return rect.x <= p.x && p.x <= rect.x + rect.width &&\n        rect.y <= p.y && p.y <= rect.y + rect.height;\n}\n\nexport function clamp (num: number, min: number, max: number): number {\n    return num <= min\n        ? min\n        : num >= max\n            ? max\n            : num;\n}\n\nexport function rotate (x: number, y: number, deg: number): IVector2D {\n    const theta = deg * (Math.PI / 180);\n    const cs = Math.cos(theta);\n    const sn = Math.sin(theta);\n\n    return {\n        x: x * cs - y * sn,\n        y: x * sn + y * cs\n    };\n}\n\nexport function rotateAround (center: IVector2D, point: IVector2D, deg: number): IVector2D {\n    const rot = rotate(point.x - center.x, point.y - center.y, deg);\n    rot.x += center.x;\n    rot.y += center.y;\n    return rot;\n}\n\nexport function intDxy(remainder: IVector2D, fDx: number, fDy: number) {\n    remainder.x += fDx;\n    remainder.y += fDy;\n    const dX = Math.round(remainder.x);\n    const dY = Math.round(remainder.y);\n    remainder.x -= dX;\n    remainder.y -= dY;\n    return {\n        dX,\n        dY,\n    };\n}\n\n/**\n * return closest even number\n * @param f\n */\nexport function roundEven(f: number) {\n    if (f % 1 === 0) {\n        if (f % 2 === 0) {\n            return f;\n        }\n        return f + 1;\n    }\n    const above = Math.ceil(f);\n    const below = Math.floor(f);\n    if (above % 2 === 0) {\n        return above;\n    } else {\n        return below;\n    }\n}\n\n/**\n * return closest uneven number\n * @param f\n */\nexport function roundUneven(f: number) {\n    if (f % 1 === 0) {\n        if (f % 2 === 0) {\n            return f + 1;\n        }\n        return f;\n    }\n    const above = Math.ceil(f);\n    const below = Math.floor(f);\n    if (above % 2 === 1) {\n        return above;\n    } else {\n        return below;\n    }\n}\n\n/**\n * round number to certain precision.\n * round(1.2345, 2) = 1.23\n * round(1.2345, 0) = 0\n * round(123, -1) = 120\n *\n * @param f\n * @param digits\n */\nexport function round(f: number, digits: number): number {\n    const digitMult = Math.pow(10, digits);\n    return Math.round((f/* + Number.EPSILON*/) * digitMult) / digitMult;\n}\n\n/**\n * update target so it includes bounds\n * @param target\n * @param bounds\n */\nexport function updateBounds (target: IBounds, bounds: IBounds): IBounds {\n    if (!bounds) {\n        return target;\n    }\n    if (!target) {\n        target = { x1: bounds.x1, y1: bounds.y1, x2: bounds.x2, y2: bounds.y2 };\n    } else {\n        target.x1 = Math.min(target.x1, bounds.x1);\n        target.y1 = Math.min(target.y1, bounds.y1);\n        target.x2 = Math.max(target.x2, bounds.x2);\n        target.y2 = Math.max(target.y2, bounds.y2);\n    }\n    return target;\n}\n\n/**\n * determine overlap of bounds with width&height\n */\nexport function boundsInArea (bounds: IBounds, width: number, height: number): IBounds | null {\n    let x1 = Math.max(0, bounds.x1);\n    let y1 = Math.max(0, bounds.y1);\n    let x2 = Math.min(width - 1, bounds.x2);\n    let y2 = Math.min(height - 1, bounds.y2);\n    if (x1 > x2 || y1 > y2) {\n        return null;\n    }\n    return { x1, y1, x2, y2 };\n}","import {clamp, dist, mix, pointsToAngleRad} from '../math/math';\n\n\ntype ChainOutFunc = (event?) => void;\n\n/**\n * for chaining event processing. useful for gestures (double tap, pinch zoom, max pointer filter).\n * each element in the chain might hold back the events, swallow them, or transform them\n *\n * p = {\n *     chainArr: ChainElement[]\n * }\n *\n * chainIn(event): null - feed an event into the chain\n * setChainOut(func): void - func(event) <- called when passed through chain\n * ^ each ChainElement needs these methods too\n *\n * @param p\n * @constructor\n */\nexport const EventChain = function (p) {\n\n    const chainArr = p.chainArr;\n    let chainOut: ChainOutFunc = () => undefined;\n\n    function continueChain(i, event) {\n        for (; i < chainArr.length; i++) {\n            event = chainArr[i].chainIn(event);\n            if (event === null) {\n                return null;\n            }\n        }\n        chainOut(event);\n        return null;\n    }\n\n    for (let i = 0; i < chainArr.length; i++) {\n        (function (i) {\n            chainArr[i].setChainOut(function (event) {\n                continueChain(i + 1, event);\n            });\n        })(i);\n    }\n\n    // --- interface ---\n\n    this.chainIn = function (event) {\n        return continueChain(0, event);\n    };\n    this.setChainOut = function (func) {\n        chainOut = func;\n    };\n};\n\n\n/**\n * A ChainElement. Detects double taps.\n *\n * p = {\n *     onDoubleTap: function({pageX: number, pageY: number}) - fires when double tap occurs\n * }\n *\n * chainIn\n * setChainOut\n * setAllowedPointerTypeArr(string[]): void - which pointer types are allowed\n * setAllowedButtonArr(string[]): void - which buttons are allowed\n *\n * @param p\n * @constructor\n */\nexport const DoubleTapper = function (p) {\n\n    let chainOut: ChainOutFunc = function () {\n    };\n    const minSilenceBeforeDurationMs = 400;\n    const maxPressedDurationMs = 300;\n    const maxPressedDistancePx = 10;\n    const maxInbetweenDistancePx = 19;\n    const maxUpToUpDurationMs = 500;\n    const maxUntilSecondDownDurationMs = 300;\n    const minSilenceAfterMs = 250;\n\n    let allowedPointerTypeArr = ['touch', 'mouse', 'pen'];\n    let allowedButtonArr = ['left'];\n\n    let sequenceArr = [];\n    const pointersDownIdArr = [];\n    let lastUpTime = 0;\n    let nowTime = 0;\n\n    let eventQueueArr = [];\n\n\n    function fail() {\n        if (sequenceArr.length === 0) { // no gesture started -> can be ignored\n            return;\n        }\n        clearTimeout(timeoutObj.fail);\n        clearTimeout(timeoutObj.maxUntilSecondDown);\n        clearTimeout(timeoutObj.success);\n        timeoutObj.fail = null;\n        timeoutObj.maxUntilSecondDown = null;\n        timeoutObj.success = null;\n\n\n        for (let i = 0; i < eventQueueArr.length; i++) {\n            chainOut(eventQueueArr[i]);\n        }\n        eventQueueArr = [];\n\n        sequenceArr = [];\n    }\n\n    // double tap achieved\n    function success() {\n        timeoutObj.fail = null;\n        timeoutObj.success = null;\n        eventQueueArr = []; // events get swallowed\n        const lastSequenceItem = sequenceArr[sequenceArr.length - 1];\n        sequenceArr = [];\n        p.onDoubleTap({\n            pageX: lastSequenceItem.pageX,\n            pageY: lastSequenceItem.pageY,\n            relX: lastSequenceItem.relX,\n            relY: lastSequenceItem.relY,\n        });\n    }\n\n\n    const timeoutObj = {\n        fail: null,\n        maxUntilSecondDown: null,\n        success: null\n    };\n\n    //returns false if time already up. otherwise sets up timeout\n    function setupTimeout(timeoutStr, targetFunc, timeMS) {\n        const diff = timeMS - nowTime;\n        //console.log(fingers + ': ' + timeoutStr + ' diff', diff);\n        if (diff <= 0) { // time already up\n            return false;\n        }\n        timeoutObj[timeoutStr] = setTimeout(targetFunc, diff);\n        return true;\n    }\n\n\n    /**\n     * @param event object - a pointer event from BB.PointerListener\n     */\n    function processEvent(event) {\n\n        if (event.type === 'pointerdown') {\n            pointersDownIdArr.push(event.pointerId);\n        } else if (event.type === 'pointerup') {\n            for (let i = 0; i < pointersDownIdArr.length; i++) {\n                if (pointersDownIdArr[i] === event.pointerId) {\n                    pointersDownIdArr.splice(i, 1);\n                    break;\n                }\n            }\n        }\n\n        if (!allowedPointerTypeArr.includes(event.pointerType)) { //wrong input type -> fail\n            //console.log('wrong input type -> fail');\n            fail();\n            return;\n        }\n\n        nowTime = performance.now();\n        const lastSequenceItem = sequenceArr.length > 0 ? sequenceArr[sequenceArr.length - 1] : null;\n        if (event.type === 'pointerup') {\n            lastUpTime = event.time;\n        }\n\n        if (event.type === 'pointerdown') {\n            if (pointersDownIdArr.length > 1) { // more than one pointer down -> fail\n                //console.log('more than one pointer down -> fail');\n                fail();\n                return;\n            }\n            if (timeoutObj.success !== null) { // silence-after not achieved -> fail\n                //console.log('silence-after not achieved -> fail');\n                fail();\n                return;\n            }\n            if (sequenceArr.length === 0 && nowTime - lastUpTime < minSilenceBeforeDurationMs) { // silence before not achieved -> fail\n                //console.log('silence before not achieved -> fail');\n                fail();\n                return;\n            }\n            if (!allowedButtonArr.includes(event.button)) { // wrong button -> fail\n                //console.log('wrong button -> fail', event.button, allowedButtonArr);\n                fail();\n                return;\n            }\n            if (lastSequenceItem && lastSequenceItem.isDown || sequenceArr.length > 2) { // jumbled -> fail\n                //console.log('jumbled -> fail');\n                fail();\n                return;\n            }\n            if (lastSequenceItem) {\n                const distance = dist(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\n                if (distance > maxInbetweenDistancePx) { //moved too much -> reset\n                    //console.log('maxInbetweenDistancePx -> reset');\n                    fail();\n\n                    if (nowTime - lastSequenceItem.time < minSilenceBeforeDurationMs) { //silence before not achieved -> fail\n                        return;\n                    }\n                }\n            }\n            sequenceArr.push({\n                isDown: true,\n                time: nowTime,\n                position: [event.pageX, event.pageY],\n                pointerId: event.pointerId\n            });\n            //maxUntilSecondDown\n\n            if (sequenceArr.length > 1) {\n                clearTimeout(timeoutObj.maxUntilSecondDown);\n            } else if (!setupTimeout('maxUntilSecondDown', fail, event.time + maxUntilSecondDownDurationMs)) {\n                //console.log('event.time + maxPressedDurationMs -> fail');\n                fail();\n                return;\n            }\n\n\n            clearTimeout(timeoutObj.fail);\n            if (!setupTimeout('fail', fail, event.time + maxPressedDurationMs)) {\n                //console.log('event.time + maxPressedDurationMs -> fail');\n                fail();\n                return;\n            }\n        }\n        if (lastSequenceItem && event.type === 'pointermove' && lastSequenceItem.pointerId === event.pointerId) {\n            /*if (lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\n                console.log('another pointer mixing in -> fail');\n                fail();\n                return;\n            }*/\n            const distance = dist(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\n            if (distance > maxPressedDistancePx) { //moved too much -> fail\n                //console.log('maxPressedDistancePx -> fail');\n                fail();\n                return;\n            }\n        }\n        if (lastSequenceItem && event.type === 'pointerup') {\n            if (lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\n                fail();\n                return;\n            }\n            if (nowTime >= lastSequenceItem.time + maxPressedDurationMs) { //pressed too long -> fail\n                fail();\n                return;\n            }\n            clearTimeout(timeoutObj.fail);\n\n            if (sequenceArr.length < 3) {\n                if (!setupTimeout('fail', fail, event.time + maxUpToUpDurationMs)) {\n                    fail();\n                    return;\n                }\n\n                sequenceArr = [\n                    lastSequenceItem,\n                    {\n                        isUp: true,\n                        time: nowTime,\n                        position: [event.pageX, event.pageY]\n                    }\n                ];\n                return;\n            }\n\n            if (nowTime < sequenceArr[1].time + maxUpToUpDurationMs) {\n                // double tap almost success\n                // only needs silence\n                sequenceArr.push({\n                    pageX: event.pageX,\n                    pageY: event.pageY,\n                    relX: event.relX,\n                    relY: event.relY,\n                });\n                if (!setupTimeout('success', success, event.time + minSilenceAfterMs)) {\n                    fail();\n                }\n            } else { // time up -> fail\n                fail();\n            }\n\n        }\n    }\n\n\n    // --- interface ---\n\n    this.chainIn = function (event) {\n\n        processEvent(event);\n\n        if (sequenceArr.length === 0) { //existing events can not become a double tap\n            fail();\n            return event;\n        }\n        // events might become a double tap -> queue\n        eventQueueArr.push(event);\n        return null;\n    };\n\n    this.setChainOut = function (func) {\n        chainOut = func;\n    };\n\n    this.setAllowedPointerTypeArr = function (arr) {\n        allowedPointerTypeArr = arr;\n    };\n\n    this.setAllowedButtonArr = function (arr) {\n        allowedButtonArr = arr;\n    };\n};\n\n\n/**\n * A ChainElement. Detects a single tap, done with N 'touch' pointers\n *\n * p = {\n *      fingers: number - number of fingers\n *      onTap: function() - fires when tap occurs\n * }\n *\n * chainIn\n * setChainOut\n *\n * @param p\n * @constructor\n */\nexport const NFingerTapper = function (p) {\n\n    const fingers = p.fingers;\n    let chainOut: ChainOutFunc = function () {\n    };\n\n    const minSilenceBeforeDurationMs = 50; //250;\n    const maxTapMs = 500;\n    const maxFirstLastFingerDownMs = 250;\n    const maxPressedDistancePx = 12; //5 + fingers * 5;\n    const silenceAfterDurationMs = 250;\n\n\n    /*\n        fingerObj = {\n            pointerId: number,\n            downTime: number,\n            downPageX: number,\n            downPageY: number,\n            isUp: boolean\n        }\n     */\n    let fingerArr = [];\n    let firstDownTime;\n    let eventQueueArr = [];\n    let lastEventTime = 0;\n    const pointersDownIdArr = [];\n\n    function fail() {\n        if (eventQueueArr.length === 0) {\n            return;\n        }\n        clearTimeout(timeoutObj.firstLastDownTimeout);\n        clearTimeout(timeoutObj.tapTimeout);\n        for (let i = 0; i < eventQueueArr.length; i++) {\n            chainOut(eventQueueArr[i]);\n        }\n        eventQueueArr = [];\n        fingerArr = [];\n    }\n\n    function success() {\n        clearTimeout(timeoutObj.firstLastDownTimeout);\n        clearTimeout(timeoutObj.tapTimeout);\n        eventQueueArr = []; // events get swallowed\n        fingerArr = [];\n        p.onTap();\n    }\n\n    let nowTime;\n    const timeoutObj = {\n        firstLastDownTimeout: null,\n        tapTimeout: null\n    };\n\n    function setupTimeout(timeoutStr, timeMS) {\n        const diff = timeMS - nowTime;\n        //console.log(fingers + ': ' + timeoutStr + ' diff', diff);\n        if (diff <= 0) { // time already up\n            return false;\n        }\n        timeoutObj[timeoutStr] = setTimeout(fail, diff);\n        return true;\n    }\n\n    function processEvent(event) {\n\n        const tempLastEventTime = lastEventTime;\n        lastEventTime = event.time;\n\n        if (event.type === 'pointerdown') {\n            pointersDownIdArr.push(event.pointerId);\n        } else if (event.type === 'pointerup') {\n            for (let i = 0; i < pointersDownIdArr.length; i++) {\n                if (pointersDownIdArr[i] === event.pointerId) {\n                    pointersDownIdArr.splice(i, 1);\n                    break;\n                }\n            }\n        }\n\n        if (event.pointerType !== 'touch') {\n            if (fingerArr.length > 0) { // already in gesture -> fail\n                fail();\n            }\n            return;\n        }\n\n        nowTime = performance.now();\n\n        if (event.type === 'pointerdown') {\n            //console.log('down');\n            if (fingerArr.length + 1 !== pointersDownIdArr.length) { // failed before, and some fingers are still down -> fail\n                fail();\n                return;\n            }\n            if (fingerArr.length === fingers) { // too many fingers down -> fail\n                //console.log(fingers + ': too many fingers down -> fail');\n                fail();\n                return;\n            }\n            if (fingerArr.length > 0 && event.time - maxFirstLastFingerDownMs > fingerArr[0].downTime) { // took too long to touch with all fingers -> fail\n                //console.log(fingers + ': took too long to touch with all fingers -> fail');\n                fail();\n                return;\n            }\n            if (fingerArr.length === 0 && event.time - minSilenceBeforeDurationMs < tempLastEventTime) { // not enough silence before -> fail\n                //console.log(fingers + ': not enough silence before -> fail');\n                fail();\n                return;\n            }\n\n            if (fingerArr.length === 0) {\n                firstDownTime = event.time;\n\n                if (!setupTimeout('firstLastDownTimeout', event.time + maxFirstLastFingerDownMs) || !setupTimeout('tapTimeout', event.time + maxTapMs)) { // timeouts already up -> fail\n                    fail();\n                    return;\n                }\n\n            }\n            fingerArr.push({\n                pointerId: event.pointerId,\n                downTime: event.time,\n                downPageX: event.pageX,\n                downPageY: event.pageY\n            });\n            return;\n\n        }\n\n        if (event.type === 'pointermove') {\n\n            if (fingerArr.length === 0) {\n                //not in a gesture -> ignore\n                return;\n            }\n\n            let fingerObj = null;\n            for (let i = 0; i < fingerArr.length; i++) {\n                if (fingerArr[i].pointerId === event.pointerId) {\n                    fingerObj = fingerArr[i];\n                    break;\n                }\n            }\n            if (fingerObj === null) { // finger not part of the tap is on screen -> fail\n                fail();\n                return;\n            }\n\n            if (event.time - maxTapMs > firstDownTime) { // tap took too long -> fail\n                //console.log(fingers + ': tap took too long -> fail');\n                fail();\n                return;\n            }\n\n            const distance = dist(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\n            if (distance > maxPressedDistancePx) { // finger moved too much -> fail\n                //console.log(fingers + ': a finger moved too much -> fail', distance);\n                fail();\n                return;\n            }\n\n        }\n\n        if (event.type === 'pointerup') {\n\n            if (fingerArr.length === 0) {\n                //not in a gesture -> ignore\n                return;\n            }\n\n            //console.log('up', event.pageX, event.pageY);\n            if (fingerArr.length !== fingers) { // not enough fingers -> fail\n                //console.log(fingers + ': not enough fingers -> fail');\n                fail();\n                return;\n            }\n\n            let fingerObj = null;\n            let i = 0;\n            for (; i < fingerArr.length; i++) {\n                if (fingerArr[i].pointerId === event.pointerId) {\n                    fingerObj = fingerArr[i];\n                    break;\n                }\n            }\n            if (fingerObj === null) {\n                //do nothing\n                return;\n            }\n\n            if (event.time - maxTapMs > firstDownTime) { // tap took too long -> fail\n                //console.log(fingers + ': tap took too long -> fail');\n                fail();\n                return;\n            }\n\n            const distance = dist(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\n            if (distance > maxPressedDistancePx) { // finger moved too much -> fail\n                //console.log(fingers + ': b finger moved too much -> fail', distance, event.pageX, event.pageY);\n                //console.log(fingerArr);\n                fail();\n                return;\n            }\n\n            fingerObj.isUp = true;\n\n            let allAreUp = true;\n            for (let i = 0; i < fingerArr.length; i++) {\n                if (!fingerArr[i].isUp) {\n                    allAreUp = false;\n                    break;\n                }\n            }\n            //console.log('fingerArr', fingerArr);\n\n            if (allAreUp) { // success\n                success();\n                return true;\n            }\n\n        }\n\n\n    }\n\n\n    // --- interface ---\n\n    this.chainIn = function (event) {\n\n        const result = processEvent(event);\n\n        //console.log(fingerArr.length);\n\n        if (result === true) {\n            //tap success -> event gets swallowed\n            return null;\n        }\n        if (fingerArr.length === 0) {\n            return event;\n        } else {\n            eventQueueArr.push(event);\n        }\n\n        return null;\n\n    };\n\n    this.setChainOut = function (func) {\n        chainOut = func;\n    };\n};\n\n\n/**\n * A ChainElement. Detects a pinch zooming (2 touch pointers). If one finger lifts, then will use the remaining.\n * Further pointers are ignored, but their events get swallowed during the pinching.\n * pinching ends when ALL pointers are lifted.\n * Events passed through if no pinching.\n *\n * p = {\n *      onPinch: function({type: 'end'} | {\n *          type: 'move',\n *          relX: number,\n *          relY: number,\n *          downRelX: number,\n *          downRelY: number,\n *          angleDeg: number,\n *          scale: number\n *      }) - fires when pinching occurs\n * }\n *\n * chainIn\n * setChainOut\n *\n * @param p\n * @constructor\n */\nexport const PinchZoomer = function (p) {\n\n    const firstFingerMaxDistancePx = 10;\n    const untilSecondFingerDurationMs = 250;\n\n    let chainOut: ChainOutFunc = function () {\n    };\n    const pointersDownIdArr = [];\n    /*\n    gestureObj = {\n        touchPointerArr: Array of {\n            pointerId: number,\n            relX: number,\n            relY: number,\n            downRelX: number, // only for first\n            downRelY: number\n        },\n        otherPointerIdArr: number[],\n        isInProgress: boolean\n    }\n    */\n    let gestureObj = null;\n    let eventQueueArr = [];\n\n\n    function end() {\n        gestureObj = null;\n        eventQueueArr = [];\n    }\n\n    function fail(doSwallow?) {\n        if (!gestureObj) { // no gesture happening -> ignore\n            return;\n        }\n\n        clearTimeout(timeoutObj.secondFingerTimeout);\n        if (!doSwallow) {\n            for (let i = 0; i < eventQueueArr.length; i++) {\n                chainOut(eventQueueArr[i]);\n            }\n        }\n        end();\n    }\n\n\n    let nowTime;\n    const timeoutObj = {\n        secondFingerTimeout: null\n    };\n\n    function setupTimeout(timeoutStr, targetFunc, timeMS) {\n        const diff = timeMS - nowTime;\n        if (diff <= 0) { // time already up\n            return false;\n        }\n        timeoutObj[timeoutStr] = setTimeout(targetFunc, diff);\n        return true;\n    }\n\n\n    function processEvent(event) {\n\n        if (event.type === 'pointerdown') {\n            pointersDownIdArr.push(event.pointerId);\n\n        } else if (event.type === 'pointerup') {\n            for (let i = 0; i < pointersDownIdArr.length; i++) {\n                if (pointersDownIdArr[i] === event.pointerId) {\n                    pointersDownIdArr.splice(i, 1);\n                    break;\n                }\n            }\n        }\n\n        //pass through scenarios\n        if (\n            !gestureObj && (\n                event.pointerType !== 'touch' || // wrong pointer type\n                (event.type === 'pointermove' && pointersDownIdArr.length > 0) || // failed before\n                pointersDownIdArr.length > 1 || // failed before\n                event.type === 'pointerup' // failed before\n            )\n        ) {\n            return;\n        }\n\n        nowTime = performance.now();\n\n\n        //pointer down\n        if (event.type === 'pointerdown') {\n\n            if (gestureObj) {\n                if (event.pointerType === 'touch') { // touch finger down - as nth pointer\n\n                    gestureObj.touchPointerArr.push({\n                        pointerId: event.pointerId,\n                        relX: event.relX,\n                        relY: event.relY\n                    });\n\n                    if (gestureObj.isInProgress) {\n                        continuePinch(gestureObj, {\n                            type: 'down',\n                            index: gestureObj.touchPointerArr.length - 1\n                        });\n                    } else {\n                        clearTimeout(timeoutObj.secondFingerTimeout);\n                        gestureObj.isInProgress = true;\n                        beginPinch(gestureObj);\n                    }\n                    return;\n\n                } else { // non-touch finger down - as nth pointer\n\n                    if (gestureObj.isInProgress) {\n                        gestureObj.otherPointerIdArr.push(event.pointerId);\n                    } else { // second pointer wrong type -> fail\n                        fail();\n                    }\n                    return;\n                }\n\n\n            } else {\n                // first finger down - can only be touch if no gestureObj\n                gestureObj = {\n                    touchPointerArr: [{\n                        pointerId: event.pointerId,\n                        relX: event.relX,\n                        relY: event.relY,\n                        downRelX: event.relX,\n                        downRelY: event.relY\n                    }],\n                    otherPointerIdArr: [],\n                    isInProgress: false\n                };\n                if (!setupTimeout('secondFingerTimeout', function () {\n                    fail();\n                }, event.time + untilSecondFingerDurationMs)) { // time ran out -> fail\n                    fail();\n                    return;\n                }\n                return;\n            }\n\n        }\n\n\n        //pointer move\n        if (event.type === 'pointermove' && event.pointerType === 'touch') {\n            //gesture object should always exist here\n\n            let touchPointerObj = null;\n            let i = 0;\n            for (; i < gestureObj.touchPointerArr.length; i++) {\n                if (event.pointerId === gestureObj.touchPointerArr[i].pointerId) {\n                    touchPointerObj = gestureObj.touchPointerArr[i];\n                    break;\n                }\n            }\n\n            //null should not be possible\n\n            touchPointerObj.relX = event.relX;\n            touchPointerObj.relY = event.relY;\n\n            if (!gestureObj.isInProgress) { // only one finger down & pinching hasn't started\n                const distance = dist(touchPointerObj.downRelX, touchPointerObj.downRelY, touchPointerObj.relX, touchPointerObj.relY);\n                if (distance > firstFingerMaxDistancePx) { // moved too much -> fail\n                    fail();\n                    return;\n                }\n\n            } else {\n                if (i < 2) { // only first two touches can affect pinching\n                    continuePinch(gestureObj, {\n                        type: 'move',\n                        index: i\n                    });\n                }\n            }\n\n            return;\n        }\n\n\n        //pointer up\n        if (event.type === 'pointerup') {\n            //gesture object should always exist here\n\n            if (event.pointerType === 'touch') {\n                let i = 0;\n                for (; i < gestureObj.touchPointerArr.length; i++) {\n                    if (gestureObj.touchPointerArr[i].pointerId === event.pointerId) {\n                        gestureObj.touchPointerArr.splice(i, 1);\n                        break;\n                    }\n                }\n                if (gestureObj.touchPointerArr.length > 0) {\n                    continuePinch(gestureObj, {\n                        type: 'up',\n                        index: i\n                    });\n                }\n\n            } else { // non-touch\n                for (let i = 0; i < gestureObj.otherPointerIdArr.length; i++) {\n                    if (gestureObj.otherPointerIdArr[i] === event.pointerId) {\n                        gestureObj.otherPointerIdArr.splice(i, 1);\n                        break;\n                    }\n                }\n            }\n\n            //all fingers lifted?\n            if (gestureObj.touchPointerArr.length === 0 && gestureObj.otherPointerIdArr.length === 0) {\n                if (gestureObj.isInProgress) { // lifted last finger -> end of pinching\n                    end();\n                    endPinch();\n                } else { // lifted finger again before pinching started -> fail\n                    fail();\n                }\n                return;\n            }\n\n        }\n\n\n    }\n\n\n    // --- actual pinch transform logic ---\n\n    let pincherArr = [];\n\n    function beginPinch(gestureObj) {\n\n        for (let i = 0; i < gestureObj.touchPointerArr.length; i++) {\n            const pointerObj = gestureObj.touchPointerArr[i];\n            pincherArr.push({\n                pointerId: pointerObj.pointerId,\n                relX: pointerObj.relX,\n                relY: pointerObj.relY,\n                downRelX: pointerObj.relX,\n                downRelY: pointerObj.relY\n            });\n        }\n\n        const event: any = {\n            type: 'move',\n            angleRad: 0,\n            scale: 1\n        };\n\n        if (pincherArr.length === 1) {\n            event.relX = pincherArr[0].downRelX;\n            event.relY = pincherArr[0].downRelY;\n        } else {\n            event.relX = 0.5 * (pincherArr[0].downRelX + pincherArr[1].downRelX);\n            event.relY = 0.5 * (pincherArr[0].downRelY + pincherArr[1].downRelY);\n        }\n        event.downRelX = event.relX;\n        event.downRelY = event.relY;\n\n        p.onPinch(event);\n\n    }\n\n    //actionObj = {type: 'down'|'move'|'up', index: number}\n    function continuePinch(gestureObj, actionObj) {\n\n        if (actionObj.index > 1) { // only first two pointers matter\n            return;\n        }\n\n        if (actionObj.type === 'move') {\n\n            let event;\n            pincherArr[actionObj.index].relX = gestureObj.touchPointerArr[actionObj.index].relX;\n            pincherArr[actionObj.index].relY = gestureObj.touchPointerArr[actionObj.index].relY;\n\n            if (pincherArr.length === 1) {\n\n                event = {\n                    type: 'move',\n                    downRelX: pincherArr[0].downRelX,\n                    downRelY: pincherArr[0].downRelY,\n                    relX: pincherArr[0].relX,\n                    relY: pincherArr[0].relY,\n                    angleRad: 0,\n                    scale: 1\n                };\n\n            } else {\n\n                const startDist = dist(pincherArr[0].downRelX, pincherArr[0].downRelY, pincherArr[1].downRelX, pincherArr[1].downRelY);\n                const distance = dist(pincherArr[0].relX, pincherArr[0].relY, pincherArr[1].relX, pincherArr[1].relY);\n\n                const startAngle = pointsToAngleRad({\n                    x: pincherArr[0].downRelX,\n                    y: pincherArr[0].downRelY\n                }, {x: pincherArr[1].downRelX, y: pincherArr[1].downRelY});\n                const angle = pointsToAngleRad({\n                    x: pincherArr[0].relX,\n                    y: pincherArr[0].relY\n                }, {x: pincherArr[1].relX, y: pincherArr[1].relY});\n\n                event = {\n                    type: 'move',\n                    downRelX: 0.5 * (pincherArr[0].downRelX + pincherArr[1].downRelX),\n                    downRelY: 0.5 * (pincherArr[0].downRelY + pincherArr[1].downRelY),\n                    relX: 0.5 * (pincherArr[0].relX + pincherArr[1].relX),\n                    relY: 0.5 * (pincherArr[0].relY + pincherArr[1].relY),\n                    angleRad: angle - startAngle,\n                    scale: distance / startDist\n                };\n\n            }\n\n            p.onPinch(event);\n\n        } else if (actionObj.type === 'down' || actionObj.type === 'up') {\n            endPinch();\n            beginPinch(gestureObj);\n        }\n\n    }\n\n    function endPinch() {\n        pincherArr = [];\n        p.onPinch({\n            type: 'end'\n        });\n    }\n\n\n    // --- interface ---\n\n    this.chainIn = function (event) {\n        processEvent(event);\n        if (gestureObj) {\n            if (!gestureObj.isInProgress) { // might still fail -> into queue\n                eventQueueArr.push(event);\n            }\n        } else {\n            return event;\n        }\n        return null;\n    };\n\n    this.setChainOut = function (func) {\n        chainOut = func;\n    };\n};\n\n\n/**\n * A ChainElement. Splits up coalesced events into their own pointermove events. Otherwise regular pass through.\n *\n * @constructor\n */\nexport const CoalescedExploder = function () {\n\n    let chainOut: ChainOutFunc = function () {\n    };\n\n    // --- interface ---\n\n    this.chainIn = function (event) {\n\n        if (event.type === 'pointermove') {\n\n            if (event.coalescedArr.length > 0) {\n\n                let eventCopy = JSON.parse(JSON.stringify(event));\n                eventCopy.coalescedArr = [];\n                let coalescedItem;\n\n                for (let i = 0; i < event.coalescedArr.length; i++) {\n\n                    if (i > 0) {\n                        eventCopy = JSON.parse(JSON.stringify(event));\n                    }\n                    coalescedItem = event.coalescedArr[i];\n\n                    eventCopy.pageX = coalescedItem.pageX;\n                    eventCopy.pageY = coalescedItem.pageY;\n                    eventCopy.relX = coalescedItem.relX;\n                    eventCopy.relY = coalescedItem.relY;\n                    eventCopy.dX = coalescedItem.dX;\n                    eventCopy.dY = coalescedItem.dY;\n                    eventCopy.time = coalescedItem.time;\n                    if (i < event.coalescedArr.length - 1) {\n                        eventCopy.isCoalesced = true;\n                    }\n\n                    chainOut(eventCopy);\n                }\n\n            } else {\n                return event;\n            }\n        } else {\n            return event;\n        }\n\n        return null;\n    };\n\n    this.setChainOut = function (func) {\n        chainOut = func;\n    };\n};\n\nexport const OnePointerLimiter = function (pointers?) {\n\n    let chainOut: ChainOutFunc = function () {\n    };\n\n    let downPointerId = null;\n    const ignorePointerIdArr = [];\n\n\n    // --- interface ---\n\n    this.chainIn = function (event) {\n\n        if (ignorePointerIdArr.includes(event.pointerId)) {\n            if (event.type === 'pointerup') {\n                for (let i = 0; i < ignorePointerIdArr.length; i++) {\n                    if (ignorePointerIdArr[i] === event.pointerId) {\n                        ignorePointerIdArr.splice(i, 1);\n                        break;\n                    }\n                }\n            }\n            return null;\n        }\n\n        if (downPointerId === null) {\n            if (event.type === 'pointerdown') {\n                downPointerId = event.pointerId;\n            }\n            return event;\n\n        } else {\n            if (event.pointerId !== downPointerId) {\n                if (event.type === 'pointerdown') {\n                    ignorePointerIdArr.push(event.pointerId);\n                }\n                return null;\n            }\n            if (event.type === 'pointerup') {\n                downPointerId = null;\n            }\n            return event;\n        }\n\n        return null;\n\n    };\n\n    this.setChainOut = function (func) {\n        chainOut = func;\n    };\n\n};\n\n\n/**\n * Not really and event chain element. but pretty similar.\n *\n * Processes draw input events. When shift held -> linetool\n * line events - what KlCanvasWorkspace passes onDraw(e)\n *\n * p = {\n *     onDraw: function(drawEvent)\n * }\n *\n * pass input in with process(drawEvent)\n *\n * modifies draw event to include such events:\n * {\n *     type: 'line',\n *     x0: null, // you have to fill that in\n *     y0: null, // you have to fill that in\n *     pressure0: null, // you have to fill that in\n *     x1: number,\n *     y1: number,\n *     pressure1: number\n * }\n *\n * @param p\n * @constructor\n */\nexport const LinetoolProcessor = function (p) {\n\n    let downEvent = null;\n    let eventQueue = [];\n    let direction = null;\n    const DIR_X = 0, DIR_Y = 1;\n\n    this.process = function (event) {\n        if (event.type === 'down') {\n            downEvent = event;\n            direction = null;\n\n            if (event.shiftIsPressed) {\n\n                p.onDraw({\n                    type: 'line',\n                    x0: null,\n                    y0: null,\n                    pressure0: null,\n                    x1: event.x,\n                    y1: event.y,\n                    pressure1: event.pressure\n                });\n\n                eventQueue.push(event);\n                return;\n            }\n\n        }\n\n        if (event.type === 'move') {\n\n            if (event.shiftIsPressed) {\n\n                if (direction === null) {\n                    const dX = Math.abs(event.x - downEvent.x);\n                    const dY = Math.abs(event.y - downEvent.y);\n\n                    if (dX > 5 || dY > 5) {\n                        direction = dX > dY ? DIR_X : DIR_Y;\n\n                        for (let i = 0; i < eventQueue.length; i++) {\n                            const e = eventQueue[i];\n                            if (direction === DIR_X) {\n                                e.y = downEvent.y;\n                            } else {\n                                e.x = downEvent.x;\n                            }\n                            p.onDraw(JSON.parse(JSON.stringify(e)));\n                        }\n                        eventQueue = [];\n                    }\n                }\n\n                if (direction === null) {\n                    eventQueue.push(event);\n                    return;\n                }\n\n                if (direction === DIR_X) {\n                    event.y = downEvent.y;\n                } else {\n                    event.x = downEvent.x;\n                }\n\n            } else {\n                if (eventQueue.length > 0) {\n                    for (let i = 0; i < eventQueue.length; i++) {\n                        p.onDraw(JSON.parse(JSON.stringify(eventQueue[i])));\n                    }\n                    eventQueue = [];\n                }\n            }\n\n        }\n\n        if (event.type === 'up') {\n            eventQueue = [];\n        }\n\n        p.onDraw(JSON.parse(JSON.stringify(event)));\n    };\n};\n\n\n/**\n * cleans up DrawEvents. More trustworthy events. EventChain element\n *\n * that events can only go line this: down -> n x move -> up\n * so, sanitizes this: down, down, down. becomes only one down. the other downs are ignored/swallowed\n * @constructor\n */\nexport const LineSanitizer = function () {\n\n    let chainOut: ChainOutFunc = function () {\n    };\n\n    let isDrawing = false;\n\n    // --- interface ---\n    this.chainIn = function (event) {\n\n        if (event.type === 'down') {\n            if (isDrawing) {\n                //console.log('line sanitizer - down, but already drawing');\n                chainOut({\n                    type: 'up',\n                    scale: event.scale,\n                    shiftIsPressed: event.shiftIsPressed,\n                    isCoalesced: false\n                });\n            } else {\n                isDrawing = true;\n            }\n        }\n        if (!isDrawing && (event.type === 'move' || event.type === 'up')) {\n            //console.log('line sanitizer - ' + event.type + ' but not drawing');\n            return null;\n        }\n\n        if (event.type === 'up' && isDrawing) {\n            isDrawing = false;\n        }\n\n        return event;\n    };\n    this.setChainOut = function (func) {\n        chainOut = func;\n    };\n    this.getIsDrawing = function () {\n        return isDrawing;\n    };\n};\n\n\n/**\n * Line smoothing. EventChain element. Smoothing via blending new position with old position.\n * for onDraw events from KlCanvasWorkspace.\n *\n * p = {\n *     smoothing: number, // 0-1, 0: no smoothing, 1: 100% smoothing -> would never catch up\n * }\n *\n * smoothing > 0: will fire DrawEvents in interval when no new move events\n *\n * type: 'line' Events are just passed through.\n *\n * @param p\n * @constructor\n */\nexport const LineSmoothing = function (p) {\n\n    let chainOut: ChainOutFunc = function () {\n    };\n    let smoothing = clamp(p.smoothing, 0, 1);\n    let lastMixedInput;\n    let interval;\n    let timeout;\n\n    // --- interface ---\n\n    this.chainIn = function (event) {\n        event = JSON.parse(JSON.stringify(event));\n        clearTimeout(timeout);\n        clearInterval(interval);\n\n        if (event.type === 'down') {\n            lastMixedInput = {\n                x: event.x,\n                y: event.y,\n                pressure: event.pressure\n            };\n        }\n\n        if (event.type === 'move') {\n\n            const inputX = event.x;\n            const inputY = event.y;\n            const inputPressure = event.pressure;\n\n            event.x = mix(event.x, lastMixedInput.x, smoothing);\n            event.y = mix(event.y, lastMixedInput.y, smoothing);\n            event.pressure = mix(event.pressure, lastMixedInput.pressure, smoothing);\n            lastMixedInput = {\n                x: event.x,\n                y: event.y,\n                pressure: event.pressure\n            };\n\n            if (smoothing > 0) {\n                timeout = setTimeout(function () {\n                    interval = setInterval(function () {\n                        event = JSON.parse(JSON.stringify(event));\n\n                        event.x = mix(inputX, lastMixedInput.x, smoothing);\n                        event.y = mix(inputY, lastMixedInput.y, smoothing);\n                        event.pressure = mix(inputPressure, lastMixedInput.pressure, smoothing);\n                        lastMixedInput = {\n                            x: event.x,\n                            y: event.y,\n                            pressure: event.pressure\n                        };\n\n                        chainOut(event);\n                    }, 35);\n                }, 80);\n            }\n\n        }\n\n        return event;\n    };\n\n    this.setChainOut = function (func) {\n        chainOut = func;\n    };\n\n    this.setSmoothing = function (s) {\n        smoothing = clamp(s, 0, 1);\n    };\n};\n","import {IKeyString, IRect} from '../BB.types';\nimport {createCanvas} from './create-canvas';\n\nexport function copyCanvas(canvas: HTMLCanvasElement): HTMLCanvasElement {\n    const resultCanvas = createCanvas(canvas.width, canvas.height);\n    const ctx = resultCanvas.getContext('2d');\n    if (!ctx) {\n        throw new Error('2d context not supported or canvas already initialized');\n    }\n    ctx.drawImage(canvas, 0, 0);\n    return resultCanvas;\n}\n\n/**\n * Determine if should disable imageSmoothing for transformation.\n * ImageSmoothing can make images blurry even when they're in the original scale and aligned with the pixelgrid.\n */\nexport function testShouldPixelate(\n    transform: {x: number, y: number, width:number, height: number, angleDeg: number},\n    scaleX: number,\n    scaleY: number,\n): boolean {\n    if (\n        ![1, -1].includes(scaleX) || ![1, -1].includes(scaleY) ||\n        transform.width % 1 !== 0 || transform.height % 1 !== 0 ||\n        Math.abs(transform.angleDeg) % 90 !== 0\n    ) {\n        return false;\n    }\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\n    const width = whSwapped ? transform.height : transform.width;\n    const height = whSwapped ? transform.width : transform.height;\n    return (\n            (Math.abs(width) % 2 === 0 && transform.x % 1 === 0) ||\n            (Math.abs(width) % 2 === 1 && transform.x % 1 === 0.5)\n        ) &&\n        (\n            (Math.abs(height) % 2 === 0 && transform.y % 1 === 0) ||\n            (Math.abs(height) % 2 === 1 && transform.y % 1 === 0.5)\n        );\n}\n\n\n/**\n * @param destCtx - the canvas that will be drawn on\n * @param transformImage - image that will be drawn on canvas\n * @param transform - {x, y, width, height, angle} - x and y are center of transformImage\n * @param bounds object - optional {x, y, width, height} - crop of transformImage in transformImage image space\n * @param pixelated\n */\nexport function drawTransformedImageWithBounds(\n    destCtx: CanvasRenderingContext2D,\n    transformImage: HTMLImageElement | HTMLCanvasElement,\n    transform: {x: number, y: number, width:number, height: number, angleDeg: number},\n    bounds?: {x: number, y: number, width: number, height: number},\n    pixelated?: boolean,\n): void {\n    if (!bounds) {\n        bounds = {\n            x: 0,\n            y: 0,\n            width: transformImage.width,\n            height: transformImage.height\n        };\n    }\n\n    destCtx.save();\n    if (pixelated) {\n        destCtx.imageSmoothingEnabled = false;\n    } else {\n        destCtx.imageSmoothingEnabled = true;\n        destCtx.imageSmoothingQuality = 'high';\n    }\n\n    destCtx.translate(transform.x, transform.y);\n    destCtx.rotate(transform.angleDeg / 180 * Math.PI);\n    destCtx.scale(transform.width > 0 ? 1 : -1, transform.height > 0 ? 1 : -1);\n    destCtx.drawImage(\n        transformImage,\n        bounds.x, bounds.y, bounds.width, bounds.height,\n        -Math.abs(transform.width) / 2, -Math.abs(transform.height) / 2, Math.abs(transform.width), Math.abs(transform.height));\n\n    destCtx.restore();\n}\n\n/**\n * all transformations are optional\n * center is the point around which will be scaled and rotated\n *\n * @param baseCanvas canvas - the canvas that will be drawn on\n * @param transformImage image|canvas - image that will be drawn on canvas\n * @param transformObj {center: {x, y}, scale: {x, y}, translate: {x, y}, angleDegree}\n */\nexport function drawTransformedImageOnCanvas(\n    baseCanvas: HTMLCanvasElement,\n    transformImage: HTMLImageElement | HTMLCanvasElement,\n    transformObj: {\n        center: {x: number, y: number},\n        scale: {x: number, y: number},\n        translate: {x: number, y: number},\n        angleDegree: number,\n    },\n): void {\n    transformObj = JSON.parse(JSON.stringify(transformObj));\n    if (!transformObj.center) {\n        transformObj.center = {\n            x: transformImage.width / 2,\n            y: transformImage.height / 2\n        }\n    }\n    if (!transformObj.scale) {\n        transformObj.scale = {\n            x: 1,\n            y: 1\n        };\n    }\n    if (!transformObj.angleDegree) {\n        transformObj.angleDegree = 0;\n    }\n    if (!transformObj.translate) {\n        transformObj.translate = {\n            x: 0,\n            y: 0\n        };\n    }\n\n    const ctx = baseCanvas.getContext('2d');\n    if (!ctx) {\n        throw new Error('2d context not supported or canvas already initialized');\n    }\n    ctx.save();\n    if (\n        Math.abs(transformObj.scale.x - 1) >  0.000001 ||\n        Math.abs(transformObj.scale.y - 1) > 0.000001 ||\n        Math.abs(transformObj.angleDegree % 90) > 0.000001\n    ) {\n        ctx.imageSmoothingEnabled = true;\n        ctx.imageSmoothingQuality = 'high';\n    } else {\n        ctx.imageSmoothingEnabled = false;\n    }\n\n    ctx.translate(transformObj.translate.x, transformObj.translate.y);\n    ctx.translate(transformObj.center.x, transformObj.center.y);\n    ctx.rotate(transformObj.angleDegree / 180 * Math.PI);\n    ctx.scale(transformObj.scale.x, transformObj.scale.y);\n    ctx.translate(-transformObj.center.x, -transformObj.center.y);\n    ctx.drawImage(transformImage, 0, 0, transformImage.width, transformImage.height);\n\n    ctx.restore();\n}\n\nexport const createCheckerCanvas = function(size: number): HTMLCanvasElement {\n    const canvas = createCanvas();\n    let ctx;\n    if (size < 1) {\n        canvas.width = 1;\n        canvas.height = 1;\n        ctx = canvas.getContext('2d');\n        if (!ctx) {\n            throw new Error('2d context not supported or canvas already initialized');\n        }\n        ctx.fillStyle = 'rgb(128, 128, 128)';\n        ctx.fillRect(0, 0, 1, 1);\n    } else if (size > 200) {\n        canvas.width = 401;\n        canvas.height = 401;\n    } else {\n        canvas.width = size * 2;\n        canvas.height = size * 2;\n        ctx = canvas.getContext('2d');\n        if (!ctx) {\n            throw new Error('2d context not supported or canvas already initialized');\n        }\n        ctx.fillStyle = 'rgb(255, 255, 255)';\n        ctx.fillRect(0, 0, size * 2, size * 2);\n        ctx.fillStyle = 'rgb(200, 200, 200)';\n        ctx.fillRect(0, 0, size, size);\n        ctx.fillRect(size, size, size * 2, size * 2);\n    }\n    return canvas;\n};\n\nexport const createCheckerDataUrl = (function () {\n    const cache: IKeyString = { // previously created dataUrls\n        '8': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMElEQVQ4T2M8ceLEfwY8wNzcHJ80A+OoAcMiDP7//483HZw8eRJ/Ohg1gIFx6IcBAIhJUqnarXQ1AAAAAElFTkSuQmCC',\n        '4': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAJ0lEQVQoU2M8ceLEfwYkYG5ujsxlYKSDgv///6O44eTJk6huoL0CAGsOKVVu8UYvAAAAAElFTkSuQmCC'\n    };\n\n    return function (size: number, callback?: (s: string) => void) {\n        function create(size: number): string {\n            size = parseInt('' + size);\n            if (cache['' + size]) {\n                return cache['' + size];\n            }\n            const canvas = createCheckerCanvas(size);\n            const result = canvas.toDataURL('image/png');\n            cache['' + size] = result;\n            return result;\n        }\n\n        if (callback) { //async\n            setTimeout(function () {\n                callback(create(size));\n            }, 1);\n        } else { //sync\n            return create(size);\n        }\n    };\n})();\n\n/**\n * smooth resize image\n * @param canvas canvas - will be resized (modified)\n * @param w\n * @param h\n * @param tmp1 canvas - optional, provide to save resources\n * @param tmp2 canvas - optional, provide to save resources\n */\nexport function resizeCanvas(\n    canvas: HTMLCanvasElement,\n    w: number,\n    h: number,\n    tmp1?: HTMLCanvasElement,\n    tmp2?: HTMLCanvasElement,\n): void {\n\n    //determine base 2 exponents of old and new size\n    function getBase2Obj(oldW: number, oldH: number, newW: number, newH: number) {\n        const result = {\n            oldWidthEx: Math.round(Math.log2(oldW)),\n            oldHeightEx: Math.round(Math.log2(oldH)),\n            newWidthEx: Math.ceil(Math.log2(newW)),\n            newHeightEx: Math.ceil(Math.log2(newH))\n        };\n        result.oldWidthEx = Math.max(result.oldWidthEx, result.newWidthEx);\n        result.oldHeightEx = Math.max(result.oldHeightEx, result.newHeightEx);\n        return result;\n    }\n\n    if (!w || !h || (w === canvas.width && h === canvas.height)) {\n        return;\n    }\n    w = Math.max(w, 1);\n    h = Math.max(h, 1);\n    if (w <= canvas.width && h <= canvas.height) {\n\n        tmp1 = !tmp1 ? createCanvas() : tmp1;\n        tmp2 = !tmp2 ? createCanvas() : tmp2;\n\n        const base2 = getBase2Obj(canvas.width, canvas.height, w, h);\n\n        //initially scale to a base of 2. unless new size is too close to old. e.g. sizing from 900 to 600\n        tmp2.width = base2.oldWidthEx > base2.newWidthEx ? Math.pow(2, base2.oldWidthEx) : w;\n        tmp2.height = base2.oldHeightEx > base2.newHeightEx ? Math.pow(2, base2.oldHeightEx) : h;\n        tmp1.getContext('2d')!.save();\n        tmp2.getContext('2d')!.save();\n\n        let ew, eh;\n        let buffer1 = tmp1, buffer2 = tmp2;\n\n        ew = base2.oldWidthEx;\n        eh = base2.oldHeightEx;\n\n        let bufferCtx = buffer2.getContext('2d')!;\n        bufferCtx.imageSmoothingEnabled = true;\n        bufferCtx.imageSmoothingQuality  = 'high';\n        bufferCtx.globalCompositeOperation  = 'copy';\n        bufferCtx.drawImage(canvas, 0, 0, buffer2.width, buffer2.height);\n\n        let currentWidth = buffer2.width;\n        let currentHeight = buffer2.height;\n\n        //stepwise half the size\n        for (; ew > base2.newWidthEx || eh > base2.newHeightEx; ew--, eh--) {\n            bufferCtx = buffer1.getContext('2d')!;\n            bufferCtx.imageSmoothingEnabled = true;\n            bufferCtx.imageSmoothingQuality  = 'high';\n            bufferCtx.globalCompositeOperation  = 'copy';\n\n            const newWidth = (ew > base2.newWidthEx) ? currentWidth / 2 : currentWidth;\n            const newHeight = (eh > base2.newHeightEx) ? currentHeight / 2 : currentHeight;\n\n            //buffer also needs to be properly sized, unfortunately\n            buffer1.width = newWidth;\n            buffer1.height = newHeight;\n\n            bufferCtx.drawImage(\n                buffer2,\n                0, 0,\n                currentWidth, currentHeight,\n                0, 0,\n                newWidth, newHeight\n            );\n            currentWidth = newWidth;\n            currentHeight = newHeight;\n\n            //swap\n            const tmp = buffer1;\n            buffer1 = buffer2;\n            buffer2 = tmp;\n        }\n\n        //when no longer can be halved, bring to target size\n        canvas.width = w;\n        canvas.height = h;\n        const canvasCtx = canvas.getContext('2d')!;\n        canvasCtx.save();\n        canvasCtx.imageSmoothingEnabled = true;\n        canvasCtx.imageSmoothingQuality  = 'high';\n        canvasCtx.drawImage(\n            buffer2,\n            0, 0,\n            currentWidth, currentHeight,\n            0, 0,\n            w, h\n        );\n        canvasCtx.restore();\n        tmp1.getContext('2d')!.restore();\n        tmp2.getContext('2d')!.restore();\n\n    } else if (w >= canvas.width && h >= canvas.height) {\n\n        tmp1 = !tmp1 ? createCanvas() : tmp1;\n        tmp1.width = w;\n        tmp1.height = h;\n        const tmp1Ctx = tmp1.getContext('2d')!;\n        tmp1Ctx.save();\n        tmp1Ctx.imageSmoothingEnabled = true;\n        tmp1Ctx.imageSmoothingQuality  = 'high';\n        tmp1Ctx.drawImage(canvas, 0, 0, w, h);\n        tmp1Ctx.restore();\n\n        canvas.width = w;\n        canvas.height = h;\n        canvas.getContext('2d')!.drawImage(tmp1, 0, 0);\n\n    } else {\n        resizeCanvas(canvas, w, canvas.height, tmp1, tmp2);\n        resizeCanvas(canvas, w, h, tmp1, tmp2);\n    }\n}\n\n/**\n * puts naive greyscale version of image into alpha channel.\n * only writes a, doesn't write rgb\n * @param canvas\n */\nexport function convertToAlphaChannelCanvas(canvas: HTMLCanvasElement): void {\n    const imdat = canvas.getContext('2d')!.getImageData(0, 0, canvas.width, canvas.height);\n    for (let i = 0; i < imdat.data.length; i += 4) {\n        if (imdat.data[i + 3] === 0) {\n            continue;\n        }\n        imdat.data[i + 3] = (imdat.data[i] + imdat.data[i + 1] + imdat.data[i + 2]) / 3 * (imdat.data[i + 3] / 255);\n    }\n    canvas.getContext('2d')!.putImageData(imdat, 0, 0);\n}\n\n/**\n * Sometimes garbage collection is too slow, and canvases use up too much memory,\n * or there is a hard to fix memory leak.\n * This function manually makes the canvas use as little memory as possible.\n */\nexport function freeCanvas(canvas: HTMLCanvasElement): void {\n    canvas.width = 1;\n    canvas.height = 1;\n    const ctx = canvas.getContext('2d');\n    ctx && ctx.clearRect(0, 0, 1, 1);\n}\n\n/**\n * Determine bounding box that describes all pixels which are not fully transparent.\n * Returns null if empty.\n *\n * @param context\n */\nexport function canvasBounds(context: CanvasRenderingContext2D): IRect | null {\n    let boundsObj: {\n        x: number;\n        y: number;\n        width: number;\n        height: number;\n    } = { x: 0, y: 0, width: 0, height: 0 };\n    {\n        let tempBounds: any = {\n            x1: null,\n            y1: null,\n            x2: null,\n            y2: null\n        };\n        let imdat = context.getImageData(0, 0, context.canvas.width, context.canvas.height);\n\n        if (imdat.data[3] > 0 && imdat.data[imdat.data.length - 1] > 0) {\n            tempBounds.x1 = 0;\n            tempBounds.y1 = 0;\n            tempBounds.x2 = context.canvas.width - 1;\n            tempBounds.y2 = context.canvas.height - 1;\n        } else {\n            for (let i = 3; i < imdat.data.length; i += 4) {\n                if (imdat.data[i] > 0 ) {\n                    let x = ((i - 3) / 4) %  context.canvas.width;\n                    let y = Math.floor((i - 3) / 4 / context.canvas.width);\n                    if (tempBounds.x1 > x || tempBounds.x1 === null) {\n                        tempBounds.x1 = x;\n                    }\n                    if (tempBounds.y1 === null) {\n                        tempBounds.y1 = y;\n                    }\n                    if (tempBounds.x2 < x || tempBounds.x2 === null) {\n                        tempBounds.x2 = x;\n                    }\n                    if (tempBounds.y2 < y || tempBounds.y2 === null) {\n                        tempBounds.y2 = y;\n                    }\n                }\n            }\n        }\n        if (tempBounds.x1 === null || tempBounds.y1 === null) {\n            return null;\n        }\n        boundsObj.x = tempBounds.x1;\n        boundsObj.y = tempBounds.y1;\n        boundsObj.width = tempBounds.x2 - tempBounds.x1 + 1;\n        boundsObj.height = tempBounds.y2 - tempBounds.y1 + 1;\n    }\n    return boundsObj;\n}","export const Matrix = (function () {\n\n    // https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Matrix_math_for_the_web\n    // yes not optimized - but it's not used for physics simulations.\n\n    // const perfTotal = 0;\n\n    // point • matrix\n    function multiplyMatrixAndPoint(matrix, point) {\n        const result = [\n            (point[0] * matrix[0]) + (point[1] * matrix[4]) + (point[2] * matrix[8]) + (point[3] * matrix[12]), // x\n            (point[0] * matrix[1]) + (point[1] * matrix[5]) + (point[2] * matrix[9]) + (point[3] * matrix[13]), // y\n            (point[0] * matrix[2]) + (point[1] * matrix[6]) + (point[2] * matrix[10]) + (point[3] * matrix[14]), // z\n            (point[0] * matrix[3]) + (point[1] * matrix[7]) + (point[2] * matrix[11]) + (point[3] * matrix[15]) // w\n        ];\n        return result;\n    }\n\n    //matrixB • matrixA\n    function multiplyMatrices(matrixA, matrixB) {\n\n        // Slice the second matrix up into rows\n        const row0 = [matrixB[0], matrixB[1], matrixB[2], matrixB[3]];\n        const row1 = [matrixB[4], matrixB[5], matrixB[6], matrixB[7]];\n        const row2 = [matrixB[8], matrixB[9], matrixB[10], matrixB[11]];\n        const row3 = [matrixB[12], matrixB[13], matrixB[14], matrixB[15]];\n\n        // Multiply each row by matrixA\n        const result0 = multiplyMatrixAndPoint(matrixA, row0);\n        const result1 = multiplyMatrixAndPoint(matrixA, row1);\n        const result2 = multiplyMatrixAndPoint(matrixA, row2);\n        const result3 = multiplyMatrixAndPoint(matrixA, row3);\n\n        // Turn the result rows back into a single matrix\n        return [\n            result0[0], result0[1], result0[2], result0[3],\n            result1[0], result1[1], result1[2], result1[3],\n            result2[0], result2[1], result2[2], result2[3],\n            result3[0], result3[1], result3[2], result3[3]\n        ];\n    }\n\n    function createTranslationMatrix(x, y) {\n        return [\n            1, 0, 0, 0,\n            0, 1, 0, 0,\n            0, 0, 1, 0,\n            x, y, 0, 1\n        ];\n    }\n\n    function createRotationMatrix(angleRad) {\n        //let angleRad = angleDeg / 360 * 2 * Math.PI;\n        return [\n            Math.cos(-angleRad), -Math.sin(-angleRad), 0, 0,\n            Math.sin(-angleRad), Math.cos(-angleRad), 0, 0,\n            0, 0, 1, 0,\n            0, 0, 0, 1\n        ];\n    }\n\n    function createScaleMatrix(f) {\n        return [\n            f, 0, 0, 0,\n            0, f, 0, 0,\n            0, 0, 1, 0,\n            0, 0, 0, 1\n        ];\n    }\n\n    return {\n        getIdentity: function () {\n            return [\n                1, 0, 0, 0,\n                0, 1, 0, 0,\n                0, 0, 1, 0,\n                0, 0, 0, 1\n            ];\n        },\n        multiplyMatrixAndPoint: multiplyMatrixAndPoint,\n        multiplyMatrices: multiplyMatrices,\n        createTranslationMatrix: createTranslationMatrix,\n        createRotationMatrix: createRotationMatrix,\n        createScaleMatrix: createScaleMatrix\n    };\n})();","import {IVector2D} from '../BB.types';\n\nexport const Vec2 = {\n    add: function (p1: IVector2D, p2: IVector2D): IVector2D {\n        return {x: p1.x + p2.x, y: p1.y + p2.y};\n    },\n    sub: function (p1: IVector2D, p2: IVector2D): IVector2D {\n        return {x: p1.x - p2.x, y: p1.y - p2.y};\n    },\n    nor: function (p: IVector2D): IVector2D {\n        const len = Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\n        return {x: p.x / len, y: p.y / len};\n    },\n    len: function (p: IVector2D): number {\n        return Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\n    },\n    dist: function (p1: IVector2D, p2: IVector2D): number {\n        return Vec2.len(Vec2.sub(p1, p2));\n    },\n    mul: function (p: IVector2D, s: number): IVector2D {\n        return {x: p.x * s, y: p.y * s};\n    },\n    angle: function (p1: IVector2D, p2: IVector2D): number {\n        return Math.atan2(p2.y - p1.y, p2.x - p1.x);\n    },\n    dot: function(a: IVector2D, b: IVector2D): number {\n        const aArr = [a.x, a.y];\n        const bArr = [b.x, b.y];\n        return aArr.map((x, i) => aArr[i] * bArr[i]).reduce((m, n) => m + n);\n    }\n};","import {Vec2} from './vec2';\nimport {pointsToAngleDeg, clamp, dist, mix} from './math';\nimport {IVector2D} from \"../bb.types\";\n\n/**\n * project p onto line\n * @param lineStart\n * @param lineEnd\n * @param p\n */\nexport const projectPointOnLine = function (lineStart: IVector2D, lineEnd: IVector2D, p: IVector2D): IVector2D {\n    let x, y;\n    if (lineStart.x === lineEnd.x) {\n        x = lineStart.x;\n        y = p.y;\n\n        return {\n            x: x,\n            y: y\n        };\n    }\n    const m = (lineEnd.y - lineStart.y) / (lineEnd.x - lineStart.x);\n    const b = lineStart.y - (m * lineStart.x);\n\n    x = (m * p.y + p.x - m * b) / (m * m + 1);\n    y = (m * m * p.y + m * p.x + b) / (m * m + 1);\n\n    return {\n        x: x,\n        y: y\n    };\n};\n\n\n\n/**\n * Operations on a line made up of points\n *\n * getAtDist(dist) - point when traveling *dist* along the line\n * getLength - gives you total length of line\n *\n * @param params object - {points: [{x:float, y:float}, ...]}\n * @constructor\n */\nexport const PointLine = function (params) {\n    const segmentArr = [];\n    const _this = this;\n\n    for (let i = 0; i < params.points.length; i++) {\n        (function (i) {\n            let length = undefined;\n            if (i < params.points.length - 1) {\n                length = dist(params.points[i].x, params.points[i].y, params.points[i + 1].x, params.points[i + 1].y);\n            }\n            segmentArr[i] = {\n                x: params.points[i].x,\n                y: params.points[i].y,\n                length: length\n            };\n        })(i);\n    }\n\n    /**\n     * @param dist number - distance in pixels, > 0\n     * @returns {{x: number, y: number}}\n     */\n    this.getAtDist = function (dist) {\n        let remainder = Math.min(_this.getLength(), dist);\n        let i = 0;\n\n        for (; remainder > segmentArr[i].length && i < segmentArr.length - 2; i++) {\n            remainder -= segmentArr[i].length;\n        }\n\n        const fac = Math.min(1, Math.max(0, remainder / segmentArr[i].length));\n\n        return {\n            x: (segmentArr[i].x * (1 - fac) + segmentArr[i + 1].x * fac),\n            y: (segmentArr[i].y * (1 - fac) + segmentArr[i + 1].y * fac)\n        };\n    };\n    this.getLength = function () {\n        let result = 0;\n        for (let i = 0; i < segmentArr.length - 1; i++) {\n            result += segmentArr[i].length;\n        }\n        return result;\n    };\n};\n\n/**\n * Each instance is one line made up of bezier interpolated segments.\n * You feed it points. It calculates control points on its own, and the resulting curve.\n *\n * @constructor\n */\nexport const BezierLine = function () {\n    const _this = this;\n    const pointArr = [];\n    let lastDot = 0;\n    let lastPoint;\n    let lastCallbackPoint;\n    let lastAngle;\n    let lastSpacing = null;\n\n    /**\n     * creates bezier curve from control points\n     *\n     * @param p1 - control point 1 {x: float, y: float}\n     * @param p2 - control point 2 {x: float, y: float}\n     * @param p3 - control point 3 {x: float, y: float}\n     * @param p4 - control point 4 {x: float, y: float}\n     * @param resolution - int\n     * @returns {Array} - bezier curve made up of points {x: float, y: float}\n     */\n    function getBezierPoints(p1, p2, p3, p4, resolution) {\n        const curvePoints = [];\n        let t, result;\n        for (let i = 0; i <= resolution; i++) {\n            t = i / resolution;\n            result = {};\n            result.x = Math.pow(1 - t, 3) * p1.x + 3 * Math.pow(1 - t, 2) * t * p2.x + 3 * (1 - t) * Math.pow(t, 2) * p3.x + Math.pow(t, 3) * p4.x;\n            result.y = Math.pow(1 - t, 3) * p1.y + 3 * Math.pow(1 - t, 2) * t * p2.y + 3 * (1 - t) * Math.pow(t, 2) * p3.y + Math.pow(t, 3) * p4.y;\n            curvePoints[curvePoints.length] = result;\n        }\n        return curvePoints;\n    }\n\n    /**\n     *\n     * add now point to line\n     * line will go until the previous point\n     *\n     * @param x - coord of new point\n     * @param y - coord of new point\n     * @param spacing - space between each step\n     * @param callback - calls for each step - x, y, t - t is 0-1 how far along\n     * @param controlsCallback - calls that callback with the bezier control points p1, p2, p3, p4 - each {x: float, y: float}\n     */\n    this.add = function (x, y, spacing, callback, controlsCallback) {\n        if (lastPoint && x === lastPoint.x && y === lastPoint.y) {\n            return;\n        }\n        lastPoint = {x: x, y: y};\n        pointArr[pointArr.length] = {\n            x: x,\n            y: y,\n            spacing: spacing\n        };\n\n        //calculate directions\n        if (pointArr.length === 1) {\n            lastSpacing = spacing;\n            return;\n        } else if (pointArr.length === 2) {\n            pointArr[0].dir = Vec2.nor(Vec2.sub(pointArr[1], pointArr[0]));\n            lastDot = spacing;\n            lastSpacing = spacing;\n            return;\n        } else {\n            const pointM1 = pointArr[pointArr.length - 1];\n            const pointM2 = pointArr[pointArr.length - 2];\n            const pointM3 = pointArr[pointArr.length - 3];\n            pointM2.dir = Vec2.nor(Vec2.sub(pointM1, pointM3));\n            if (isNaN(pointM2.dir.x) || isNaN(pointM2.dir.y)) {\n                //when xy -3 == -1\n                pointM2.dir = JSON.parse(JSON.stringify(pointM3.dir));\n            }\n        }\n\n        //get bezier curve\n        const a = pointArr[pointArr.length - 3];\n        const b = pointArr[pointArr.length - 2];\n        const p1 = a;\n        const p2 = Vec2.add(a, Vec2.mul(a.dir, Vec2.dist(a, b) / 4));\n        const p3 = Vec2.sub(b, Vec2.mul(b.dir, Vec2.dist(a, b) / 4));\n        const p4 = b;\n\n\n        let pointLine;\n        if (callback) {\n            let curvePoints;\n            curvePoints = getBezierPoints(p1, p2, p3, p4, 20);\n            pointLine = new PointLine({points: curvePoints});\n        } else {\n            pointLine = new PointLine({points: [p1, p4]});\n        }\n\n        //interate over curve with spacing and callback\n        const len = pointLine.getLength();\n        let tempSpacing = mix(lastSpacing, spacing, clamp(lastDot / len, 0, 1));\n        let d = lastDot;\n        for (; d <= len; d += tempSpacing) {\n            tempSpacing = mix(lastSpacing, spacing, clamp(d / len, 0, 1));\n            const point = pointLine.getAtDist(d);\n            const angle = lastCallbackPoint ? pointsToAngleDeg(lastCallbackPoint, point) : undefined;\n            if (callback) {\n                callback({\n                    x: point.x,\n                    y: point.y,\n                    t: d / len,\n                    angle: angle,\n                    dAngle: lastCallbackPoint ? angle - lastAngle : 0\n                });\n            }\n            lastCallbackPoint = point;\n            lastAngle = angle;\n        }\n\n        if (callback) {\n            lastDot = d - len;\n        } else {\n            lastDot = 0;\n            controlsCallback({p1: p1, p2: p2, p3: p3, p4: p4});\n        }\n\n        lastSpacing = spacing;\n    };\n\n    this.addFinal = function(spacing, callback, controlsCallback) {\n        if (pointArr.length < 2) {\n            return;\n        }\n\n        const p1 = pointArr[pointArr.length - 2];\n        const p2 = pointArr[pointArr.length - 1];\n\n        const newP = Vec2.add(p2, Vec2.sub(p2, p1));\n\n        _this.add(newP.x, newP.y, spacing, callback, controlsCallback);\n    };\n\n};\n\n/**\n * from glfx.script by evanW:\n * from SplineInterpolator.cs in the Paint.NET source code\n *\n * points go 0 - 1. I think.\n *\n * @param points\n * @constructor\n */\nexport const SplineInterpolator = function (points) {\n    const n = points.length;\n    this.xa = [];\n    this.ya = [];\n    this.u = [];\n    this.y2 = [];\n    let i;\n\n    const first = points[0][0];\n    const last = points[points.length - 1][0];\n\n    points.sort(function (a, b) {\n        return a[0] - b[0];\n    });\n    for (i = 0; i < n; i++) {\n        this.xa.push(points[i][0]);\n        this.ya.push(points[i][1]);\n    }\n\n    this.u[0] = 0;\n    this.y2[0] = 0;\n\n    for (i = 1; i < n - 1; ++i) {\n        // This is the decomposition loop of the tridiagonal algorithm.\n        // y2 and u are used for temporary storage of the decomposed factors.\n        const wx = this.xa[i + 1] - this.xa[i - 1];\n        const sig = (this.xa[i] - this.xa[i - 1]) / wx;\n        const p = sig * this.y2[i - 1] + 2.0;\n\n        this.y2[i] = (sig - 1.0) / p;\n\n        const ddydx =\n            (this.ya[i + 1] - this.ya[i]) / (this.xa[i + 1] - this.xa[i]) -\n            (this.ya[i] - this.ya[i - 1]) / (this.xa[i] - this.xa[i - 1]);\n\n        this.u[i] = (6.0 * ddydx / wx - sig * this.u[i - 1]) / p;\n    }\n\n    this.y2[n - 1] = 0;\n\n    // This is the backsubstitution loop of the tridiagonal algorithm\n    for (i = n - 2; i >= 0; --i) {\n        this.y2[i] = this.y2[i] * this.y2[i + 1] + this.u[i];\n    }\n\n    this.getFirstX = function () {\n        return first;\n    };\n    this.getLastX = function () {\n        return last;\n    };\n};\n\nSplineInterpolator.prototype.interpolate = function (x) {\n    const n = this.ya.length;\n    let klo = 0;\n    let khi = n - 1;\n\n    // We will find the right place in the table by means of\n    // bisection. This is optimal if sequential calls to this\n    // routine are at random values of x. If sequential calls\n    // are in order, and closely spaced, one would do better\n    // to store previous values of klo and khi.\n    while (khi - klo > 1) {\n        const k = (khi + klo) >> 1;\n\n        if (this.xa[k] > x) {\n            khi = k;\n        } else {\n            klo = k;\n        }\n    }\n\n    const h = this.xa[khi] - this.xa[klo];\n    const a = (this.xa[khi] - x) / h;\n    const b = (x - this.xa[klo]) / h;\n\n    // Cubic spline polynomial is now evaluated.\n    return a * this.ya[klo] + b * this.ya[khi] +\n        ((a * a * a - a) * this.y2[klo] + (b * b * b - b) * this.y2[khi]) * (h * h) / 6.0;\n};\n\n/**\n * find x to y. simply by stepping through. suboptimal, so don't call often.\n * searches in x 0-1 range\n *\n * @param y\n * @param resolution\n */\nSplineInterpolator.prototype.findX = function (y, resolution) {\n    let x = null;\n    let dist = null;\n    for (let i = 0; i <= resolution; i++) {\n        const tempX = i / resolution;\n        const tempY = this.interpolate(tempX);\n        if (x === null) {\n            x = tempX;\n            dist = Math.abs(tempY - y);\n            continue;\n        }\n\n        const tempDist = Math.abs(tempY - y);\n\n        if (tempDist < dist) {\n            x = tempX;\n            dist = tempDist;\n        } else {\n            //distance increasing\n            break;\n        }\n    }\n    return x;\n};\n\n/**\n * input for a spline, following curve of quadratic function x^2 [0 - 1]\n * returns [[0, startVal], ..., [1, endVal]]\n * @param startVal\n * @param endVal\n * @param stepSize\n * @returns {[]}\n */\nexport const quadraticSplineInput = function (startVal, endVal, stepSize) {\n    function round(v, dec) {\n        return Math.round(v * Math.pow(10, dec)) / Math.pow(10, dec);\n    }\n\n    const resultArr = [];\n    for (let i = 0; i <= 1; i += stepSize) {\n        resultArr.push([round(i, 4), round(startVal + Math.pow(i, 2) * (endVal - startVal), 4)]);\n    }\n    return resultArr;\n};","\n\n\n// based on js color conversion http://www.webtoolkit.info/\n\n\nexport class HSV {\n    h: number;\n    s: number;\n    v: number;\n    constructor(h: number, s: number, v: number) {\n        this.h = Math.max(0, Math.min(360, h));\n        this.s = Math.max(0.001, Math.min(100, s)); //bug when 0\n        this.v = Math.max(0, Math.min(100, v));\n    }\n}\n\nexport class RGB {\n    r : number;\n    g: number;\n    b: number;\n    constructor(r: number, g: number, b: number) {\n        this.r = Math.max(0, Math.min(255, r));\n        this.g = Math.max(0, Math.min(255, g));\n        this.b = Math.max(0, Math.min(255, b));\n    }\n}\n\nexport class CMYK {\n    c: number;\n    m: number;\n    y: number;\n    k: number;\n    constructor(c: number, m: number, y: number, k: number) {\n        this.c = Math.max(0, Math.min(100, c));\n        this.m = Math.max(0, Math.min(100, m));\n        this.y = Math.max(0, Math.min(100, y));\n        this.k = Math.max(0, Math.min(100, k));\n    }\n}\n\nexport const ColorConverter = {\n\n    _RGBtoHSV: function (RGB: RGB): HSV {\n        const result = new HSV(0, 0, 0);\n\n        const r = RGB.r / 255;\n        const g = RGB.g / 255;\n        const b = RGB.b / 255;\n\n        const minVal = Math.min(r, g, b);\n        const maxVal = Math.max(r, g, b);\n        const delta = maxVal - minVal;\n\n        result.v = maxVal;\n\n        if (delta == 0) {\n            result.h = 0;\n            result.s = 0;\n        } else {\n            result.s = delta / maxVal;\n            const del_R = (((maxVal - r) / 6) + (delta / 2)) / delta;\n            const del_G = (((maxVal - g) / 6) + (delta / 2)) / delta;\n            const del_B = (((maxVal - b) / 6) + (delta / 2)) / delta;\n\n            if (r == maxVal) {\n                result.h = del_B - del_G;\n            } else if (g == maxVal) {\n                result.h = (1 / 3) + del_R - del_B;\n            } else if (b == maxVal) {\n                result.h = (2 / 3) + del_G - del_R;\n            }\n\n            if (result.h < 0) {\n                result.h += 1;\n            }\n            if (result.h > 1) {\n                result.h -= 1;\n            }\n        }\n\n        result.h = Math.round(result.h * 360);\n        result.s = Math.round(result.s * 100);\n        result.v = Math.round(result.v * 100);\n\n        return result;\n    },\n\n    _HSVtoRGB: function (HSV: HSV): RGB {\n        const result = new RGB(0, 0, 0);\n\n        let var_h, var_i, var_1, var_2, var_3, var_r, var_g, var_b;\n\n        const h = (HSV.h / 360) % 1;\n        const s = HSV.s / 100;\n        const v = HSV.v / 100;\n\n        if (s == 0) {\n            result.r = v * 255;\n            result.g = v * 255;\n            result.b = v * 255;\n        } else {\n            var_h = h * 6;\n            var_i = Math.floor(var_h);\n            var_1 = v * (1 - s);\n            var_2 = v * (1 - s * (var_h - var_i));\n            var_3 = v * (1 - s * (1 - (var_h - var_i)));\n\n            if (var_i == 0) {\n                var_r = v;\n                var_g = var_3;\n                var_b = var_1\n            } else if (var_i == 1) {\n                var_r = var_2;\n                var_g = v;\n                var_b = var_1\n            } else if (var_i == 2) {\n                var_r = var_1;\n                var_g = v;\n                var_b = var_3\n            } else if (var_i == 3) {\n                var_r = var_1;\n                var_g = var_2;\n                var_b = v\n            } else if (var_i == 4) {\n                var_r = var_3;\n                var_g = var_1;\n                var_b = v\n            } else {\n                var_r = v;\n                var_g = var_1;\n                var_b = var_2\n            }\n\n            result.r = var_r * 255;\n            result.g = var_g * 255;\n            result.b = var_b * 255;\n\n            result.r = Math.round(result.r);\n            result.g = Math.round(result.g);\n            result.b = Math.round(result.b);\n        }\n\n        return result;\n    },\n\n    _CMYKtoRGB: function (CMYK: CMYK): RGB {\n        const result = new RGB(0, 0, 0);\n\n        const c = CMYK.c / 100;\n        const m = CMYK.m / 100;\n        const y = CMYK.y / 100;\n        const k = CMYK.k / 100;\n\n        result.r = 1 - Math.min(1, c * (1 - k) + k);\n        result.g = 1 - Math.min(1, m * (1 - k) + k);\n        result.b = 1 - Math.min(1, y * (1 - k) + k);\n\n        result.r = Math.round(result.r * 255);\n        result.g = Math.round(result.g * 255);\n        result.b = Math.round(result.b * 255);\n\n        return result;\n    },\n\n    _RGBtoCMYK: function (RGB: RGB): CMYK {\n        const result = new CMYK(0, 0, 0, 0);\n\n        const r = RGB.r / 255;\n        const g = RGB.g / 255;\n        const b = RGB.b / 255;\n\n        result.k = Math.min(1 - r, 1 - g, 1 - b);\n        result.c = (1 - r - result.k) / (1 - result.k);\n        result.m = (1 - g - result.k) / (1 - result.k);\n        result.y = (1 - b - result.k) / (1 - result.k);\n\n        result.c = Math.round(result.c * 100);\n        result.m = Math.round(result.m * 100);\n        result.y = Math.round(result.y * 100);\n        result.k = Math.round(result.k * 100);\n\n        return result;\n    },\n\n    toRGB: function (o: RGB | HSV | CMYK): RGB {\n        if (o instanceof RGB) {\n            return o;\n        }\n        if (o instanceof HSV) {\n            return this._HSVtoRGB(o);\n        }\n        if (o instanceof CMYK) {\n            return this._CMYKtoRGB(o);\n        }\n    },\n\n    toHSV: function (o: RGB | HSV | CMYK): HSV {\n        if (o instanceof HSV) {\n            return o;\n        }\n        if (o instanceof RGB) {\n            return this._RGBtoHSV(o);\n        }\n        if (o instanceof CMYK) {\n            return this._RGBtoHSV(this._CMYKtoRGB(o));\n        }\n    },\n\n    toCMYK: function (o: RGB | HSV | CMYK): CMYK {\n        if (o instanceof CMYK) {\n            return o;\n        }\n        if (o instanceof RGB) {\n            return this._RGBtoCMYK(o);\n        }\n        if (o instanceof HSV) {\n            return this._RGBtoCMYK(this._HSVtoRGB(o));\n        }\n    },\n    toHexString: function (o: RGB): string {\n        if (o instanceof RGB || ('r' in o && 'g' in o && 'b' in o)) {\n            let ha = (parseInt('' + o.r)).toString(16);\n            let hb = (parseInt('' + o.g)).toString(16);\n            let hc = (parseInt('' + o.b)).toString(16);\n            if (ha.length == 1)\n                ha = '0' + ha;\n            if (hb.length == 1)\n                hb = '0' + hb;\n            if (hc.length == 1)\n                hc = '0' + hc;\n            return ha + hb + hc;\n        }\n    },\n    toRgbStr: function(rgbObj: {r: number, g: number, b: number}): string {\n        return 'rgb(' + Math.round(rgbObj.r) + ', ' + Math.round(rgbObj.g) + ', ' + Math.round(rgbObj.b) + ')';\n    },\n    toRgbaStr: function(rgbaObj: {r: number, g: number, b: number, a: number}): string {\n        return 'rgba(' + Math.round(rgbaObj.r) + ', ' + Math.round(rgbaObj.g) + ', ' + Math.round(rgbaObj.b) + ', ' + rgbaObj.a + ')';\n    },\n    hexToRGB: function(hexStr: string): RGB | null {\n        hexStr = hexStr.trim();\n        // Expand shorthand form (e.g. \"03F\") to full form (e.g. \"0033FF\")\n        const shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\n        hexStr = hexStr.replace(shorthandRegex, function(m, r, g, b) {\n            return r + r + g + g + b + b;\n        });\n\n        const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hexStr);\n        return result ? new RGB(\n            parseInt(result[1], 16),\n            parseInt(result[2], 16),\n            parseInt(result[3], 16)\n        ) : null;\n    }\n\n};\n\nexport function testIsWhiteBestContrast(rgbObj: {r: number, g: number, b: number}): boolean {\n    return (rgbObj.r * 0.299 + rgbObj.g * 0.587 + rgbObj.b * 0.114) < 125;\n}","import {addEventListener} from '../input/event-listener';\nimport {css} from './base';\nimport {BB} from '../bb';\n\n\nexport function appendTextDiv(target: HTMLElement, text: string): HTMLDivElement {\n    const div = document.createElement('div');\n    div.innerHTML = text;\n    target.appendChild(div);\n    return div;\n}\n\n/**\n * Is an input element focused.\n * Set attribute \"data-ignore-focus\" to \"true\" if its focus should be ignored.\n *\n * @param getAll - check all, even those with \"data-ignore-focus\" = \"true\"\n */\nexport function isInputFocused(getAll: boolean = false): boolean {\n    let result = document.activeElement && ['INPUT', 'TEXTAREA'].includes(document.activeElement.tagName);\n    if (getAll) {\n        return result;\n    } else {\n        return result && !document.activeElement.getAttribute('data-ignore-focus');\n    }\n}\n\nexport function unfocusAnyInput(): void {\n    if (isInputFocused(true)) {\n        /*\n            Unfocus anything that is focused.\n\n            If an Input is focused in Firefox, and it gets detached from the DOM via a Node\n            that isn't its direct parent, then Firefox will keep anything attached to this\n            Input in memory. It will not be garbage collected until a new Input is focused.\n\n            Workaround: Temporarily create an input, focus it, detach it.\n             */\n        const focusEl = BB.el({\n            parent: document.body,\n            tagName: 'input',\n            css: {\n                opacity: '0',\n                width: '0',\n                height: '0',\n            }\n        }) as HTMLInputElement;\n        setTimeout(() => {\n            focusEl.select();\n            focusEl.focus();\n            focusEl.parentNode.removeChild(focusEl);\n        }, 10);\n    }\n}\n\n/**\n * clears text selection in window\n */\nexport function clearSelection(): void {\n    if (window.getSelection) {\n        const sel = window.getSelection();\n        if (sel) {\n            if (sel.empty) {\n                sel.empty();\n            } else if (sel.removeAllRanges) {\n                sel.removeAllRanges();\n            }\n        }\n    } else if ('selection' in document) {\n        (document as any).selection.empty();\n    }\n}\n\n/**\n * prevents being able to focus element.\n * warning: it creates a listener\n *\n * @param el - dom element\n */\nexport const makeUnfocusable = (function() {\n\n    function preventFocus(event: MouseEvent) {\n        event.preventDefault();\n        let didFocusRelated = false;\n        if (event.relatedTarget) {\n            try {\n                (event.relatedTarget as HTMLElement).focus();\n                didFocusRelated = true;\n            } catch(e) {\n                console.error('failed to focus');\n            }\n        }\n        if (!didFocusRelated) {\n            (event.currentTarget as HTMLElement).blur();\n        }\n    }\n\n    return function(el) {\n        el.setAttribute('tabindex', '-1');\n        addEventListener(el, 'focus', preventFocus);\n    };\n})();\n\n\nconst els: {\n    el: HTMLElement;\n    listeners: [string, any][];\n}[] = [];\n// window['els'] = els;\n\n/**\n *\n * Create DOM element - div by default\n * params = {\n * \t    parent: someOtherDiv,\n * \t    css: {\n * \t\t    width: \"500px\",\n * \t\t    backgroundColor: \"#fff\"\n * \t    },\n * \t    content: \"test\", //or  content: [divA, divB, divC]   or content: someDiv\n * \t    className: \"bla\",\n *      id: \"bla\"\n * }\n *\n *  If onClick or onChange is used, then BB.destroyEl MUST be called\n *  to prevent a memory leak.\n *\n * @param params\n */\nexport function el(\n    params: {\n        parent?: HTMLElement,\n        css?: { [key: string]: string },\n        custom?: { [key: string]: any },\n        content?: string | (HTMLElement | string | null)[] | HTMLElement | SVGElement,\n        textContent?: string,\n        className?: string,\n        title?: string,\n        id?: string,\n        tagName?: string,\n        onClick?: (e: Event) => void,\n        onChange?: (e: Event) => void,\n    }\n): HTMLElement {\n    const div = document.createElement(params.tagName ? params.tagName : 'div');\n    if (params.css) {\n        css(div, params.css);\n    }\n\n    if (params.content) {\n        if (typeof params.content === typeof 'aa') {\n            div.innerHTML = params.content as string;\n\n        } else if (Array.isArray(params.content)) {\n            BB.append(div, params.content);\n\n        } else {\n            div.appendChild(params.content as HTMLElement);\n\n        }\n    }\n    if (params.textContent) {\n        div.textContent = params.textContent;\n    }\n    if (params.className) {\n        div.className = params.className;\n    }\n    if (params.id) {\n        div.id = params.id;\n    }\n    if (params.parent) {\n        params.parent.appendChild(div);\n    }\n    if ('title' in params && params.title !== undefined) {\n        div.title = params.title;\n    }\n    const listeners = [];\n    if ('onClick' in params) {\n        addEventListener(div, 'click', params.onClick);\n        listeners.push(['click', params.onClick]);\n    }\n    if ('onChange' in params) {\n        addEventListener(div, 'change', params.onChange);\n        listeners.push(['change', params.onChange]);\n    }\n    if (listeners.length > 0) {\n        els.push({\n            el: div,\n            listeners: listeners,\n        })\n        /*div.style.backgroundColor = '#ff0';\n        div.style.border = '1px solid #ff0';*/\n    }\n    if ('custom' in params) {\n        const customKeyArr = Object.keys(params.custom);\n        for (let i = 0; i < customKeyArr.length; i++) {\n            div.setAttribute(customKeyArr[i], params.custom[customKeyArr[i]]);\n        }\n    }\n    return div;\n}\n\n/**\n * removes event listeners for Elements created via el()\n * @param el\n */\nexport function destroyEl(el: HTMLElement) {\n    for (let i = 0; i < els.length; i++) {\n        const item = els[i];\n        if (item.el === el) {\n            item.listeners.forEach(item => {\n                el.removeEventListener(item[0], item[1]);\n            });\n            els.splice(i, 1);\n            return;\n        }\n    }\n    // not found\n    return;\n}\n","\nexport class BbLog {\n\n    private static listeners: any[] = [];\n\n    constructor() {\n    }\n\n    static subscribe(listener) {\n        if (BbLog.listeners.includes(listener)) {\n            return;\n        }\n        BbLog.listeners.push(listener);\n    }\n\n    static unsubscribe(listener) {\n        for (let i = 0; i < BbLog.listeners.length; i++) {\n            if (listener === BbLog.listeners[i]) {\n                BbLog.listeners.splice(i, 1);\n                return;\n            }\n        }\n    }\n\n    static emit (msg) {\n        BbLog.listeners.forEach(item => {\n            item(msg);\n        });\n    }\n}",null,"/**\n * LocalStorage wrapper that does not throw exceptions.\n * If cookies disabled in Safari localStorage interactions throw exception \"insecure operation\"\n */\nexport class LocalStorage {\n\n    private static error;\n\n    static getItem (key: string): string {\n        let result = null;\n        try {\n            result = localStorage.getItem(key);\n        } catch (e) {\n            this.error = e;\n        }\n        return result;\n    }\n\n    static setItem (key: string, value: string): void {\n        try {\n            localStorage.setItem(key, value);\n        } catch (e) {\n            this.error = e;\n        }\n    }\n\n    static removeItem (key: string): void {\n        try {\n            localStorage.removeItem(key);\n        } catch (e) {\n            this.error = e;\n        }\n    }\n\n    static getError (): any {\n        return this.error;\n    }\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"l7FYj\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kbyFQ\");","import {BB} from '../../../bb/bb';\n\n/**\n * Checkbox - with label\n */\nexport class Checkbox {\n\n    private element: HTMLElement;\n    private check: HTMLInputElement;\n    private doHighlight: boolean;\n\n    // --- public ---\n\n    constructor (params: {\n        init?: boolean; // default false\n        label: string;\n        callback: (boolean) => void;\n        allowTab?: boolean; // default false\n        title?: string;\n        doHighlight?: boolean; // default false\n        css?: any;\n    }) {\n        this.doHighlight = params.doHighlight;\n\n        this.element = BB.el({\n            className: 'kl-checkbox'\n        });\n\n        const innerEl = BB.el({\n            parent: this.element,\n            tagName: 'label',\n            className: 'kl-checkbox__inner'\n        });\n\n        this.check = BB.el({\n            parent: innerEl,\n            tagName: 'input',\n            css: {\n                marginLeft: '0',\n                display: 'inline-block'\n            },\n            custom: {\n                type: 'checkbox'\n            }\n        }) as HTMLInputElement;\n        this.check.checked = params.init;\n        if (this.doHighlight && this.check.checked) {\n            this.element.classList.add('kl-checkbox--highlight');\n        }\n        if (!params.allowTab) {\n            this.check.tabIndex = -1;\n        }\n\n        if (params.title) {\n            innerEl.title = params.title;\n        }\n\n        const label = document.createElement('div');\n        label.style.display = 'inline-block';\n        label.innerHTML = params.label;\n        (label as any).allowClick = true;\n        innerEl.appendChild(label);\n\n        this.check.onchange = () => {\n            if (this.doHighlight) {\n                this.element.classList.toggle('kl-checkbox--highlight', this.check.checked);\n            }\n            params.callback(this.check.checked);\n            setTimeout(() => {\n                this.check.blur();\n            }, 0);\n        };\n        if (params.css) {\n            BB.css(this.element, params.css);\n        }\n    }\n\n    getValue(): boolean {\n        return this.check.checked;\n    }\n\n    setValue(b: boolean) {\n        this.check.checked = !!b;\n        if (this.doHighlight) {\n            this.element.classList.toggle('kl-checkbox--highlight', this.check.checked);\n        }\n    }\n\n    getElement(): HTMLElement {\n        return this.element;\n    }\n\n    destroy() {\n        this.check.onchange = null;\n    }\n\n}\n","import {BB} from '../../../bb/bb';\nimport {IKeyString} from '../../../bb/bb.types';\n\nexport const input = function (params: {\n    type?: 'button' | 'checkbox' | 'number' | 'text' | 'color'; // default text\n    min?: number;\n    max?: number;\n    callback: (val: string) => void;\n    init: string | number;\n    css?: IKeyString;\n}) {\n    const result = document.createElement('input');\n    if (params.type) {\n        try {\n            result.type = params.type;\n        } catch(e) {} // ie can't deal with number\n    } else {\n        result.type = 'text';\n    }\n    if (params.min !== undefined) {\n        result.min = '' + params.min;\n    }\n    if (params.max !== undefined) {\n        result.max = '' + params.max;\n    }\n    result.value = '' + params.init;\n    if (params.callback) {\n        result.onchange = function() {\n            params.callback(result.value);\n        };\n    }\n    if (params.css) {\n        BB.css(result, params.css);\n    }\n\n    return result;\n};","import {BB} from '../../../bb/bb';\nimport {IKeyString} from '../../../bb/bb.types';\n\n/**\n * A select dropdown\n */\nexport class Select {\n\n    private selectEl: HTMLSelectElement;\n    private optionArr: ([string, string] | null)[]; // [value, label]\n    private changeListener: (event) => void;\n    private onChange: (val: string) => void;\n\n    \n    // --- public ---\n    constructor (p: {\n        isFocusable?: boolean; // default false\n        optionArr: ([string, string] | null)[], // [value, label]\n        initValue?: string; // default null\n        onChange: (val: string) => void;\n        css?: IKeyString;\n        title?: string;\n    }) {\n        this.selectEl = BB.el({\n            tagName: 'select',\n            title: p.title,\n            css: {\n                cursor: 'pointer',\n                fontSize: '15px',\n                padding: '3px',\n                background: '#fff', // makes safari pay attention to font-size\n                //webkitAppearance: 'none'\n                colorScheme: 'only light', // chrome doesn't properly invert the text color\n            }\n        }) as HTMLSelectElement;\n        if (p.css) {\n            BB.css(this.selectEl, p.css);\n        }\n\n        const isFocusable = p.isFocusable;\n        if (!isFocusable) {\n            this.selectEl.tabIndex = -1;\n        }\n        this.optionArr = p.optionArr;\n        for (let i = 0; i < this.optionArr.length; i++) {\n            if (this.optionArr[i] === null) {\n                continue;\n            }\n            const option = document.createElement('option');\n            option.value = this.optionArr[i][0];\n            option.textContent = this.optionArr[i][1];\n            this.selectEl.append(option);\n        }\n        this.onChange = p.onChange;\n        this.changeListener = (e) => {\n            if (!isFocusable) {\n                this.selectEl.blur();\n            }\n            this.onChange(this.selectEl.value);\n        };\n        this.selectEl.addEventListener('change', this.changeListener);\n        this.selectEl.value = 'initValue' in p ? p.initValue : null;\n    }\n\n    setValue (val) {\n        this.selectEl.value = val;\n    }\n\n    getValue () {\n        return this.selectEl.value;\n    }\n\n    setDeltaValue (delta) {\n        let index = 0;\n        for (let i = 0; i < this.optionArr.length; i++) {\n            if ('' + this.optionArr[i][0] === this.selectEl.value) {\n                index = i;\n                break;\n            }\n        }\n        index = Math.max(0, Math.min(this.optionArr.length -1, index + delta));\n        this.selectEl.value = this.optionArr[index][0];\n        this.onChange(this.selectEl.value);\n    }\n\n    getElement () {\n        return this.selectEl;\n    }\n\n    destroy = () => {\n        this.selectEl.removeEventListener('change', this.changeListener);\n    }\n    \n}\n","import {BB} from '../../../bb/bb';\n\n\n/**\n * Toggle button with an image\n *\n * p = {\n *     initValue: boolean,\n *     title: string,\n *     isRadio: boolean, // if true, can't click when active\n *     onChange: function(boolean)\n * }\n *\n * @param p\n * @constructor\n */\nexport const ImageToggle = function(p) {\n    let isActive = !!p.initValue;\n    const div = BB.el({\n        className: 'image-toggle',\n        title: p.title,\n        css: {\n            backgroundImage: \"url('\" + p.image + \"')\"\n        },\n        onClick: function(e) {\n            e.preventDefault();\n            if (p.isRadio && isActive) {\n                return;\n            }\n            isActive = !isActive;\n            update();\n            p.onChange(isActive);\n        },\n    });\n\n    function update() {\n        div.classList.toggle('image-toggle-active', isActive);\n    }\n\n    update();\n\n    // --- interface ---\n    this.setValue = function(b) {\n        isActive = !!b;\n        update();\n    };\n    this.getElement = function() {\n        return div;\n    };\n    this.getValue = function() {\n        return isActive;\n    };\n    this.destroy = () => {\n        BB.destroyEl(div);\n    };\n\n};","import {BB} from '../../../bb/bb';\nimport {ImageToggle} from './image-toggle';\n\n/**\n * Radio input group. each one has an image\n *\n * p = {\n *     optionArr: {\n *         id: string,\n *         title: string,\n *         image: string,\n *     }[],\n *     initId: string,\n *     sizePx: number,\n *     onChange: function(id: string): void\n * }\n *\n * @param p\n */\nexport const ImageRadioList = function(p) {\n\n    const div = BB.el({\n        className: 'image-radio-wrapper',\n        css: {\n            display: 'flex'\n        }\n    });\n\n    let activeIndex;\n    const optionArr = [];\n\n    function select(index, id) {\n        activeIndex = index;\n        for (let i = 0; i < optionArr.length; i++) {\n            optionArr[i].setValue(i === activeIndex);\n        }\n        p.onChange(id);\n    }\n\n    function createOption(index, o) {\n        if (o.id === p.initId) {\n            activeIndex = index;\n        }\n        const radioEl = new ImageToggle({\n            image: o.image,\n            title: o.title,\n            initValue: o.id === p.initId,\n            isRadio: true,\n            onChange: function() {\n                select(index, o.id);\n            }\n        });\n        div.appendChild(radioEl.getElement());\n\n        return radioEl;\n\n    }\n\n    for (let i = 0; i < p.optionArr.length; i++) {\n        optionArr.push(createOption(i, p.optionArr[i]));\n    }\n\n\n    // --- interface ---\n    this.getElement = function() {\n        return div;\n    };\n    this.getValue = function() {\n        return p.optionArr[activeIndex].id;\n    };\n    this.destroy = () => {\n        optionArr.forEach(item => {\n            item.destroy();\n        })\n    };\n};","import {BB} from '../../../bb/bb';\n// @ts-ignore\nimport iconImg from 'url:~/src/app/img/ui/brush-pressure.svg';\nimport {LANG} from '../../../language/language';\n\n\n/**\n * small toggle button with a pen icon - representing toggling pressure sensitivity\n * @param isChecked - boolean - initial value\n * @param changeCallback - function(isChecked boolean) - called on change\n * @returns {HTMLElement} - the toggle button\n */\nexport const penPressureToggle = function(isChecked, changeCallback) {\n\n    const toggleDiv = BB.el({\n        css: {\n            cssFloat: 'right',\n            borderRadius: '3px',\n            width: '18px',\n            height: '18px',\n            backgroundImage: 'url(\"' + iconImg + '\")',\n            backgroundSize: 'contain',\n            backgroundRepeat: 'no-repeat',\n            cursor: 'pointer',\n            boxSizing: 'border-box',\n            colorScheme: 'only light',\n        }\n    });\n\n    if (!BB.hasPointerEvents) {\n        toggleDiv.style.display = 'none';\n    }\n\n    function redraw() {\n        if (isChecked) {\n            BB.css(toggleDiv, {\n                backgroundColor: '#fff',\n                opacity: '0.9',\n                border: '1px solid var(--active-highlight-color)'\n            });\n        } else {\n            BB.css(toggleDiv, {\n                backgroundColor: 'transparent',\n                opacity: '0.5',\n                border: '1px solid #666'\n            });\n        }\n    }\n\n    toggleDiv.title = LANG('brush-toggle-pressure');\n    toggleDiv.onclick = function() {\n        isChecked = !isChecked;\n        redraw();\n        changeCallback(isChecked);\n    };\n\n    redraw();\n    changeCallback(isChecked);\n\n    return toggleDiv;\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"5H9IS\");","import {BB} from '../../../bb/bb';\nimport {calcSliderFalloffFactor} from './slider-falloff';\nimport {IKlSliderConfig} from '../../kl.types';\nimport {languageStrings} from '../../../language/language';\nimport {DoubleTapper, EventChain} from '../../../bb/input/event-chain';\nimport {KlSliderManualInput} from './kl-slider-manual-input';\n\n/**\n * Horizontal slider, can be changed by dragging anywhere on it. Has a label & value.\n * e.g. used for brush size\n *\n * left mouse button - set absolute value\n * right mouse button - change relative value\n * drag mouse vertically away - high precision mode\n * double-click/tap slider -> manual input mode\n *\n * Values can be spline interpolated\n * On change callback can be debounced\n *\n */\nexport class KlSlider {\n\n    /*\n    Three types of values\n    - value - the actual value, when using setValue(), getValue(), and what is emitted\n    - displayValue - the number that the user sees on the slider and in the manual input field\n        - might be further formatted with formatFunc\n        - also might be the same as value, if no toDisplayValue function provided\n    - sliderValue - the draggable position of the slider, 0 - 1\n     */\n\n    private value: number;\n\n    private elementWidth: number;\n    private elementHeight: number;\n    private isEnabled: boolean;\n\n    private min: number; // min value\n    private max: number; // max value\n    private useSpline: boolean;\n    private splineInterpolator: any; // todo type\n    private resolution: number;\n\n    private isChangeOnFinal: boolean;\n    private formatFunc: null | ((val: number) => number);\n\n    private onChange: (val: number) => void;\n    private valueToDisplayValue: (value: number) => number;\n    private displayValueToValue: (displayValue: number) => number;\n\n\n    private roolEl: HTMLElement;\n    private sliderWrapperEl: HTMLElement;\n    private textEl: HTMLElement; // displays label, displayValue\n    private label: string;\n    private control: HTMLElement;\n    private manualInput: null | KlSliderManualInput;\n    private manualInputRoundDigits: number;\n\n    private pointerListener: any; // todo type\n    private pointerListenerTimeout: any;\n\n    private eventResMs: null | number;\n    private emitValue: null | number = null; // next value for interval\n    private emitInterval: null | any; // interval of eventResMs which calls onChange()\n\n    private valueToSliderValue(value: number): number {\n        if (this.useSpline) {\n            return this.splineInterpolator.findX(value, Math.floor(this.resolution));\n        }\n        return (value - this.min) / (this.max - this.min);\n    }\n\n    private sliderValuetoValue(sliderValue: number): number {\n        let result = this.min + sliderValue * (this.max - this.min);\n        if (this.useSpline) {\n            result = this.splineInterpolator.interpolate(sliderValue);\n        }\n        return result;\n    }\n\n    private updateLabel(): void {\n        let displayValue: number | string = this.valueToDisplayValue(this.value);\n        displayValue = this.formatFunc ? this.formatFunc(displayValue) : Math.round(displayValue);\n        displayValue = displayValue.toLocaleString(languageStrings.getCode());\n        this.textEl.innerHTML = this.label + '&nbsp;&nbsp;<span style=\"font-weight:bold\">' + displayValue + '</span>';\n\n        const sliderValue = this.valueToSliderValue(this.value);\n        this.control.style.width = (sliderValue * this.elementWidth) + 'px';\n    }\n\n    private emit(isFinal: boolean): void {\n        if (!isFinal && this.isChangeOnFinal) {\n            return;\n        }\n\n        if (isFinal || !this.eventResMs) {\n            this.onChange(this.value);\n            if (this.emitInterval) {\n                clearInterval(this.emitInterval);\n                this.emitInterval = null;\n            }\n            return;\n        }\n\n        if (this.emitInterval) {\n            this.emitValue = this.value;\n\n        } else {\n            this.onChange(this.value);\n\n            this.emitInterval = setInterval(() => {\n                if (this.emitValue === null) {\n                    clearInterval(this.emitInterval);\n                    this.emitInterval = null;\n                } else {\n                    this.onChange(this.emitValue);\n                    this.emitValue = null;\n                }\n            }, this.eventResMs);\n        }\n    }\n\n    private updateEnable(): void {\n        BB.css(this.sliderWrapperEl, {\n            opacity: this.isEnabled ? null : '0.5',\n            pointerEvents: this.isEnabled ? null : 'none',\n        });\n        if (this.manualInput) {\n            this.manualInput.setIsEnabled(this.isEnabled);\n        }\n    }\n\n    private showManualInput(): void {\n\n        this.manualInput = new KlSliderManualInput(\n            this.valueToDisplayValue(this.value),\n            this.valueToDisplayValue(this.min),\n            this.valueToDisplayValue(this.max),\n            this.sliderWrapperEl.getBoundingClientRect(),\n            (val) => {\n                val = this.displayValueToValue(val);\n                this.setValue(BB.clamp(val, this.min, this.max));\n                this.onChange(this.value);\n            },\n            () => {\n                BB.css(this.sliderWrapperEl, {\n                    display: null,\n                });\n                this.roolEl.removeChild(this.manualInput.getElement());\n                this.manualInput.destroy();\n                this.manualInput = null;\n            },\n            (this.manualInputRoundDigits && this.manualInputRoundDigits > 0) ? this.manualInputRoundDigits : 0,\n        );\n        this.roolEl.append(this.manualInput.getElement());\n        setTimeout(() => {\n            this.manualInput.focus();\n        });\n        BB.css(this.sliderWrapperEl, {\n            display: 'none',\n        });\n    }\n\n\n    // --- public ---\n\n    constructor (\n        p: {\n            label: string,\n            width: number, // px\n            height: number, // px\n            min: number, // min value\n            max: number,\n            value: number,\n            resolution?: number, // int, if you want spline.findX() to use a custom resolution\n            curve?: 'quadratic' | any[], // optional. array is BB.SplineInterpolator points. 0-1\n            formatFunc?: (val: number) => number, // function to display a different number than value\n            onChange?: (val: number) => void,\n            isChangeOnFinal?: boolean, // only fire onChange on pointerUp\n            eventResMs?: number, // frequency of change events\n            isEnabled?: boolean, // default = true\n            manualInputRoundDigits?: number, // default 0, how value should be rounded for manual input\n            toDisplayValue?: (value: number) => number,\n            toValue?: (displayValue: number) => number,\n        }\n    ) {\n        const _this = this;\n        this.isEnabled = p.isEnabled !== false;\n        this.manualInputRoundDigits = p.manualInputRoundDigits;\n        this.useSpline = !!p.curve;\n\n        if (!p.label) {\n            throw new Error('KlSlider missing params');\n        }\n        if (p.min != 0 && p.max != 0 && p.value != 0) {\n            if (!p.min || !p.max || !p.value) {\n                throw new Error('KlSlider broken params');\n            }\n        }\n        if (p.min >= p.max) {\n            throw new Error('KlSlider broken params');\n        }\n\n        this.min = p.min;\n        this.max = p.max;\n        this.value = BB.clamp(p.value, this.min, this.max);\n        this.elementWidth = p.width;\n        this.elementHeight = p.height;\n        this.resolution = p.resolution ? p.resolution : this.elementWidth * 2;\n\n        this.onChange = p.onChange ? p.onChange : () => {};\n        if (!this.displayValueToValue !== !this.valueToDisplayValue) {\n            throw new Error('both or neither have to be set, toValue and toDisplayValue');\n        }\n        this.displayValueToValue = p.toValue ? p.toValue : (displayValue) => displayValue;\n        this.valueToDisplayValue = p.toDisplayValue ? p.toDisplayValue : (value) => value;\n        this.isChangeOnFinal = !!p.isChangeOnFinal;\n        this.formatFunc = p.formatFunc;\n        this.eventResMs = p.eventResMs;\n\n        if (this.useSpline) {\n            const curveArr = p.curve === 'quadratic' ? BB.quadraticSplineInput(this.min, this.max, 0.1) : p.curve;\n            this.splineInterpolator = new BB.SplineInterpolator(curveArr);\n        }\n\n        this.roolEl = BB.el({\n            css: {\n                display: 'flex',\n            }\n        });\n        this.sliderWrapperEl = BB.el({\n            parent: this.roolEl,\n            className: 'sliderWrapper',\n            css: {\n                overflow: 'hidden',\n                position: 'relative',\n                width: this.elementWidth + 'px',\n                height: this.elementHeight + 'px',\n                userSelect: 'none'\n            }\n        });\n        this.roolEl.oncontextmenu = function () {\n            return false;\n        };\n        this.label = p.label;\n        const labelFontSize = this.elementHeight - 14;\n        this.textEl = BB.el({\n            content: this.label,\n            css: {\n                position: 'absolute',\n                left: '7px',\n                top: (this.elementHeight / 2 - labelFontSize / 2 + 1) + 'px',\n                lineHeight: labelFontSize + 'px',\n                fontSize: labelFontSize + 'px',\n                pointerEvents: 'none'\n            }\n        });\n        this.control = BB.el({\n            className: 'sliderInner',\n            css: {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n                width: (this.valueToSliderValue(this.value) * this.elementWidth) + 'px',\n                height: this.elementHeight + 'px',\n            }\n        });\n        const controlInner = document.createElement('div');\n\n        this.sliderWrapperEl.append(this.control, this.textEl);\n        this.control.append(controlInner);\n\n        this.updateEnable();\n\n\n        const doubleTapper = new DoubleTapper({\n            onDoubleTap: () => {\n                this.showManualInput();\n            }\n        })\n        doubleTapper.setAllowedButtonArr(['left', 'right']);\n        const eventChain = new EventChain({\n            chainArr: [\n                doubleTapper\n            ]\n        });\n\n        let virtualVal;\n        const onPointer = (event) => {\n            event.eventPreventDefault();\n\n            if (!this.isEnabled) {\n                return;\n            }\n\n            if (event.type === 'pointerdown') {\n\n                // unfocus manual slider input\n                BB.unfocusAnyInput();\n\n                this.sliderWrapperEl.className = 'sliderWrapper sliderWrapperActive';\n\n                if (event.button === 'left') {\n                    let sliderValue = event.relX / this.elementWidth;\n                    sliderValue = Math.max(0, Math.min(1, sliderValue));\n                    this.value = this.sliderValuetoValue(sliderValue);\n                    this.updateLabel();\n                    this.emit(false);\n                }\n                virtualVal = this.valueToSliderValue(this.value);\n            }\n\n            if (event.type === 'pointermove' && ['left', 'right'].includes(event.button)) {\n\n                let deltaX = event.dX;\n                const deltaY = Math.abs(event.pageY - event.downPageY);\n                const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\n                deltaX *= factor;\n                deltaX /= this.elementWidth;\n\n                virtualVal += deltaX;\n\n                let sliderValue = Math.max(0, Math.min(1, virtualVal));\n                this.value = this.sliderValuetoValue(sliderValue);\n                this.updateLabel();\n                this.emit(false);\n            }\n\n            if (event.type === 'pointerup') {\n                this.sliderWrapperEl.className = 'sliderWrapper';\n                this.emit(true);\n            }\n\n        }\n\n        this.pointerListenerTimeout = setTimeout(() => {\n            this.pointerListener = new BB.PointerListener({\n                target: this.sliderWrapperEl,\n                maxPointers: 1,\n                fixScribble: true,\n                onPointer: (e) => {\n                    onPointer(e);\n                    eventChain.chainIn(e);\n                },\n                onWheel: (event) => {\n                    let sliderValue = this.valueToSliderValue(this.value);\n                    sliderValue = BB.clamp(sliderValue - event.deltaY / 40, 0, 1);\n                    this.value = this.sliderValuetoValue(sliderValue);\n                    this.updateLabel();\n                    this.onChange(this.value);\n                }\n            });\n            this.updateLabel();\n        }, 1);\n    }\n\n    changeSliderValue(f: number): void {\n        if (!this.isEnabled) {\n            return;\n        }\n        let sliderValue = this.valueToSliderValue(this.value);\n        sliderValue = BB.clamp(sliderValue + f, 0, 1);\n        this.value = this.sliderValuetoValue(sliderValue);\n        this.updateLabel();\n        this.onChange(this.value);\n    }\n\n    setValue (v: number): void {\n        this.value = BB.clamp(v, this.min, this.max);\n        this.updateLabel();\n    }\n\n    getValue (): number {\n        return this.value;\n    }\n\n    update (config: IKlSliderConfig): void {\n        this.min = config.min;\n        this.max = config.max;\n        this.useSpline = !!config.curve;\n        if (this.useSpline) {\n            const curveArr = config.curve === 'quadratic' ? BB.quadraticSplineInput(this.min, this.max, 0.1) : config.curve;\n            this.splineInterpolator = new BB.SplineInterpolator(curveArr);\n        } else {\n            this.splineInterpolator = null;\n        }\n        this.setIsEnabled(!config.isDisabled);\n    }\n\n    setIsEnabled (e: boolean): void {\n        this.isEnabled = !!e;\n        this.updateEnable();\n    }\n\n    destroy (): void {\n        clearTimeout(this.pointerListenerTimeout);\n        if (this.pointerListener) {\n            this.pointerListener.destroy();\n        }\n        if (this.manualInput) {\n            this.manualInput.destroy();\n        }\n        if (this.emitInterval) {\n            clearInterval(this.emitInterval);\n        }\n    }\n\n    getElement (): HTMLElement {\n        return this.roolEl;\n    }\n\n}\n","\n\n/**\n * to make sliders more finegrained.\n * @param deltaY number - how far pointer moved away vertically since down\n * @returns {number} the factor 0-1. 0 -> infinite movement for change of 1. 1 -> 1px for change of 1\n */\nexport const calcSliderFalloffFactor = function(deltaY, isRightButton) {\n    let result = Math.min(10, 1 + Math.pow(Math.floor(deltaY / 50), 2));\n    if (isRightButton) {\n        result *= 2;\n    }\n    return 1 / result;\n};\n","import {BB} from '../../../bb/bb';\nimport {input} from './input';\n\n/**\n * Used by KlSlider. Allows user to type in value in input (type=number) field, instead of dragging with mouse.\n * Input goes away when losing focus, or when pressing Enter/Escape.\n */\nexport class KlSliderManualInput {\n\n    private input: HTMLInputElement;\n    private isEnabled: boolean;\n    private scrollBefore: { x: number, y: number }; // window scroll position on creation\n    private lastValue: number; // last emitted value\n    private isClosed: boolean = false;\n\n    private emit(): void {\n        if (this.lastValue !== Number(this.input.value)) {\n            this.onChange(Number(this.input.value));\n            this.lastValue = Number(this.input.value);\n        }\n    }\n\n    private privateOnClose(): void {\n        if (this.isClosed) {\n            return;\n        }\n        this.isClosed = true;\n\n        this.emit();\n        this.onClose();\n        setTimeout(() => {\n            // because iPad keyboard changes the scroll position\n            window.scrollTo(this.scrollBefore.x, this.scrollBefore.y);\n            this.scrollBefore = null;\n        });\n    }\n\n    // --- public ---\n\n    constructor(\n        value: number, // initial value (displayValue)\n        min: number,\n        max: number,\n        rect: DOMRect, // size of input field\n        private onChange: (displayValue: number) => void,\n        private onClose: () => void,\n        roundDigits?: number,\n    ) {\n\n        this.input = input({\n            type: 'number',\n            init: value,\n            min,\n            max,\n            callback: (val) => {\n                this.emit();\n            },\n        });\n        if (roundDigits !== 0) {\n            this.input.setAttribute('step', 'any');\n        }\n        this.input.onblur = () => {\n            this.privateOnClose();\n        };\n        this.input.addEventListener('keyup', (e) => {\n            if (['Enter', 'Escape'].includes(e.key)) {\n                this.privateOnClose();\n            } else {\n                this.emit();\n            }\n        });\n        this.input.addEventListener('wheel', () => this.emit());\n\n        this.scrollBefore = {\n            x: window.scrollX,\n            y: window.scrollY,\n        };\n\n        let currentValue;\n        if (roundDigits || roundDigits === 0) {\n            currentValue = BB.round(value, roundDigits);\n        } else {\n            currentValue = value;\n        }\n        this.lastValue = currentValue;\n        this.input.value = '' + currentValue;\n\n        BB.css(this.input, {\n            width: rect.width + 'px',\n            height: rect.height + 'px',\n        });\n    }\n\n    getElement() {\n        return this.input;\n    }\n\n    setIsEnabled(b: boolean): void {\n        this.isEnabled = !!b;\n    }\n\n    focus(): void {\n        this.input.focus();\n        this.input.select();\n    }\n\n    destroy(): void {\n        BB.destroyEl(this.input);\n    }\n}","import {BB} from '../../../bb/bb';\nimport {input} from '../base-components/input';\nimport {popup} from './popup';\nimport {LANG} from '../../../language/language';\n// @ts-ignore\nimport copyImg from 'url:~/src/app/img/ui/copy.svg';\n\n/**\n * dialog for manually inputting the color\n * @param p {color: rgbObj, onClose: function(rgbObj | null)}\n * @constructor\n */\nexport const HexColorDialog = function (p) {\n\n    let lastValidRgb = new BB.RGB(p.color.r, p.color.g, p.color.b);\n\n    const div = BB.el({});\n\n    const previewEl = BB.el({\n        css: {\n            width: '20px',\n            height: '20px',\n            marginBottom: '10px',\n            boxShadow: 'inset 0 0 0 1px #fff, 0 0 0 1px #000',\n            background: '#' + BB.ColorConverter.toHexString(lastValidRgb),\n            colorScheme: 'only light',\n        }\n    });\n    div.appendChild(previewEl);\n\n\n    // --- Hex ---\n    const hexRowEl = BB.el({\n        css: {\n            display: 'flex',\n            alignItems: 'center',\n            marginBottom: '15px'\n        }\n    });\n    const hexLabel = BB.el({\n        content: LANG('mci-hex'),\n        css: {\n            width: '60px'\n        }\n    });\n    const hexInput = input({\n        init: '#' + BB.ColorConverter.toHexString(lastValidRgb),\n        css: {\n            width: '80px'\n        },\n        callback: function() {\n            let rgbObj = BB.ColorConverter.hexToRGB(hexInput.value);\n            if (rgbObj === null) {\n                rgbObj = lastValidRgb;\n                hexInput.value = '#' + BB.ColorConverter.toHexString(lastValidRgb);\n            } else {\n                lastValidRgb = rgbObj;\n            }\n            previewEl.style.background = '#' + BB.ColorConverter.toHexString(rgbObj);\n\n            for (let i = 0; i < rgbArr.length; i++) {\n                rgbArr[i].update();\n            }\n        }\n    });\n    const copyButton = BB.el({\n        tagName: 'button',\n        content: '<img src=\"' + copyImg + '\" height=\"20\"/>',\n        title: LANG('mci-copy'),\n        css: {\n            marginLeft: '10px'\n        },\n        onClick: function() {\n            hexInput.select();\n            document.execCommand('copy');\n        }\n    });\n    hexRowEl.appendChild(hexLabel);\n    hexRowEl.appendChild(hexInput);\n    hexRowEl.appendChild(copyButton);\n    div.appendChild(hexRowEl);\n    setTimeout(function () {\n        hexInput.focus();\n        hexInput.select();\n    }, 0);\n\n\n    // --- R G B ---\n    function createRgbInputRow(labelStr, attributeStr) {\n        const result: any = {};\n\n        const rowEl = BB.el({\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                marginTop: '5px',\n            }\n        });\n        const labelEl = BB.el({\n            content: labelStr,\n            css: {\n                width: '60px'\n            }\n        });\n\n        const inputEl = input({\n            init: lastValidRgb[attributeStr],\n            min: 0,\n            max: 255,\n            type: 'number',\n            css: {\n                width: '80px'\n            },\n            callback: function() {\n                if (inputEl.value === '' || parseFloat(inputEl.value) < 0 || parseFloat(inputEl.value) > 255) {\n                    result.update();\n                    return;\n                }\n                inputEl.value = '' + Math.round(parseFloat(inputEl.value));\n                lastValidRgb[attributeStr] = inputEl.value;\n                previewEl.style.background = '#' + BB.ColorConverter.toHexString(lastValidRgb);\n                hexInput.value = '#' + BB.ColorConverter.toHexString(lastValidRgb);\n            }\n        });\n\n        rowEl.appendChild(labelEl);\n        rowEl.appendChild(inputEl);\n        div.appendChild(rowEl);\n\n\n        result.update = function() {\n            inputEl.value = lastValidRgb[attributeStr];\n        };\n        result.destroy = () => {\n            inputEl.onchange = null;\n        };\n        return result;\n    }\n    const rgbArr = [];\n    rgbArr.push(createRgbInputRow(LANG('red'), 'r'));\n    rgbArr.push(createRgbInputRow(LANG('green'), 'g'));\n    rgbArr.push(createRgbInputRow(LANG('blue'), 'b'));\n\n\n    popup({\n        target: document.body,\n        message: `<b>${LANG('manual-color-input')}</b>`,\n        div: div,\n        autoFocus: false,\n        clickOnEnter: 'Ok',\n        buttons: ['Ok', 'Cancel'],\n        callback: function (resultStr) {\n            BB.destroyEl(copyButton);\n            rgbArr.forEach(item => item.destroy());\n            rgbArr.splice(0, rgbArr.length);\n\n            p.onClose(resultStr === 'Ok' ? BB.ColorConverter.hexToRGB(hexInput.value) : null);\n        }\n    });\n\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"la7yv\");","import {BB} from '../../../bb/bb';\nimport {HexColorDialog} from '../modals/color-slider-hex-dialog';\nimport {calcSliderFalloffFactor} from './slider-falloff';\n// @ts-ignore\nimport eyedropperImg from 'url:~/src/app/img/ui/tool-picker.svg';\nimport {LANG} from '../../../language/language';\n\n/**\n * big main HS+V color slider\n * 2 elements: slider, and colorpreview(output) + eyedropper\n *\n * p = {\n *     width: number,\n *     height: number, // hue slider and output height\n *     svHeight: number,\n *     startValue: rgb, // 0-255\n *     onPick: function(rgb)\n * }\n *\n * @param p\n * @constructor\n */\nexport const KlColorSlider = function (p) {\n\n    const _this = this;\n    let pickCallback = function(result?) {};\n    const div = document.createElement('div');\n    div.style.position = 'relative';\n    div.className = 'colorSlider';\n    const outputDiv = BB.el({\n        css: {\n            display: 'flex',\n            alignItems: 'center'\n        }\n    });\n    const width = p.width;\n    let svHeight = p.svHeight;\n    const height = p.height;\n    const emitColor = p.onPick;\n\n    let primaryColorRGB = {\n        r: parseInt(p.startValue.r, 10),\n        g: parseInt(p.startValue.g, 10),\n        b: parseInt(p.startValue.b, 10)\n    };\n    let primaryColorHSV = BB.ColorConverter.toHSV(p.startValue); // BB.HSV\n    let secondaryColorRGB = {r: 255, g: 255, b: 255};\n    let secondaryColorHSV = BB.ColorConverter._RGBtoHSV(secondaryColorRGB); // BB.HSV\n\n    const svWrapper = BB.el({});\n    const svSvg = new DOMParser().parseFromString('<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\" preserveAspectRatio=\"none\"> <defs> <linearGradient id=\"value\" gradientTransform=\"rotate(90)\"> <stop offset=\"0\" stop-color=\"rgba(0,0,0,0)\"/> <stop offset=\"100%\" stop-color=\"rgba(0,0,0,1)\"/> </linearGradient> <linearGradient id=\"hue\" gradientTransform=\"rotate(0)\"> <stop offset=\"0\" stop-color=\"#fff\"/> <stop id=\"hue-stop\" offset=\"100%\" stop-color=\"#f00\"/> </linearGradient> </defs> <rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#hue\\')\"/> <rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#value\\')\"/></svg>', 'image/svg+xml').documentElement;\n    const hueStop = (svSvg as any).getElementById('hue-stop');\n    BB.setAttributes(hueStop, {\n        'stop-color': '#f0f'\n    });\n    BB.css(svSvg, {\n        width: width + 'px',\n        height: svHeight + 'px'\n    });\n    svWrapper.appendChild(svSvg);\n\n    const divH = document.createElement('div');\n    BB.css(divH, {\n        position: 'relative',\n        height: height + 'px'\n    });\n    const divPreview = document.createElement('div');\n    const controlH = document.createElement('div');\n\n    const enabled = true;\n\n    function updatePrimaryHSV(hsv) {\n        if (hsv.s === 0) {\n            primaryColorHSV = new BB.HSV(primaryColorHSV.h, hsv.s, hsv.v);\n        } else {\n            primaryColorHSV = new BB.HSV(hsv.h, hsv.s, hsv.v);\n        }\n    }\n\n    function createHueBg(targetEl) {\n        const im = new Image();\n        BB.css(im, {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n            display: 'none',\n            pointerEvents: 'none'\n        });\n        const cv = BB.canvas(width, height);\n        const ctx = cv.getContext('2d');\n        const gradH = ctx.createLinearGradient(0, 0, width, 0);\n        for (let i = 0; i < 1; i += 0.01) {\n            const col = BB.ColorConverter.toRGB(new BB.HSV(i * 360, 100, 100));\n            let ha = (parseInt('' + col.r)).toString(16);\n            let hb = (parseInt('' + col.g)).toString(16);\n            let hc = (parseInt('' + col.b)).toString(16);\n            if (ha.length === 1)\n                ha = '0' + ha;\n            if (hb.length === 1)\n                hb = '0' + hb;\n            if (hc.length === 1)\n                hc = '0' + hc;\n            gradH.addColorStop(i, '#' + ha + hb + hc);\n        }\n        ctx.fillStyle = gradH;\n        ctx.fillRect(0, 0, width, height);\n\n        targetEl.appendChild(im);\n        im.alt = 'hue';\n        im.src = cv.toDataURL('image/png');\n        im.style.display = 'block';\n    }\n\n\n    function updateSVCanvas() {\n        const rgb = BB.ColorConverter.toRGB(new BB.HSV(primaryColorHSV.h, 100, 100));\n        BB.setAttributes(hueStop, {\n            'stop-color': '#' + BB.ColorConverter.toHexString(rgb)\n        });\n    }\n\n    function updateSVPointer() {\n\n        const left = primaryColorHSV.s / 100 * width - 7;\n        const top = (1 - primaryColorHSV.v / 100) * svHeight - 6;\n        BB.css(pointerSV, {\n            left: left + 'px',\n            top: top + 'px'\n        });\n    }\n\n    function setColPreview() {\n        divPreview.style.backgroundColor = 'rgb(' + primaryColorRGB.r + ',' + primaryColorRGB.g + ',' + primaryColorRGB.b + ')';\n\n        if (BB.testIsWhiteBestContrast(primaryColorRGB)) {\n            BB.css(pickerButton, {\n                filter: 'invert(1)'\n            });\n            BB.css(hexButton, {\n                filter: 'invert(1)'\n            });\n        } else{\n            BB.css(pickerButton, {\n                filter: ''\n            });\n            BB.css(hexButton, {\n                filter: ''\n            });\n        }\n\n    }\n\n    updateSVCanvas();\n    div.style.width = width + 'px';\n    div.oncontextmenu = function () {\n        return false;\n    };\n\n    const SVContainer = document.createElement('div');\n    BB.css(SVContainer, {\n        width: width + 'px',\n        height: svHeight + 'px',\n        overflow: 'hidden',\n        display: 'block',\n        position: 'relative',\n        cursor: 'crosshair',\n        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px'\n    });\n\n    const pointerSV = document.createElement('div');\n    BB.css(pointerSV, {\n        width: '12px',\n        height: '12px',\n        borderRadius: '6px',\n        position: 'absolute',\n        pointerEvents: 'none',\n        boxShadow: '0px 0px 0 1px #000, inset 0px 0px 0 1px #fff'\n    });\n\n    SVContainer.appendChild(svWrapper);\n    SVContainer.appendChild(pointerSV);\n    updateSVPointer();\n    div.appendChild(SVContainer);\n    div.appendChild(divH);\n    outputDiv.appendChild(divPreview);\n    BB.css(divPreview, {\n        display: 'flex',\n        justifyContent: 'space-between',\n        width: (height * 2.5) + 'px',\n        height: height + 'px',\n        //position: \"relative\",\n        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px',\n        colorScheme: 'only light',\n    });\n\n    BB.css(divH, {\n        overflow: 'hidden',\n        position: 'relative',\n        width: width + 'px',\n        height: height + 'px',\n        cursor: 'ew-resize',\n        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px',\n        marginTop: '1px',\n        marginBottom: '1px'\n    });\n\n    //divH.className = \"svSlider\";\n    BB.css(controlH, {\n        width: '1px',\n        height: height + 'px',\n        background: '#000',\n        borderLeft: '1px solid #fff',\n        position: 'absolute',\n        top: '0',\n        left: parseInt('' + (primaryColorHSV.h / 360 * width - 1)) + 'px'\n    });\n\n\n    const virtualHSV = {\n        h: 0,\n        s: 0,\n        v: 0\n    };\n    let svPointerListener;\n    let hPointerListener;\n\n\n    const pickerButton = BB.el({\n        title: LANG('eyedropper') + ' [Alt]',\n        className: 'color-picker-preview-button',\n        css: {\n            width: '30px',\n            height: '30px',\n            backgroundImage: 'url(' + eyedropperImg + ')',\n            backgroundRepeat:  'no-repeat',\n            backgroundSize: '70%',\n            backgroundPosition: 'center'\n        }\n    });\n    let isPicking = false;\n\n\n    pickerButton.onclick = function () {\n        if (isPicking === false) {\n            pickerButton.classList.remove('color-picker-preview-button-hover');\n            pickerButton.classList.add('color-picker-preview-button-active');\n            isPicking = true;\n            pickCallback(true);\n        } else {\n            pickCallback(false);\n            _this.pickingDone();\n        }\n    };\n    const pickerButtonPointerListener = new BB.PointerListener({\n        target: pickerButton,\n        onEnterLeave: function(isOver) {\n            if (isPicking) {\n                return;\n            }\n            pickerButton.classList.toggle('color-picker-preview-button-hover', isOver);\n        }\n    });\n    divPreview.appendChild(pickerButton);\n\n\n    const hexButton = BB.el({\n        content: '#',\n        className: 'color-picker-preview-button',\n        title: LANG('manual-color-input'),\n        css: {\n            height: '100%',\n            width: height + 'px',\n            lineHeight: height + 'px',\n            fontSize: (height * 0.65) + 'px'\n        },\n        onClick: function() {\n            HexColorDialog({\n                color: new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b),\n                onClose: function(rgbObj) {\n                    if (!rgbObj) {\n                        return;\n                    }\n                    _this.setColor(rgbObj);\n                    emitColor(new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b));\n                }\n            });\n        }\n    });\n    const hexButtonPointerListener = new BB.PointerListener({\n        target: hexButton,\n        onEnterLeave: function(isOver) {\n            hexButton.classList.toggle('color-picker-preview-button-hover', isOver);\n        }\n    });\n    divPreview.appendChild(hexButton);\n\n    setColPreview();\n\n\n    setTimeout(function() {\n        createHueBg(divH);\n        divH.appendChild(controlH);\n        svPointerListener = new BB.PointerListener({\n            target: svWrapper,\n            maxPointers: 1,\n            fixScribble: true,\n            onPointer: function(event) {\n                if (event.type === 'pointerdown') {\n\n                    // prevent manual slider input keeping focus on iPad\n                    BB.unfocusAnyInput();\n\n                    BB.css(SVContainer, {\n                        boxShadow: '0px 0px 0px 1px rgb(255,255,255)',\n                        zIndex: '1'\n                    });\n\n                    if (event.button === 'left') {\n\n                        virtualHSV.s = event.relX / width * 100;\n                        virtualHSV.v = 100 - event.relY / svHeight * 100;\n\n                        primaryColorHSV = new BB.HSV(primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\n                        primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\n\n                        updateSVPointer();\n                        setColPreview();\n                        emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\n                    } else {\n                        virtualHSV.s = primaryColorHSV.s;\n                        virtualHSV.v = primaryColorHSV.v;\n                    }\n                }\n\n                if (event.type === 'pointermove' && ['left', 'right'].includes(event.button)) {\n\n                    let factor = 1;\n                    if (event.button === 'right') {\n                        factor = 0.5;\n                    }\n\n                    virtualHSV.s += event.dX / width * 100 * factor;\n                    virtualHSV.v -= event.dY / svHeight * 100 * factor;\n\n                    primaryColorHSV = new BB.HSV(primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\n                    primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\n                    updateSVPointer();\n                    setColPreview();\n                    emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\n\n                }\n\n                if (event.type === 'pointerup') {\n                    BB.css(SVContainer, {\n                        boxShadow: '0 0 0 1px rgb(188, 188, 188)',\n                        zIndex: '0'\n                    });\n                }\n\n            }\n        });\n        hPointerListener = new BB.PointerListener({\n            target: divH,\n            maxPointers: 1,\n            fixScribble: true,\n            onPointer: function(event) {\n\n                if (event.type === 'pointerdown') {\n\n                    // prevent manual slider input keeping focus on iPad\n                    BB.unfocusAnyInput();\n\n                    BB.css(divH, {\n                        boxShadow: '0px 0px 0px 1px rgba(255,255,255,1)'\n                    });\n\n                    if (event.button === 'left') {\n\n                        virtualHSV.h = event.relX / width * 359.99;\n\n                        primaryColorHSV = new BB.HSV(virtualHSV.h, primaryColorHSV.s, primaryColorHSV.v);\n                        primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\n                        controlH.style.left = (Math.round(primaryColorHSV.h / 359.99 * width) - 1) + 'px';\n                        updateSVCanvas();\n                        setColPreview();\n                        emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\n                    } else {\n                        virtualHSV.h = primaryColorHSV.h;\n                    }\n                }\n\n                if (event.type === 'pointermove' && ['left', 'right'].includes(event.button)) {\n\n                    const deltaY = Math.abs(event.pageY - event.downPageY);\n                    const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\n\n                    virtualHSV.h += event.dX / width * 359.99 * factor;\n\n                    if (event.button === 'right') {\n                        virtualHSV.h = virtualHSV.h % 359.99;\n                        if (virtualHSV.h < 0) {\n                            virtualHSV.h += 359.99;\n                        }\n                    }\n                    virtualHSV.h = Math.min(359.99, virtualHSV.h);\n                    primaryColorHSV = new BB.HSV(virtualHSV.h, primaryColorHSV.s, primaryColorHSV.v);\n                    primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\n                    controlH.style.left = (Math.round(primaryColorHSV.h / 359.99 * width) - 1) + 'px';\n                    updateSVCanvas();\n                    setColPreview();\n                    emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\n\n                }\n\n                if (event.type === 'pointerup') {\n                    BB.css(divH, {\n                        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px'\n                    });\n                }\n            }\n        });\n    }, 1);\n\n\n    // --- second color ---\n\n    const secondaryColorBtn = BB.el({\n        parent: outputDiv,\n        title: LANG('secondary-color') + ' [X]',\n        css: {\n            cursor: 'pointer',\n            marginLeft: '5px',\n            width: '22px',\n            height: '22px',\n            boxShadow: 'rgb(188, 188, 188) 0px 0px 0px 1px',\n            colorScheme: 'only light',\n        },\n        onClick: function(e) {\n            e.preventDefault();\n            swapColors();\n        }\n    });\n    function updateSecondaryColor() {\n        secondaryColorBtn.style.backgroundColor = BB.ColorConverter.toRgbStr(secondaryColorRGB);\n    }\n    function swapColors() {\n        // swap hsv\n        let tmp: any = secondaryColorHSV;\n        secondaryColorHSV = primaryColorHSV;\n        updatePrimaryHSV(tmp);\n        // swap rgb\n        tmp = secondaryColorRGB;\n        secondaryColorRGB = primaryColorRGB;\n        primaryColorRGB = tmp;\n\n        controlH.style.left = parseInt('' + (primaryColorHSV.h / 359 * width - 1)) + 'px';\n        updateSVCanvas();\n        updateSVPointer();\n        setColPreview();\n        updateSecondaryColor();\n\n        emitColor(new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b));\n    }\n    updateSecondaryColor();\n\n\n\n    // --- interface ---\n\n    this.setColor = function (c) {\n        primaryColorRGB = {r: parseInt(c.r, 10), g: parseInt(c.g, 10), b: parseInt(c.b, 10)};\n        updatePrimaryHSV(BB.ColorConverter.toHSV(c));\n        controlH.style.left = parseInt('' + (primaryColorHSV.h / 359 * width - 1)) + 'px';\n        updateSVCanvas();\n        updateSVPointer();\n        setColPreview();\n    };\n\n    this.getColor = function () {\n        return new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b);\n    };\n\n    this.getSecondaryRGB = function() {\n        return new BB.RGB(secondaryColorRGB.r, secondaryColorRGB.g, secondaryColorRGB.b);\n    };\n\n    this.setPickCallback = function (func) {\n        pickCallback = func;\n    };\n\n    this.pickingDone = function () {\n        if (!isPicking) {\n            return;\n        }\n        isPicking = false;\n        pickerButton.classList.remove('color-picker-preview-button-active');\n    };\n\n    this.enable = function (e) {\n        if (e) {\n            div.style.pointerEvents = '';\n            div.style.opacity = '1';\n            outputDiv.style.pointerEvents = '';\n            outputDiv.style.opacity = '1';\n        } else {\n            div.style.pointerEvents = 'none';\n            div.style.opacity = '0.5';\n            outputDiv.style.pointerEvents = 'none';\n            outputDiv.style.opacity = '0.5';\n        }\n    };\n\n    this.setHeight = function (h) {\n        h = parseInt('' +(h - height * 2 - 3), 10);\n        if (h === svHeight) {\n            return;\n        }\n        svHeight = h;\n        BB.css(svSvg, {\n            width: width + 'px',\n            height: svHeight + 'px'\n        });\n        SVContainer.style.height = svHeight + 'px';\n        updateSVPointer();\n    };\n\n    this.swapColors = function() {\n        swapColors();\n    };\n\n    this.getElement = function() {\n        return div;\n    };\n\n    this.getOutputElement = function() {\n        return outputDiv;\n    }\n\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"cTtMO\");","import {BB} from '../../../bb/bb';\nimport {calcSliderFalloffFactor} from './slider-falloff';\n\n\n/**\n * a small color slider\n *\n * params {\n * \t width: 200,\n * \t heightSV: 200,\n * \t heightH: 10,\n * \t color: {r,g,b}\n * \t callback: function(c){}\n * }\n *\n * @param params\n * @constructor\n */\nexport const KlSmallColorSlider = function (params) {\n    const div = document.createElement('div');\n    div.oncontextmenu = function(e) {\n        e.preventDefault();\n    };\n    let color = BB.ColorConverter.toHSV(new BB.RGB(params.color.r, params.color.g, params.color.b));\n    BB.css(div, {\n        width: params.width + 'px',\n        position: 'relative',\n        overflow: 'hidden',\n        userSelect: 'none'\n    });\n\n    const canvasSV = BB.canvas(10, 10);\n    canvasSV.style.width = params.width + 'px';\n    canvasSV.style.height = params.heightSV + 'px';\n    canvasSV.style.cursor = 'crosshair';\n\n    function updateSV() {\n        const ctx = canvasSV.getContext('2d');\n        for (let i = 0; i < canvasSV.height; i += 1) {\n            const gradient1 = ctx.createLinearGradient(0, 0, canvasSV.width, 0);\n\n            const colleft = BB.ColorConverter.toRGB(new BB.HSV(color.h, 1, 100 - (i / canvasSV.height * 100.0)));\n            const colright = BB.ColorConverter.toRGB(new BB.HSV(color.h, 100, 100 - (i / canvasSV.height * 100.0)));\n            gradient1.addColorStop(0, '#' + BB.ColorConverter.toHexString(colleft));\n            gradient1.addColorStop(1, '#' + BB.ColorConverter.toHexString(colright));\n            ctx.fillStyle = '#ff0000'; //needed for chrome...otherwise alpha problem\n            ctx.fillStyle = gradient1;\n            ctx.fillRect(0, i, canvasSV.width, 1);\n        }\n    }\n\n    updateSV();\n\n    const canvasH = BB.canvas(params.width, params.heightH);\n    canvasH.style.cursor = 'ew-resize';\n    (function () {\n        const ctx = canvasH.getContext('2d');\n\n        const gradH = ctx.createLinearGradient(0, 0, params.width, 0);\n        for (let i = 0; i < 1; i += 0.01) {\n            const col = BB.ColorConverter.toRGB(new BB.HSV(i * 360, 100, 100));\n            gradH.addColorStop(i, 'rgba(' + parseInt('' + col.r) + ', ' + parseInt('' + col.g) + ', ' + parseInt('' + col.b) + ', 1)');\n        }\n        ctx.fillStyle = gradH;\n        ctx.fillRect(0, 0, params.width, params.heightH);\n\n    })();\n    BB.css(canvasSV, {\n        width: params.width + 'px',\n        height: params.heightSV + 'px',\n        overflow: 'hidden',\n        position: 'relative'\n    });\n    canvasSV.style.cssFloat = 'left';\n    canvasH.style.cssFloat = 'left';\n\n    div.appendChild(canvasSV);\n    div.appendChild(canvasH);\n\n    const pointerSV = document.createElement('div');\n    BB.css(pointerSV, {\n        width: '8px',\n        height: '8px',\n        borderRadius: '8px',\n        position: 'absolute',\n        pointerEvents: 'none',\n        boxShadow: '0 0 0 1px #000, inset 0 0 0 1px #fff'\n    });\n    div.appendChild(pointerSV);\n\n    const pointerH = document.createElement('div');\n    BB.css(pointerH, {\n        width: '0',\n        height: params.heightH + 'px',\n        borderLeft: '1px solid #fff',\n        borderRight: '1px solid #000',\n        position: 'absolute',\n        top: params.heightSV + 'px',\n        pointerEvents: 'none'\n    });\n    div.appendChild(pointerH);\n\n\n    function updateSVPointer() {\n        const left = color.s / 100 * params.width - 4;\n        const top = (1 - color.v / 100) * params.heightSV - 4;\n        BB.css(pointerSV, {\n            left: left + 'px',\n            top: top + 'px'\n        });\n        /*if (top < params.heightSV/3) {\n        pointerSV.style.border = \"1px solid rgba(0,0,0,1)\";\n    } else {\n        pointerSV.style.border = \"1px solid rgba(255,255,255,1)\";\n    }*/\n    }\n\n    function updateHPointer() {\n        pointerH.style.left = (color.h / 359.999 * params.width - 1) + 'px';\n    }\n\n    updateSVPointer();\n    updateHPointer();\n\n    const virtualHSV = {\n        h: 0,\n        s: 0,\n        v: 0\n    };\n\n    let svPointerId = null;\n    const svPointerListener = new BB.PointerListener({\n        target: canvasSV,\n        maxPointers: 1,\n        fixScribble: true,\n        onPointer: function(event) {\n\n            if (event.type === 'pointerdown') {\n\n                // prevent manual slider input keeping focus on iPad\n                BB.unfocusAnyInput();\n\n                svPointerId = event.pointerId;\n                if (event.button === 'left') {\n\n                    virtualHSV.s = event.relX / params.width * 100;\n                    virtualHSV.v = 100 - event.relY / params.heightSV * 100;\n\n                    color = new BB.HSV(color.h, virtualHSV.s, virtualHSV.v);\n\n                    updateSVPointer();\n                    params.callback(BB.ColorConverter.toRGB(color));\n                } else {\n                    virtualHSV.s = color.s;\n                    virtualHSV.v = color.v;\n                }\n            }\n\n            if (event.type === 'pointermove' && ['left', 'right'].includes(event.button) && svPointerId === event.pointerId) {\n\n                let factor = 1;\n                if (event.button === 'right') {\n                    factor = 0.5;\n                }\n\n                virtualHSV.s += event.dX / params.width * 100 * factor;\n                virtualHSV.v -= event.dY / params.heightSV * 100 * factor;\n\n                color = new BB.HSV(color.h, virtualHSV.s, virtualHSV.v);\n                updateSVPointer();\n                params.callback(BB.ColorConverter.toRGB(color));\n\n            }\n            if (event.type === 'pointerup') {\n                svPointerId = null;\n            }\n\n        }\n    });\n\n    let hPointerId = null;\n    const hPointerListener = new BB.PointerListener({\n        target: canvasH,\n        maxPointers: 1,\n        fixScribble: true,\n        onPointer: function(event) {\n\n            if (event.type === 'pointerdown') {\n                hPointerId = event.pointerId;\n                if (event.button === 'left') {\n\n                    virtualHSV.h = event.relX / params.width * 359.99;\n\n                    color = new BB.HSV(virtualHSV.h, color.s, color.v);\n                    updateSV();\n                    updateHPointer();\n                    params.callback(BB.ColorConverter.toRGB(color));\n                } else {\n                    virtualHSV.h = color.h;\n                }\n            }\n\n            if (event.type === 'pointermove' && ['left', 'right'].includes(event.button) && hPointerId === event.pointerId) {\n\n                const deltaY = Math.abs(event.pageY - event.downPageY);\n                const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\n\n                virtualHSV.h += event.dX / params.width * 359.99 * factor;\n\n                if (event.button === 'right') {\n                    virtualHSV.h = virtualHSV.h % 359.99;\n                    if (virtualHSV.h < 0) {\n                        virtualHSV.h += 359.99;\n                    }\n                }\n                virtualHSV.h = Math.min(359.99, virtualHSV.h);\n                color = new BB.HSV(virtualHSV.h, color.s, color.v);\n                updateSV();\n                updateHPointer();\n                params.callback(BB.ColorConverter.toRGB(color));\n\n            }\n            if (event.type === 'pointerup') {\n                hPointerId = null;\n            }\n        }\n    });\n\n\n    const cleardiv = document.createElement('div');\n    cleardiv.style.clear = 'both';\n    div.appendChild(cleardiv);\n\n    // --- interface ---\n    this.setColor = function (c) {\n        color = BB.ColorConverter.toHSV(new BB.RGB(c.r, c.g, c.b));\n        updateSV();\n        updateSVPointer();\n        updateHPointer();\n    };\n    this.getColor = function () {\n        return BB.ColorConverter.toRGB(color);\n    };\n    this.getElement = function() {\n        return div;\n    };\n    this.destroy = function() {\n        svPointerListener.destroy();\n        hPointerListener.destroy();\n    };\n    this.end = function() {\n        svPointerId = null;\n        hPointerId = null;\n    };\n\n};","import {BB} from '../../../bb/bb';\n\n\n/**\n * a slider that looks like this\n * ------O----\n *\n * param: {init, width, pointSize, callback(value, isFirst, isLast)}\n *\n * @param param\n * @constructor\n */\nexport const PointSlider = function(param) {\n\n    const div = document.createElement('div');\n    div.style.position = 'relative';\n    const sliderLine = BB.el({});\n    const sliderPoint = BB.el({\n        css: {\n            colorScheme: 'only light',\n        }\n    });\n    div.appendChild(sliderLine);\n    div.appendChild(sliderPoint);\n    let sliderPos;\n    let isDragging = false;\n\n    //sliderLine\n    {\n        BB.css(sliderLine, {\n            marginTop: parseInt('' + (param.pointSize / 2 - 1)) + 'px',\n            height: '2px',\n            background: '#aaa',\n            width: param.width + 'px'\n        });\n    }\n    //sliderPoint\n    const touchAreaEl = BB.el({ // expand clickable area\n        parent: sliderPoint,\n        css: {\n            // background: 'rgba(255,0,0,0.4)',\n            margin: '-7px 0 0 -7px',\n            width: 'calc(100% + 14px)',\n            height: 'calc(100% + 7px)',\n        }\n    });\n\n    function redrawPoint() {\n        sliderPoint.style.left = sliderPos + 'px';\n        if (isDragging) {\n            sliderPoint.style.boxShadow = '0 0 6px rgba(0,0,0,1)';\n        } else {\n            sliderPoint.style.boxShadow = '0 0 3px rgba(0,0,0,0.8)';\n        }\n    }\n    function getValue() {\n        return sliderPos /  (param.width - param.pointSize);\n    }\n\n    let pointerListener;\n    {\n        let isFirst;\n        sliderPos = BB.clamp(param.init * (param.width - param.pointSize), 0, param.width - param.pointSize);\n        BB.css(sliderPoint, {\n            position: 'absolute',\n            top: '0px',\n            backgroundColor: '#eaeaea',\n            boxShadow: '0 0 3px rgba(0,0,0,0.8)',\n            width: param.pointSize + 'px',\n            height: param.pointSize + 'px',\n            borderRadius: param.pointSize + 'px',\n            cursor: 'ew-resize',\n            transition: 'box-shadow 0.2s ease-in-out'\n        });\n        redrawPoint();\n        let imaginaryPos;\n        pointerListener = new BB.PointerListener({\n            target: sliderPoint,\n            fixScribble: true,\n            onPointer: function(event) {\n                if (event.type === 'pointerdown' && event.button === 'left') {\n                    isFirst = true;\n                    isDragging = true;\n                    imaginaryPos = sliderPos;\n                    redrawPoint();\n                    event.eventStopPropagation();\n                } else if (event.type === 'pointermove' && event.button === 'left') {\n                    event.eventStopPropagation();\n                    imaginaryPos = imaginaryPos + event.dX;\n                    sliderPos = parseInt('' + BB.clamp(imaginaryPos, 0, param.width - param.pointSize));\n                    redrawPoint();\n                    param.callback(getValue(), isFirst, false);\n                    isFirst = false;\n                }\n                if (event.type === 'pointerup') {\n                    event.eventStopPropagation();\n                    isDragging = false;\n                    redrawPoint();\n                    param.callback(getValue(), false, true);\n                }\n            }\n        })\n    }\n\n    // --- interface ---\n    this.getEl = function() {\n        return div;\n    };\n    this.setActive = function(isActive) {\n        if (isActive) {\n            sliderPoint.style.backgroundColor = '#fff';\n        } else {\n            sliderPoint.style.backgroundColor = '#eaeaea';\n        }\n    };\n    this.destroy = function() {\n        pointerListener.destroy();\n    };\n};","import {BB} from '../../../bb/bb';\n\n/**\n * UI to pick between colors in colorArr. can display full transparent (checkerboard).\n * Can't deal with 0.5 alpha.\n * Rectangular buttons.\n *\n * p = {\n *     colorArr: rgba[], // duplicates are removed\n *     onChange: func(rgbaObj),\n *     label: string,\n *     initialIndex: int// optional, index before duplicates were removed\n * }\n *\n * @param p\n * @constructor\n */\nexport const ColorOptions = function(p) {\n    const div = BB.el({\n        content: p.label ? p.label : '',\n        css: {\n            display: 'flex',\n            alignItems: 'center',\n            colorScheme: 'only light',\n        }\n    });\n\n    let selectedIndex = 0;\n    const colorArr = [];\n    const buttonArr = [];\n    const buttonSize = 22;\n    const checkerUrl = BB.createCheckerDataUrl(5);\n\n    // build colorArr while removing duplicates\n    for (let i = 0; i < p.colorArr.length; i++) {\n        const item = p.colorArr[i];\n        let found = false;\n        for (let e = 0; e < colorArr.length; e++) {\n            const sItem = colorArr[e];\n            if (sItem === null || item === null) {\n                continue;\n            }\n            if (sItem.r === item.r && sItem.g === item.g && sItem.b === item.b && sItem.a === item.a) {\n                found = true;\n                break;\n            }\n        }\n        if (found) {\n            continue;\n        }\n        colorArr.push(item);\n        if ('initialIndex' in p && p.initialIndex === i) {\n            selectedIndex = colorArr.length - 1;\n        }\n    }\n\n    for (let i = 0; i < colorArr.length; i++) {\n        (function(i) {\n\n            const colorButton = BB.el({\n                content: colorArr[i] ? '' : 'X',\n                css: {\n                    width: buttonSize + 'px',\n                    height: buttonSize + 'px',\n                    backgroundColor: colorArr[i] ? BB.ColorConverter.toRgbaStr(colorArr[i]) : 'transparent',\n                    marginLeft: '7px',\n                    boxShadow: '0 0 0 1px #aaa',\n                    cursor: 'pointer',\n                    userSelect: 'none',\n                    textAlign: 'center',\n                    lineHeight: (buttonSize + 1) + 'px',\n                    color: '#aaa'\n                }\n            });\n            if (colorArr[i] && colorArr[i].a === 0) {\n                colorButton.style.backgroundImage = 'url(' + checkerUrl + ')';\n            }\n\n            colorButton.onclick = function(e) {\n                e.preventDefault();\n                selectedIndex = i;\n                update();\n                p.onChange(colorArr[i]);\n            };\n\n            (colorButton as any).setIsSelected = function(b) {\n                if (b) {\n                    BB.css(colorButton, {\n                        boxShadow: '0 0 0 2px var(--active-highlight-color), 0 0 5px 0 var(--active-highlight-color)',\n                        pointerEvents: 'none'\n                    });\n                } else {\n                    BB.css(colorButton, {\n                        boxShadow: '0 0 0 1px #aaa',\n                        pointerEvents: ''\n                    });\n                }\n            };\n\n\n            div.appendChild(colorButton);\n            buttonArr.push(colorButton);\n        })(i);\n    }\n\n\n    function update() {\n        for (let i = 0; i < buttonArr.length; i++) {\n            buttonArr[i].setIsSelected(i === selectedIndex);\n        }\n    }\n    update();\n\n    // --- interface ---\n    this.getElement = function() {\n        return div;\n    };\n\n    this.destroy = () => {\n        buttonArr.forEach(item => {\n            item.onclick = null;\n        });\n        buttonArr.splice(0, buttonArr.length);\n    };\n};","import {BB} from '../../../bb/bb';\n\n/**\n * selectable options\n * p = {\n *     optionArr: {\n *          id: string,\n *          label: string | HTMLElement\n *     }[],\n *     initialId?: string,\n *     onChange: function(id string): void,\n *     changeOnInit?: boolean, // trigger change on creation\n * }\n *\n * @param p\n * @constructor\n */\nexport const Options = function(p) {\n    const div = BB.el({});\n\n    const wrapperEl = BB.el({\n        parent: div,\n        className: 'kl-option-wrapper',\n        css: {\n            display: 'flex'\n        }\n    });\n\n    const optionArr: {\n        id: string;\n        el: HTMLElement;\n    }[] = [];\n    let selectedId = 'initialId' in p ? p.initialId : p.optionArr[0].id;\n\n    function createOption(o) {\n        const optionObj = {\n            id: o.id,\n            el: null,\n        };\n\n        const classArr = ['kl-option'];\n        if (p.isSmall) {\n            classArr.push('kl-option--small');\n        }\n        if (typeof o.label !== 'string') {\n            classArr.push('kl-option--custom-el');\n            BB.css(o.label, {\n                display: 'block',\n                pointerEvents: 'none',\n            });\n        }\n\n        optionObj.el = BB.el({\n            parent: wrapperEl,\n            content: o.label,\n            className: classArr.join(' '),\n            onClick: function() {\n                if (selectedId !== optionObj.id) {\n                    selectedId = optionObj.id;\n                    update();\n                    p.onChange(selectedId);\n                }\n            }\n        });\n\n        if (o.title) {\n            optionObj.el.title = o.title;\n        }\n\n        optionArr.push(optionObj);\n    }\n\n    function update() {\n        for (let i = 0; i < optionArr.length; i++) {\n            optionArr[i].el.classList.toggle('kl-option-selected', optionArr[i].id === selectedId);\n        }\n    }\n\n    for (let i = 0; i < p.optionArr.length; i++) {\n        createOption(p.optionArr[i]);\n    }\n\n    update();\n\n    if (p.changeOnInit) {\n        setTimeout(function() {\n            p.onChange(selectedId);\n        }, 0);\n    }\n\n    function getIndex() {\n        for (let i = 0; i < optionArr.length; i++) {\n            if (optionArr[i].id === selectedId) {\n                return i;\n            }\n        }\n    }\n\n    // --- interface ---\n    this.getElement = function() {\n        return div;\n    };\n    this.getValue = function() {\n        return selectedId;\n    }\n    this.next = function() {\n        selectedId = optionArr[(getIndex() + 1) % optionArr.length].id;\n        update();\n        p.onChange(selectedId);\n    };\n    this.previous = function() {\n        selectedId = optionArr[(optionArr.length + getIndex() - 1) % optionArr.length].id;\n        update();\n        p.onChange(selectedId);\n    };\n    this.destroy = () => {\n        optionArr.forEach(item => {\n            BB.destroyEl(item.el);\n        });\n        optionArr.splice(0, optionArr.length);\n    };\n};","import {BB} from '../../../bb/bb';\n// @ts-ignore\nimport angleSvg from 'url:~/src/app/img/ui/angle.svg';\n\n\ntype TUiState = 'left' | 'right';\n\n/**\n * display little messages at the top of KlWorkspace\n */\nexport class StatusOverlay {\n\n    private el: HTMLDivElement;\n    private innerEl: HTMLDivElement;\n    private angleIm: HTMLImageElement;\n    private innerInnerEl: HTMLDivElement;\n    private isWide: boolean;\n    private uiState: TUiState;\n\n    private timeout: number;\n    private timeout2: number;\n    private timeout3: number;\n\n    private updateUiState() {\n        if (!this.el) {\n            return;\n        }\n        setTimeout(()=>{}, 100);\n        if (this.uiState === 'left') {\n            this.el.style.left = '271px';\n        } else {\n            this.el.style.removeProperty('left');\n        }\n    }\n\n    private init() {\n        this.el = BB.el({\n            className: \"top-overlay g-root\",\n            onClick: BB.handleClick,\n        }) as HTMLDivElement;\n\n        if (this.isWide) {\n            this.el.style.width = '100%';\n        }\n\n        this.updateUiState();\n\n        this.innerEl = BB.el({\n            className: 'top-overlay-inner',\n        }) as HTMLDivElement\n\n\n        this.angleIm = new Image();\n        this.angleIm.src = angleSvg;\n        BB.css(this.angleIm, {\n            verticalAlign: 'bottom',\n            width: '20px',\n            height: '20px',\n            marginLeft: '5px',\n            borderRadius: '10px'\n        });\n\n        this.innerInnerEl = document.createElement('div');\n        this.innerInnerEl.style.display = 'inline-block';\n\n        this.innerEl.appendChild(this.innerInnerEl);\n        this.innerEl.appendChild(this.angleIm);\n        this.el.appendChild(this.innerEl);\n        document.body.appendChild(this.el);\n        this.el.style.display = \"none\";\n    }\n\n\n    // --- public ---\n\n    constructor () {\n        this.init();\n    }\n\n    setWide(b: boolean) {\n        this.isWide = !!b;\n\n        if (!this.el) {\n            return;\n        }\n\n        if (this.isWide) {\n            this.el.style.width = '100%';\n            this.el.style.left = '';\n        } else {\n            this.el.style.removeProperty('width');\n            this.el.style.left = this.uiState === 'left' ? '271px' : '';\n        }\n    }\n\n    setUiState(state: TUiState) {\n        this.uiState = state;\n        this.updateUiState();\n    }\n\n    out(msg: string | {type: 'transform', angleDeg: number, scale: number}, doPulse?: boolean) {\n\n        if (msg && typeof msg === 'object') {\n\n            if (msg.type === 'transform') {\n                this.angleIm.style.display = 'inline-block';\n                this.angleIm.style.transform = 'rotate(' + msg.angleDeg + 'deg)';\n\n                if (msg.angleDeg % 90 === 0) {\n                    this.angleIm.style.boxShadow = 'inset 0 0 0 1px rgba(255, 255, 255, 0.7)';\n                } else {\n                    this.angleIm.style.boxShadow = '';\n                }\n\n                this.innerInnerEl.innerHTML = Math.round(msg.scale * 100) + \"%\";\n\n\n            } else {\n                this.angleIm.style.display = 'none';\n            }\n\n\n\n        } else if (typeof msg === 'string') {\n            this.angleIm.style.display = 'none';\n            this.innerInnerEl.innerHTML = msg;\n        }\n\n        if (doPulse) {\n            this.innerEl.style.animation = '';\n            setTimeout(\n                () => this.innerEl.style.animation = 'top-overlay-pulse 0.5s ease-out',\n                20\n            );\n            if (this.timeout3) {\n                clearTimeout(this.timeout3);\n            }\n            this.timeout3 = window.setTimeout(\n                () => this.innerEl.style.animation = '',\n                520\n            );\n        }\n\n\n\n        if (this.timeout) {\n            clearTimeout(this.timeout);\n        }\n        if (this.timeout2) {\n            clearTimeout(this.timeout2);\n        }\n        this.el.style.animationName = doPulse ? 'consoleInFast' : \"consoleIn\";\n        this.el.style.opacity = \"1\";\n        this.timeout = window.setTimeout(() => {\n            this.el.style.opacity = \"0\";\n            this.el.style.animationName = \"consoleOut\";\n            this.timeout2 = window.setTimeout(() => {\n                this.el.style.display = \"none\";\n                this.timeout2 = 0;\n            }, 450);\n            this.timeout = 0;\n        }, 1200);\n        this.el.style.display = \"flex\";\n    }\n\n\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"iQ1f0\");","import {BB} from '../../../bb/bb';\nimport {popup} from './popup';\n\nexport function exportDialog(parent, image) {\n    let boxSize, aboutCloseFunc, aboutDiv, closed, aniToggle, imageContainer, coverImage, coverSize,\n        text, holding, aniTimeout, halfBoxSize;\n    boxSize = 22 * 2;\n    halfBoxSize = 22;\n    aboutCloseFunc = function () {\n    };\n    closed = false;\n    aniToggle = false;\n    aboutDiv = document.createElement(\"div\");\n    BB.css(aboutDiv, {\n        width: (7 * boxSize) + \"px\"\n    });\n\n    imageContainer = document.createElement(\"div\");\n    coverImage = new Image();\n    coverImage.src = image.src;\n\n    imageContainer.appendChild(coverImage);\n    imageContainer.appendChild(image);\n\n    BB.css(imageContainer, {\n        width: (6 * boxSize) + \"px\",\n        height: (4 * boxSize) + \"px\",\n        marginTop: (boxSize / 2 - 1) + \"px\",\n        marginLeft: (boxSize / 2 - 1) + \"px\",\n        position: \"relative\",\n        overflow: \"hidden\",\n        boxShadow: \"0 0 10px 4px rgba(255,255,255, 0)\",\n        border: \"1px solid rgba(255, 255, 255, 1)\",\n        transition: \"box-shadow 0.7s linear\"\n    });\n    BB.css(image, {\n        position: \"absolute\",\n        left: '0',\n        top: '0',\n        width: (6 * boxSize) + \"px\",\n        height: (4 * boxSize) + \"px\",\n        opacity: '0'\n    });\n    coverSize = {\n        width: (6 * boxSize),\n        height: (6 * boxSize / image.width) * image.height\n    };\n    if (coverSize.height < (4 * boxSize)) {\n        coverSize.height = (4 * boxSize);\n        coverSize.width = (coverSize.height / image.height) * image.width;\n    }\n    BB.css(coverImage, {\n        position: \"absolute\",\n        top: (2 * boxSize) + \"px\",\n        left: (3 * boxSize) + \"px\",\n        width: coverSize.width + \"px\",\n        height: coverSize.height + \"px\",\n        marginLeft: (-coverSize.width / 2) + \"px\",\n        marginTop: (-coverSize.height / 2) + \"px\"\n    });\n\n    function animation() {\n        if (closed) {\n            return;\n        }\n        aniToggle = !aniToggle;\n        if (aniToggle) {\n            BB.css(imageContainer, {\n                border: \"1px solid rgba(0, 0, 0, 1)\"\n            });\n        } else {\n            BB.css(imageContainer, {\n                border: \"1px solid rgba(200, 200, 200, 1)\"\n            });\n        }\n        setTimeout(animation, 510);\n    }\n\n    animation();\n\n    text = document.createElement(\"div\");\n    text.innerHTML = \"Right-Click or Press-Hold on the image, then save.\";\n    text.ontouchstart = function () {\n        return false;\n    };\n    BB.css(text, {\n        fontSize: (boxSize / 2.5) + \"px\",\n        color: \"#666\",\n        padding: \"10px\",\n        textAlign: \"center\"\n    });\n\n    aboutDiv.appendChild(imageContainer);\n    aboutDiv.appendChild(text);\n\n    holding = false;\n    image.ontouchstart = function () {\n        BB.css(imageContainer, {\n            boxShadow: \"0 0 10px 8px rgba(0,255,255, 1)\"\n        });\n        holding = true;\n        aniTimeout = setTimeout(function () {\n            holding = false;\n            BB.css(imageContainer, {\n                boxShadow: \"0 0 10px 4px rgba(0,255,255, 0)\"\n            });\n        }, 1500);\n    };\n    image.ontouchmove = function () {\n        BB.css(imageContainer, {\n            boxShadow: \"0 0 10px 4px rgba(0,255,255, 0)\"\n        });\n        holding = false;\n        clearTimeout(aniTimeout);\n    };\n    image.ontouchend = function () {\n        BB.css(imageContainer, {\n            boxShadow: \"0 0 10px 4px rgba(0,255,255, 0)\"\n        });\n        holding = false;\n        clearTimeout(aniTimeout);\n    };\n\n    popup({\n        target: parent,\n        message: \"<b>Save Image</b>\",\n        div: aboutDiv,\n        buttons: [\"Close\"],\n        callback: function (result) {\n            closed = true;\n        }\n    });\n}","import {BB} from '../../../bb/bb';\n\n/**\n * element that lets you crop an image and copy it via right click\n *\n * param = {\n *     width: number,\n *     height: number,\n *     canvas: image | canvas,\n *     isNotCopy: boolean,\n *     onChange: function(width, height)\n * }\n *\n * @param param object\n * @constructor\n */\nexport function CropCopy(param) {\n    const div = document.createElement('div');\n    BB.css(div, {\n        position: 'relative',\n        height: param.height + 'px',\n        width: param.width + 'px',\n        overflow: 'hidden',\n        colorScheme: 'only light',\n    });\n    div.style.position = 'relative';\n\n    let crop;\n    function resetCrop() {\n        crop = {\n            x: 0,\n            y: 0,\n            width: param.canvas.width,\n            height: param.canvas.height\n        };\n    }\n    resetCrop();\n\n\n    function updateCroppedCanvas() {\n        croppedCanvas.width = Math.round(crop.width);\n        croppedCanvas.height = Math.round(crop.height);\n        let ctx = croppedCanvas.getContext('2d');\n        ctx.drawImage(param.canvas, Math.round(-crop.x), Math.round(-crop.y));\n        if (croppedImage) {\n            croppedImage.src = croppedCanvas.toDataURL('image/png');\n        }\n\n        if (param.onChange) {\n            param.onChange(croppedCanvas.width, croppedCanvas.height);\n        }\n    }\n    function updateSelectionRect() {\n        BB.css(selectionRect, {\n            left: (thumbX + crop.x * scaleW) + 'px',\n            top: (thumbY + crop.y * scaleH) + 'px',\n            width: (crop.width * scaleW) + 'px',\n            height: (crop.height * scaleH) + 'px'\n        });\n        if (param.onChange) {\n            param.onChange(Math.round(crop.width), Math.round(crop.height));\n        }\n    }\n    function isInsideSelectionRect(p) {\n        let rect = {\n            x: Math.round(thumbX + crop.x * scaleW),\n            y: Math.round(thumbY + crop.y * scaleH),\n            width: Math.round(crop.width * scaleW),\n            height: Math.round(crop.height * scaleH)\n        };\n        return BB.isInsideRect(p, rect);\n    }\n\n    const croppedCanvas = BB.canvas();\n    let eventTarget = croppedCanvas;\n    let croppedImage = null;\n    if (!param.isNotCopy) { //navigator.appName === 'Microsoft Internet Explorer') { //i would prefer not using an image\n        croppedImage = new Image();\n        eventTarget = croppedImage;\n    }\n    BB.css(eventTarget, {\n        height: param.height + 'px',\n        width: param.width + 'px'\n    });\n    div.appendChild(eventTarget);\n    updateCroppedCanvas();\n\n    const padding = 20;\n    const previewWrapper = BB.el({\n        css: {\n            width: param.width + 'px',\n            height: param.height + 'px',\n            position: 'absolute',\n            left: '0',\n            top: '0',\n            pointerEvents: 'none'\n        }\n    });\n    div.appendChild(previewWrapper);\n    BB.createCheckerDataUrl(4, function(v) {\n        previewWrapper.style.backgroundImage = 'url('+v+')';\n    });\n\n    const thumbSize = BB.fitInto(param.canvas.width, param.canvas.height, param.width - padding * 2, param.height - padding * 2, 1);\n    const thumbCanvas = BB.canvas(Math.round(thumbSize.width), Math.round(thumbSize.height));\n    thumbCanvas.style.imageRendering = 'pixelated';\n    const scaleW = thumbCanvas.width / param.canvas.width;\n    const scaleH = thumbCanvas.height / param.canvas.height;\n    const thumbCtx = thumbCanvas.getContext('2d');\n    thumbCtx.imageSmoothingEnabled = false;\n    thumbCtx.drawImage(param.canvas, 0, 0, thumbCanvas.width, thumbCanvas.height);\n    previewWrapper.appendChild(thumbCanvas);\n    const thumbX = parseInt('' + ((param.width - thumbCanvas.width) / 2));\n    const thumbY = parseInt('' + ((param.height - thumbCanvas.height) / 2));\n    BB.css(thumbCanvas, {\n        position: 'absolute',\n        left: thumbX + \"px\",\n        top: thumbY + \"px\"\n    });\n\n    const selectionRect = BB.el({\n        css: {\n            position: 'absolute',\n            boxShadow: '0 0 0 1px #fff, 0 0 0 2px #000, 0 0 40px 1px #000',\n        }\n    });\n    previewWrapper.appendChild(selectionRect);\n    updateSelectionRect();\n\n\n    function toOriginalSpace(p) {\n        return {\n            x: BB.clamp((p.x - thumbX) / scaleW, 0, param.canvas.width),\n            y: BB.clamp((p.y - thumbY) / scaleH, 0, param.canvas.height),\n        };\n    }\n    //gen crop from thumb-space points\n    function genCrop(p1, p2) {\n        let topLeftP = {\n            x: Math.min(p1.x, p2.x),\n            y: Math.min(p1.y, p2.y)\n        };\n        let bottomRightP = {\n            x: Math.max(p1.x, p2.x),\n            y: Math.max(p1.y, p2.y)\n        };\n        let origTopLeftP = toOriginalSpace(topLeftP);\n        let origBottomRightP = toOriginalSpace(bottomRightP);\n        origTopLeftP.x = Math.floor(origTopLeftP.x);\n        origTopLeftP.y = Math.floor(origTopLeftP.y);\n        origBottomRightP.x = Math.ceil(origBottomRightP.x);\n        origBottomRightP.y = Math.ceil(origBottomRightP.y);\n        return {\n            x: origTopLeftP.x,\n            y: origTopLeftP.y,\n            width: origBottomRightP.x - origTopLeftP.x,\n            height: origBottomRightP.y - origTopLeftP.y\n        };\n    }\n\n    function isReset() {\n        return crop.x === 0 && crop.y === 0 && crop.width === param.canvas.width && crop.height === param.canvas.height;\n    }\n\n    let startP;\n    let startCrop = null;\n    let isDragging = false;\n    let didMove = false;\n    let updateCropTimeout;\n    const pointerListener = new BB.PointerListener({\n        target: eventTarget,\n        fixScribble: true,\n        onPointer: function(event) {\n            let fullPos;\n            if (event.type === 'pointerdown' && event.button === 'left') {\n                event.eventPreventDefault();\n                isDragging = true;\n                startP = {\n                    x: event.relX,\n                    y: event.relY\n                };\n                if (!isReset() && isInsideSelectionRect(startP)) {\n                    startCrop = {\n                        x: crop.x,\n                        y: crop.y,\n                        width: crop.width,\n                        height: crop.height\n                    };\n                } else {\n                    crop = genCrop(startP, startP);\n                }\n            } else if (event.type === 'pointermove' && event.button === 'left') {\n                event.eventPreventDefault();\n                didMove = true;\n                if (startCrop) {\n                    crop.x = startCrop.x + Math.round((event.relX - startP.x) / scaleW);\n                    crop.y = startCrop.y + Math.round((event.relY - startP.y) / scaleH);\n                    crop.x = BB.clamp(crop.x, 0, param.canvas.width - crop.width);\n                    crop.y = BB.clamp(crop.y, 0, param.canvas.height - crop.height);\n                } else {\n                    crop = genCrop(startP, {x: event.relX, y: event.relY});\n                }\n                updateSelectionRect();\n            } else if (event.type === 'pointerup' && startP) {\n                event.eventPreventDefault();\n                isDragging = false;\n                startCrop = null;\n                startP = null;\n                if (crop.width === 0 || crop.height === 0 || !didMove) {\n                    resetCrop();\n                    updateSelectionRect();\n                }\n                didMove = false;\n                updateCropTimeout = setTimeout(updateCroppedCanvas, 1);\n            }\n        }\n    });\n\n    const keyListener = new BB.KeyListener({\n        onDown: function(keyStr, e, comboStr) {\n            if (isDragging) {\n                return;\n            }\n            let doUpdate = false;\n\n            let stepSize = Math.max(1, 1 / scaleW);\n            let shiftIsPressed = keyListener.isPressed('shift');\n\n            if (keyStr === 'left') {\n                if (shiftIsPressed) {\n                    crop.width = BB.clamp(crop.width - stepSize, 1, param.canvas.width - crop.x);\n                } else {\n                    crop.x = BB.clamp(crop.x - stepSize, 0, param.canvas.width - crop.width);\n                }\n                doUpdate = true;\n            }\n            if (keyStr === 'right') {\n                if (shiftIsPressed) {\n                    crop.width = BB.clamp(crop.width + stepSize, 1, param.canvas.width - crop.x);\n                } else {\n                    crop.x = BB.clamp(crop.x + stepSize, 0, param.canvas.width - crop.width);\n                }\n                doUpdate = true;\n            }\n            if (keyStr === 'up') {\n                if (shiftIsPressed) {\n                    crop.height = BB.clamp(crop.height - stepSize, 1, param.canvas.height - crop.y);\n                } else {\n                    crop.y = BB.clamp(crop.y - stepSize, 0, param.canvas.height - crop.height);\n                }\n                doUpdate = true;\n            }\n            if (keyStr === 'down') {\n                if (shiftIsPressed) {\n                    crop.height = BB.clamp(crop.height + stepSize, 1, param.canvas.height - crop.y);\n                } else {\n                    crop.y = BB.clamp(crop.y + stepSize, 0, param.canvas.height - crop.height);\n                }\n                doUpdate = true;\n            }\n\n            if (doUpdate) {\n                e.preventDefault();\n                updateSelectionRect();\n                clearTimeout(updateCropTimeout);\n                updateCropTimeout = setTimeout(updateCroppedCanvas, 100);\n            }\n        }\n    });\n\n    this.getEl = function() {\n        return div;\n    };\n    this.reset = function() {\n        resetCrop();\n        updateCroppedCanvas();\n        updateSelectionRect();\n    };\n    this.destroy = function() {\n        eventTarget.style.removeProperty('width');\n        eventTarget.style.removeProperty('height');\n        keyListener.destroy();\n        pointerListener.destroy();\n    };\n    this.isReset = function() {\n        return isReset();\n    };\n    this.getRect = function() {\n        return JSON.parse(JSON.stringify(crop));\n    };\n    this.getCroppedImage = function() {\n        return croppedCanvas;\n    };\n}\n","import {BB} from '../../../bb/bb';\nimport {popup} from './popup';\nimport {CropCopy} from '../components/crop-copy';\nimport {LANG} from '../../../language/language';\n\n/// <reference path=\"./types.d.ts\" />\n\n/**\n *\n * @param parent\n * @param fullCanvas\n * @param cropCallback\n * @param output - BB.Output\n * @param showCrop - boolean - show crop button\n */\nexport function clipboardDialog(parent, fullCanvas, cropCallback, output, showCrop) {\n\n    let clipboardItemIsSupported = false;\n    try {\n        clipboardItemIsSupported = !!ClipboardItem;\n    } catch (e) {}\n\n    const div = document.createElement(\"div\");\n    const isSmall = window.innerWidth < 550 || window.innerHeight < 550;\n\n    let topWrapper = BB.el({\n        content: LANG('crop-drag-to-crop') + (clipboardItemIsSupported ? '' : '<br>' + LANG('cropcopy-click-hold')),\n        css: {\n            textAlign: 'center'\n        }\n    });\n    div.appendChild(topWrapper);\n\n\n    let cropCopy = new CropCopy({\n        width: isSmall ? 340 : 540,\n        height: isSmall ? 300 : 350,\n        canvas: fullCanvas,\n        clipboardItemIsSupported\n    });\n    BB.css(cropCopy.getEl(), {\n        marginTop: '10px',\n        marginLeft: '-20px',\n        borderTop: '1px solid #bbb',\n        borderBottom: '1px solid #bbb'\n    });\n    div.appendChild(cropCopy.getEl());\n\n    function toClipboard() {\n        const imgURL = cropCopy.getCroppedImage().toDataURL('image/png');\n        setTimeout(async function() {\n            try {\n                const data = await fetch(imgURL);\n                const blob = await data.blob();\n                await (navigator.clipboard as any).write([\n                    new ClipboardItem({\n                        [blob.type]: blob\n                    } as any) // todo check is possible?\n                ]);\n                setTimeout(function() {\n                    output.out(LANG('cropcopy-copied'), true);\n                }, 200);\n            } catch (err) {\n                console.error(err.name, err.message);\n            }\n        }, 0);\n    }\n\n    let keyListener = new BB.KeyListener({\n        onDown: function(keyStr, KeyEvent, comboStr) {\n            if (comboStr === 'ctrl+c') {\n                toClipboard();\n                closefunc();\n            }\n        }\n    });\n\n    let closefunc;\n    function blur() {\n        closefunc();\n    }\n    BB.addEventListener(window, \"blur\", blur);\n\n    const buttonArr = [];\n    if (clipboardItemIsSupported) {\n        buttonArr.push(LANG('cropcopy-btn-copy'));\n    }\n    if (showCrop) {\n        buttonArr.push(LANG('cropcopy-btn-crop'));\n    }\n    buttonArr.push('Cancel');\n\n    popup({\n        target: parent,\n        message: '<b>' + (showCrop ? `${LANG('cropcopy-title-copy')} / ${LANG('cropcopy-title-crop')}` : `${LANG('cropcopy-title-copy')}`) + '</b>',\n        div: div,\n        style: isSmall ? {} : {\n            width: \"500px\"\n        },\n        buttons: buttonArr,\n        primaries: [LANG('cropcopy-btn-copy')],\n        callback: function (result) {\n            if (result === LANG('cropcopy-btn-copy')) {\n                toClipboard();\n            } else if (result === LANG('cropcopy-btn-crop')) {\n                let rectObj = cropCopy.getRect();\n                cropCallback({\n                    left: Math.round(-rectObj.x),\n                    right: Math.round(rectObj.x + rectObj.width - fullCanvas.width),\n                    top: Math.round(-rectObj.y),\n                    bottom: Math.round(rectObj.y + rectObj.height - fullCanvas.height)\n                });\n            }\n            BB.removeEventListener(window, \"blur\", blur);\n            cropCopy.destroy();\n            keyListener.destroy();\n        },\n        clickOnEnter: LANG('cropcopy-btn-copy'),\n        closefunc: function (func) {\n            closefunc = func;\n        }\n    });\n}","import {BB} from '../../../bb/bb';\nimport {popup} from '../modals/popup';\nimport {klHistory} from '../../history/kl-history';\nimport {Options} from '../base-components/options';\nimport {Select} from '../base-components/select';\nimport {PointSlider} from '../base-components/point-slider';\n// @ts-ignore\nimport addLayerImg from 'url:~/src/app/img/ui/add-layer.svg';\n// @ts-ignore\nimport duplicateLayerImg from 'url:~/src/app/img/ui/duplicate-layer.svg';\n// @ts-ignore\nimport mergeLayerImg from 'url:~/src/app/img/ui/merge-layers.svg';\n// @ts-ignore\nimport removeLayerImg from 'url:~/src/app/img/ui/remove-layer.svg';\n// @ts-ignore\nimport renameLayerImg from 'url:~/src/app/img/ui/rename-layer.svg';\nimport {KlCanvas, MAX_LAYERS} from '../../canvas/kl-canvas';\nimport {IMixMode} from '../../kl.types';\nimport {LANG} from '../../../language/language';\nimport {translateBlending} from '../../canvas/translate-blending';\n\n\nexport function klLayerManager(p_canvas: KlCanvas, p_func, p_rootDiv) {\n    let klCanvas: KlCanvas = p_canvas;\n    let layerElArr = [];\n    let layerHeight = 35;\n    let layerSpacing = 0;\n    let width = 250;\n    let oldHistoryState;\n    let updatefunc = p_func;\n    let uiState = 'right'; // 'left | 'right'\n\n\n    let largeThumbDiv = BB.el({\n        onClick: BB.handleClick,\n        css: {\n            position: \"absolute\",\n            right: \"280px\",\n            top: \"500px\",\n            background: \"#aaa\",\n            boxShadow: \"1px 1px 3px rgba(0,0,0,0.3)\",\n            pointerEvents: \"none\",\n            padding: '0',\n            border: \"1px solid #aaa\",\n            transition: \"opacity 0.3s ease-out\",\n            userSelect: 'none',\n            colorScheme: 'only light',\n        }\n    });\n    BB.createCheckerDataUrl(4, function(url) {\n        largeThumbDiv.style.backgroundImage = \"url(\" + url + \")\";\n    });\n    let largeThumbCanvas = BB.canvas(200, 200);\n    largeThumbCanvas.style.display = \"block\";\n    largeThumbDiv.appendChild(largeThumbCanvas);\n    let largeThumbTimeout, largeThumbInTimeout;\n    let largeThumbInDocument = false;\n\n\n    let klCanvasLayerArr = klCanvas.getLayers();\n    let selectedSpotIndex = klCanvasLayerArr.length - 1;\n    let div = document.createElement(\"div\");\n    div.style.marginRight = \"10px\";\n    div.style.marginBottom = \"10px\";\n    div.style.marginLeft = \"10px\";\n    div.style.marginTop = \"10px\";\n    div.style.cursor = \"default\";\n\n    let listdiv = document.createElement(\"div\");\n    BB.css(listdiv, {\n        width: width + \"px\",\n        position: \"relative\"\n\n    });\n\n\n    function renameLayer(layer) {\n        let div = document.createElement('div');\n\n        let label = BB.el({\n            content: LANG('layers-rename-name') + ':',\n            css: {\n                marginRight: '5px'\n            }\n        });\n\n        const row = BB.el({\n            css: {\n                display: 'flex',\n            }\n        });\n        let input = document.createElement('input');\n        input.value = klCanvas.getLayer(layer).name;\n        input.setAttribute('data-ignore-focus', 'true');\n        const clearBtn = BB.el({\n            tagName: 'Button',\n            content: '<img src=\"' + removeLayerImg + '\" height=\"20\"/>',\n            title: LANG('layers-rename-clear'),\n            css: {\n                marginLeft: '10px',\n            },\n            onClick: () => {\n                input.value = '';\n                input.focus();\n            }\n        });\n        const suggestions = [\n            LANG('layers-rename-sketch'),\n            LANG('layers-rename-colors'),\n            LANG('layers-rename-shading'),\n            LANG('layers-rename-lines'),\n            LANG('layers-rename-effects'),\n            LANG('background'),\n            LANG('layers-rename-foreground'),\n        ];\n        const suggestionBtns = [];\n        const row2 = BB.el({\n            css: {\n                display: 'flex',\n                flexWrap: 'wrap',\n                marginTop: '5px',\n                marginLeft: '-5px',\n            }\n        }) as HTMLDivElement;\n        suggestions.forEach(item => {\n            const btn = BB.el({\n                parent: row2,\n                tagName: 'Button',\n                content: item,\n                onClick: () => {\n                    input.value = btn.textContent;\n                },\n                css: {\n                    margin: '5px 0 0 5px',\n                }\n            });\n            suggestionBtns.push(btn);\n        });\n\n        div.appendChild(label);\n        label.append(row, row2);\n        row.append(input, clearBtn);\n\n        setTimeout(function() {\n            input.focus();\n            input.select();\n        }, 10);\n\n        popup({\n            target: p_rootDiv,\n            message: `<b>${LANG('layers-rename-title')}</b>`,\n            div: div,\n            buttons: [LANG('layers-rename'), 'Cancel'],\n            primaries: [LANG('layers-rename')],\n            callback: function (val) {\n                BB.destroyEl(clearBtn);\n                suggestionBtns.forEach(item => {\n                    BB.destroyEl(item);\n                });\n                suggestionBtns.splice(0, suggestionBtns.length);\n                if (val === LANG('layers-rename')) {\n                    if (input.value === klCanvas.getLayer(layer).name) {\n                        return;\n                    }\n                    klCanvas.renameLayer(layer, input.value);\n                    createLayerList();\n                    klHistory.pause(true);\n                    updatefunc(layer);\n                    klHistory.pause(false);\n                }\n            },\n            clickOnEnter: LANG('layers-rename')\n        });\n    }\n\n\n    let layerListEl = BB.el({});\n\n    (div as any).disableButtons = function(){}; //probably remove\n    (div as any).enableButtons = function(){}; //probably remove\n    let addnewBtn = document.createElement(\"button\");\n    let duplicateBtn = document.createElement(\"button\");\n    let mergeBtn = document.createElement(\"button\");\n    let removeBtn = document.createElement(\"button\");\n    let renameBtn = document.createElement(\"button\");\n\n    function createButtons() {\n        let div = document.createElement(\"div\");\n        function async() {\n            BB.makeUnfocusable(addnewBtn);\n            BB.makeUnfocusable(duplicateBtn);\n            BB.makeUnfocusable(mergeBtn);\n            BB.makeUnfocusable(removeBtn);\n            BB.makeUnfocusable(renameBtn);\n\n            addnewBtn.style.cssFloat = 'left';\n            duplicateBtn.style.cssFloat = 'left';\n            mergeBtn.style.cssFloat = 'left';\n            removeBtn.style.cssFloat = 'left';\n            renameBtn.style.cssFloat = 'left';\n\n            addnewBtn.title = LANG('layers-new');\n            duplicateBtn.title = LANG('layers-duplicate');\n            removeBtn.title = LANG('layers-remove');\n            mergeBtn.title = LANG('layers-merge');\n            renameBtn.title = LANG('layers-rename-title');\n\n            addnewBtn.style.paddingLeft = \"5px\";\n            addnewBtn.style.paddingRight = \"3px\";\n\n            removeBtn.style.paddingLeft = \"5px\";\n            removeBtn.style.paddingRight = \"3px\";\n\n            duplicateBtn.style.paddingLeft = \"5px\";\n            duplicateBtn.style.paddingRight = \"3px\";\n\n            mergeBtn.style.paddingLeft = \"5px\";\n            mergeBtn.style.paddingRight = \"3px\";\n\n            renameBtn.style.height = \"30px\";\n            renameBtn.style.lineHeight = \"20px\";\n\n            addnewBtn.innerHTML = \"<img src='\" + addLayerImg + \"' height='20'/>\";\n            duplicateBtn.innerHTML = \"<img src='\" + duplicateLayerImg + \"' height='20'/>\";\n            mergeBtn.innerHTML = \"<img src='\" + mergeLayerImg + \"' height='20'/>\";\n            removeBtn.innerHTML = \"<img src='\" + removeLayerImg + \"' height='20'/>\";\n            renameBtn.innerHTML = \"<img src='\" + renameLayerImg + \"' height='20'/>\";\n            addnewBtn.style.marginRight = \"5px\";\n            removeBtn.style.marginRight = \"5px\";\n            duplicateBtn.style.marginRight = \"5px\";\n            mergeBtn.style.marginRight = \"5px\";\n            div.appendChild(addnewBtn);\n            div.appendChild(removeBtn);\n            div.appendChild(duplicateBtn);\n            div.appendChild(mergeBtn);\n            div.appendChild(renameBtn);\n            div.appendChild(BB.el({\n                css: {\n                    clear: 'both'\n                }\n            }));\n\n            let clearboth = document.createElement(\"div\");\n            clearboth.style.clear = \"both\";\n            clearboth.style.height = \"10px\";\n            div.appendChild(clearboth);\n\n\n            addnewBtn.onclick = function () {\n                if (klCanvas.addLayer(selectedSpotIndex) === false) {\n                    return;\n                }\n                klCanvasLayerArr = klCanvas.getLayers();\n\n                if (klCanvasLayerArr.length === MAX_LAYERS) {\n                    addnewBtn.disabled = true;\n                    duplicateBtn.disabled = true;\n                }\n                removeBtn.disabled = false;\n                selectedSpotIndex = selectedSpotIndex + 1;\n                createLayerList();\n                klHistory.pause(true);\n                updatefunc(selectedSpotIndex);\n                klHistory.pause(false);\n            };\n            duplicateBtn.onclick = function () {\n                if (klCanvas.duplicateLayer(selectedSpotIndex) === false) {\n                    return;\n                }\n                klCanvasLayerArr = klCanvas.getLayers();\n                if (klCanvasLayerArr.length === MAX_LAYERS) {\n                    addnewBtn.disabled = true;\n                    duplicateBtn.disabled = true;\n                }\n                removeBtn.disabled = false;\n                selectedSpotIndex++;\n                createLayerList();\n                klHistory.pause(true);\n                updatefunc(selectedSpotIndex);\n                klHistory.pause(false);\n            };\n            removeBtn.onclick = function () {\n                if (layerElArr.length <= 1) {\n                    return;\n                }\n\n                klCanvas.removeLayer(selectedSpotIndex);\n                if (selectedSpotIndex > 0) {\n                    selectedSpotIndex--;\n                }\n                klCanvasLayerArr = klCanvas.getLayers();\n                createLayerList();\n                klHistory.pause(true);\n                updatefunc(selectedSpotIndex);\n                klHistory.pause(false);\n                if (klCanvasLayerArr.length === 1) {\n                    removeBtn.disabled = true;\n                }\n                if (klCanvasLayerArr.length < MAX_LAYERS) {\n                    addnewBtn.disabled = false;\n                    duplicateBtn.disabled = false;\n                }\n            };\n            mergeBtn.onclick = function () {\n                if (selectedSpotIndex <= 0) {\n                    return;\n                }\n\n                function mergeDialog(p) {\n                    let div = document.createElement(\"div\");\n                    div.innerHTML = LANG('layers-merge-description');\n\n                    let options = new Options({\n                        optionArr: [\n                            {id: p.mixModeStr, label: translateBlending(p.mixModeStr)},\n                            {id: 'source-in', label: 'source-in'},\n                            {id: 'source-out', label: 'source-out'},\n                            {id: 'source-atop', label: 'source-atop'},\n                            {id: 'destination-in', label: 'destination-in'},\n                            {id: 'destination-out', label: 'destination-out'},\n                            {id: 'destination-atop', label: 'destination-atop'},\n                            {id: 'xor', label: 'xor'}\n                        ],\n                        initId: p.mixModeStr,\n                        onChange: function(id) {\n                            update();\n                        },\n                        isSmall: true\n                    });\n                    options.getElement().style.marginTop = '5px';\n                    div.appendChild(options.getElement());\n\n                    const thumbDimensions = BB.fitInto(p.topCanvas.width, p.topCanvas.height, 200, 200, 1);\n                    let preview = BB.canvas(thumbDimensions.width, thumbDimensions.height);\n                    preview.title = LANG('preview');\n                    let spacer = document.createElement(\"div\");\n                    spacer.innerHTML = \"<br/>\";\n                    spacer.style.clear = \"both\";\n                    div.appendChild(spacer);\n                    div.appendChild(preview);\n                    BB.css(preview, {\n                        display: \"block\",\n                        marginLeft: \"auto\",\n                        marginRight: \"auto\",\n                        colorScheme: 'only light',\n                    });\n                    preview.style.boxShadow = \"0 0 3px rgba(0,0,0,0.5)\";\n                    BB.createCheckerDataUrl(4, function(url) {\n                        preview.style.backgroundImage = \"url(\" + url + \")\";\n                    });\n\n                    let alphaCanvas = BB.copyCanvas(preview);\n                    alphaCanvas.getContext(\"2d\").drawImage(p.topCanvas, 0, 0, alphaCanvas.width, alphaCanvas.height);\n                    BB.convertToAlphaChannelCanvas(alphaCanvas);\n\n                    function update() {\n                        let ctx = preview.getContext(\"2d\");\n                        ctx.save();\n                        ctx.clearRect(0, 0, preview.width, preview.height);\n                        if (preview.width > p.topCanvas.width) {\n                            ctx.imageSmoothingEnabled = false;\n                        }\n                        ctx.drawImage(p.bottomCanvas, 0, 0, preview.width, preview.height);\n\n                        if (options.getValue() === 'as-alpha') {\n                            ctx.globalCompositeOperation = 'destination-in';\n                            ctx.globalAlpha = p.topOpacity;\n                            ctx.drawImage(alphaCanvas, 0, 0, preview.width, preview.height);\n                        } else {\n                            ctx.globalCompositeOperation = options.getValue();\n                            ctx.globalAlpha = p.topOpacity;\n                            ctx.drawImage(p.topCanvas, 0, 0, preview.width, preview.height);\n                        }\n                        ctx.restore();\n                    }\n\n                    update();\n\n\n                    let keyListener = new BB.KeyListener({\n                        onDown: function(keyStr) {\n                            if (keyStr === 'right') {\n                                options.next();\n                            }\n                            if (keyStr === 'left') {\n                                options.previous();\n                            }\n                        }\n                    });\n\n                    popup({\n                        target: p_rootDiv,\n                        message: `<b>${LANG('layers-merge-modal-title')}</b>`,\n                        div: div,\n                        buttons: [\"Ok\", \"Cancel\"],\n                        clickOnEnter: 'Ok',\n                        callback: function (val) {\n                            keyListener.destroy();\n                            options.destroy();\n                            if (val === \"Ok\") {\n                                p.callback(options.getValue());\n                            }\n                        }\n                    });\n                }\n                mergeDialog({\n                    topCanvas: klCanvasLayerArr[selectedSpotIndex].context.canvas,\n                    bottomCanvas: klCanvasLayerArr[selectedSpotIndex - 1].context.canvas,\n                    topOpacity: klCanvas.getLayer(selectedSpotIndex).opacity,\n                    mixModeStr: klCanvasLayerArr[selectedSpotIndex].mixModeStr,\n                    callback: function (mode) {\n                        klCanvas.mergeLayers(selectedSpotIndex, selectedSpotIndex - 1, mode);\n                        klCanvasLayerArr = klCanvas.getLayers();\n                        selectedSpotIndex--;\n                        if (klCanvasLayerArr.length === 1) {\n                            removeBtn.disabled = true;\n                        }\n                        if (klCanvasLayerArr.length < MAX_LAYERS) {\n                            addnewBtn.disabled = false;\n                            duplicateBtn.disabled = false;\n                        }\n                        createLayerList();\n                        klHistory.pause(true);\n                        updatefunc(selectedSpotIndex);\n                        klHistory.pause(false);\n                    }\n                });\n            };\n\n            renameBtn.onclick = function () {\n                renameLayer(selectedSpotIndex);\n            };\n        }\n        setTimeout(async, 1);\n        return div;\n    }\n    div.appendChild(createButtons());\n\n    let modeWrapper;\n    let modeSelect;\n    {\n        modeWrapper = BB.el({\n            content: LANG('layers-blending') + '&nbsp;',\n            css: {\n                fontSize: '15px'\n            }\n        });\n\n        modeSelect = new Select({\n            optionArr: [\n                'source-over',\n                null,\n                'darken',\n                'multiply',\n                'color-burn',\n                null,\n                'lighten',\n                'screen',\n                'color-dodge',\n                null,\n                'overlay',\n                'soft-light',\n                'hard-light',\n                null,\n                'difference',\n                'exclusion',\n                null,\n                'hue',\n                'saturation',\n                'color',\n                'luminosity',\n            ].map((item: IMixMode) => {\n                return item ? [item, translateBlending(item)] : null;\n            }),\n            onChange: function(val) {\n                klCanvas.setMixMode(selectedSpotIndex, val as IMixMode);\n                (div as any).update(selectedSpotIndex);\n            },\n            css: {\n                marginBottom: '10px'\n            }\n        });\n\n        modeWrapper.appendChild(modeSelect.getElement());\n        div.appendChild(modeWrapper);\n\n    }\n\n\n    function createLayerList() {\n        oldHistoryState = klHistory.getState();\n        function createLayerEntry(index) {\n            let layerName = klCanvas.getLayer(index).name;\n            let opacity = klCanvasLayerArr[index].opacity;\n            let layercanvas = klCanvasLayerArr[index].context.canvas;\n\n            let layer = document.createElement(\"div\");\n            layer.className = \"layerBox\";\n            layerElArr[index] = layer;\n            (layer as any).posY = ((klCanvasLayerArr.length - 1) * 35 - index * 35);\n            BB.css(layer, {\n                width: \"250px\",\n                height: \"34px\",\n                backgroundColor: \"rgb( 220, 220, 220)\",\n                border: \"1px solid #aaa\",\n                position: \"absolute\",\n                left: \"0 px\",\n                top: (layer as any).posY + \"px\",\n                transition: \"all 0.1s linear\",\n                borderRadius: \"5px\",\n                boxSizing: 'border-box'\n            });\n            let innerLayer = document.createElement(\"div\");\n            BB.css(innerLayer, {\n                position: \"relative\"\n            });\n\n            let container1 = document.createElement(\"div\");\n            BB.css(container1, {\n                width: \"250px\",\n                height: \"34px\"\n            });\n            let container2 = document.createElement(\"div\");\n            layer.appendChild(innerLayer);\n            innerLayer.appendChild(container1);\n            innerLayer.appendChild(container2);\n\n            (layer as any).spot = index;\n\n            //thumb\n            {\n                let thumbDimensions = BB.fitInto(layercanvas.width, layercanvas.height, 30, 30, 1);\n                let thumb = (layer as any).thumb = BB.canvas(thumbDimensions.width, thumbDimensions.height);\n\n                let thc = thumb.getContext(\"2d\");\n                thc.save();\n                if (thumb.width > layercanvas.width) {\n                    thc.imageSmoothingEnabled = false;\n                }\n                thc.drawImage(layercanvas, 0, 0, thumb.width, thumb.height);\n                thc.restore();\n                BB.css((layer as any).thumb, {\n                    position: \"absolute\",\n                    left: ((32 - (layer as any).thumb.width) / 2) + \"px\",\n                    top: ((32 - (layer as any).thumb.height) / 2) + \"px\",\n                    colorScheme: 'only light',\n                });\n                BB.createCheckerDataUrl(4, function(url) {\n                    thumb.style.backgroundImage = \"url(\" + url + \")\";\n                });\n            }\n\n            //layerlabel\n            {\n                (layer as any).label = document.createElement(\"div\");\n                (layer as any).lname = layerName;\n                (layer as any).label.append((layer as any).lname);\n\n                BB.css((layer as any).label, {\n                    position: \"absolute\",\n                    left: (1 + 32 + 5) + \"px\",\n                    top: 1 + \"px\",\n                    fontSize: \"13px\",\n                    width: \"170px\",\n                    height: \"20px\",\n                    overflow: \"hidden\",\n                    color: \"#666\",\n                    whiteSpace: 'nowrap'\n                });\n\n                (layer as any).label.ondblclick = function() {\n                    renameLayer((layer as any).spot);\n                };\n            }\n            //layerlabel\n            {\n                (layer as any).opacityLabel = document.createElement(\"div\");\n                (layer as any).opacity = opacity;\n                (layer as any).opacityLabel.append(parseInt('' + ((layer as any).opacity * 100)) + \"%\");\n\n                BB.css((layer as any).opacityLabel, {\n                    position: \"absolute\",\n                    left: (250 - 1 - 5 - 50) + \"px\",\n                    top: 1 + \"px\",\n                    fontSize: \"13px\",\n                    textAlign: \"right\",\n                    width: \"50px\",\n                    color: \"#666\",\n                    transition: \"color 0.2s ease-in-out\"\n                });\n            }\n\n            let oldOpacity;\n            let opacitySlider = new PointSlider({\n                init: (layer as any).opacity,\n                width: 204,\n                pointSize: 14,\n                callback: function(sliderValue, isFirst, isLast) {\n                    if (isFirst) {\n                        oldOpacity = klCanvas.getLayer((layer as any).spot).opacity;\n                        klHistory.pause(true);\n                        return;\n                    }\n                    if (isLast) {\n                        klHistory.pause(false);\n                        if (oldOpacity !== sliderValue) {\n                            klCanvas.layerOpacity((layer as any).spot, sliderValue);\n                        }\n                        return;\n                    }\n                    (layer as any).opacityLabel.innerHTML = Math.round(sliderValue * 100) + \"%\";\n                    klCanvas.layerOpacity((layer as any).spot, sliderValue);\n                }\n            });\n            BB.css(opacitySlider.getEl(), {\n                position: 'absolute',\n                left: '39px',\n                top: '17px'\n            });\n            (layer as any).opacitySlider = opacitySlider;\n\n            //larger layer preview - hover\n            BB.setEventListener((layer as any).thumb, 'onpointerover', function (e) {\n                if (e.buttons !== 0 && (!e.pointerType || e.pointerType !== 'touch')) { //shouldn't show while dragging\n                    return;\n                }\n\n                let thumbDimensions = BB.fitInto(layercanvas.width, layercanvas.height, 250, 250, 1);\n\n                if (largeThumbCanvas.width !== thumbDimensions.width || largeThumbCanvas.height !== thumbDimensions.height) {\n                    largeThumbCanvas.width = thumbDimensions.width;\n                    largeThumbCanvas.height = thumbDimensions.height;\n                }\n                let ctx = largeThumbCanvas.getContext(\"2d\");\n                ctx.save();\n                if (largeThumbCanvas.width > layercanvas.width) {\n                    ctx.imageSmoothingEnabled = false;\n                }\n                ctx.imageSmoothingQuality = 'high';\n                ctx.clearRect(0, 0, largeThumbCanvas.width, largeThumbCanvas.height);\n                ctx.drawImage(layercanvas, 0, 0, largeThumbCanvas.width, largeThumbCanvas.height);\n                ctx.restore();\n                BB.css(largeThumbDiv, {\n                    top: (e.clientY - largeThumbCanvas.height / 2) + \"px\",\n                    opacity: '0'\n                });\n                if (largeThumbInDocument === false) {\n                    document.body.appendChild(largeThumbDiv);\n                    largeThumbInDocument = true;\n                }\n                clearTimeout(largeThumbInTimeout);\n                largeThumbInTimeout = setTimeout(function () {\n                    BB.css(largeThumbDiv, {\n                        opacity: '1'\n                    });\n                }, 20);\n                clearTimeout(largeThumbTimeout);\n            });\n            BB.setEventListener((layer as any).thumb, 'onpointerout', function () {\n                clearTimeout(largeThumbInTimeout);\n                BB.css(largeThumbDiv, {\n                    opacity: '0'\n                });\n                clearTimeout(largeThumbTimeout);\n                largeThumbTimeout = setTimeout(function () {\n                    if (!largeThumbInDocument) {\n                        return;\n                    }\n                    document.body.removeChild(largeThumbDiv);\n                    largeThumbInDocument = false;\n                }, 300);\n            });\n\n            container1.appendChild((layer as any).thumb);\n            container1.appendChild((layer as any).label);\n            container1.appendChild((layer as any).opacityLabel);\n            container1.appendChild(opacitySlider.getEl());\n            let dragstart = false;\n            let freshSelection = false;\n\n            //events for moving layers up and down\n            function dragEventHandler(event) {\n                if (event.type === 'pointerdown' && event.button === 'left') {\n                    BB.css(layer, {\n                        transition: \"box-shadow 0.3s ease-in-out\"\n                    });\n                    //dragContainer.appendChild(layer);\n                    layer.style.zIndex = '1';\n                    lastpos = (layer as any).spot;\n                    freshSelection = false;\n                    if (!(layer as any).isSelected) {\n                        freshSelection = true;\n                        (div as any).activateLayer((layer as any).spot);\n                    }\n                    dragstart = true;\n\n                } else if (event.type === 'pointermove' && event.button === 'left') {\n\n                    if (dragstart) {\n                        dragstart = false;\n                        BB.css(layer, {\n                            boxShadow: \"1px 3px 5px rgba(0,0,0,0.4)\"\n                        });\n                    }\n                    (layer as any).posY += event.dY;\n                    let corrected = Math.max(0, Math.min((klCanvasLayerArr.length - 1) * (35), (layer as any).posY));\n                    layer.style.top = corrected + \"px\";\n                    updateLayersVerticalPosition((layer as any).spot, posToSpot((layer as any).posY));\n\n                }\n                if (event.type === 'pointerup') {\n                    BB.css(layer, {\n                        transition: \"all 0.1s linear\"\n                    });\n                    setTimeout(function () {\n                        BB.css(layer, {\n                            boxShadow: \"\"\n                        });\n                    }, 20);\n                    (layer as any).posY = Math.max(0, Math.min((klCanvasLayerArr.length - 1) * (35), (layer as any).posY));\n                    //regularContainer.appendChild(layer);\n                    layer.style.zIndex = \"\";\n                    let newSpot = posToSpot((layer as any).posY);\n                    let oldSpot = (layer as any).spot;\n                    move((layer as any).spot, newSpot);\n                    if (oldSpot != newSpot) {\n                        klHistory.pause(true);\n                        updatefunc(selectedSpotIndex);\n                        klHistory.pause(false);\n                    }\n                    if (oldSpot === newSpot && freshSelection) {\n                        updatefunc(selectedSpotIndex);\n                    }\n                    freshSelection = false;\n                }\n            }\n\n            (layer as any).pointerListener = new BB.PointerListener({\n                target: container1,\n                maxPointers: 1,\n                onPointer: dragEventHandler\n            });\n\n            layerListEl.appendChild(layer);\n        }\n        layerElArr = [];\n        while (layerListEl.firstChild) {\n            let child = layerListEl.firstChild;\n            (child as any).pointerListener.destroy();\n            (child as any).opacitySlider.destroy();\n            layerListEl.removeChild(child);\n        }\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\n            createLayerEntry(i);\n        }\n        (div as any).activateLayer(selectedSpotIndex);\n        updateHeight();\n    }\n\n\n    listdiv.appendChild(layerListEl);\n    div.appendChild(listdiv);\n\n\n    function posToSpot(p) {\n        let result = parseInt('' + ((p) / (layerHeight + layerSpacing) + 0.5));\n        result = Math.min(klCanvasLayerArr.length - 1, Math.max(0, result));\n        result = klCanvasLayerArr.length - result - 1;\n        return result;\n    }\n\n    let lastpos = 0;\n\n    //update css position of all layers that are not being dragged, while dragging\n    function updateLayersVerticalPosition(id, newspot) {\n        newspot = Math.min(klCanvasLayerArr.length - 1, Math.max(0, newspot));\n        if (newspot === lastpos) {\n            return;\n        }\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\n            if (layerElArr[i].spot === id) { // <- here\n                continue;\n            }\n            let posy = layerElArr[i].spot;\n            if (layerElArr[i].spot > id) {\n                posy--;\n            }\n            if (posy >= newspot) {\n                posy++;\n            }\n            layerElArr[i].posY = (layerHeight + layerSpacing) * (klCanvasLayerArr.length - posy - 1);\n            layerElArr[i].style.top = layerElArr[i].posY + \"px\";\n        }\n        lastpos = newspot;\n    }\n\n    function move(oldSpotIndex, newSpotIndex) {\n        if (isNaN(oldSpotIndex) || isNaN(newSpotIndex)) {\n            throw 'layermanager - invalid move';\n        }\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\n            (function (i) {\n                let posy = layerElArr[i].spot; // <- here\n                if (layerElArr[i].spot === oldSpotIndex) {\n                    posy = newSpotIndex;\n                } else {\n                    if (layerElArr[i].spot > oldSpotIndex)\n                        posy--;\n                    if (posy >= newSpotIndex)\n                        posy++;\n                }\n                layerElArr[i].spot = posy;\n                layerElArr[i].posY = (layerHeight + layerSpacing) * (klCanvasLayerArr.length - posy - 1);\n                layerElArr[i].style.top = layerElArr[i].posY + \"px\";\n            }(i));\n        }\n        if (oldSpotIndex === newSpotIndex) {\n            return;\n        }\n        klCanvas.moveLayer(selectedSpotIndex, newSpotIndex - oldSpotIndex);\n        klCanvasLayerArr = klCanvas.getLayers();\n        selectedSpotIndex = newSpotIndex;\n        mergeBtn.disabled = selectedSpotIndex === 0;\n    }\n\n\n    //updating the thumbs in interval\n    //don't update when: manager not visible || layer didn't change || is drawing\n    let updateThumbsInterval = setInterval(function() {\n        if (div.style.display !== \"block\") {\n            return;\n        }\n\n        let historyState = klHistory.getState();\n        if (historyState === oldHistoryState) {\n            return;\n        }\n        oldHistoryState = historyState;\n\n        for (let i = 0; i < layerElArr.length; i++) {\n            if (selectedSpotIndex === layerElArr[i].spot && klCanvasLayerArr[layerElArr[i].spot]) { // second check, because might be out of date\n                let ctx = layerElArr[i].thumb.getContext(\"2d\");\n                ctx.save();\n                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n                if (klCanvasLayerArr[layerElArr[i].spot].context.canvas.width < layerElArr[i].thumb.width) {\n                    ctx.imageSmoothingEnabled = false;\n                }\n                ctx.drawImage(klCanvasLayerArr[layerElArr[i].spot].context.canvas, 0, 0, layerElArr[i].thumb.width, layerElArr[i].thumb.height);\n                ctx.restore();\n            }\n        }\n\n    }, 1);\n\n    function updateHeight() {\n        layerListEl.style.height = (layerElArr.length * 35) + 'px';\n    }\n\n    // ---- interface ----\n\n    (div as any).update = function (activeLayerSpotIndex) {\n        klCanvasLayerArr = klCanvas.getLayers();\n        if (activeLayerSpotIndex || activeLayerSpotIndex === 0) {\n            selectedSpotIndex = activeLayerSpotIndex;\n        }\n        removeBtn.disabled = klCanvasLayerArr.length === 1;\n        if (klCanvasLayerArr.length === MAX_LAYERS) {\n            addnewBtn.disabled = true;\n            duplicateBtn.disabled = true;\n        } else {\n            addnewBtn.disabled = false;\n            duplicateBtn.disabled = false;\n        }\n        setTimeout(function() {\n            createLayerList();\n        }, 1);\n    };\n    (div as any).getSelected = function () {\n        return selectedSpotIndex;\n    };\n    (div as any).activateLayer = function (spotIndex) {\n        if (spotIndex < 0 || spotIndex > layerElArr.length - 1) {\n            throw 'invalid spotIndex ' + spotIndex + ', layerElArr.length ' + layerElArr.length;\n        }\n        selectedSpotIndex = spotIndex;\n        modeSelect.setValue(klCanvasLayerArr[selectedSpotIndex].mixModeStr);\n        for (let i = 0; i < layerElArr.length; i++) {\n            if (selectedSpotIndex === layerElArr[i].spot) {\n                layerElArr[i].style.backgroundColor = \"rgb( 250, 250, 250)\";\n                layerElArr[i].label.style.color = \"#000\";\n                layerElArr[i].style.boxShadow = \"\";\n                layerElArr[i].style.border = \"1px solid var(--active-highlight-color)\";\n                layerElArr[i].opacitySlider.setActive(true);\n                layerElArr[i].isSelected = true;\n            } else {\n                layerElArr[i].style.backgroundColor = \"rgb( 220, 220, 220)\";\n                layerElArr[i].label.style.color = \"#666\";\n                layerElArr[i].style.boxShadow = \"\";\n                layerElArr[i].style.border = \"1px solid rgb(158, 158, 158)\";\n                layerElArr[i].opacitySlider.setActive(false);\n                layerElArr[i].isSelected = false;\n            }\n        }\n        mergeBtn.disabled = selectedSpotIndex === 0;\n    };\n    (div as any).setUiState = function(stateStr) {\n        uiState = '' + stateStr;\n\n        if (uiState === 'left') {\n            BB.css(largeThumbDiv, {\n                left: '280px',\n                right: ''\n            });\n        } else {\n            BB.css(largeThumbDiv, {\n                left: '',\n                right: '280px'\n            });\n        }\n    };\n\n    createLayerList();\n\n    return div;\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1mb1v\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"11KJK\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"floUo\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kino6\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hhQeq\");","import {BB} from '../../bb/bb';\nimport {floodFillBits} from '../image-operations/flood-fill';\nimport {drawShape} from '../image-operations/shape-tool';\nimport {IRenderTextParam, renderText} from '../image-operations/render-text';\nimport {IGradient, IKlProject, IMixMode, IRGB, IShapeToolObject} from '../kl.types';\nimport {DecoyKlHistory, KlHistoryInterface} from '../history/kl-history';\nimport {drawProject} from './draw-project';\nimport {LANG} from '../../language/language';\nimport {drawGradient} from '../image-operations/gradient-tool';\n\n\nconst allowedMixModes = [\n    'source-over',\n    'darken',\n    'multiply',\n    'color-burn',\n    'lighten',\n    'screen',\n    'color-dodge',\n    'overlay',\n    'soft-light',\n    'hard-light',\n    'difference',\n    'exclusion',\n    'hue',\n    'saturation',\n    'color',\n    'luminosity',\n];\n\nexport const MAX_LAYERS = 16;\n\ninterface KlCanvasLayer extends HTMLCanvasElement {\n    name: string;\n    mixModeStr: IMixMode;\n    opacity: number;\n    compositeObj?: {\n        draw: (ctx: CanvasRenderingContext2D) => void;\n    },\n    index: number; // certain brushes need to know\n}\n\n/**\n * The image/canvas that the user paints on\n * Has layers. layers have names and opacity.\n *\n * Interacts with the history you specify (for undo/redo)\n */\nexport class KlCanvas {\n\n    // todo changeListener consistent concept\n    // todo history interaction, consistent concept - currently have to look at code to know if something pushes on history\n\n    private width: number;\n    private height: number;\n    private layerCanvasArr: KlCanvasLayer[];\n    private pickCanvas: HTMLCanvasElement; // canvas to draw into for color picker\n    private history: KlHistoryInterface;\n    private changeListenerArr:  (() => void)[]; // subscribers get notified when opacity changes\n\n\n    private init (w: number, h: number): void {\n        if (!w || !h || isNaN(w) || isNaN(h) || w < 1 || h < 1) {\n            throw new Error('init - invalid canvas size: ' + w + ', ' + h);\n        }\n        this.width = w;\n        this.height = h;\n    }\n\n    private emitChange (): void {\n        // some changes don't get captured by the history - e.g. changing opacity as the user drags the slider\n        this.changeListenerArr.forEach(item => item());\n    }\n\n    private updateIndices (): void {\n        this.layerCanvasArr.forEach((item, index) => {\n            item.index = index;\n        });\n    }\n\n    // ---- public ----\n\n    constructor (\n        params: {\n            projectObj: {\n                width: number;\n                height: number;\n                layers: {\n                    name: string;\n                    opacity: number;\n                    image: HTMLImageElement | HTMLCanvasElement; // already loaded!\n                }[];\n            }\n        } | {\n            // creates blank KlCanvas, 0 layers\n            width: number;\n            height: number;\n        } | {\n            copy: KlCanvas;\n        },\n        private layerNrOffset: number = 0,\n    ) {\n        this.layerCanvasArr = [];\n        this.pickCanvas = BB.canvas(1, 1);\n        this.history = new DecoyKlHistory();\n        if ('copy' in params) {\n            this.width = 1;\n            this.height = 1;\n        } else {\n            if ('width' in params && 'height' in params) {\n                this.width = params.width;\n                this.height = params.height;\n            } else {\n                this.width = 1;\n                this.height = 1;\n            }\n        }\n        this.init(this.width, this.height);\n\n        this.changeListenerArr = [];\n\n        if ('copy' in params) {\n            try {\n                this.copy(params.copy);\n            } catch (e) {\n                this.destroy();\n                throw e;\n            }\n        } else if ('projectObj' in params) {\n            const origLayers = [].concat(params.projectObj.layers);\n            this.init(params.projectObj.width, params.projectObj.height);\n\n            if (!origLayers.length) {\n                throw new Error('project.layers needs at least 1 layer');\n            }\n\n            for (let i = 0; i < origLayers.length; i++) {\n                if (origLayers[i].mixModeStr && !allowedMixModes.includes(origLayers[i].mixModeStr)) {\n                    throw new Error('unknown mixModeStr ' + origLayers[i].mixModeStr);\n                }\n\n                this.addLayer();\n                this.layerOpacity(i, origLayers[i].opacity);\n                this.layerCanvasArr[i].name = origLayers[i].name;\n                this.layerCanvasArr[i].mixModeStr = origLayers[i].mixModeStr ? origLayers[i].mixModeStr : 'source-over';\n                this.layerCanvasArr[i].getContext(\"2d\").drawImage(origLayers[i].image, 0, 0);\n            }\n        }\n        this.updateIndices();\n    }\n\n    setHistory (h: KlHistoryInterface): void {\n        this.history = h;\n    }\n\n    /**\n     * Resets canvas -> 1 layer, 100% opacity,\n     * unless layers provided.\n     * @param p\n     */\n    reset (\n        p: {\n            width: number;\n            height: number;\n            color?: IRGB; // optional - fill color\n            image?: HTMLImageElement | HTMLCanvasElement; // image drawn on layer\n            layerName?: string; // if via image\n            layers?: {\n                name: string;\n                opacity: number;\n                mixModeStr: IMixMode;\n                image: HTMLCanvasElement;\n            }[];\n        }\n    ): void | number {\n        if (!p.width || !p.height || p.width < 1 || p.height < 1 || isNaN(p.width) || isNaN(p.height) ) {\n            throw new Error('invalid canvas size');\n        }\n\n        this.history.pause(true);\n\n        this.width = p.width;\n        this.height = p.height;\n\n        this.layerCanvasArr.splice(1, Math.max(0, this.layerCanvasArr.length - 1));\n\n        if (p.layers) {\n            for (let i = 0; i < p.layers.length; i++) {\n                let item = p.layers[i];\n                if (!this.layerCanvasArr[i]) {\n                    this.addLayer();\n                }\n                this.layerCanvasArr[i].name = item.name;\n                this.layerCanvasArr[i].width = this.width;\n                this.layerCanvasArr[i].height = this.height;\n                this.layerCanvasArr[i].mixModeStr = item.mixModeStr ? item.mixModeStr : 'source-over';\n                this.layerCanvasArr[i].getContext(\"2d\").drawImage(item.image, 0, 0);\n                this.layerOpacity(i, item.opacity);\n            }\n        } else {\n            this.layerCanvasArr[0].name = p.layerName ? p.layerName : LANG('layers-layer') + \" 1\";\n            this.layerCanvasArr[0].width = this.width;\n            this.layerCanvasArr[0].height = this.height;\n            this.layerCanvasArr[0].mixModeStr = 'source-over';\n            this.layerOpacity(0, 1);\n            if (p.color) {\n                this.layerFill(0, p.color);\n            } else if (p.image) {\n                this.layerCanvasArr[0].getContext(\"2d\").drawImage(p.image, 0, 0);\n            }\n        }\n        this.updateIndices();\n\n        this.history.pause(false);\n\n        this.history.push({\n            tool: [\"canvas\"],\n            action: \"reset\",\n            params: [p] // dont screw with p\n        });\n\n        return this.layerCanvasArr.length - 1;\n    }\n\n    isLayerLimitReached (): boolean {\n        return this.layerCanvasArr.length >= MAX_LAYERS;\n    }\n\n    getWidth (): number {\n        return this.width;\n    }\n\n    getHeight (): number {\n        return this.height;\n    }\n\n    copy (toCopyCanvas: KlCanvas): void {\n        if (\n            toCopyCanvas.getWidth() < 1 ||\n            toCopyCanvas.getHeight() < 1 ||\n            isNaN(toCopyCanvas.getWidth()) ||\n            isNaN(toCopyCanvas.getHeight())\n        ) {\n            throw new Error('invalid canvas size');\n        }\n\n        // keep existing canvases\n\n        let origLayers = toCopyCanvas.getLayers();\n\n        while (this.layerCanvasArr.length > origLayers.length) {\n            this.removeLayer(this.layerCanvasArr.length - 1);\n        }\n\n        if (toCopyCanvas.getWidth() != this.width || toCopyCanvas.getHeight() != this.height) {\n            this.init(toCopyCanvas.getWidth(), toCopyCanvas.getHeight());\n        }\n        for (let i = 0; i < origLayers.length; i++) {\n            if (i >= this.layerCanvasArr.length) {\n                this.addLayer();\n            } else {\n                this.layerCanvasArr[i].width = this.width;\n                this.layerCanvasArr[i].height = this.height;\n            }\n            this.layerOpacity(i, origLayers[i].opacity);\n            this.layerCanvasArr[i].name = origLayers[i].name;\n            this.layerCanvasArr[i].mixModeStr = origLayers[i].mixModeStr;\n            this.layerCanvasArr[i].getContext(\"2d\").drawImage(origLayers[i].context.canvas, 0, 0);\n        }\n        this.updateIndices();\n    }\n\n    getLayerCount (): number {\n        return this.layerCanvasArr.length;\n    }\n\n    resize (w: number, h: number, algorithm: 'smooth' | 'pixelated' = 'smooth'): boolean {\n        if (!w || !h || (w === this.width && h === this.height) || isNaN(w) || isNaN(h) || w < 1 || h < 1) {\n            return false;\n        }\n        w = Math.max(w, 1);\n        h = Math.max(h, 1);\n\n        let tmp1, tmp2;\n\n        if (algorithm === 'pixelated') {\n            tmp1 = BB.canvas(w, h);\n            let tmp1Ctx = tmp1.getContext('2d');\n            tmp1Ctx.imageSmoothingEnabled = false;\n            for (let i = 0; i < this.layerCanvasArr.length; i++) {\n                if (i > 0) {\n                    tmp1Ctx.clearRect(0, 0, w, h);\n                }\n                let layerCanvas = this.layerCanvasArr[i];\n                tmp1Ctx.drawImage(layerCanvas, 0, 0, w, h);\n                layerCanvas.width = w;\n                layerCanvas.height = h;\n                let layerContext = layerCanvas.getContext('2d');\n                layerContext.drawImage(tmp1, 0, 0);\n            }\n\n        } else if (algorithm === 'smooth') {\n            tmp1 = BB.canvas();\n            tmp2 = BB.canvas();\n            for (let i = 0; i < this.layerCanvasArr.length; i++) {\n                BB.resizeCanvas(this.layerCanvasArr[i], w, h, tmp1, tmp2);\n            }\n        } else {\n            throw new Error('unknown resize algorithm');\n        }\n\n        this.width = w;\n        this.height = h;\n        return true;\n    }\n\n    /**\n     * crop / extend\n     * @param p\n     */\n    resizeCanvas (p: {\n        left: number;\n        top: number;\n        right: number;\n        bottom: number;\n        fillColor?: IRGB\n    }): void {\n\n        const newW = Math.round(p.left) + this.width + Math.round(p.right);\n        const newH = Math.round(p.top) + this.height + Math.round(p.bottom);\n        const offX = Math.round(p.left);\n        const offY = Math.round(p.top);\n\n        if (isNaN(newW) || isNaN(newH) || newW < 1 || newH < 1) {\n            throw new Error('KlCanvas.resizeCanvas - invalid canvas size');\n        }\n\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\n            const ctemp = BB.canvas(this.width, this.height);\n            let layerCanvas = this.layerCanvasArr[i];\n            let layerCtx = this.layerCanvasArr[i].getContext(\"2d\");\n            ctemp.getContext(\"2d\").drawImage(layerCanvas, 0, 0);\n\n            this.layerCanvasArr[i].width = newW;\n            this.layerCanvasArr[i].height = newH;\n\n            layerCtx.save();\n            if (i === 0 && p.fillColor) {\n                layerCtx.fillStyle = BB.ColorConverter.toRgbStr(p.fillColor);\n                layerCtx.fillRect(0, 0, newW, newH);\n                layerCtx.clearRect(offX, offY, this.width, this.height);\n            }\n            layerCtx.drawImage(ctemp, offX, offY);\n            layerCtx.restore();\n        }\n        this.width = newW;\n        this.height = newH;\n    }\n\n    /**\n     * will be inserted on top of selected\n     * @param selected\n     */\n    addLayer (selected?: number): false | number {\n        if (this.isLayerLimitReached()) {\n            return false;\n        }\n        let canvas = BB.canvas(this.width, this.height);\n        if (!canvas.getContext('2d')) {\n            throw new Error('kl-create-canvas-error');\n        }\n\n        (canvas as any).mixModeStr = 'source-over';\n\n        if (selected === undefined) {\n            this.layerCanvasArr[this.layerCanvasArr.length] = canvas as any;\n            selected = Math.max(0, this.layerCanvasArr.length - 1);\n        } else {\n            this.layerCanvasArr.splice(selected + 1, 0, canvas as any);\n            selected++;\n        }\n\n        (canvas as any).name = LANG('layers-layer') + \" \" + (this.layerCanvasArr.length + this.layerNrOffset);\n        this.history.pause(true);\n        this.layerOpacity(selected, 1);\n        this.history.pause(false);\n        this.updateIndices();\n        this.history.push({\n            tool: [\"canvas\"],\n            action: \"addLayer\",\n            params: [selected - 1]\n        });\n        return selected;\n    }\n\n    duplicateLayer (i: number): false | number {\n        if (!this.layerCanvasArr[i] || this.isLayerLimitReached()) {\n            return false;\n        }\n        let canvas = BB.canvas(this.width, this.height);\n        this.layerCanvasArr.splice(i + 1, 0, canvas as any);\n\n        (canvas as any).name = this.layerCanvasArr[i].name + \" \" + LANG('layers-copy');\n        (canvas as any).mixModeStr = this.layerCanvasArr[i].mixModeStr;\n        canvas.getContext(\"2d\").drawImage(this.layerCanvasArr[i], 0, 0);\n        this.history.pause(true);\n        this.layerOpacity(i + 1, this.layerCanvasArr[i].opacity);\n        this.history.pause(false);\n\n        this.updateIndices();\n\n        this.history.push({\n            tool: [\"canvas\"],\n            action: \"duplicateLayer\",\n            params: [i]\n        });\n        return i + 1;\n    }\n\n    getLayerContext (i: number, doReturnNull?: boolean): CanvasRenderingContext2D | null {\n        if (this.layerCanvasArr[i]) {\n            return this.layerCanvasArr[i].getContext(\"2d\");\n        }\n        if (doReturnNull) {\n            return null;\n        }\n        throw new Error(\"layer of index \" + i + \" not found (in \" + this.layerCanvasArr.length + \" layers)\");\n    }\n\n    removeLayer (i: number): false | number {\n        if (this.layerCanvasArr[i]) {\n            this.layerCanvasArr.splice(i, 1);\n            this.updateIndices();\n        } else {\n            return false;\n        }\n        this.history.push({\n            tool: [\"canvas\"],\n            action: \"removeLayer\",\n            params: [i]\n        });\n\n        return Math.max(0, i - 1);\n    }\n\n    renameLayer (i: number, name: string): boolean {\n        if (this.layerCanvasArr[i]) {\n            this.layerCanvasArr[i].name = name;\n        } else {\n            return false;\n        }\n\n        this.history.push({\n            tool: [\"canvas\"],\n            action: \"renameLayer\",\n            params: [i, name]\n        });\n\n        return true;\n    }\n\n    layerOpacity (i: number, o: number): void {\n        if (!this.layerCanvasArr[i]) {\n            return;\n        }\n        o = Math.max(0, Math.min(1, o));\n        this.layerCanvasArr[i].opacity = o;\n\n        this.history.push({\n            tool: [\"canvas\"],\n            action: \"layerOpacity\",\n            params: [i, o]\n        });\n\n        this.emitChange();\n    }\n\n    moveLayer (i: number, d: number): void | number {\n        if (d === 0) {\n            return;\n        }\n        if (this.layerCanvasArr[i]) {\n            const temp = this.layerCanvasArr[i];\n            this.layerCanvasArr.splice(i, 1);\n            const targetIndex = Math.max(0, Math.min(i + d, this.layerCanvasArr.length));\n            this.layerCanvasArr.splice(targetIndex, 0, temp);\n            this.updateIndices();\n            this.history.push({\n                tool: [\"canvas\"],\n                action: \"moveLayer\",\n                params: [i, d]\n            });\n            return targetIndex;\n        }\n    }\n\n    mergeLayers (layerBottomIndex: number, layerTopIndex: number, mixModeStr: IMixMode | 'as-alpha'): void | number {\n        if (\n            !this.layerCanvasArr[layerBottomIndex] ||\n            !this.layerCanvasArr[layerTopIndex] ||\n            layerBottomIndex === layerTopIndex\n        ) {\n            return;\n        }\n        //order messed up\n        if (layerBottomIndex > layerTopIndex) {\n            let temp = layerBottomIndex;\n            layerBottomIndex = layerTopIndex;\n            layerTopIndex = temp;\n        }\n\n        let topOpacity = this.layerCanvasArr[layerTopIndex].opacity;\n        if (topOpacity !== 0 && topOpacity) {\n            let ctx = this.layerCanvasArr[layerBottomIndex].getContext(\"2d\");\n            ctx.save();\n\n            if (mixModeStr === 'as-alpha') { // todo remove this?\n\n                BB.convertToAlphaChannelCanvas(this.layerCanvasArr[layerTopIndex]);\n                ctx.globalCompositeOperation = 'destination-in';\n                ctx.globalAlpha = topOpacity;\n                this.layerCanvasArr[layerBottomIndex].getContext(\"2d\").drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\n\n            } else {\n\n                if (mixModeStr) {\n                    ctx.globalCompositeOperation = mixModeStr;\n                }\n                ctx.globalAlpha = topOpacity;\n                this.layerCanvasArr[layerBottomIndex].getContext(\"2d\").drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\n\n            }\n\n            ctx.restore();\n\n            // workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\n            // TODO remove if chrome updated\n            if (mixModeStr) {\n                ctx.save();\n                ctx.fillStyle = \"rgba(0,0,0,0.01)\";\n                ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\n                ctx.restore();\n            }\n        }\n        this.updateIndices();\n        this.history.pause(true);\n        this.removeLayer(layerTopIndex);\n        this.history.pause(false);\n        this.history.push({\n            tool: [\"canvas\"],\n            action: \"mergeLayers\",\n            params: [layerBottomIndex, layerTopIndex, mixModeStr]\n        });\n\n        return layerBottomIndex;\n    }\n\n    rotate (deg: number): void {\n        while (deg < 0) {\n            deg += 360;\n        }\n        deg %= 360;\n        if (deg % 90 != 0 || deg === 0)\n            return;\n        let temp = BB.canvas();\n        if (deg === 0 || deg === 180) {\n            temp.width = this.width;\n            temp.height = this.height;\n        } else if (deg === 90 || deg === 270) {\n            temp.width = this.height;\n            temp.height = this.width;\n        }\n        let ctx = temp.getContext(\"2d\");\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\n            ctx.clearRect(0, 0, temp.width, temp.height);\n            ctx.save();\n            ctx.translate(temp.width / 2, temp.height / 2);\n            ctx.rotate(deg * Math.PI / 180);\n            if (deg === 180) {\n                ctx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\n            } else if (deg === 90 || deg === 270) {\n                ctx.drawImage(this.layerCanvasArr[i], -temp.height / 2, -temp.width / 2);\n            }\n            this.layerCanvasArr[i].width = temp.width;\n            this.layerCanvasArr[i].height = temp.height;\n            this.layerCanvasArr[i].getContext(\"2d\").clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\n            this.layerCanvasArr[i].getContext(\"2d\").drawImage(temp, 0, 0);\n            ctx.restore();\n        }\n        this.width = temp.width;\n        this.height = temp.height;\n    }\n\n    flip (isHorizontal: boolean, isVertical: boolean, layerIndex: number): void {\n        if (!isHorizontal && !isVertical) {\n            return;\n        }\n\n        let temp = BB.canvas(this.width, this.height);\n        temp.width = this.width;\n        temp.height = this.height;\n        let tempCtx = temp.getContext(\"2d\");\n\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\n\n            if ( (layerIndex || layerIndex === 0) && i !== layerIndex) {\n                continue;\n            }\n\n            tempCtx.save();\n            tempCtx.clearRect(0, 0, temp.width, temp.height);\n            tempCtx.translate(temp.width / 2, temp.height / 2);\n            tempCtx.scale((isHorizontal ? -1 : 1), (isVertical ? -1 : 1));\n            tempCtx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\n            tempCtx.restore();\n\n            this.layerCanvasArr[i].getContext(\"2d\").clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\n            this.layerCanvasArr[i].getContext(\"2d\").drawImage(temp, 0, 0);\n        }\n    }\n\n    layerFill (layerIndex: number, colorObj: IRGB, compositeOperation?: string): void {\n        let ctx = this.layerCanvasArr[layerIndex].getContext(\"2d\");\n        ctx.save();\n        if (compositeOperation) {\n            ctx.globalCompositeOperation = compositeOperation as GlobalCompositeOperation;\n        }\n        ctx.fillStyle = \"rgba(\" + colorObj.r + \",\" + colorObj.g + \",\" + colorObj.b + \",1)\";\n        ctx.fillRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\n        ctx.restore();\n\n        // workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\n        // TODO remove if chrome updated\n        ctx.save();\n        ctx.fillStyle = \"rgba(0,0,0,0.01)\";\n        ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\n        ctx.restore();\n\n        /*if (!document.getElementById('testocanvas')) {\n            layerCanvasArr[layerIndex].id = 'testocanvas';\n            document.body.appendChild(layerCanvasArr[layerIndex]);\n            BB.css(layerCanvasArr[layerIndex], {\n                position: 'fixed',\n                left: '0',\n                top: '0',\n                zIndex: '1111111',\n                transform: 'scale(0.2)',\n                border: '10px solid red',\n            });\n        }\n        if (!document.getElementById('testocanvas')) {\n            let c = document.createElement('canvas');\n            c.width = 1000;\n            c.height = 1000;\n            let ctx2 = c.getContext('2d');\n            ctx2.drawImage(layerCanvasArr[layerIndex], 0, 0);\n            c.id = 'testocanvas';\n            document.body.appendChild(c);\n            BB.css(c, {\n                position: 'fixed',\n                left: '0',\n                top: '0',\n                zIndex: '1111111',\n                transform: 'scale(0.2)',\n                border: '10px solid red',\n            });\n        }*/\n\n        this.history.push({\n            tool: [\"canvas\"],\n            action: \"layerFill\",\n            params: [layerIndex, colorObj, compositeOperation]\n        });\n    }\n\n    floodFill (\n        layerIndex: number, // index of layer to be filled\n        x: number, // starting point\n        y: number,\n        rgb: IRGB | null, // fill color, if null -> erase\n        opacity: number,\n        tolerance: number,\n        sampleStr: 'current' | 'all' | 'above',\n        grow: number, // int >= 0 - radius around filled area that is to be filled too\n        isContiguous: boolean,\n    ): void {\n        if (x < 0 || y < 0 || x >= this.width || y >= this.height || opacity === 0) {\n            return;\n        }\n        tolerance = Math.round(tolerance);\n\n        if (!(['above', 'current', 'all'].includes(sampleStr))) {\n            throw new Error('invalid sampleStr');\n        }\n\n        let result;\n\n        let srcCtx;\n        let srcImageData;\n        let srcData;\n\n        let targetCtx;\n        let targetImageData;\n        let targetData;\n\n\n        if (sampleStr === 'all') {\n\n            let srcCanvas = this.layerCanvasArr.length === 1 ? this.layerCanvasArr[0] : this.getCompleteCanvas(1);\n            srcCtx = srcCanvas.getContext('2d');\n            srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\n            srcData = srcImageData.data;\n            result = floodFillBits(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\n\n            srcCanvas = null;\n            srcCtx = null;\n            srcImageData = null;\n            srcData = null;\n\n            targetCtx = this.layerCanvasArr[layerIndex].getContext('2d');\n            targetImageData = targetCtx.getImageData(0, 0, this.width, this.height);\n\n        } else {\n            let srcIndex = sampleStr === 'above' ? layerIndex + 1 : layerIndex;\n\n            if (srcIndex >= this.layerCanvasArr.length) {\n                return;\n            }\n\n            srcCtx = this.layerCanvasArr[srcIndex].getContext('2d');\n            srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\n            srcData = srcImageData.data;\n            result = floodFillBits(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\n\n            if (layerIndex !== srcIndex) {\n                srcCtx = null;\n                srcImageData = null;\n                srcData = null;\n            }\n\n            targetCtx = layerIndex === srcIndex ? srcCtx : this.layerCanvasArr[layerIndex].getContext('2d');\n            targetImageData = layerIndex === srcIndex ? srcImageData : targetCtx.getImageData(0, 0, this.width, this.height);\n\n        }\n\n        targetData = targetImageData.data;\n        if (rgb) {\n            if (opacity === 1) {\n                for (let i = 0; i < this.width * this.height; i++) {\n                    if (result.data[i] === 255) {\n                        targetData[i * 4] = rgb.r;\n                        targetData[i * 4 + 1] = rgb.g;\n                        targetData[i * 4 + 2] = rgb.b;\n                        targetData[i * 4 + 3] = 255;\n                    }\n                }\n            } else {\n                for (let i = 0; i < this.width * this.height; i++) {\n                    if (result.data[i] === 255) {\n                        targetData[i * 4] = BB.mix(targetData[i * 4], rgb.r, opacity);\n                        targetData[i * 4 + 1] = BB.mix(targetData[i * 4 + 1], rgb.g, opacity);\n                        targetData[i * 4 + 2] = BB.mix(targetData[i * 4 + 2], rgb.b, opacity);\n                        targetData[i * 4 + 3] = BB.mix(targetData[i * 4 + 3], 255, opacity);\n                    }\n                }\n            }\n        } else { // erase\n            if (opacity === 1) {\n                for (let i = 0; i < this.width * this.height; i++) {\n                    if (result.data[i] === 255) {\n                        targetData[i * 4 + 3] = 0;\n                    }\n                }\n            } else {\n                for (let i = 0; i < this.width * this.height; i++) {\n                    if (result.data[i] === 255) {\n                        targetData[i * 4 + 3] = BB.mix(targetData[i * 4 + 3], 0, opacity);\n                    }\n                }\n            }\n        }\n        targetCtx.putImageData(targetImageData, 0, 0);\n\n\n        this.history.push({\n            tool: [\"canvas\"],\n            action: \"replaceLayer\",\n            params: [layerIndex, targetImageData]\n        });\n    }\n\n    /**\n     * draw shape via BB.drawShape\n     * @param layerIndex\n     * @param shapeObj\n     */\n    drawShape (layerIndex: number, shapeObj: IShapeToolObject): void {\n        if (shapeObj.x1 === shapeObj.x2 && shapeObj.y1 === shapeObj.y2) {\n            return;\n        }\n        drawShape(this.layerCanvasArr[layerIndex].getContext(\"2d\"), shapeObj);\n        this.history.push({\n            tool: [\"canvas\"],\n            action: \"drawShape\",\n            params: [layerIndex, BB.copyObj(shapeObj)],\n        });\n    }\n\n    drawGradient(layerIndex: number, gradientObj: IGradient): void {\n        drawGradient(this.layerCanvasArr[layerIndex].getContext(\"2d\"), gradientObj);\n        this.history.push({\n            tool: [\"canvas\"],\n            action: \"drawGradient\",\n            params: [layerIndex, BB.copyObj(gradientObj)],\n        });\n    }\n\n    text (layerIndex: number, p: IRenderTextParam): void {\n        renderText(this.layerCanvasArr[layerIndex], BB.copyObj(p));\n        this.history.push({\n            tool: [\"canvas\"],\n            action: \"text\",\n            params: [layerIndex, BB.copyObj(p)],\n        });\n    }\n\n    replaceLayer (layerIndex: number, imageData: ImageData): void {\n        let ctx = this.layerCanvasArr[layerIndex].getContext(\"2d\");\n        ctx.putImageData(imageData, 0, 0);\n        this.history.push({\n            tool: [\"canvas\"],\n            action: \"replaceLayer\",\n            params: [layerIndex, imageData],\n        });\n    }\n\n    clearLayer (layerIndex: number): void {\n        let ctx = this.layerCanvasArr[layerIndex].getContext(\"2d\");\n        ctx.save();\n        ctx.clearRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\n        ctx.restore();\n\n        this.history.push({\n            tool: [\"canvas\"],\n            action: \"clearLayer\",\n            params: [layerIndex]\n        });\n    }\n\n    getLayers (): {\n        context: CanvasRenderingContext2D;\n        opacity: number;\n        name: string;\n        mixModeStr: IMixMode;\n    }[] {\n        return this.layerCanvasArr.map(item => {\n            return {\n                context: item.getContext(\"2d\"),\n                opacity: item.opacity,\n                name: item.name,\n                mixModeStr: item.mixModeStr,\n            };\n        });\n    }\n\n    getLayersFast (): {\n        canvas: KlCanvasLayer;\n        opacity: number;\n        name: string;\n        mixModeStr: IMixMode;\n    }[] {\n        return this.layerCanvasArr.map(item => {\n            return {\n                canvas: item,\n                opacity: item.opacity,\n                name: item.name,\n                mixModeStr: item.mixModeStr,\n            };\n        });\n    }\n\n    getLayerIndex (canvasObj: HTMLCanvasElement, doReturnNull?: boolean): null | number {\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\n            if (this.layerCanvasArr[i] === canvasObj) {\n                return i;\n            }\n        }\n        if (!doReturnNull) {\n            throw new Error(\"layer not found (in \" + this.layerCanvasArr.length + \" layers)\");\n        }\n        return null;\n    }\n\n    getLayer (index: number, doReturnNull?: boolean): null | {\n        context: CanvasRenderingContext2D;\n        opacity: number;\n        name: string;\n        id: number;\n    } {\n        if (this.layerCanvasArr[index]) {\n            return {\n                context: this.layerCanvasArr[index].getContext(\"2d\"),\n                opacity: this.layerCanvasArr[index].opacity,\n                name: this.layerCanvasArr[index].name,\n                id: index,\n            };\n        }\n        if (!doReturnNull) {\n            throw new Error(\"layer of index \" + index + \" not found (in \" + this.layerCanvasArr.length + \" layers)\");\n        }\n        return null;\n    }\n\n    getColorAt (x: number, y: number): IRGB {\n        x = Math.floor(x);\n        y = Math.floor(y);\n        let ctx = this.pickCanvas.getContext(\"2d\");\n        ctx.save();\n        ctx.imageSmoothingEnabled = false;\n        ctx.clearRect(0, 0, 1, 1);\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\n            ctx.globalAlpha = this.layerCanvasArr[i].opacity;\n            ctx.globalCompositeOperation = this.layerCanvasArr[i].mixModeStr;\n            ctx.drawImage(this.layerCanvasArr[i], -x, -y);\n        }\n        ctx.restore();\n        let imData = ctx.getImageData(0, 0, 1, 1);\n        return new BB.RGB(imData.data[0], imData.data[1], imData.data[2]);\n    }\n\n    getCompleteCanvas (factor: number): HTMLCanvasElement {\n        return drawProject(this.getProject(), factor);\n    }\n\n    getProject (): IKlProject {\n        return {\n            width: this.width,\n            height: this.height,\n            layers: this.layerCanvasArr.map(layer => {\n                return {\n                    name: layer.name,\n                    opacity: layer.opacity,\n                    mixModeStr: layer.mixModeStr,\n                    image: layer,\n                };\n            }),\n        };\n    }\n\n    addChangeListener (func: () => void): void {\n        if (this.changeListenerArr.includes(func)) {\n            return;\n        }\n        this.changeListenerArr.push(func);\n    }\n\n    removeChangeListener (func: () => void): void {\n        for (let i = 0; i < this.changeListenerArr.length; i++) {\n            if (this.changeListenerArr[i] === func) {\n                this.changeListenerArr.splice(i, 1);\n                return;\n            }\n        }\n    }\n\n    setMixMode (layerIndex: number, mixModeStr: IMixMode): void {\n        if (!this.layerCanvasArr[layerIndex]) {\n            throw new Error('invalid layer');\n        }\n        this.layerCanvasArr[layerIndex].mixModeStr = mixModeStr;\n\n        this.history.push({\n            tool: [\"canvas\"],\n            action: \"setMixMode\",\n            params: [layerIndex, '' + mixModeStr],\n        });\n    }\n\n    /**\n     * Set composite drawing step for KlCanvasWorkspace.\n     * To apply temporary manipulations to a layer.\n     *\n     * @param layerIndex\n     * @param compositeObj\n     */\n    setComposite (\n        layerIndex: number,\n        compositeObj: null | {\n            draw: (ctx: CanvasRenderingContext2D) => void;\n        }\n    ): void {\n        if (!this.layerCanvasArr[layerIndex]) {\n            throw new Error('invalid layer');\n        }\n        this.layerCanvasArr[layerIndex].compositeObj = compositeObj;\n    }\n\n    destroy (): void {\n        if (this.layerCanvasArr === null) {\n            return;\n        }\n        this.layerCanvasArr.forEach(canvas => {\n            BB.freeCanvas(canvas);\n        });\n        this.layerCanvasArr = null;\n    }\n\n}\n","\n/**\n * Flood fill. Tried https://github.com/binarymax/floodfill.js/ but it implemented tolerance wrong, and had bugs.\n * So, my own implementation. can handle tolerance, grow, opacity.\n * Needs to be optimized.\n */\n\n/**\n * Set values in data within rect to 254, unless they're 255\n *\n * @param data Uint8Array\n * @param width int\n * @param x0 int\n * @param y0 int\n * @param x1 int >x0\n * @param y1 int >y0\n */\nfunction fillRect(data, width, x0, y0, x1, y1) {\n    for (let x = x0; x <= x1; x++) {\n        for (let y = y0; y <= y1; y++) {\n            if (data[y * width + x] === 255) {\n                continue;\n            }\n            data[y * width + x] = 254;\n        }\n    }\n}\n\nlet mx, my;\n\n/**\n * Get index i moved by dX, dY. in array with dimensions width height.\n * Returns null if outside bounds.\n *\n * @param width int\n * @param height int\n * @param i int\n * @param dX int\n * @param dY int\n * @returns {null|*}\n */\nfunction moveIndex(width, height, i, dX, dY) {\n    mx = i % width + dX;\n    my = Math.floor(i / width) + dY;\n\n    if (mx < 0 || my < 0 || mx >= width || my >= height) {\n        return null;\n    }\n\n    return my * width + mx;\n}\n\n/**\n * If pixel can be filled (within tolerance) will be set 255 and returns true.\n * returns false if already filled, or i is null\n *\n * @param srcArr Uint8Array rgba\n * @param targetArr Uint8Array\n * @param width int\n * @param height int\n * @param initRgba rgba\n * @param tolerance int 0 - 255\n * @param i int - srcArr index\n * @returns {boolean}\n */\nfunction testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, i) {\n    if (i === null || targetArr[i] === 255) {\n        return false;\n    }\n\n    if (\n        srcArr[i * 4] === initRgba[0] &&\n        srcArr[i * 4 + 1] === initRgba[1] &&\n        srcArr[i * 4 + 2] === initRgba[2] &&\n        srcArr[i * 4 + 3] === initRgba[3]\n    ) {\n        targetArr[i] = 255;\n        return true;\n    }\n\n    if (\n        tolerance > 0 &&\n        Math.abs(srcArr[i * 4] - initRgba[0]) <= tolerance &&\n        Math.abs(srcArr[i * 4 + 1] - initRgba[1]) <= tolerance &&\n        Math.abs(srcArr[i * 4 + 2] - initRgba[2]) <= tolerance &&\n        Math.abs(srcArr[i * 4 + 3] - initRgba[3]) <= tolerance\n    ) {\n        targetArr[i] = 255;\n        return true;\n    }\n\n    return false;\n}\n\n\n/**\n *\n * @param srcArr Uint8Array rgba\n * @param targetArr Uint8Array\n * @param width int\n * @param height int\n * @param px int\n * @param py int\n * @param tolerance int 0 - 255\n * @param grow int >= 0\n * @param isContiguous boolean\n */\nfunction floodFill(srcArr, targetArr, width, height, px, py, tolerance, grow, isContiguous) {\n\n    let initRgba = [\n        srcArr[(py * width + px) * 4],\n        srcArr[(py * width + px) * 4 + 1],\n        srcArr[(py * width + px) * 4 + 2],\n        srcArr[(py * width + px) * 4 + 3]\n    ];\n\n    if (isContiguous) {\n        let q = [];\n        q.push(py * width + px);\n        targetArr[py * width + px] = 255;\n\n        let i, e;\n        while (q.length) {\n            i = q.pop();\n\n            // queue up unfilled neighbors\n            e = moveIndex(width, height, i, -1, 0); // left\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\n\n            e = moveIndex(width, height, i, 1, 0); // right\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\n\n            e = moveIndex(width, height, i, 0, -1); // up\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\n\n            e = moveIndex(width, height, i, 0, 1); // bottom\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\n        }\n    } else {\n        for (let i = 0; i < width * height; i++) {\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, i);\n        }\n    }\n\n\n    // grow\n    if (grow === 0) {\n        return;\n    }\n\n    // how does it grow? it finds all pixel at the edge.\n    // then depending on what kind of edge it is, it draws a rectangle into target\n    // the rectangle has the value 254, or else it mess it all up.\n    // after it's all done, replaces it with 255\n    let x0, x1, y0, y1;\n    let l, tl, t, tr, r, br, b, bl; // left, top left, top, top right, etc.\n    for (let x = 0; x < width; x++) {\n        for (let y = 0; y < height; y++) {\n            if (targetArr[y * width + x] !== 255) {\n                continue;\n            }\n\n            // bounds of rectangle\n            x0 = x;\n            x1 = x;\n            y0 = y;\n            y1 = y;\n\n            l = targetArr[(y) * width + x - 1] !== 255;\n            tl = targetArr[(y - 1) * width + x - 1] !== 255;\n            t = targetArr[(y - 1) * width + x] !== 255;\n            tr = targetArr[(y - 1) * width + x + 1] !== 255;\n            r = targetArr[(y) * width + x + 1] !== 255;\n            br = targetArr[(y + 1) * width + x + 1] !== 255;\n            b = targetArr[(y + 1) * width + x] !== 255;\n            bl = targetArr[(y + 1) * width + x - 1] !== 255;\n\n            if (l) { // left\n                x0 = x - grow;\n            }\n            if (l && tl && t) { // top left\n                x0 = x - grow;\n                y0 = y - grow;\n            }\n            if (t) { // top\n                y0 = Math.min(y0, y - grow);\n            }\n            if (t && tr && r) { // top right\n                y0 = Math.min(y0, y - grow);\n                x1 = x + grow;\n            }\n            if (r) { // right\n                x1 = Math.max(x1, x + 1 * grow);\n            }\n            if (r && br && b) { // bottom right\n                x1 = Math.max(x1, x + 1 * grow);\n                y1 = Math.max(y1, y + 1 * grow);\n            }\n            if (b) { // bottom\n                y1 = Math.max(y1, y + 1 * grow);\n            }\n            if (b && bl && l) { // bottom left\n                x0 = Math.min(x0, x - 1 * grow);\n                y1 = Math.max(y1, y + 1 * grow);\n            }\n\n            if (!l && !tl && !t && !tr && !r && !br && !b && !bl) {\n                continue;\n            }\n\n            fillRect(\n                targetArr,\n                width,\n                Math.max(0, x0),\n                Math.max(0, y0),\n                Math.min(width - 1, x1),\n                Math.min(height - 1, y1)\n            );\n        }\n    }\n    for (let i = 0; i < width * height; i++) {\n        if (targetArr[i] === 254) {\n            targetArr[i] = 255;\n        }\n    }\n\n}\n\n\n/**\n * Does flood fill, and returns that. an array - 0 not filled. 255 filled\n *\n * returns {\n *     data: Uint8Array\n * }\n *\n * @param rgbaArr Uint8Array rgba\n * @param width int\n * @param height int\n * @param x int\n * @param y int\n * @param tolerance int 0 - 255\n * @param grow int >= 0\n * @param isContiguous boolean\n * @returns {{data: Uint8Array}}\n */\nexport function floodFillBits(rgbaArr, width, height, x, y, tolerance, grow, isContiguous) {\n    x = Math.round(x);\n    y = Math.round(y);\n\n    let resultArr = new Uint8Array(new ArrayBuffer(width * height));\n\n    floodFill(rgbaArr, resultArr, width, height, x, y, tolerance, grow, isContiguous);\n\n    return {\n        data: resultArr\n    }\n}\n","import {BB} from '../../bb/bb';\nimport {IRGB, IShapeToolObject} from '../kl.types';\n\n\n/**\n * Input processor for shape tool.\n * Coordinates are in canvas space.\n * angleRad is the angle of the canvas.\n *\n * @param p - {onShape: func(isDone, x1, y1, x2, y2, angleRad)}\n * @constructor\n */\nexport function ShapeTool(p) {\n\n    let downX, downY, downAngleRad;\n\n    this.onDown = function(x, y, angleRad) {\n        downX = x;\n        downY = y;\n        downAngleRad = angleRad;\n    };\n\n    this.onMove = function(x, y) {\n        p.onShape(false, downX, downY, x, y, downAngleRad);\n    };\n\n    this.onUp = function(x, y) {\n        p.onShape(true, downX, downY, x, y, downAngleRad);\n    };\n}\n\nfunction applyDefaults(obj: any, defaults: any): void {\n    for (const property in defaults) {\n        if (!(property in obj)) {\n            obj[property] = defaults[property];\n        }\n    }\n}\n\n/**\n * Draw a shape (rectangle, ellipse, line)\n *\n * @param ctx\n * @param shapeObj\n */\nexport function drawShape(\n    ctx: CanvasRenderingContext2D,\n    shapeObj: IShapeToolObject,\n) {\n    shapeObj = BB.copyObj(shapeObj);\n    applyDefaults(shapeObj, {\n        angleRad: 0,\n        isOutwards: false,\n        opacity: 1,\n        isEraser: false,\n        doLockAlpha: false,\n    });\n\n    if (['rect', 'ellipse', 'line'].includes(shapeObj.type)) {\n        const lineWidth = Math.round(shapeObj.lineWidth);\n        const angleDeg = shapeObj.angleRad * 180 / Math.PI;\n\n        // --- prep color ---\n        let colorRGB: IRGB = shapeObj.isEraser ? {r: 255, g: 255, b: 255} : (shapeObj.fillRgb ? shapeObj.fillRgb : shapeObj.strokeRgb);\n\n\n        // --- prep canvas ---\n        ctx.save();\n        if (shapeObj.opacity) {\n            ctx.globalAlpha = shapeObj.opacity;\n        }\n        if (shapeObj.isEraser) {\n            ctx.globalCompositeOperation = 'destination-out';\n        }\n        if (shapeObj.doLockAlpha) {\n            ctx.globalCompositeOperation = 'source-atop';\n        }\n        ctx.rotate(-shapeObj.angleRad);\n        if (shapeObj.fillRgb) {\n            ctx.fillStyle = BB.ColorConverter.toRgbStr(colorRGB);\n        } else if (shapeObj.strokeRgb) {\n            ctx.strokeStyle = BB.ColorConverter.toRgbStr(colorRGB);\n            ctx.lineWidth = lineWidth;\n        }\n\n        let x1 = shapeObj.x1;\n        let y1 = shapeObj.y1;\n        let x2 = shapeObj.x2;\n        let y2 = shapeObj.y2;\n\n        // --- angle snapping ---\n        if (shapeObj.isAngleSnap) {\n            let r1 = BB.rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\n            let r2 = BB.rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\n\n            let pAngleDeg = BB.pointsToAngleDeg(r1, r2) + 90;\n            let pAngleDegSnapped = Math.round(pAngleDeg / 45) * 45;\n            let rotated = BB.rotateAround({x: x1, y: y1}, {x: x2, y: y2}, pAngleDegSnapped - pAngleDeg);\n            x2 = rotated.x;\n            y2 = rotated.y;\n\n            // needs to be perfect if p1->p2 aligns with canvas x- or y-axis\n            if ((angleDeg + pAngleDegSnapped) % 90 === 0) {\n                if (Math.round((angleDeg - pAngleDegSnapped) / 90) % 2 === 0) { // up or down\n                    x2 = x1;\n                } else { // left or right\n                    y2 = y1;\n                }\n            }\n        }\n\n        let x = x1;\n        let y = y1;\n        let dX = x2 - x1;\n        let dY = y2 - y1;\n\n        // --- 1:1 ratio ---\n        if (shapeObj.type !== 'line' && shapeObj.isFixedRatio) {\n            let r1 = BB.rotate(shapeObj.x1, shapeObj.y1, shapeObj.angleRad / Math.PI * 180);\n            let r2 = BB.rotate(shapeObj.x2, shapeObj.y2, shapeObj.angleRad / Math.PI * 180);\n\n            let rx = r1.x;\n            let ry = r1.y;\n            let rdX = r2.x - r1.x;\n            let rdY = r2.y - r1.y;\n\n            if (Math.abs(rdX) < Math.abs(rdY)) {\n                rdY = Math.abs(rdX) * (rdY < 0 ? -1 : 1);\n            } else {\n                rdX = Math.abs(rdY) * (rdX < 0 ? -1 : 1);\n            }\n            r2.x = rx + rdX;\n            r2.y = ry + rdY;\n\n            r1 = BB.rotate(r1.x, r1.y, -shapeObj.angleRad / Math.PI * 180);\n            r2 = BB.rotate(r2.x, r2.y, -shapeObj.angleRad / Math.PI * 180);\n\n            x1 = r1.x;\n            y1 = r1.y;\n            x2 = r2.x;\n            y2 = r2.y;\n\n            x = x1;\n            y = y1;\n            dX = x2 - x1;\n            dY = y2 - y1;\n        }\n\n        // outwards modifier\n        if (shapeObj.isOutwards) {\n            x -= dX;\n            y -= dY;\n            dX *= 2;\n            dY *= 2;\n\n            x1 = x;\n            y1 = y;\n            x2 = x + dX;\n            y2 = y + dY;\n        }\n\n        let p1;\n        let p2;\n        if (shapeObj.type === 'line') { // --- line ---\n\n            // rounded\n            const x1r = Math.round(x1);\n            const y1r = Math.round(y1);\n            const x2r = Math.round(x2);\n            const y2r = Math.round(y2);\n\n            // floored\n            const x1f = Math.floor(x1);\n            const y1f = Math.floor(y1);\n            const x2f = Math.floor(x2);\n            const y2f = Math.floor(y2);\n\n            if (lineWidth % 2 === 0) {\n\n                if (y1r === y2r) {\n                    p1 = {\n                        x: x1f,\n                        y: y1r,\n                    };\n                    p2 = {\n                        x: x2f,\n                        y: y2r,\n                    };\n\n                    if (x1f < x2f) {\n                        p2.x += 1;\n                    } else {\n                        p1.x += 1;\n                    }\n                } else if (x1r === x2r) {\n                    p1 = {\n                        x: x1r,\n                        y: y1f,\n                    };\n                    p2 = {\n                        x: x2r,\n                        y: y2f,\n                    };\n\n                    if (y1f < y2f) {\n                        p2.y += 1;\n                    } else {\n                        p1.y += 1;\n                    }\n                } else {\n                    p1 = {\n                        x: x1,\n                        y: y1,\n                    };\n                    p2 = {\n                        x: x2,\n                        y: y2,\n                    };\n                }\n\n            } else {\n                p1 = {\n                    x: x1f,\n                    y: y1f,\n                };\n                p2 = {\n                    x: x2f,\n                    y: y2f,\n                };\n                if (y1f === y2f) {\n                    if (x1f < x2f) {\n                        p2.x += 1;\n                    } else {\n                        p1.x += 1;\n                    }\n                    p1.y += 0.5;\n                    p2.y += 0.5;\n                } else if (x1f === x2f) {\n                    if (y1f < y2f) {\n                        p2.y += 1;\n                    } else {\n                        p1.y += 1;\n                    }\n                    p1.x += 0.5;\n                    p2.x += 0.5;\n                } else {\n                    p1.x = x1;\n                    p1.y = y1;\n                    p2.x = x2;\n                    p2.y = y2;\n                }\n            }\n\n            p1 = BB.rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\n            p2 = BB.rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\n\n            ctx.beginPath();\n            ctx.moveTo(p1.x, p1.y);\n            ctx.lineTo(p2.x, p2.y);\n            ctx.stroke();\n\n        } else if (shapeObj.type === 'rect') { // --- rect ---\n\n            // floored\n            const x1f = Math.floor(x1);\n            const y1f = Math.floor(y1);\n            const x2f = Math.floor(x2);\n            const y2f = Math.floor(y2);\n\n            if (angleDeg % 90 === 0) {\n                if (shapeObj.fillRgb) {\n                    if (x1 % 1 === 0) {\n                        x1 += 1;\n                    }\n                    if (y1 % 1 === 0) {\n                        y1 += 1;\n                    }\n                    if (x2 % 1 === 0) {\n                        x2 += 1;\n                    }\n                    if (y2 % 1 === 0) {\n                        y2 += 1;\n                    }\n\n                    p1 = {\n                        x: x1 < x2 ? x1f : x2f,\n                        y: y1 < y2 ? y1f : y2f,\n                    };\n                    p2 = {\n                        x: Math.ceil((x1 < x2 ? x2 : x1) - p1.x),\n                        y: Math.ceil((y1 < y2 ? y2 : y1) - p1.y),\n                    };\n                    p2.x = p1.x + p2.x;\n                    p2.y = p1.y + p2.y;\n\n                } else {\n                    if (lineWidth % 2 === 0) {\n                        p1 = {\n                            x: x1f,\n                            y: y1f,\n                        };\n                        p2 = {\n                            x: x2f,\n                            y: y2f,\n                        };\n                    } else {\n                        p1 = {\n                            x: x1f + 0.5,\n                            y: y1f + 0.5,\n                        };\n                        p2 = {\n                            x: x2f + 0.5,\n                            y: y2f + 0.5,\n                        };\n                    }\n                }\n            } else {\n                p1 = {\n                    x: x1,\n                    y: y1,\n                };\n                p2 = {\n                    x: x2,\n                    y: y2,\n                };\n            }\n\n            p1 = BB.rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\n            p2 = BB.rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\n            p2.x = p2.x - p1.x;\n            p2.y = p2.y - p1.y;\n\n            if (shapeObj.fillRgb) {\n                ctx.fillRect(p1.x, p1.y, p2.x, p2.y);\n            } else {\n                ctx.strokeRect(p1.x, p1.y, p2.x, p2.y);\n            }\n\n        } else {  // --- circle ---\n            p1 = BB.rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\n            p2 = BB.rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\n            x = p1.x;\n            y = p1.y;\n            dX = p2.x - p1.x;\n            dY = p2.y - p1.y;\n\n            ctx.beginPath();\n            ctx.ellipse(x + dX / 2, y + dY / 2, Math.abs(dX / 2), Math.abs(dY / 2), 0, 0, Math.PI * 2);\n            if (shapeObj.fillRgb) {\n                ctx.fill();\n            } else {\n                ctx.stroke();\n            }\n        }\n\n\n        ctx.restore();\n\n    } else {\n        throw new Error('unknown shape');\n    }\n}","import {BB} from '../../bb/bb';\nimport {IRect} from '../../bb/bb.types';\n\nexport interface IRenderTextParam {\n    textStr: string; // text to be drawn. can contain newlines\n    x: number;\n    y: number;\n    size: number;\n    font: 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy'; // default sans-serif\n    align: 'left' | 'center' | 'right'; // default 'left'\n    isBold: boolean; // default false\n    isItalic: boolean; // default false\n    angleRad: number; // default 0 - rotates around x y\n    lineHeight?: number; // pixels\n    color: string;\n    isDebug?: boolean;\n}\n\n\n/**\n * Draw text on a canvas.\n *\n * @param canvas\n * @param p\n * @returns - bounds. coords relative to p.x p.y\n */\nexport function renderText(canvas: HTMLCanvasElement, p: IRenderTextParam): IRect {\n\n    // always at least a space. so bounds aren't just a dot\n    let textStr = p.textStr === '' ? ' ' : p.textStr;\n\n    // --- create el ---\n    // create an actual dom element. figure out where exactly each letter is positioned.\n    // that way multiline is feasible. canvas can't do multiline or text-align\n    let outer = BB.el({\n        css: {\n            position: 'fixed',\n            left: '0',\n            top: '0',\n            width: '100000px',\n            fontSize: p.size + 'px',\n            lineHeight: p.lineHeight ? p.lineHeight + 'px' : 'default',\n        }\n    });\n    let div = BB.el({\n        parent: outer,\n        css: {\n            display: 'inline-block',\n            textAlign: p.align ? p.align : 'left',\n            fontFamily: p.font ? p.font : 'sans-serif',\n            fontSize: p.size + 'px',\n            fontWeight: p.isBold ? 'bold' : 'normal',\n            fontStyle: p.isItalic ? 'italic' : 'normal',\n            lineHeight: p.lineHeight ? p.lineHeight + 'px' : 'default',\n\n\n            opacity: '0',\n            pointerEvents: 'none'\n        }\n    });\n    let spanStr = '';\n    let replaceObj = {\n        \"\\n\": '<br>',\n        \" \": '&nbsp;',\n        \"\t\": '&nbsp;&nbsp;&nbsp;&nbsp;',\n    };\n    for (let i = 0; i < textStr.length; i++) {\n        if (textStr[i] === \"\\n\") {\n            div.appendChild(BB.el({\n                tagName: 'span',\n                textContent: spanStr,\n                css: {\n                    whiteSpace: 'pre'\n                }\n            }));\n            spanStr = '';\n            div.appendChild(BB.el({\n                tagName: 'br'\n            }));\n            continue;\n        }\n        spanStr += textStr[i].replace(\"\\t\", '    ');\n    }\n    div.appendChild(BB.el({\n        tagName: 'span',\n        textContent: spanStr,\n        css: {\n            whiteSpace: 'pre'\n        }\n    }));\n    document.body.appendChild(outer);\n\n\n    // --- determine bounds ---\n    let bounds = {\n        x0: 99999999,\n        y0: 99999999,\n        x1: 0,\n        y1: 0\n    }\n    for (let i = 0; i < div.children.length; i++) {\n        let el = div.children[i] as HTMLElement;\n        bounds.x0 = Math.min(bounds.x0, el.offsetLeft);\n        bounds.y0 = Math.min(bounds.y0, el.offsetTop);\n        bounds.x1 = Math.max(bounds.x1, el.offsetLeft + el.offsetWidth);\n        bounds.y1 = Math.max(bounds.y1, el.offsetTop + el.offsetHeight);\n    }\n\n    // --- draw ---\n    let ctx = canvas.getContext('2d');\n    ctx.save();\n\n    let font = [];\n    if (p.isItalic) {\n        font.push('italic');\n    }\n    if (p.isBold) {\n        font.push('bold');\n    }\n    font.push(p.size + 'px ' + (p.font ? p.font : 'sans-serif'));\n    ctx.font = font.join(' ');\n    ctx.fillStyle = p.color ? p.color : '#000';\n\n    let x = p.x;\n    let y = p.y;\n    if (p.align === 'right') {\n        x += -bounds.x1 + bounds.x0;\n    }\n    if (p.align === 'center') {\n        x += (-bounds.x1 + bounds.x0) / 2;\n    }\n    ctx.translate(p.x, p.y);\n    ctx.rotate(p.angleRad ? -p.angleRad : 0);\n    ctx.translate(-p.x, -p.y);\n    ctx.translate(x, y);\n\n    // fill\n    for (let i = 0; i < div.children.length; i++) {\n        let el = div.children[i] as HTMLElement;\n\n        //ctx.fillText(el.innerText, 0, 0);\n        ctx.fillText(el.innerText, el.offsetLeft, el.offsetTop);\n    }\n\n    if (p.isDebug) {\n        ctx.lineWidth = 1;\n        ctx.strokeRect(0, -p.size * 0.85, bounds.x1, bounds.y1);\n        ctx.restore();\n        ctx.fillRect(p.x - 1, p.y - 1, 2, 2);\n    } else {\n        ctx.restore();\n    }\n\n    document.body.removeChild(outer);\n\n    return {\n        x: x - p.x,\n        y: y - p.y -p.size * 0.85,\n        width: bounds.x1 - bounds.x0,\n        height: bounds.y1 - bounds.y0\n    };\n}","import {BB} from '../../bb/bb';\nimport {IKlProject} from '../kl.types';\n\nexport function drawProject(project: IKlProject, factor) {\n    let resultCanvas = BB.canvas(\n        Math.max(1, Math.round(project.width * factor)),\n        Math.max(1, Math.round(project.height * factor))\n    );\n    let ctx = resultCanvas.getContext(\"2d\");\n    ctx.save();\n    if (factor > 1) {\n        ctx.imageSmoothingEnabled = false;\n    }\n    for (let i = 0; i < project.layers.length; i++) {\n        if (project.layers[i].opacity === 0) {\n            continue;\n        }\n        ctx.globalAlpha = project.layers[i].opacity;\n        ctx.globalCompositeOperation = project.layers[i].mixModeStr ? project.layers[i].mixModeStr : 'source-over';\n        ctx.drawImage(project.layers[i].image, 0, 0, resultCanvas.width, resultCanvas.height);\n    }\n    ctx.restore();\n    return resultCanvas;\n}","import {IGradient} from '../kl.types';\nimport {BB} from '../../bb/bb';\n\n\ntype TOnGradient = (isDone: boolean, x1: number, y1: number, x2: number, y2: number, angleRad: number) => void;\n\n/**\n * Input processor for gradient tool.\n * Coordinates are in canvas space.\n * angleRad is the angle of the canvas.\n */\nexport class GradientTool {\n    private downX: number;\n    private downY: number;\n    private downAngleRad: number;\n    private onGradient: TOnGradient;\n\n    // ---- public ----\n    constructor(\n        p: {\n            onGradient: TOnGradient;\n        }\n    ) {\n        this.onGradient = p.onGradient;\n    }\n\n    onDown(x: number, y: number, angleRad: number): void {\n        this.downX = x;\n        this.downY = y;\n        this.downAngleRad = angleRad;\n    }\n\n    onMove(x: number, y: number): void {\n        this.onGradient(false, this.downX, this.downY, x, y, this.downAngleRad);\n    }\n\n    onUp(x: number, y: number): void {\n        this.onGradient(true, this.downX, this.downY, x, y, this.downAngleRad);\n    }\n}\n\nexport function drawGradient(\n    ctx: CanvasRenderingContext2D,\n    gradientObj: IGradient,\n): void {\n    ctx.save();\n\n    let x1 = gradientObj.x1;\n    let y1 = gradientObj.y1;\n    let x2 = gradientObj.x2;\n    let y2 = gradientObj.y2;\n\n    if (gradientObj.doSnap) {\n        const angleDeg = gradientObj.angleRad * 180 / Math.PI;\n\n        let r1 = BB.rotate(x1, y1, gradientObj.angleRad / Math.PI * 180);\n        let r2 = BB.rotate(x2, y2, gradientObj.angleRad / Math.PI * 180);\n\n        let pAngleDeg = BB.pointsToAngleDeg(r1, r2) + 90;\n        let pAngleDegSnapped = Math.round(pAngleDeg / 45) * 45;\n        let rotated = BB.rotateAround({x: x1, y: y1}, {x: x2, y: y2}, pAngleDegSnapped - pAngleDeg);\n        x2 = rotated.x;\n        y2 = rotated.y;\n\n        // needs to be perfect if p1->p2 aligns with canvas x- or y-axis\n        if ((angleDeg + pAngleDegSnapped) % 90 === 0) {\n            if (Math.round((angleDeg - pAngleDegSnapped) / 90) % 2 === 0) { // up or down\n                x2 = x1;\n            } else { // left or right\n                y2 = y1;\n            }\n        }\n    }\n\n    let baseColor = gradientObj.color1;\n    if (gradientObj.isEraser && gradientObj.doLockAlpha) {\n        baseColor = {r: 255, g: 255, b: 255};\n    }\n    let color1 = BB.copyObj(baseColor);\n    color1.a = gradientObj.opacity;\n    let color2 = BB.copyObj(baseColor);\n    color2.a = 0;\n    if (gradientObj.isReversed) {\n        const temp = color1;\n        color1 = color2;\n        color2 = temp;\n    }\n\n    let gradient;\n    if (gradientObj.type === 'linear') {\n        gradient = ctx.createLinearGradient(x1, y1, x2, y2);\n        gradient.addColorStop(0, BB.ColorConverter.toRgbaStr(color1));\n        gradient.addColorStop(1, BB.ColorConverter.toRgbaStr(color2));\n\n    } else if (gradientObj.type === 'linear-mirror') {\n        const d = {\n            x: x2 - x1,\n            y: y2 - y1,\n        };\n        gradient = ctx.createLinearGradient(x1 - d.x,y1 - d.y, x2, y2);\n        gradient.addColorStop(0, BB.ColorConverter.toRgbaStr(color2));\n        gradient.addColorStop(0.5, BB.ColorConverter.toRgbaStr(color1));\n        gradient.addColorStop(1, BB.ColorConverter.toRgbaStr(color2));\n\n    } else if (gradientObj.type === 'radial') {\n        const r = BB.Vec2.dist(\n            {x: x1, y: y1},\n            {x: x2, y: y2},\n        );\n        gradient = ctx.createRadialGradient(x1, y1, 0, x1, y1, r);\n        gradient.addColorStop(0, BB.ColorConverter.toRgbaStr(color1));\n        gradient.addColorStop(1, BB.ColorConverter.toRgbaStr(color2));\n    }\n\n    ctx.fillStyle = gradient;\n    if (gradientObj.isEraser) {\n        ctx.globalCompositeOperation = 'destination-out';\n    }\n    if (gradientObj.doLockAlpha) {\n        ctx.globalCompositeOperation = 'source-atop';\n    }\n    ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n\n\n    ctx.restore();\n}","import {IMixMode} from '../kl.types';\nimport {LANG} from '../../language/language';\nimport {TTranslationCode} from '../../../languages/languages';\n\nexport function translateBlending(blendMode?: IMixMode): string {\n    if (!blendMode) {\n        return LANG('layers-blend-normal');\n    }\n\n    const codes: {\n        [key: string]: TTranslationCode\n    } = {\n        'source-over': 'layers-blend-normal',\n        'darken': 'layers-blend-darken',\n        'multiply': 'layers-blend-multiply',\n        'color-burn': 'layers-blend-color-burn',\n        'lighten': 'layers-blend-lighten',\n        'screen': 'layers-blend-screen',\n        'color-dodge': 'layers-blend-color-dodge',\n        'overlay': 'layers-blend-overlay',\n        'soft-light': 'layers-blend-soft-light',\n        'hard-light': 'layers-blend-hard-light',\n        'difference': 'layers-blend-difference',\n        'exclusion': 'layers-blend-exclusion',\n        'hue': 'layers-blend-hue',\n        'saturation': 'layers-blend-saturation',\n        'color': 'layers-blend-color',\n        'luminosity': 'layers-blend-luminosity',\n    };\n\n    if (!(blendMode in codes)) {\n        throw new Error('unknown blend mode');\n    }\n    return LANG(codes[blendMode]);\n}","import {BB} from '../../bb/bb';\nimport {IRGB} from '../kl.types';\n\n/**\n * Overlay for KlCanvasWorkspace.\n * - brush circle\n * - eyedropper circle\n * - compass needle (rotation hud)\n */\nexport class WorkspaceSvgOverlay {\n    private rootElement: SVGElement;\n    private brushCircleOuter: SVGElement;\n    private brushCircleInner: SVGElement;\n    private pickerPreviewBorder: SVGElement;\n    private pickerPreviewCol: SVGElement;\n    private readonly compassSize: number;\n    private compass: SVGElement;\n    private compassInner: SVGElement;\n    private compassBaseCircle: SVGElement;\n    private compassLineCircle: SVGElement;\n    private compassUpperTriangle: SVGElement;\n    private compassLowerTriangle: SVGElement;\n\n    // ---- public ----\n\n    constructor (\n        p: {\n            width: number;\n            height: number;\n        }\n    ) {\n        this.rootElement = BB.createSvg({\n            elementType: 'svg',\n            width: '' + p.width,\n            height: '' + p.height,\n        });\n        BB.css(this.rootElement, {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n            pointerEvents: 'none',\n            userSelect: 'none'\n        });\n\n        //brush circles\n        this.brushCircleOuter = BB.createSvg({\n            elementType: 'circle',\n            r: '10',\n            stroke: 'rgba(0,0,0,0.7)',\n            'stroke-width': '1',\n            fill: 'none',\n        });\n        this.brushCircleInner = BB.createSvg({\n            elementType: 'circle',\n            r: '9',\n            stroke: 'rgba(255,255,255,0.7)',\n            'stroke-width': '1',\n            fill: 'none',\n        });\n        this.rootElement.append(this.brushCircleOuter, this.brushCircleInner);\n\n        //color picker preview circle\n        this.pickerPreviewBorder = BB.createSvg({\n            elementType: 'circle',\n            r: '47',\n            stroke: 'black',\n            'stroke-width': '22',\n            fill: 'none',\n        });\n        this.pickerPreviewBorder.style.opacity = '0';\n        this.pickerPreviewCol = BB.createSvg({\n            elementType: 'circle',\n            r: '47',\n            stroke: 'black',\n            'stroke-width': '20',\n            fill: 'none',\n        });\n        this.pickerPreviewCol.style.opacity = '0';\n        this.rootElement.append(this.pickerPreviewBorder, this.pickerPreviewCol);\n\n\n        //rotation compass\n        this.compassSize = 30;\n        this.compass = BB.createSvg({\n            elementType: 'g',\n            transform: 'translate(' + (p.width/2) + ', ' + (p.height/2) + ')',\n        });\n        BB.css(this.compass, {\n            transition: 'opacity 0.25s ease-in-out',\n            opacity: '0',\n        });\n        this.compassInner = BB.createSvg({\n            elementType: 'g',\n            transform: 'rotate(45)',\n        });\n        this.compassBaseCircle = BB.createSvg({\n            elementType: 'circle',\n            fill: 'rgba(0,0,0,0.9)',\n            stroke: 'none',\n            cx: '0',\n            cy: '0',\n            r: '' + this.compassSize,\n        });\n        this.compassLineCircle = BB.createSvg({\n            elementType: 'circle',\n            fill: 'none',\n            stroke: 'rgba(255,255,255,0.75)',\n            'stroke-width': '1',\n            cx: '0',\n            cy: '0',\n            r: '' + (this.compassSize * 0.9),\n        });\n        this.compassUpperTriangle = BB.createSvg({\n            elementType: 'path',\n            fill: '#f00',\n            stroke: 'none',\n            d: 'M -'+(this.compassSize * 0.25)+',0 '+(this.compassSize * 0.25)+',0 0,-'+(this.compassSize * 0.9)+' z',\n        });\n        this.compassLowerTriangle = BB.createSvg({\n            elementType: 'path',\n            fill: '#fff',\n            stroke: 'none',\n            d: 'M -'+(this.compassSize * 0.25)+',0 '+(this.compassSize * 0.25)+',0 0,'+(this.compassSize * 0.9)+' z',\n        });\n\n        this.compassInner.append(\n            this.compassBaseCircle,\n            this.compassLineCircle,\n            this.compassUpperTriangle,\n            this.compassLowerTriangle\n        );\n        this.compass.append(this.compassInner);\n        this.rootElement.append(this.compass);\n    }\n\n    getElement (): SVGElement {\n        return this.rootElement;\n    }\n\n    setSize (width: number, height: number): void {\n        this.rootElement.setAttribute('width', '' + width);\n        this.rootElement.setAttribute('height', '' + height);\n        this.compass.setAttribute('transform', 'translate(' + (width/2) + ', ' + (height/2) + ')');\n    }\n\n    updateCursor (p: {\n        x?: number;\n        y?: number;\n        radius?: number;\n        isVisible?: boolean;\n    }): void {\n        if ('x' in p) {\n            this.brushCircleOuter.setAttribute('cx', '' + p.x);\n            this.brushCircleInner.setAttribute('cx', '' + p.x);\n        }\n        if ('y' in p) {\n            this.brushCircleOuter.setAttribute('cy', '' + p.y);\n            this.brushCircleInner.setAttribute('cy', '' + p.y);\n        }\n        if ('radius' in p) {\n            this.brushCircleOuter.setAttribute('r', '' + Math.max(0, p.radius));\n            this.brushCircleInner.setAttribute('r', '' + Math.max(0, p.radius - 1));\n        }\n        if ('isVisible' in p) {\n            this.brushCircleOuter.style.opacity = p.isVisible ? '1' : '0';\n            this.brushCircleInner.style.opacity = p.isVisible ? '1' : '0';\n        }\n    }\n\n    updateColorPreview (p: {\n        x?: number;\n        y?: number;\n        color?: IRGB;\n        isVisible?: boolean;\n    }): void {\n        if ('x' in p) {\n            this.pickerPreviewCol.setAttribute('cx', '' + p.x);\n            this.pickerPreviewBorder.setAttribute('cx', '' + p.x);\n        }\n        if ('y' in p) {\n            this.pickerPreviewCol.setAttribute('cy', '' + p.y);\n            this.pickerPreviewBorder.setAttribute('cy', '' + p.y);\n        }\n        if ('color' in p) {\n            this.pickerPreviewCol.setAttribute('stroke', BB.ColorConverter.toRgbStr(p.color));\n            let borderColor = BB.testIsWhiteBestContrast(p.color) ? 'rgba(255,255,255,0.5)' : 'rgba(0,0,0,0.5)'\n            this.pickerPreviewBorder.setAttribute('stroke', borderColor);\n        }\n        if ('isVisible' in p) {\n            this.pickerPreviewCol.style.opacity = p.isVisible ? '1' : '0';\n            this.pickerPreviewBorder.style.opacity = p.isVisible ? '1' : '0';\n        }\n    }\n\n    updateCompass (p: {\n        angleDeg?: number;\n        isVisible?: boolean;\n    }): void {\n        if ('angleDeg' in p) {\n            this.compassInner.setAttribute('transform', 'rotate(' + p.angleDeg + ')');\n            this.compassLineCircle.style.opacity = p.angleDeg % 90 === 0 ? '1' : '0';\n        }\n        if ('isVisible' in p) {\n            this.compass.style.opacity = p.isVisible ? '1' : '0';\n        }\n    }\n\n}\n","import {BB} from '../../bb/bb';\nimport {IRGB, ITransform} from '../kl.types';\nimport {WorkspaceSvgOverlay} from './workspace-svg-overlay';\nimport {klHistory} from '../history/kl-history';\n// @ts-ignore\nimport pickerImg from 'url:~/src/app/img/ui/cursor-picker.png';\n// @ts-ignore\nimport zoomEwImg from 'url:~/src/app/img/ui/cursor-zoom-ew.png';\n// @ts-ignore\nimport fillImg from 'url:~/src/app/img/ui/cursor-fill.png';\n// @ts-ignore\nimport textImg from 'url:~/src/app/img/ui/cursor-text.png';\nimport {IPressureInput, IVector2D} from '../../bb/bb.types';\nimport {KlCanvas} from '../canvas/kl-canvas';\nimport {KeyListener} from '../../bb/input/key-listener';\nimport {KL} from '../kl';\n\nexport interface IViewChangeEvent {\n    changed: ('scale' | 'angle')[];\n    angle: number;\n    scale: number;\n}\n\ntype TModeStr = 'draw' | 'pick' | 'hand' | 'shape' | 'fill' | 'gradient' | 'text'; // | 'transform' | 'select'\n\nconst MIN_SCALE = 1 / 16;\nconst MAX_SCALE = 64;\nenum TMode {\n    Draw,\n    Hand,\n    HandGrabbing,\n    Pick,\n    Zoom,\n    Rotate,\n    Rotating,\n    Fill,\n    Gradient,\n    Text,\n    Shape,\n}\nconst ANIMATION_SPEED = 0.3; // rate of transition towards targetTransform\n\n/**\n * Work area that displays the KlCanvas.\n * - pan, zoom, rotate (also via multi-touch)\n * - input modes: drawing, hand, pick, fill, text // transform, select\n * - drawing input events\n * - view change events\n * - eyedropper input events (pick)\n * - draws cursor, eyedropper overlay\n *\n * subscribes to klCanvas changes\n * listens to kl history for changes\n * and you can manually trigger redraw\n */\nexport class KlCanvasWorkspace {\n\n    private rootEl: HTMLElement;\n    private klCanvas: KlCanvas;\n    private renderTargetCanvas: HTMLCanvasElement;\n    private renderTargetCtx: CanvasRenderingContext2D;\n    private renderWidth: number;\n    private renderHeight: number;\n    private compositeCanvas: HTMLCanvasElement; // for drawing klcanvas layer composite\n    private compositeCtx: CanvasRenderingContext2D;\n    private doResizeCanvas: boolean;\n    private oldTransformObj: ITransform;\n    private targetTransformObj: ITransform; // animation target\n    private highResTransformObj: ITransform; // animated, internal high res\n    private renderedTransformObj: ITransform; // same as highRes, but rounded - what's actually displayed\n    private cursorPos: IVector2D;\n    private usesCssCursor: boolean;\n    private bgVisible: boolean;\n    private transformIsDirty: boolean;\n    private doAnimateTranslate: boolean;\n    private svgOverlay: WorkspaceSvgOverlay;\n    private emptyCanvas: HTMLCanvasElement;\n    private keyListener: KeyListener;\n    private currentMode: TMode;\n    private globalMode: TMode;\n    private renderTime: number; // for debugging - average ms per render()\n    private lastDrawEvent: IPressureInput | null; // previous drawing input\n    private linetoolProcessor: any; // todo type - BB.EventChain.LinetoolProcessor\n    private pointer: IVector2D | null; // position of cursor\n    private isDrawing: boolean;\n    private inputProcessorObj: any; // todo type\n    private currentInputProcessor: any; // todo type\n    private angleIsExtraSticky: boolean;\n    private pinchZoomer: any; // todo type - BB.EventChain.PinchZoomer\n    private mainDoubleTapper: any; // todo type - BB.EventChain.DoubleTapper - todo docs\n    private middleDoubleTapper: any; // todo type - BB.EventChain.DoubleTapper - todo docs\n    private twoFingerTap: any; // todo type - BB.EventChain.NFingerTapper\n    private threeFingerTap: any; // todo type - BB.EventChain.NFingerTapper\n    private pointerEventChain: any; // todo type - BB.EventChain.EventChain\n    private pointerListener: any; // todo type - BB.PointerListener\n    private brushRadius: number;\n    private animationFrameRequested: boolean;\n    private lastRenderedState: number; // KlHistory state - to detect if there are changes to draw\n    private lastRenderTime: number; // ms from performance.now()\n    private hideBrushCursorTimeout: number;\n    private onViewChange: (e:  IViewChangeEvent) => void;\n\n    private getRenderedTransform (): ITransform {\n        // rounded x & y so canvas is less blurry.\n        const result = this.renderedTransformObj;\n        result.x = this.highResTransformObj.x;\n        result.y = this.highResTransformObj.y;\n        result.scale = this.highResTransformObj.scale;\n        result.angle = this.highResTransformObj.angle;\n\n        if (result.angle % (Math.PI / 2) === 0 && result.scale % 1 === 0) {\n            result.x = Math.round(result.x);\n            result.y = Math.round(result.y);\n        }\n\n        return result;\n    }\n\n    private updateChangeListener (): void {\n        this.klCanvas.addChangeListener(() => {\n            this.lastRenderedState = -1;\n            this.reqFrame();\n        });\n    }\n\n    private updateCursor (modeInt: TMode, doForce?: boolean): void {\n        if (modeInt === this.currentMode && !doForce) {\n            return;\n        }\n        const oldMode = this.currentMode;\n        this.currentMode = modeInt;\n        this.lastRenderedState = -1;\n        if (this.currentMode === TMode.Draw) {\n            this.rootEl.style.cursor = 'crosshair';\n        } else if (this.currentMode === TMode.Hand) {\n            this.rootEl.style.cursor = 'grab';\n        } else if (this.currentMode === TMode.HandGrabbing) {\n            this.rootEl.style.cursor = 'grabbing';\n        } else if (this.currentMode === TMode.Pick) {\n            this.rootEl.style.cursor = \"url('\" + pickerImg + \"') 0 15, crosshair\";\n        } else if (this.currentMode === TMode.Zoom) {\n            this.rootEl.style.cursor = \"url('\" + zoomEwImg + \"') 7 7, zoom-in\";\n        } else if (this.currentMode === TMode.Rotate) {\n            this.rootEl.style.cursor = \"grab\";\n        } else if (this.currentMode === TMode.Rotating) {\n            this.rootEl.style.cursor = \"grabbing\";\n        } else if (this.currentMode === TMode.Fill) {\n            this.rootEl.style.cursor = \"url('\" + fillImg + \"') 1 12, crosshair\";\n        } else if (this.currentMode === TMode.Gradient) {\n            this.rootEl.style.cursor = 'crosshair';\n        } else if (this.currentMode === TMode.Text) {\n            this.rootEl.style.cursor = \"url('\" + textImg + \"') 1 12, crosshair\";\n        } else if (this.currentMode === TMode.Shape) {\n            this.rootEl.style.cursor = 'crosshair';\n        }\n\n        if ([TMode.Draw, TMode.Pick, TMode.Fill, TMode.Text, TMode.Shape].includes(this.globalMode)) {\n            const oldIsHand = [TMode.Hand, TMode.HandGrabbing].includes(oldMode);\n            const currentIsHand = [TMode.Hand, TMode.HandGrabbing].includes(this.currentMode);\n            if (!oldIsHand && currentIsHand) {\n                this.mainDoubleTapper.setAllowedPointerTypeArr(['mouse', 'pen', 'touch']);\n            }\n            if (oldIsHand && !currentIsHand) {\n                this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n            }\n        }\n\n        if (this.currentMode !== TMode.Pick) {\n            this.svgOverlay.updateColorPreview({isVisible: false});\n        }\n    }\n\n    /**\n     * returns false if no change of zoom\n     * @param stepNum\n     * @param centerX\n     * @param centerY\n     * @private\n     */\n    private internalZoomByStep (stepNum: number, centerX: number, centerY: number): boolean {\n        const step = Math.log2(this.targetTransformObj.scale);\n\n        let newStep = step / Math.abs(stepNum);\n        newStep += stepNum > 0 ? 1 : -1;\n        newStep = Math.round(newStep);\n        newStep *= Math.abs(stepNum);\n        const newScale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, Math.pow(2, newStep)));\n\n        //has zoomed?\n        if (newScale === this.targetTransformObj.scale) {\n            return false;\n        }\n\n\n        const effectiveFactor = newScale / this.targetTransformObj.scale;\n        this.targetTransformObj.scale = newScale;\n\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerX, centerY));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(effectiveFactor));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerX, -centerY));\n\n        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\n        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\n        this.targetTransformObj.x = origin[0];\n        this.targetTransformObj.y = origin[1];\n\n        this.transformIsDirty = true;\n\n        return true;\n    }\n\n    /**\n     * mixes two transform objects. modifies A\n     * @param transformA\n     * @param transformB\n     * @param blendFactor 0 -> A, 1 -> B\n     * @private\n     */\n    private mixTransformObj (transformA: ITransform, transformB: ITransform, blendFactor: number): void {\n        if (transformA.angle === transformB.angle) {\n            transformA.scale = BB.mix(transformA.scale, transformB.scale, blendFactor);\n            transformA.x = BB.mix(transformA.x, transformB.x, blendFactor);\n            transformA.y = BB.mix(transformA.y, transformB.y, blendFactor);\n            transformA.angle = BB.mix(transformA.angle, transformB.angle, blendFactor);\n            return;\n        }\n\n        const w = this.klCanvas.getWidth();\n        const h = this.klCanvas.getHeight();\n\n        // --- determine centerPosA, centerPosB ---\n        const centerPosA = this.canvasToWorkspaceCoord({\n            x: w / 2,\n            y: h / 2\n        }, transformA);\n        const centerPosB = this.canvasToWorkspaceCoord({\n            x: w / 2,\n            y: h / 2\n        }, transformB);\n\n        // --- centerPosMixed ---\n        transformA.x = BB.mix(centerPosA.x , centerPosB.x, blendFactor);\n        transformA.y = BB.mix(centerPosA.y , centerPosB.y, blendFactor);\n\n        // --- scale and angle ---\n        transformA.scale = BB.mix(transformA.scale, transformB.scale, blendFactor);\n        transformA.angle = BB.mix(transformA.angle, transformB.angle, blendFactor);\n\n        // --- x and y ---\n        const mixedPos = this.canvasToWorkspaceCoord({\n            x: -w / 2,\n            y: -h / 2\n        }, transformA);\n        transformA.x = mixedPos.x;\n        transformA.y = mixedPos.y;\n    }\n\n    private render (): void {\n        if (this.doResizeCanvas) {\n            this.doResizeCanvas = false;\n            this.renderTargetCanvas.width = this.renderWidth;\n            this.renderTargetCanvas.height = this.renderHeight;\n        }\n        this.renderContext(this.renderTargetCtx);\n    }\n\n    /**\n     * is the gray background that surrounds canvas visible?\n     * @private\n     */\n    private testBgVisible (): boolean {\n        //bring workspace points (corners of workspace) into canvas coordinate system\n        //then check if any corner point is outside of the canvas -> that means the bg is visible\n\n        const workspacePointArr = [\n            [0, 0], // top left\n            [this.renderWidth, 0], // top right\n            [this.renderWidth, this.renderHeight], // bottom right\n            [0, this.renderHeight], // bottom left\n        ];\n\n        const art = this.getRenderedTransform();\n\n        //setup transformation matrix\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\n\n        //transform points, then test if outside of canvas\n        for (let i = 0; i < workspacePointArr.length; i++) {\n            let coords = [workspacePointArr[i][0], workspacePointArr[i][1], 0, 1];\n            coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n\n            if (\n                !(0 <= coords[0] && coords[0] <= this.klCanvas.getWidth() &&\n                    0 <= coords[1] && coords[1] <= this.klCanvas.getHeight())\n            ){\n                //if not inside -> bg visible\n                return true;\n            }\n        }\n        return false;\n    }\n\n    private renderContext (ctx: CanvasRenderingContext2D): void {\n        const w = this.klCanvas.getWidth();\n        const h = this.klCanvas.getHeight();\n\n        const art = this.getRenderedTransform();\n\n        if (art.scale >= 4 || (art.scale === 1 && art.angle === 0)) {\n            ctx.imageSmoothingEnabled = false;\n        } else {\n            ctx.imageSmoothingEnabled = true;\n            ctx.imageSmoothingQuality  = 'low'; // art.scale >= 1 ? 'low' : 'medium';\n        }\n        //ctx.imageSmoothingEnabled = false;\n        //renderTargetCtx.globalCompositeOperation  = 'multiply';\n\n\n\n        ctx.save();\n        {\n            if (this.bgVisible) {\n                ctx.fillStyle = 'rgb(158,158,158)'; // 'rgb(185,185,185)';\n                ctx.fillRect(0, 0, this.renderWidth, this.renderHeight);\n            } else {\n                ctx.clearRect(0, 0, this.renderWidth, this.renderHeight);\n            }\n\n\n\n            if (this.bgVisible) {\n                ctx.save();\n\n                ctx.translate(art.x, art.y);\n                ctx.scale(art.scale, art.scale);\n                ctx.rotate(art.angle);\n\n                ctx.imageSmoothingEnabled = false;\n\n                //outline\n                const borderSize = 1;\n                ctx.globalAlpha = 0.2;\n                ctx.drawImage(\n                    this.emptyCanvas,\n                    -borderSize / art.scale,\n                    -borderSize / art.scale,\n                    w + borderSize * 2 / art.scale,\n                    h + borderSize * 2 / art.scale\n                );\n                ctx.globalAlpha = 1;\n\n                //erase\n                ctx.globalCompositeOperation = 'destination-out';\n                ctx.drawImage(this.emptyCanvas, 0, 0, w, h);\n\n                ctx.restore();\n            }\n\n            /*const region = new Path2D();\n            region.rect(80, 10, 20, 130);\n            ctx.clip(region);*/\n\n            ctx.translate(art.x, art.y);\n            ctx.scale(art.scale, art.scale);\n            ctx.rotate(art.angle);\n\n            const layerArr = this.klCanvas.getLayersFast();\n            for (let i = 0; i < layerArr.length; i++) {\n                if (layerArr[i].opacity > 0) {\n                    ctx.globalAlpha = layerArr[i].opacity;\n                    ctx.globalCompositeOperation = layerArr[i].mixModeStr;\n\n                    if (layerArr[i].canvas.compositeObj) {\n                        if (this.compositeCanvas.width !== layerArr[i].canvas.width || this.compositeCanvas.height !== layerArr[i].canvas.height) {\n                            this.compositeCanvas.width = layerArr[i].canvas.width;\n                            this.compositeCanvas.height = layerArr[i].canvas.height;\n                        } else {\n                            this.compositeCtx.clearRect(0, 0, this.compositeCanvas.width, this.compositeCanvas.height);\n                        }\n                        this.compositeCtx.drawImage(layerArr[i].canvas, 0, 0);\n                        layerArr[i].canvas.compositeObj.draw(this.compositeCtx);\n                        ctx.drawImage(this.compositeCanvas, 0, 0, w, h);\n                    } else {\n                        ctx.drawImage(layerArr[i].canvas, 0, 0, w, h);\n                    }\n                }\n            }\n            ctx.globalAlpha = 1;\n\n\n\n        }\n        ctx.restore();\n\n        // rotation hud\n        if (TMode.Rotate === this.currentMode || TMode.Rotating === this.currentMode) {\n            this.svgOverlay.updateCompass({\n                isVisible: true,\n                angleDeg: art.angle / Math.PI * 180\n            });\n        } else {\n            this.svgOverlay.updateCompass({\n                isVisible: false\n            });\n        }\n    }\n\n    private workspaceToCanvasCoord (p: IVector2D): IVector2D {\n        const art = this.getRenderedTransform();\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\n\n        let coords = [p.x, p.y, 0, 1];\n        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n\n        return {\n            x: coords[0],\n            y: coords[1],\n        };\n    }\n\n    private canvasToWorkspaceCoord (p: IVector2D, transformObj: ITransform): IVector2D {\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(transformObj.x, transformObj.y));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(transformObj.angle));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(transformObj.scale));\n\n        let coords = [p.x, p.y, 0, 1];\n        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n\n        return {\n            x: coords[0],\n            y: coords[1],\n        };\n    }\n\n    private snapAngleRad (angleRad: number, snapDegIncrement: number, maxDistDeg: number): number {\n        let angleDeg = angleRad * 180 / Math.PI;\n        const modDeg = Math.abs(angleDeg % snapDegIncrement);\n        const dist = Math.min(modDeg, snapDegIncrement - modDeg);\n\n        if (dist <= maxDistDeg) {\n            angleDeg = Math.round(angleDeg / snapDegIncrement) * snapDegIncrement;\n        }\n\n        return angleDeg / 180 * Math.PI;\n    }\n\n    /**\n     * angle always in range [-PI, PI]\n     * @param angleRad\n     * @private\n     */\n    private minimizeAngleRad (angleRad: number): number {\n        angleRad = angleRad % (2 * Math.PI);\n        if (angleRad > Math.PI) {\n            angleRad -= 2 * Math.PI;\n        } else if (angleRad < -Math.PI) {\n            angleRad += 2 * Math.PI;\n        }\n        return angleRad;\n    }\n\n    private resetInputProcessor (): void {\n        this.currentInputProcessor = null;\n        this.updateCursor(this.globalMode);\n        this.reqFrame(true);\n    }\n\n    private reqFrame (doRedrawCanvas?: boolean): void {\n        this.animationFrameRequested = true;\n        if (doRedrawCanvas) {\n            this.lastRenderedState = -1;\n        }\n    }\n\n    private updateLoop (): void {\n        window.requestAnimationFrame(() => this.updateLoop());\n        const newState = klHistory.getState();\n        const doRender = this.lastRenderedState < newState;\n\n        //handle variable framerate\n        const nowTime = performance.now();\n        const elapsedFrames = (nowTime - this.lastRenderTime) * 60 / 1000; //how many frames elapsed since last render if fps were 60fps\n        this.lastRenderTime = nowTime;\n\n        if (this.animationFrameRequested || doRender) {\n            this.animationFrameRequested = false;\n            this.checkChange(elapsedFrames);\n        }\n    }\n\n    private checkChange (elapsedFrames: number): void {\n\n        const newState = klHistory.getState();\n        const doRender = this.lastRenderedState < newState ||\n            this.highResTransformObj.scale !== this.targetTransformObj.scale ||\n            this.highResTransformObj.x !== this.targetTransformObj.x ||\n            this.highResTransformObj.y !== this.targetTransformObj.y;\n\n        //update transform\n        if (\n            !this.doAnimateTranslate &&\n            (\n                this.highResTransformObj.scale === this.targetTransformObj.scale ||\n                Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale\n            )\n        ) {\n            this.highResTransformObj.scale = this.targetTransformObj.scale;\n            this.highResTransformObj.x = this.targetTransformObj.x;\n            this.highResTransformObj.y = this.targetTransformObj.y;\n            this.highResTransformObj.angle = this.targetTransformObj.angle;\n            if (this.transformIsDirty) {\n                this.transformIsDirty = false;\n                this.bgVisible = this.testBgVisible();\n            }\n\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\n        } else if (\n            (this.highResTransformObj.x === this.targetTransformObj.x || Math.abs(this.highResTransformObj.x - this.targetTransformObj.x) < 0.5) &&\n            (this.highResTransformObj.y === this.targetTransformObj.y || Math.abs(this.highResTransformObj.y - this.targetTransformObj.y) < 0.5) &&\n            (\n                this.highResTransformObj.scale === this.targetTransformObj.scale ||\n                Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale\n            )\n        ) {\n            this.highResTransformObj.scale = this.targetTransformObj.scale;\n            this.highResTransformObj.x = this.targetTransformObj.x;\n            this.highResTransformObj.y = this.targetTransformObj.y;\n            this.highResTransformObj.angle = this.targetTransformObj.angle;\n            this. doAnimateTranslate = false;\n            if (this.transformIsDirty) {\n                this.transformIsDirty = false;\n                this.bgVisible = this.testBgVisible();\n            }\n\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\n        } else {\n            this.reqFrame(); //probably needs another frame\n            const blendFactor = Math.min(1, ANIMATION_SPEED * elapsedFrames);\n            this.mixTransformObj(this.highResTransformObj, this.targetTransformObj, blendFactor);\n            this.bgVisible = true; // spare yourself the calculation\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\n        }\n\n        if (this.pointer && this.currentMode == TMode.Draw && !this.usesCssCursor) {\n            this.svgOverlay.updateCursor({\n                x: this.pointer.x,\n                y: this.pointer.y,\n                isVisible: true\n            });\n        } else {\n            this.svgOverlay.updateCursor({isVisible: false});\n        }\n\n\n        if (doRender) {\n            //console.log('scale', this.renderedTransform.scale, 'x', this.renderedTransform.x, 'y', this.renderedTransform.y);\n            this.lastRenderedState = newState;\n            const start = performance.now();\n            this.render();\n            this.renderTime = BB.mix(this.renderTime, performance.now() - start, 0.05);\n        }\n        //setTimeout(this.checkChange, 100);\n\n\n\n        if (doRender) {\n\n            //console.log('rendertime ms: ', this.renderTime);\n        }\n\n    }\n\n    // ---- public ----\n\n    constructor (\n        p: {\n            klCanvas: any; // todo\n            width: number;\n            height: number;\n            onDraw: (val) => void; // todo\n            onPick: (rgb: IRGB, isPointerup: boolean) => void;\n            onFill: (canvasX: number, canvasY: number) => void;\n            onGradient: (type: 'down' | 'up' | 'move', canvasX: number, canvasY: number, angleRad: number) => void;\n            onText: (canvasX: number, canvasY: number, angleRad: number) => void;\n            onShape: (type: 'down' | 'up' | 'move', canvasX: number, canvasY: number, angleRad: number) => void;\n            onViewChange: (e:  IViewChangeEvent) => void;\n            onUndo: () => void;\n            onRedo: () => void;\n        }\n    ) {\n        const _this = this;\n        this.rootEl = BB.el({\n            css: {\n                position: 'absolute',\n                left: '0',\n                right: '0',\n                top: '0',\n                bottom: '0',\n                cursor: 'crosshair',\n                userSelect: 'none',\n                colorScheme: 'only light',\n            }\n        });\n        this.klCanvas = p.klCanvas;\n        this.onViewChange = p.onViewChange;\n        this.renderTargetCanvas = BB.canvas(p.width, p.height);\n        this.renderTargetCtx = this.renderTargetCanvas.getContext('2d');\n        this.renderWidth = p.width;\n        this.renderHeight = p.height;\n        this.compositeCanvas = BB.canvas(1, 1); // for drawing klcanvas layer composite\n        this.compositeCtx = this.compositeCanvas.getContext('2d');\n        this.doResizeCanvas = false;\n        this.oldTransformObj = null;\n        this.targetTransformObj = {\n            x: 0,\n            y: 0,\n            scale: 1,\n            angle: 0\n        };\n        this.highResTransformObj = {\n            x: 0,\n            y: 0,\n            scale: 1,\n            angle: 0\n        };\n        this.renderedTransformObj = {\n            x: null,\n            y: null,\n            scale: null,\n            angle: null\n        };\n        this.cursorPos = {\n            x: 0,\n            y: 0\n        };\n        this.usesCssCursor = false;\n        this.bgVisible = true;\n        this.transformIsDirty = true;\n        this.doAnimateTranslate = true;\n\n        this.svgOverlay = new WorkspaceSvgOverlay({\n            width: p.width,\n            height: p.height\n        });\n\n        BB.css(this.renderTargetCanvas, {\n            userSelect: 'none',\n            pointerEvents: 'none',\n        });\n        BB.createCheckerDataUrl(8, (url) => {\n            this.renderTargetCanvas.style.background = \"url(\" + url + \")\";\n        });\n        this.rootEl.appendChild(this.renderTargetCanvas);\n        this.rootEl.appendChild(this.svgOverlay.getElement());\n        BB.addEventListener(this.rootEl, 'touchend', (e) => {\n            e.preventDefault();\n            return false;\n        });\n        BB.addEventListener(this.rootEl, 'contextmenu', (e) => {\n            e.preventDefault();\n            return false;\n        });\n        BB.addEventListener(this.rootEl, 'dragstart', (e) => {\n            e.preventDefault();\n            return false;\n        });\n\n        this.emptyCanvas = BB.canvas(1, 1);\n        {\n            const ctx = this.emptyCanvas.getContext('2d');\n            ctx.fillRect(0, 0, 1, 1);\n        }\n\n        this.keyListener = new BB.KeyListener({\n            onDown: (keyStr, event, comboStr, isRepeat) => {\n\n                if (KL.dialogCounter.get() > 0 || BB.isInputFocused(true)) {\n                    return;\n                }\n                if (keyStr === 'alt') {\n                    event.preventDefault();\n                }\n                if (isRepeat) {\n                    return;\n                }\n\n                if (this.currentInputProcessor) {\n                    this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n\n                } else {\n\n                    if ([TMode.Draw, TMode.Pick, TMode.Fill, TMode.Gradient, TMode.Text, TMode.Shape].includes(this.globalMode) && comboStr === 'space') {\n                        this.currentInputProcessor = this.inputProcessorObj.spaceHand;\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n                        return;\n                    }\n\n                    if ([TMode.Draw, TMode.Hand, TMode.Fill, TMode.Gradient, TMode.Text, TMode.Shape].includes(this.globalMode) && comboStr === 'alt') {\n                        this.currentInputProcessor = this.inputProcessorObj.altPicker;\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n                        return;\n                    }\n\n                    if (['r', 'shift+r'].includes(comboStr)) {\n                        this.currentInputProcessor = this.inputProcessorObj.rotate;\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n                        return;\n                    }\n\n                    if ('z' === comboStr) {\n                        this.currentInputProcessor = this.inputProcessorObj.zoom;\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n                        return;\n                    }\n\n                }\n\n            },\n            onUp: (keyStr, event, oldComboStr) => {\n                // prevent menu bar in Firefox\n                if (keyStr === 'alt') {\n                    event.preventDefault();\n                }\n\n                if (this.currentInputProcessor) {\n                    this.currentInputProcessor.onKeyUp(keyStr, event, oldComboStr);\n                }\n            }\n        });\n\n        this.updateChangeListener();\n\n        this.currentMode = TMode.Draw;\n        this.globalMode = TMode.Draw;\n\n        this.renderTime = 0;\n\n        this.lastDrawEvent = null;\n\n        this.linetoolProcessor = new BB.EventChain.LinetoolProcessor({\n            onDraw: (event) => {\n                const getMatrix = () => {\n                    const art = this.getRenderedTransform();\n                    let matrix = BB.Matrix.getIdentity();\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\n                    return matrix;\n                };\n\n                if (event.type === 'line' && !this.lastDrawEvent) {\n                    const matrix = getMatrix();\n                    let coords = [event.x1, event.y1, 0, 1];\n                    coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n                    this.lastDrawEvent = {\n                        x: coords[0],\n                        y: coords[1],\n                        pressure: event.pressure1\n                    };\n                    return;\n                }\n\n                if ('x' in event || 'x0' in event) {\n\n                    const matrix = getMatrix();\n\n                    if ('x' in event) { //down or move\n                        let coords = [event.x, event.y, 0, 1];\n                        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n                        event.x = coords[0];\n                        event.y = coords[1];\n                    }\n                    if ('x0' in event) { //line\n                        event.x0 = this.lastDrawEvent.x;\n                        event.y0 = this.lastDrawEvent.y;\n                        event.pressure0 = this.lastDrawEvent.pressure;\n                        let coords = [event.x1, event.y1, 0, 1];\n                        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n                        event.x1 = coords[0];\n                        event.y1 = coords[1];\n\n                        this.lastDrawEvent = {\n                            x: event.x1,\n                            y: event.y1,\n                            pressure: event.pressure1,\n                        };\n                    }\n                }\n\n\n                if (['down', 'move'].includes(event.type)) {\n                    this.lastDrawEvent = event;\n                }\n                p.onDraw(event);\n            }\n        });\n\n        this.pointer = null;\n        this.isDrawing = false;\n\n\n        this.inputProcessorObj = {\n            draw: {\n                onPointer: (val) => {\n\n                    this.reqFrame();\n                    this.updateCursor(TMode.Draw);\n\n                    const comboStr = this.keyListener.getComboStr();\n\n                    const event: any = {\n                        scale: this.highResTransformObj.scale\n                    };\n                    event.shiftIsPressed = comboStr === 'shift';\n                    event.pressure = val.pressure;\n                    event.isCoalesced = !!val.isCoalesced;\n\n                    if (val.type === 'pointerdown') {\n\n                        this.isDrawing = true;\n                        event.type = 'down';\n\n                    } else if (val.button) {\n                        event.type = 'move';\n\n                    } else if (val.type === 'pointerup') {\n\n                        this.isDrawing = false;\n                        event.type = 'up';\n\n                        this.linetoolProcessor.process(event);\n                        this.resetInputProcessor();\n                        return;\n                    } else {\n                        return;\n                    }\n\n                    event.x = val.relX;\n                    event.y = val.relY;\n\n                    this.linetoolProcessor.process(event);\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                }\n            },\n            fill: {\n                onPointer: (event) => {\n\n                    this.reqFrame();\n                    this.updateCursor(TMode.Fill);\n\n                    if (event.type === 'pointerdown') {\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\n                        p.onFill(Math.floor(coord.x), Math.floor(coord.y));\n\n                    } else if (event.type === 'pointerup') {\n                        this.resetInputProcessor();\n                        return;\n\n                    }\n\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                }\n            },\n            gradient: {\n                onPointer: (event) => {\n\n                    this.reqFrame();\n                    this.updateCursor(TMode.Gradient);\n                    const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\n\n                    if (event.type === 'pointerdown') {\n                        this.isDrawing = true;\n                        p.onGradient('down', coord.x, coord.y, this.renderedTransformObj.angle);\n\n                    } else if (event.type === 'pointermove') {\n                        p.onGradient('move', coord.x, coord.y, this.renderedTransformObj.angle);\n\n                    } else if (event.type === 'pointerup') {\n                        this.isDrawing = false;\n                        p.onGradient('up', coord.x, coord.y, this.renderedTransformObj.angle);\n                        this.resetInputProcessor();\n\n                    }\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                }\n            },\n            text: {\n                onPointer: (event) => {\n\n                    this.reqFrame();\n                    this.updateCursor(TMode.Text);\n\n                    if (event.type === 'pointerdown') {\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\n                        p.onText(Math.floor(coord.x), Math.floor(coord.y), this.renderedTransformObj.angle);\n\n                    } else if (event.type === 'pointerup') {\n                        this.resetInputProcessor();\n                        return;\n\n                    }\n\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                }\n            },\n            shape: {\n                onPointer: (event) => {\n\n                    this.reqFrame();\n                    this.updateCursor(TMode.Shape);\n                    const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\n\n                    if (event.type === 'pointerdown') {\n                        this.isDrawing = true;\n                        p.onShape('down', coord.x, coord.y, this.renderedTransformObj.angle);\n\n                    } else if (event.type === 'pointermove') {\n                        p.onShape('move', coord.x, coord.y, this.renderedTransformObj.angle);\n\n                    } else if (event.type === 'pointerup') {\n                        this.isDrawing = false;\n                        p.onShape('up', coord.x, coord.y, this.renderedTransformObj.angle);\n                        this.resetInputProcessor();\n\n                    }\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                }\n            },\n            hand: {\n                onPointer: (event) => {\n                    this.updateCursor(TMode.Hand);\n                    if (['left', 'middle'].includes(event.button)) {\n                        this.updateCursor(TMode.HandGrabbing);\n                        this.targetTransformObj.x += event.dX;\n                        this.targetTransformObj.y += event.dY;\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\n                        this.doAnimateTranslate = false;\n                        this.transformIsDirty = true;\n                        this.reqFrame(true);\n                    } else if (event.type === 'pointerup') {\n                        this.resetInputProcessor();\n                    }\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                }\n            },\n            spaceHand: {\n                onPointer: (event) => {\n                    this.updateCursor(TMode.Hand);\n                    if (['left', 'middle'].includes(event.button)) {\n                        this.updateCursor(TMode.HandGrabbing);\n                        this.targetTransformObj.x += event.dX;\n                        this.targetTransformObj.y += event.dY;\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\n                        this.doAnimateTranslate = false;\n                        this.transformIsDirty = true;\n                        this.reqFrame(true);\n                    }\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n                    if (comboStr !== 'space') {\n                        this.resetInputProcessor();\n                    } else {\n                        this.updateCursor(TMode.Hand);\n                    }\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n                    this.resetInputProcessor();\n                }\n            },\n            zoom: {\n                onPointer: (event) => {\n                    this.updateCursor(TMode.Zoom);\n\n                    if (event.button === 'left' && !event.isCoalesced && event.dX != 0) {\n\n                        const offsetX = event.pageX - event.relX;\n                        const offsetY = event.pageY - event.relY;\n\n                        this.internalZoomByStep(event.dX / 175, event.downPageX - offsetX, event.downPageY - offsetY);\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\n                        this.lastRenderedState = -1;\n                        this.reqFrame();\n\n                        this.onViewChange({\n                            changed: ['scale'],\n                            angle: this.targetTransformObj.angle,\n                            scale: this.targetTransformObj.scale\n                        });\n                    }\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n                    if (comboStr !== 'z') {\n                        this.resetInputProcessor();\n                    } else {\n                        this.updateCursor(TMode.Zoom);\n                    }\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n                    this.resetInputProcessor();\n                }\n            },\n            picker: {\n                onPointer: (event) => {\n                    this.updateCursor(TMode.Pick);\n                    if (\n                        (['left', 'right'].includes(event.button) && !event.isCoalesced) ||\n                        event.type === 'pointerup'\n                    ) {\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\n                        const pickedColor = this.klCanvas.getColorAt(coord.x, coord.y);\n                        p.onPick(pickedColor, event.type === 'pointerup');\n                        this.svgOverlay.updateColorPreview({\n                            x: event.relX,\n                            y: event.relY,\n                            color: pickedColor,\n                            isVisible: event.type !== 'pointerup'\n                        });\n\n                        if (event.type === 'pointerup') {\n                            this.resetInputProcessor();\n                        }\n                    }\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                }\n            },\n            altPicker: {\n                onPointer: (event) => {\n                    this.updateCursor(TMode.Pick);\n                    if (\n                        (['left', 'right'].includes(event.button) && !event.isCoalesced) ||\n                        event.type === 'pointerup'\n                    ) {\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\n                        const pickedColor = this.klCanvas.getColorAt(coord.x, coord.y);\n                        p.onPick(pickedColor, event.type === 'pointerup');\n                        this.svgOverlay.updateColorPreview({\n                            x: event.relX,\n                            y: event.relY,\n                            color: pickedColor,\n                            isVisible: event.type !== 'pointerup'\n                        });\n                    }\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n                    if (comboStr !== 'alt') {\n                        this.resetInputProcessor();\n                    } else {\n                        this.updateCursor(TMode.Pick);\n                    }\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n                    this.resetInputProcessor();\n                }\n            },\n            rotate: {\n                onPointer: (event) => {\n                    this.updateCursor(event.button === 'left' ? TMode.Rotating : TMode.Rotate);\n\n                    if (event.type === 'pointerdown' && event.button === 'left') {\n                        this.oldTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\n                    } else if (event.button === 'left' && !event.isCoalesced && this.oldTransformObj) {\n\n\n                        const offsetX = event.pageX - event.relX;\n                        const offsetY = event.pageY - event.relY;\n                        //rotation done around center\n                        const centerObj = {\n                            x: this.renderWidth / 2,\n                            y: this.renderHeight / 2\n                        };\n\n                        const startAngleRad = BB.Vec2.angle(centerObj, {x: event.downPageX - offsetX, y: event.downPageY - offsetY});\n                        const angleRad = BB.Vec2.angle(centerObj, {x: event.pageX - offsetX, y: event.pageY - offsetY});\n                        let dAngleRad = angleRad - startAngleRad;\n\n                        //apply angle\n                        this.targetTransformObj = JSON.parse(JSON.stringify(this.oldTransformObj));\n                        this.targetTransformObj.angle += dAngleRad;\n\n                        if (this.keyListener.isPressed('shift')) {\n                            this.targetTransformObj.angle = Math.round(this.targetTransformObj.angle / Math.PI * 8) * Math.PI / 8; //snap the angle to 45/2 degs\n                            dAngleRad = this.targetTransformObj.angle - this.oldTransformObj.angle;\n                        }\n\n                        this.targetTransformObj.angle = this.minimizeAngleRad(this.targetTransformObj.angle);\n\n                        //rotate transform.xy\n                        let matrix = BB.Matrix.getIdentity();\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\n                        //matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(effectiveFactor));\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(dAngleRad));\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\n                        //matrix = multiplyMatrices(matrix, createTranslationMatrix(val.x - val.startX, val.y - val.startY));\n\n                        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\n                        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\n                        this.targetTransformObj.x = origin[0];\n                        this.targetTransformObj.y = origin[1];\n\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\n\n                        this.transformIsDirty = true;\n                        this.lastRenderedState = -1;\n                        this.reqFrame();\n\n                        this.onViewChange({\n                            changed: ['angle'],\n                            scale: this.targetTransformObj.scale,\n                            angle: this.targetTransformObj.angle\n                        });\n\n                    }\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n                    if (['r', 'r+shift', 'shift+r', 'r+left', 'r+right', 'r+left+right', 'r+right+left', 'r+up'].includes(comboStr)) {\n                        this.updateCursor(TMode.Rotate);\n                    } else {\n                        this.resetInputProcessor();\n                    }\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n                    const comboStr = this.keyListener.getComboStr();\n                    if (['r', 'r+shift', 'shift+r', 'r+left', 'r+right', 'r+left+right', 'r+right+left', 'r+up'].includes(comboStr)) {\n                        this.updateCursor(TMode.Rotate);\n                    } else {\n                        this.resetInputProcessor();\n                    }\n                }\n            }\n        };\n        this.currentInputProcessor = null;\n\n\n        this.angleIsExtraSticky = false;\n        this.pinchZoomer = new BB.EventChain.PinchZoomer({\n            onPinch: (event) => {\n\n                if (event.type === 'move') {\n\n                    if (!this.oldTransformObj) {\n                        this.oldTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\n                        this.angleIsExtraSticky = this.targetTransformObj.angle % (Math.PI / 2) === 0;\n                    }\n\n                    this.targetTransformObj = JSON.parse(JSON.stringify(this.oldTransformObj));\n\n                    event.scale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, this.targetTransformObj.scale * event.scale)) / this.targetTransformObj.scale;\n\n                    this.targetTransformObj.scale *= event.scale;\n                    this.targetTransformObj.angle += event.angleRad;\n                    this.targetTransformObj.angle = this.minimizeAngleRad(\n                        this.snapAngleRad(\n                            this.targetTransformObj.angle,\n                            90,\n                            this.angleIsExtraSticky ? 12 : 4\n                        )\n                    );\n                    if (this.targetTransformObj.angle % (Math.PI / 2) !== 0) {\n                        this.angleIsExtraSticky = false;\n                    }\n                    //targetTransformObj.angle = minimizeAngleRad(snapAngleRad(targetTransformObj.angle, 90, 7));\n                    event.angleRad = this.targetTransformObj.angle - this.oldTransformObj.angle;\n\n                    //calc translation\n                    {\n                        let matrix = BB.Matrix.getIdentity();\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(event.relX, event.relY));\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(event.scale));\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(event.angleRad));\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-event.relX, -event.relY));\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(event.relX - event.downRelX, event.relY - event.downRelY));\n\n\n                        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\n                        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\n\n                        this.targetTransformObj.x = origin[0];\n                        this.targetTransformObj.y = origin[1];\n\n                    }\n\n                    this.highResTransformObj = BB.copyObj(this.targetTransformObj);\n\n                    //if (event.scale !== 1) {\n                    this.onViewChange({\n                        changed: ['scale', 'angle'],\n                        scale: this.targetTransformObj.scale,\n                        angle: this.targetTransformObj.angle\n                    });\n                    //}\n                    this.reqFrame();\n                    this.transformIsDirty = true;\n                    this.lastRenderedState = -1;\n\n\n                } else if (event.type === 'end') {\n                    this.oldTransformObj = null;\n                }\n\n\n            }\n        });\n\n        const onDoubleTap = (event) => {\n            if (_this.fitView()) {\n                this.lastRenderedState = -1;\n                this.reqFrame();\n            } else {\n                // zoom 2 steps further\n\n                let didZoom = this.internalZoomByStep(\n                    2,\n                    event.relX,\n                    event.relY,\n                );\n                if (didZoom) {\n                    this.onViewChange({\n                        changed: ['scale'],\n                        angle: this.targetTransformObj.angle,\n                        scale: this.targetTransformObj.scale\n                    });\n                }\n\n                //updateCursor(TMode.Draw, true);\n                this.lastRenderedState = -1;\n            }\n        }\n\n        this.mainDoubleTapper = new BB.EventChain.DoubleTapper({ onDoubleTap });\n        this.middleDoubleTapper = new BB.EventChain.DoubleTapper({ onDoubleTap });\n        this.middleDoubleTapper.setAllowedButtonArr(['middle']);\n\n\n        this.twoFingerTap = new BB.EventChain.NFingerTapper({\n            fingers: 2,\n            onTap: () => {\n                p.onUndo();\n            }\n        });\n        this.threeFingerTap = new BB.EventChain.NFingerTapper({\n            fingers: 3,\n            onTap: () => {\n                p.onRedo();\n            }\n        });\n\n\n        this.pointerEventChain = new BB.EventChain.EventChain({\n            chainArr: [\n                this.twoFingerTap,\n                this.threeFingerTap,\n                this.mainDoubleTapper,\n                this.middleDoubleTapper,\n                this.pinchZoomer,\n                new BB.EventChain.OnePointerLimiter(),\n                new BB.EventChain.CoalescedExploder()\n            ]\n        });\n        this.pointerEventChain.setChainOut((event) => {\n\n            this.cursorPos.x = event.relX;\n            this.cursorPos.y = event.relY;\n            if (event.type === 'pointerup' && event.pointerType === 'touch') {\n                this.pointer = null;\n                this.lastRenderedState = -1;\n                this.reqFrame();\n            } else {\n                if (!this.pointer) {\n                    this.pointer = { x: 0, y: 0 };\n                }\n                this.pointer.x = event.relX;\n                this.pointer.y = event.relY;\n            }\n\n            if (this.currentInputProcessor) {\n                this.currentInputProcessor.onPointer(event);\n\n            } else {\n\n                let comboStr = this.keyListener.getComboStr();\n\n                if (this.globalMode === TMode.Draw) {\n\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\n                        this.currentInputProcessor = this.inputProcessorObj.draw;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Draw);\n                        this.reqFrame();\n                    }\n\n                } else if (this.globalMode === TMode.Hand) {\n\n                    if (event.type === 'pointerdown' && ['left', 'middle'].includes(event.button)) {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Hand);\n                    }\n\n                } else if (this.globalMode === TMode.Pick) {\n\n                    if (event.type === 'pointerdown' && ['left', 'right'].includes(event.button)) {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Pick);\n                    }\n\n                } else if (this.globalMode === TMode.Fill) {\n\n                    if (event.type === 'pointerdown' && event.button === 'left') {\n                        this.currentInputProcessor = this.inputProcessorObj.fill;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Fill);\n                        this.reqFrame();\n                    }\n\n                } else if (this.globalMode === TMode.Gradient) {\n\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\n                        this.currentInputProcessor = this.inputProcessorObj.gradient;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Gradient);\n                        this.reqFrame();\n                    }\n\n                } else if (this.globalMode === TMode.Text) {\n\n                    if (event.type === 'pointerdown' && event.button === 'left') {\n                        this.currentInputProcessor = this.inputProcessorObj.text;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Text);\n                        this.reqFrame();\n                    }\n\n                } else if (this.globalMode === TMode.Shape) {\n\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\n                        this.currentInputProcessor = this.inputProcessorObj.shape;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Shape);\n                        this.reqFrame();\n                    }\n\n                }\n\n\n            }\n\n        });\n\n        //prevent ctrl scroll -> zooming page\n        BB.addEventListener(this.rootEl, 'wheel', (event) => {\n            event.preventDefault();\n        });\n\n\n        setTimeout(() => {\n            this.pointerListener = new BB.PointerListener({\n                target: this.rootEl,\n                fixScribble: true,\n                onPointer: (e) => {\n                    if (e.type === 'pointerdown' && e.button === 'middle') {\n                        try {\n                            e.eventPreventDefault();\n                        } catch (e) {}\n                    }\n                    // prevent manual slider input keeping focus on iPad\n                    if (e.type === 'pointerdown') {\n                        BB.unfocusAnyInput();\n                    }\n                    /*if (e.type === 'pointermove') {\n                        BB.throwOut(JSON.stringify(e));\n                    }*/\n\n                    this.pointerEventChain.chainIn(e)\n                },\n                onWheel: (wheelEvent) => {\n\n                    if (this.isDrawing) {\n                        return;\n                    }\n\n                    this.reqFrame();\n                    let didZoom = this.internalZoomByStep(\n                        -wheelEvent.deltaY / (this.keyListener.isPressed('shift') ? 8 : 2),\n                        wheelEvent.relX,\n                        wheelEvent.relY\n                    );\n                    if (didZoom) {\n                        this.onViewChange({\n                            changed: ['scale'],\n                            angle: this.targetTransformObj.angle,\n                            scale: this.targetTransformObj.scale\n                        });\n                    }\n\n                    //updateCursor(TMode.Draw, true);\n                    this.lastRenderedState = -1;\n\n\n                },\n                onEnterLeave: (isOver) => {\n                    if (!isOver) {\n                        if (!this.isDrawing) {\n                            this.pointer = null;\n                            this.lastRenderedState = -1;\n                        }\n                    }\n                },\n                maxPointers: 4\n            });\n        }, 1);\n\n        this.brushRadius = 1;\n\n        this.animationFrameRequested = false;\n\n\n\n\n        //setup rendering\n        this.lastRenderedState = -2;\n        this.lastRenderTime = performance.now();\n\n        window.requestAnimationFrame(() => this.updateLoop());\n\n        this.resetView();\n    }\n\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    setCanvas (klC: KlCanvas): void {\n        this.klCanvas = klC;\n        this.lastDrawEvent = null;\n        this.resetView();\n\n        this.updateChangeListener();\n\n        this.lastRenderedState = -1;\n        this.reqFrame();\n    }\n\n    /**\n     * set size of workspace area in pixels\n     * @param width\n     * @param height\n     */\n    setSize (width: number, height: number): void {\n        const oldWidth = this.renderWidth;\n        const oldHeight = this.renderHeight;\n\n        if (width === oldWidth && height === oldHeight) {\n            return;\n        }\n\n        this.doResizeCanvas = true;\n        this.renderWidth = width;\n        this.renderHeight = height;\n\n        this.svgOverlay.setSize(width, height);\n\n        this.targetTransformObj.x += (width - oldWidth) / 2;\n        this.targetTransformObj.y += (height - oldHeight) / 2;\n\n        this.highResTransformObj.x = this.targetTransformObj.x;\n        this.highResTransformObj.y = this.targetTransformObj.y;\n\n        this.bgVisible = this.testBgVisible();\n\n        this.lastRenderedState = -1;\n        this.reqFrame();\n    }\n\n    setMode (modeStr: TModeStr): void {\n        //only sets the base mode\n        if (modeStr === 'draw') {\n            this.globalMode = TMode.Draw;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n        }\n        if (modeStr === 'fill') {\n            this.globalMode = TMode.Fill;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n        }\n        if (modeStr === 'gradient') {\n            this.globalMode = TMode.Gradient;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n        }\n        if (modeStr === 'text') {\n            this.globalMode = TMode.Text;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n        }\n        if (modeStr === 'shape') {\n            this.globalMode = TMode.Shape;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n        }\n        if (modeStr === 'hand') {\n            this.globalMode = TMode.Hand;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['mouse', 'pen', 'touch']);\n        }\n        if (modeStr === 'pick') {\n            this.globalMode = TMode.Pick;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n        }\n    }\n\n    getMode(): TModeStr {\n        if (this.globalMode === TMode.Draw) {\n            return 'draw';\n        }\n        if (this.globalMode === TMode.Fill) {\n            return 'fill';\n        }\n        if (this.globalMode === TMode.Gradient) {\n            return 'gradient';\n        }\n        if (this.globalMode === TMode.Text) {\n            return 'text';\n        }\n        if (this.globalMode === TMode.Shape) {\n            return 'shape';\n        }\n        if (this.globalMode === TMode.Hand) {\n            return 'hand';\n        }\n        if (this.globalMode === TMode.Pick) {\n            return 'pick';\n        }\n    }\n\n    setEnabled (b: boolean): void {\n        // todo\n    }\n\n    setCursorSize (diameter: number): void {\n        this.brushRadius = diameter / 2;\n\n        this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\n\n        if (this.pointer === null) {\n            clearTimeout(this.hideBrushCursorTimeout);\n\n            this.svgOverlay.updateCursor({\n                x: this.renderWidth / 2,\n                y: this.renderHeight / 2,\n                isVisible: true\n            });\n\n            // @ts-ignore\n            this.hideBrushCursorTimeout = setTimeout(() => {\n                if (this.pointer !== null) {\n                    return;\n                }\n                this.svgOverlay.updateCursor({isVisible: false});\n            }, 500);\n        }\n    }\n\n    zoomByStep (stepNum: number): void {\n        if (!this.internalZoomByStep(stepNum, this.renderWidth / 2, this.renderHeight / 2)) {\n            return;\n        }\n\n        this.lastRenderedState = -1;\n        this.reqFrame();\n\n        this.onViewChange({\n            changed: ['scale'],\n            angle: this.targetTransformObj.angle,\n            scale: this.targetTransformObj.scale\n        });\n    }\n\n    resetView (doAnimate?: boolean): void {\n        this.targetTransformObj.scale = 1;\n        this.targetTransformObj.angle = 0;\n\n        this.targetTransformObj.x = (this.renderWidth - this.klCanvas.getWidth()) / 2;\n        this.targetTransformObj.y = (this.renderHeight - this.klCanvas.getHeight()) / 2;\n\n        if (!doAnimate) {\n            this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\n        } else {\n            this.doAnimateTranslate = true;\n            this.transformIsDirty = true;\n        }\n\n        this.bgVisible = this.testBgVisible();\n        this.reqFrame();\n\n        if (doAnimate) {\n            this.onViewChange({\n                changed: ['scale', 'angle'],\n                scale: this.targetTransformObj.scale,\n                angle: this.targetTransformObj.angle\n            });\n        }\n    }\n\n    /**\n     * fit into view. center. snap angle. padding\n     * returns true if transform changes\n     */\n    fitView (): boolean {\n        // determine new transform\n        const newAngle = this.snapAngleRad(this.targetTransformObj.angle, 90, 90);\n\n        //calc width and height of bounds\n        const canvasPointsArr = [\n            [0, 0], // top left\n            [this.klCanvas.getWidth(), 0], // top right\n            [this.klCanvas.getWidth(), this.klCanvas.getHeight()], // bottom right\n            [0, this.klCanvas.getHeight()], // bottom left\n            [this.klCanvas.getWidth() / 2, this.klCanvas.getHeight() / 2], // center\n        ];\n\n        //setup transformation matrix\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(newAngle));\n\n        //rotate points\n        for (let i = 0; i < canvasPointsArr.length; i++) {\n            let coords = [canvasPointsArr[i][0], canvasPointsArr[i][1], 0, 1];\n            coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n            canvasPointsArr[i][0] = coords[0];\n            canvasPointsArr[i][1] = coords[1];\n        }\n\n        const boundsObj = {\n            x0: null,\n            y0: null,\n            x1: null,\n            y1: null\n        };\n        for (let i = 0; i < canvasPointsArr.length; i++) {\n            if (boundsObj.x0 === null || canvasPointsArr[i][0] < boundsObj.x0) {\n                boundsObj.x0 = canvasPointsArr[i][0];\n            }\n            if (boundsObj.y0 === null || canvasPointsArr[i][1] < boundsObj.y0) {\n                boundsObj.y0 = canvasPointsArr[i][1];\n            }\n            if (boundsObj.x1 === null || canvasPointsArr[i][0] > boundsObj.x1) {\n                boundsObj.x1 = canvasPointsArr[i][0];\n            }\n            if (boundsObj.y1 === null || canvasPointsArr[i][1] > boundsObj.y1) {\n                boundsObj.y1 = canvasPointsArr[i][1];\n            }\n        }\n        const boundsWidth = boundsObj.x1 - boundsObj.x0;\n        const boundsHeight = boundsObj.y1 - boundsObj.y0;\n\n        //fit bounds\n        const padding = 0;\n        const { width: fitWidth } = BB.fitInto(\n            boundsWidth,\n            boundsHeight, \n            this.renderWidth - padding, \n            this.renderHeight - padding, \n            1\n        );\n\n        //determine scale\n        const factor = fitWidth / boundsWidth;\n\n        const newTargetTransformObj = {\n            angle: newAngle,\n            x: (this.renderWidth / 2) - (canvasPointsArr[4][0] - canvasPointsArr[0][0]) * factor,\n            y: (this.renderHeight / 2) - (canvasPointsArr[4][1] - canvasPointsArr[0][1]) * factor,\n            scale: factor,\n        };\n\n        if (\n            newTargetTransformObj.angle === this.targetTransformObj.angle &&\n            Math.abs(newTargetTransformObj.x - this.targetTransformObj.x) < 0.0000000001 &&\n            Math.abs(newTargetTransformObj.y - this.targetTransformObj.y) < 0.0000000001 &&\n            newTargetTransformObj.scale === this.targetTransformObj.scale\n        ) {\n            return false;\n        }\n        this.targetTransformObj = newTargetTransformObj;\n\n        this.doAnimateTranslate = true;\n        this.transformIsDirty = true;\n        this.reqFrame();\n\n        this.onViewChange({\n            changed: ['scale', 'angle'],\n            scale: this.targetTransformObj.scale,\n            angle: this.targetTransformObj.angle\n        });\n        return true;\n    }\n\n    setAngle (angleDeg: number, isRelative?: boolean): void {\n        //rotation done around center\n        const centerObj = {\n            x: this.renderWidth / 2,\n            y: this.renderHeight / 2\n        };\n\n        const oldAngleRad = this.targetTransformObj.angle;\n        const angleRad = angleDeg / 180 * Math.PI;\n\n        if (isRelative) {\n            this.targetTransformObj.angle += angleRad;\n        } else {\n            this.targetTransformObj.angle = angleRad;\n        }\n\n        this.targetTransformObj.angle = this.minimizeAngleRad(\n            this.snapAngleRad(\n                this.targetTransformObj.angle,\n                90,\n                4\n            )\n        );\n\n        //rotate transform.xy\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(this.targetTransformObj.angle - oldAngleRad));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\n\n        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\n        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\n        this.targetTransformObj.x = origin[0];\n        this.targetTransformObj.y = origin[1];\n\n        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\n        this.transformIsDirty = true;\n        this.reqFrame(true);\n    }\n\n    /**\n     * translate canvas by viewport pixels\n     * @param tx\n     * @param ty\n     */\n    translateView (tx: number, ty: number): void {\n        const scale = 40;\n\n        this.targetTransformObj.x += tx * scale;\n        this.targetTransformObj.y += ty * scale;\n\n        this.transformIsDirty = true;\n        this.doAnimateTranslate = true;\n        this.reqFrame(true);\n    }\n\n    getIsDrawing (): boolean {\n        return this.isDrawing;\n    }\n\n    getScale (): number {\n        return this.targetTransformObj.scale;\n    }\n\n    getAngleDeg (): number {\n        return this.targetTransformObj.angle * 180 / Math.PI;\n    }\n\n    getMaxScale (): number {\n        return MAX_SCALE;\n    }\n\n    getMinScale (): number {\n        return MIN_SCALE;\n    }\n\n    requestFrame (): void {\n        this.lastRenderedState = -1;\n        this.reqFrame();\n    }\n\n    setLastDrawEvent (x: number | null, y?: number, pressure?: number): void {\n        if (x === null) {\n            this.lastDrawEvent = null;\n            return;\n        }\n\n        if (!this.lastDrawEvent) {\n            this.lastDrawEvent = {x: 0, y: 0, pressure: 0};\n        }\n        this.lastDrawEvent.x = x;\n        this.lastDrawEvent.y = y;\n        this.lastDrawEvent.pressure = pressure;\n    }\n\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1dLwT\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"9wZxU\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hQSEH\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"916ZI\");","import {BB} from '../../bb/bb';\nimport {IKlBasicLayer} from '../kl.types';\n\n/**\n * preview of image with layers. can do mix modes and opacity.\n * creates a canvas.\n *\n * p = {\n *     width: 123,\n *     height: 123,\n *     layers: [// can be changed after the fact\n *         {\n *             image: Canvas,\n *             opacity: 1,\n *             mixModeStr: 'source-over'\n *         }\n *     ]\n * }\n *\n * @param p\n * @constructor\n */\nexport function KlCanvasPreview(\n    p: {\n        width: number;\n        height: number;\n        layers: IKlBasicLayer[];\n    }\n) {\n    const scale = p.width / p.layers[0].image.width;\n    const width = scale > 1 ? p.layers[0].image.width : p.width;\n    const height = scale > 1 ? p.layers[0].image.height : p.height;\n\n    let canvas = BB.canvas(width, height);\n    canvas.style.backgroundImage = 'url(' + BB.createCheckerDataUrl(8) + ')';\n    let ctx = canvas.getContext('2d');\n\n    BB.css(canvas, {\n        width: '100%',\n        height: '100%',\n        imageRendering: scale > 1 ? 'pixelated' : null,\n    });\n\n    function render() {\n        ctx.save();\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\n        for (let i = 0; i < p.layers.length; i++) {\n            ctx.globalAlpha = p.layers[i].opacity;\n            ctx.globalCompositeOperation = p.layers[i].mixModeStr;\n            if (canvas.width > p.layers[i].image.width) {\n                ctx.imageSmoothingEnabled = false;\n            }\n            ctx.drawImage(p.layers[i].image, 0, 0, canvas.width, canvas.height);\n        }\n        ctx.restore();\n    }\n\n    setTimeout(render, 0);\n\n    // --- interface ---\n    this.getElement = function() {\n        return canvas;\n    };\n\n    this.render = function() {\n        render();\n    };\n}","import {BB} from '../../../bb/bb';\n// @ts-ignore\nimport rotateImg from 'url:~/src/app/img/ui/cursor-rotate.png';\nimport {KeyListener} from '../../../bb/input/key-listener';\nimport {IVector2D} from '../../../bb/bb.types';\n\nexport interface ITransform {\n    x: number; // center of transform region. image space\n    y: number;\n    width: number; // size of transform region. image space\n    height: number;\n    angleDeg: number; // angle of transform region. degrees\n}\n\n\n/**\n * snap entire transform to pixel grid. changes transform\n *\n * for x y:\n * If a dimension has an even size, it be an integer.\n * If it's uneven, it's sits exactly half way between two pixels.\n *\n * @param transform\n */\nfunction snapToPixel(transform: ITransform): void {\n    if (Math.abs(transform.angleDeg) % 90 !== 0) {\n        return;\n    }\n\n    transform.width = Math.round(transform.width);\n    transform.height = Math.round(transform.height);\n    // 0° is original orientation.\n    // At 90° and 270° width and height become swapped due to different orientation.\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\n    transform.x = ((whSwapped ? transform.height : transform.width) % 2 === 0) ? Math.round(transform.x) : Math.round(transform.x - 0.5) + 0.5;\n    transform.y = ((whSwapped ? transform.width : transform.height) % 2 === 0)  ? Math.round(transform.y) : Math.round(transform.y - 0.5) + 0.5;\n}\n\nfunction copyTransform(transform: ITransform): ITransform {\n    return {\n        x: transform.x,\n        y: transform.y,\n        width: transform.width,\n        height: transform.height,\n        angleDeg: transform.angleDeg,\n    };\n}\n\n/**\n * image space to transform space\n * - origin of transform space is at center of transform bounds.\n * - same scale as image space. -> one unit is x: 1/width, y: 1/height\n * - up is where transform points up\n * - x goes right\n * - y goes down\n * @param x\n * @param y\n * @param transform\n */\nfunction toTransformSpace (x: number, y: number, transform: ITransform): IVector2D {\n    let px, py;\n    px = x - transform.x;\n    py = y - transform.y;\n\n    const rot = BB.rotateAround({x: 0, y: 0},\n        {x: px, y: py},\n        -transform.angleDeg);\n    px = rot.x;\n    py = rot.y;\n\n    return {\n        x: px,\n        y: py,\n    };\n}\n\n/**\n * transform space to image space\n * @param x\n * @param y\n * @param transform\n */\nfunction toImageSpace(x: number, y: number, transform: ITransform): IVector2D {\n    const rot = BB.rotateAround({x: 0, y: 0},\n        {x: x, y: y},\n        transform.angleDeg);\n    return {\n        x: rot.x + transform.x,\n        y: rot.y + transform.y,\n    };\n}\n\n\n\n/**\n * Free Transform UI\n * rotate, scale, translate\n *\n * - if rotation is multiple of 90° it will snap to pixels, to be more useful for pixel art\n * - when rotation goes from non-multiple of 90° to a multiple, it will snap position and width height to pixels\n * - transform.x, transform.y can sit between pixels (by 0.5) if width or height is odd number.\n *      - this is what complicates things\n * - if transform region small, corner grips move out of the way\n *\n * iX iY, iP.x, iP.y - i indicates image space\n * tX tY, tP.x, tP.y - t indicates transform space\n *\n * Not sure if can be used for navigable canvas. (especially if canvas rotates view)\n * Probably can't be extended for distort. Needs a different approach.\n *\n * --- DOM structure ---\n * rootEl {\n * \ttransEl [\n * \t\tboundsEl\n * \t\tedges[]\n * \t\tcorners[] - round grips in the corner of transform region\n * \t\tangleGrip\n * \t]\n * }\n *\n */\nexport class FreeTransform {\n\n    // --- private ---\n    private readonly transform: ITransform; // coordinates and dimensions of transformation\n    private isConstrained: boolean;\n    private ratio: number; // aspect ratio of transform\n    private readonly scale: number;\n    private readonly scaled = { // scaled coordinates and dimensions for screenspace\n        x: 0,\n        y: 0,\n        width: 0,\n        height: 0,\n        corners: [{x: 0, y: 0}], // in transform space\n    };\n    private readonly minSnapDist = 7; // minimal snapping distance in px screenspace\n    private snappingEnabled: boolean;\n    private readonly snapX: number[];\n    private readonly snapY: number[];\n    private readonly callback: (transform: ITransform) => void;\n\n\n    private readonly cornerCursors = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];\n    private readonly gripSize = 14;\n    private readonly edgeSize = 10;\n\n    private readonly rootEl: HTMLElement; // sits at origin of image\n    private readonly transEl: HTMLElement; // at middle of transform. rotates\n    private readonly boundsEl: HTMLElement; // draggable bounds rectangle with outline\n    private readonly corners: {\n        i: number; // index in corners array\n        el: HTMLElement; // draggable corner circle in DOM\n        x: number; // unscaled position (transform space)\n        y: number;\n        virtualPos: IVector2D; // unscaled temporary position (image space)\n        updateDOM: () => void; // update styling in DOM\n        pointerListener: any;\n    }[] = [];\n    private keyListener: KeyListener;\n    private boundsPointerListener: any; // BB.PointerListener\n    private anglePointerListener: any; // BB.PointerListener\n    private readonly edges: { // derive position from corners\n        el: HTMLElement;\n        updateDOM: () => void;\n        pointerListener: any;\n    }[] = [];\n    private readonly angleGrip: {\n        el: HTMLElement,\n        x: number; // transform space\n        y: number;\n        snap: boolean,\n        updateDOM: () => void,\n    };\n\n    private updateScaled(): void {\n        this.scaled.x = this.transform.x * this.scale;\n        this.scaled.y = this.transform.y * this.scale;\n        this.scaled.width = this.transform.width * this.scale;\n        this.scaled.height = this.transform.height * this.scale;\n        this.scaled.corners = this.corners.map((item) => {\n            return {x: item.x * this.scale, y: item.y * this.scale};\n        });\n    }\n\n    /**\n     * Returns snapped point, if ix, iy snaps. If no snapping, returns point unchanged.\n     * both in image space\n     *\n     * @param iX - image space\n     * @param iY - image space\n     * @private\n     */\n    private snapCorner (iX: number, iY: number): IVector2D {\n        if (!this.snappingEnabled) {\n            return {x: iX, y: iY};\n        }\n        let dist: number;\n        const snap: {\n            x: number;\n            y: number;\n            dist: {\n                x: number;\n                y: number;\n            }\n        } = {\n            x: null,\n            y: null,\n            dist: {\n                x: null,\n                y: null,\n            }\n        };\n        for (let e = 0; e < this.snapX.length; e++) {\n            dist = Math.abs(iX - this.snapX[e]);\n            if (dist < this.minSnapDist / this.scale) {\n                if (snap.x === null || dist < snap.dist.x) {\n                    snap.x = this.snapX[e];\n                    snap.dist.x = dist;\n                }\n            }\n        }\n        for (let e = 0; e < this.snapY.length; e++) {\n            dist = Math.abs(iY - this.snapY[e]);\n            if (dist < this.minSnapDist / this.scale) {\n                if (snap.y === null || dist < snap.dist.y) {\n                    snap.y = this.snapY[e];\n                    snap.dist.y = dist;\n                }\n            }\n        }\n\n        if (snap.x === null && snap.y === null) {\n            return {\n                x: iX,\n                y: iY,\n            };\n        }\n        return {\n            x: snap.x ?? iX,\n            y: snap.y ?? iY,\n        };\n    }\n\n    /**\n     * If constrained return nearest corner pos that fits aspect ratio\n     *\n     * @param cornerIndex\n     * @param iX\n     * @param iY\n     * @private\n     */\n    private constrainCorner (cornerIndex: number, iX: number, iY: number): IVector2D {\n        if (!this.isConstrained) {\n            return {\n                x: iX,\n                y: iY,\n            };\n        }\n        const flip = this.transform.width * this.transform.height < 0 ? -1 : 1;\n        return BB.projectPointOnLine(\n            {x: this.transform.x, y: this.transform.y},\n            toImageSpace(this.ratio, flip * ([0, 2].includes(cornerIndex) ? 1 : -1), this.transform),\n            {x: iX, y: iY}\n        );\n    }\n\n    /**\n     * Update corners according to width height.\n     * Not their DOM.\n     */\n    private updateCornerPositions (): void {\n        this.corners[0].x = (-this.transform.width / 2); // top left\n        this.corners[0].y = (-this.transform.height / 2);\n\n        this.corners[1].x = (this.transform.width / 2); // top right\n        this.corners[1].y = (-this.transform.height / 2);\n\n        this.corners[2].x = (this.transform.width / 2); // bottom right\n        this.corners[2].y = (this.transform.height / 2);\n\n        this.corners[3].x = (-this.transform.width / 2); // bottom left\n        this.corners[3].y = (this.transform.height / 2);\n    }\n\n    /**\n     * If constrained and dragging an edge, restore aspect ratio\n     * Updates corner positions.\n     *\n     * @param widthChanged\n     * @param heightChanged\n     * @private\n     */\n    private restoreRatio (widthChanged: boolean, heightChanged: boolean): void {\n        if (!this.isConstrained) {\n            return;\n        }\n        const angle90 = Math.abs(this.transform.angleDeg) % 90 === 0;\n        const whSwapped = Math.abs(this.transform.angleDeg - 90) % 180 === 0;\n        if (heightChanged && !widthChanged) {\n            const newHeight = Math.abs(this.corners[3].y - this.corners[0].y);\n            let newWidth = this.ratio * newHeight;\n            if (angle90) {\n                newWidth = (whSwapped ? this.transform.y % 1 : this.transform.x % 1) === 0 ?\n                    BB.roundEven(newWidth) : BB.roundUneven(newWidth);\n            }\n            if (this.corners[1].x - this.corners[0].x < 0) {\n                newWidth *= -1;\n            }\n            this.corners[0].x = -newWidth / 2;\n            this.corners[3].x = -newWidth / 2;\n            this.corners[1].x = newWidth / 2;\n            this.corners[2].x = newWidth / 2;\n        }\n        if (!heightChanged && widthChanged) {\n            const newWidth = Math.abs(this.corners[0].x - this.corners[1].x);\n            let newHeight = newWidth / this.ratio;\n            if (angle90) {\n                newHeight = (whSwapped ? this.transform.x % 1 : this.transform.y % 1) === 0  ?\n                    BB.roundEven(newHeight) : BB.roundUneven(newHeight);\n            }\n            if (this.corners[3].y - this.corners[0].y < 0) {\n                newHeight *= -1;\n            }\n            this.corners[0].y = -newHeight / 2;\n            this.corners[1].y = -newHeight / 2;\n            this.corners[2].y = newHeight / 2;\n            this.corners[3].y = newHeight / 2;\n        }\n    }\n\n\n    /**\n     * update transform based on corners\n     * @private\n     */\n    private updateTransformViaCorners (): void {\n\n        // calc transform center in image space\n        const rot = BB.rotateAround(\n            {x: 0, y: 0},\n            {\n                x: (this.corners[0].x + this.corners[1].x) / 2,\n                y: (this.corners[0].y + this.corners[3].y) / 2,\n            },\n            this.transform.angleDeg\n        );\n        this.transform.x = rot.x + this.transform.x;\n        this.transform.y = rot.y + this.transform.y;\n\n        // update size\n        this.transform.width = this.corners[1].x - this.corners[0].x;\n        this.transform.height = this.corners[3].y - this.corners[0].y;\n\n        // new center means corners changed their position\n        this.updateCornerPositions();\n\n        this.updateDOM();\n    }\n\n    /**\n     * updates DOM according to transform\n     * @param skipCallback\n     */\n    private updateDOM (skipCallback?: boolean) {\n        this.updateScaled();\n\n        BB.css(this.transEl, {\n            left: this.scaled.x + \"px\",\n            top: this.scaled.y + \"px\",\n            transformOrigin: \"0 0\",\n            transform: \"rotate(\" + this.transform.angleDeg + \"deg)\",\n        });\n\n        BB.css(this.boundsEl, {\n            width: Math.abs(this.scaled.width) + \"px\",\n            height: Math.abs(this.scaled.height) + \"px\",\n            left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + \"px\",\n            top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + \"px\"\n        });\n\n        this.corners[0].updateDOM();\n        this.corners[1].updateDOM();\n        this.corners[2].updateDOM();\n        this.corners[3].updateDOM();\n\n        this.edges[0].updateDOM();\n        this.edges[1].updateDOM();\n        this.edges[2].updateDOM();\n        this.edges[3].updateDOM();\n\n\n        this.angleGrip.x = 0;\n        this.angleGrip.y = (-Math.abs(this.transform.height * this.scale) / 2) - 20;\n        this.angleGrip.updateDOM();\n        if (!skipCallback) {\n            if (this.callback) { // why should updateDOM trigger the callback?\n                this.callback(copyTransform(this.transform));\n            }\n        }\n    }\n\n\n\n    // --- public ---\n    constructor (\n        params: {\n            x: number; // center of transform region. image space\n            y: number;\n            width: number; // size of transform region. image space\n            height: number;\n            angleDeg: number; // angle of transform region. degrees\n\n            isConstrained: boolean; // proportions constrained\n            snapX: number[]; // where snapping along X axis. image space\n            snapY: number[]; // where snapping along X axis. image space\n            scale: number; // ratio of screen-space / image-space\n            callback: (transform: ITransform) => void;\n        }\n    ) {\n        this.transform = { // coordinates and dimensions of transformation\n            x: params.x,\n            y: params.y,\n            width: params.width,\n            height: params.height,\n            angleDeg: params.angleDeg,\n        };\n\n        this.isConstrained = !!params.isConstrained;\n\n        this.snapX = params.snapX;\n        this.snapY = params.snapY;\n        this.callback = params.callback;\n        this.scale = params.scale;\n        this.snappingEnabled = true;\n        this.ratio = this.transform.width / this.transform.height;\n\n        this.rootEl = BB.el({\n            className: 'kl-free-transform',\n            css: {\n                userSelect: 'none',\n            }\n        });\n        this.transEl = BB.el({\n            parent: this.rootEl,\n            css: {\n                position: 'absolute',\n            }\n        });\n\n        this.boundsEl = BB.el({\n            css: {\n                position: 'absolute',\n                cursor: 'move',\n                boxShadow: 'rgba(255, 255, 255, 0.5) 0 0 0 1px inset, rgba(0, 0, 0, 0.5) 0 0 0 1px',\n            }\n        });\n\n        const pointerRemainder = {\n            x: 0,\n            y: 0,\n        };\n        function resetRemainder() {\n            pointerRemainder.x = 0;\n            pointerRemainder.y = 0;\n        }\n        this.keyListener = new BB.KeyListener({});\n\n        let boundsStartP = {\n            x: 0,\n            y: 0,\n        }\n        this.boundsPointerListener = new BB.PointerListener({\n            target: this.boundsEl,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointerdown') {\n                    boundsStartP = {x: this.transform.x, y: this.transform.y};\n                }\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    this.transform.x = boundsStartP.x + (event.pageX - event.downPageX) / this.scale;\n                    this.transform.y = boundsStartP.y + (event.pageY - event.downPageY) / this.scale;\n\n\n                    let dist;\n                    let snap: any = {};\n                    if (this.snappingEnabled) {\n                        let i;\n                        for (i = 0; i < this.snapX.length; i++) {\n                            dist = Math.abs(this.transform.x - this.snapX[i]);\n                            if (dist < this.minSnapDist / this.scale) {\n                                if (!snap.x || dist < snap.distX) {\n                                    snap.x = this.snapX[i];\n                                    snap.distX = dist;\n                                }\n                            }\n                        }\n                        for (i = 0; i < this.snapY.length; i++) {\n                            dist = Math.abs(this.transform.y - this.snapY[i]);\n                            if (dist < this.minSnapDist / this.scale) {\n                                if (!snap.y || dist < snap.distY) {\n                                    snap.y = this.snapY[i];\n                                    snap.distY = dist;\n                                }\n                            }\n                        }\n\n                        let iP;\n                        for (i = 0; i < 4; i++) {\n                            iP = toImageSpace(this.corners[i].x, this.corners[i].y, this.transform);\n                            let j;\n                            for (j = 0; j < this.snapX.length; j++) {\n                                dist = Math.abs(iP.x - this.snapX[j]);\n                                if (dist < this.minSnapDist / this.scale) {\n                                    if (!snap.x || dist < snap.distX) {\n                                        snap.x = this.snapX[j] - (iP.x - this.transform.x);\n                                        snap.distX = dist;\n                                    }\n                                }\n                            }\n                            for (j = 0; j < this.snapY.length; j++) {\n                                dist = Math.abs(iP.y - this.snapY[j]);\n                                if (dist < this.minSnapDist / this.scale) {\n                                    if (!snap.y || dist < snap.distY) {\n                                        snap.y = this.snapY[j] - (iP.y - this.transform.y);\n                                        snap.distY = dist;\n                                    }\n                                }\n                            }\n                        }\n                    }\n                    if (this.keyListener.getComboStr() === 'shift') {\n                        let projected = BB.projectPointOnLine(\n                            {x: 0, y: boundsStartP.y},\n                            {x: 10, y: boundsStartP.y},\n                            {x: this.transform.x, y: this.transform.y});\n                        let dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\n                        snap = {};\n                        snap.x = projected.x;\n                        snap.y = projected.y;\n                        snap.distX = dist;\n                        snap.distY = dist;\n\n                        projected = BB.projectPointOnLine(\n                            {x: boundsStartP.x, y: 0},\n                            {x: boundsStartP.x, y: 10},\n                            {x: this.transform.x, y: this.transform.y});\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\n                        if (dist < snap.distX) {\n                            snap.x = projected.x;\n                            snap.y = projected.y;\n                            snap.distX = dist;\n                            snap.distY = dist;\n                        }\n\n                        projected = BB.projectPointOnLine(\n                            {x: boundsStartP.x, y: boundsStartP.y},\n                            {x: boundsStartP.x + 1, y: boundsStartP.y + 1},\n                            {x: this.transform.x, y: this.transform.y});\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\n                        if (dist < snap.distX) {\n                            snap.x = projected.x;\n                            snap.y = projected.y;\n                            snap.distX = dist;\n                            snap.distY = dist;\n                        }\n\n                        projected = BB.projectPointOnLine(\n                            {x: boundsStartP.x, y: boundsStartP.y},\n                            {x: boundsStartP.x + 1, y: boundsStartP.y - 1},\n                            {x: this.transform.x, y: this.transform.y});\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\n                        if (dist < snap.distX) {\n                            snap.x = projected.x;\n                            snap.y = projected.y;\n                            snap.distX = dist;\n                            snap.distY = dist;\n                        }\n                    }\n                    if (snap.x != undefined) {\n                        this.transform.x = snap.x;\n                    }\n                    if (snap.y != undefined) {\n                        this.transform.y = snap.y;\n                    }\n\n                    // snap to pixels\n                    if (Math.abs(this.transform.angleDeg) % 90 === 0) {\n                        snapToPixel(this.transform);\n                        this.updateCornerPositions();\n                    }\n\n                    this.updateDOM();\n                }\n            }\n        })\n\n        for (let i = 0; i < 4; i++) {\n            ((i) => {\n                const g = this.corners[i] = {\n                    i: i,\n                    el: BB.el({\n                        css: {\n                            width: this.gripSize + 'px',\n                            height: this.gripSize + 'px',\n                            background: '#fff',\n                            /*background: [\n                                '#ff0000',\n                                '#00ff00',\n                                '#0000ff',\n                                '#ff00ff',\n                            ][i],*/\n                            borderRadius: this.gripSize + 'px',\n                            position: 'absolute',\n                            boxShadow: 'inset 0 0 0 2px #000'\n                        }\n                    }),\n                    x: 0,\n                    y: 0,\n                    virtualPos: {\n                        x: 0,\n                        y: 0,\n                    },\n                    updateDOM: null,\n                    pointerListener: null,\n                };\n                g.updateDOM = () => {\n\n                    // grip position\n                    // if gets small, offset grips, so easier to handle\n                    const offsetArr = [[-1, -1], [1, -1], [1, 1], [-1, 1]].map(item => {\n                        item[0] *= this.transform.width > 0 ? 1 : -1;\n                        item[1] *= this.transform.height > 0 ? 1 : -1;\n                        return item;\n                    });\n                    const tinyOffset = Math.abs(this.scaled.width) < 20 || Math.abs(this.scaled.height) < 20 ? 10 : 0;\n\n                    BB.css(g.el, {\n                        left: (this.scaled.corners[g.i].x - this.gripSize / 2 + offsetArr[i][0] * tinyOffset) + 'px',\n                        top: (this.scaled.corners[g.i].y - this.gripSize / 2 + offsetArr[i][1] * tinyOffset) + 'px'\n                    });\n\n\n                    // cursor\n                    let angle = BB.pointsToAngleDeg(\n                        {\n                            x: this.transform.x,\n                            y: this.transform.y,\n                        },\n                        toImageSpace(g.x, g.y, this.transform),\n                    ) + 135; // offset so nw is 0\n                    while (angle < 0) {\n                        angle += 360;\n                    }\n                    let index = Math.round(angle / 45) % this.cornerCursors.length;\n                    BB.css(g.el, {\n                        cursor: this.cornerCursors[index] + '-resize',\n                    });\n                };\n\n                g.pointerListener = new BB.PointerListener({\n                    target: this.corners[i].el,\n                    fixScribble: true,\n                    onPointer: (event) => {\n                        event.eventPreventDefault();\n                        if (event.type === 'pointerdown' && event.button === 'left') {\n                            this.corners[i].virtualPos = toImageSpace(this.corners[i].x, this.corners[i].y, this.transform);\n\n                        } else if (event.type === 'pointermove' && event.button === 'left') {\n                            this.corners[i].virtualPos.x += event.dX / this.scale;\n                            this.corners[i].virtualPos.y += event.dY / this.scale;\n\n                            let iP = {\n                                x: this.corners[i].virtualPos.x,\n                                y: this.corners[i].virtualPos.y,\n                            };\n                            iP = this.constrainCorner(i, iP.x, iP.y);\n                            if (!this.isConstrained) {\n                                iP = this.snapCorner(iP.x, iP.y);\n                            }\n\n                            if (Math.abs(this.transform.angleDeg) % 90 === 0) {\n                                iP.x = Math.round(iP.x);\n                                iP.y = Math.round(iP.y);\n                            }\n\n                            const tP = toTransformSpace(iP.x, iP.y, this.transform);\n\n                            const dX = tP.x - this.corners[i].x;\n                            const dY = tP.y - this.corners[i].y;\n                            this.corners[i].x = tP.x;\n                            this.corners[i].y = tP.y;\n\n                            let indexes = [];\n                            if (i === 0) { // top left\n                                indexes = [3, 1, 2];\n                            } else if (i === 1) { // top right\n                                indexes = [2, 0, 3];\n                            } else if (i === 2) { // bottom right\n                                indexes = [1, 3, 0];\n                            } else if (i === 3) { // bottom left\n                                indexes = [0, 2, 1];\n                            }\n\n                            this.corners[indexes[0]].x = this.corners[i].x;\n                            this.corners[indexes[1]].y = this.corners[i].y;\n                            if (this.keyListener.isPressed('shift')) {\n                                this.corners[indexes[2]].x -= dX;\n                                this.corners[indexes[2]].y -= dY;\n                                this.corners[indexes[1]].x = this.corners[indexes[2]].x;\n                                this.corners[indexes[0]].y = this.corners[indexes[2]].y;\n                            }\n\n                            this.updateTransformViaCorners();\n\n                        }\n                    }\n                });\n\n            })(i);\n        }\n\n        this.updateCornerPositions();\n        this.updateScaled();\n\n        let isInverted: boolean;\n        for (let i = 0; i < 4; i++) {\n            ((i) => {\n                this.edges[i] = {\n                    el: BB.el({\n                        css: {\n                            width: this.edgeSize + 'px',\n                            height: this.edgeSize + 'px',\n                            /*background: [\n                                '#ff000044',\n                                '#00ff0044',\n                                '#0000ff44',\n                                '#ff00ff44',\n                            ][i],*/\n                            position: 'absolute',\n                        },\n                    }),\n                    updateDOM: null,\n                    pointerListener: null,\n                };\n                const g = this.edges[i];\n                g.updateDOM = () => {\n                    if (i === 0) {\n                        BB.css(g.el, {\n                            left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\n                            top: (Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) - this.edgeSize) + 'px',\n                            width: Math.abs(this.scaled.width) + 'px',\n                            height: this.edgeSize + 'px',\n                        });\n                    } else if (i === 1) {\n                        BB.css(g.el, {\n                            left: Math.max(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\n                            top: Math.min(this.scaled.corners[1].y, this.scaled.corners[2].y) + 'px',\n                            width: this.edgeSize + 'px',\n                            height: Math.abs(this.scaled.height) + 'px',\n                        });\n                    } else if (i === 2) {\n                        BB.css(g.el, {\n                            left: Math.min(this.scaled.corners[3].x, this.scaled.corners[2].x) + 'px',\n                            top: Math.max(this.scaled.corners[0].y,this.scaled.corners[3].y) + 'px',\n                            width: Math.abs(this.scaled.width) + 'px',\n                            height: this.edgeSize + 'px',\n                        });\n                    } else if (i === 3) {\n                        BB.css(g.el, {\n                            left: (Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) - this.edgeSize) + 'px',\n                            top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + 'px',\n                            width: this.edgeSize + 'px',\n                            height: Math.abs(this.scaled.height) + 'px',\n                        });\n                    }\n                    let angleOffset = Math.round(this.transform.angleDeg / 45);\n                    while (angleOffset < 0)\n                        angleOffset += 8;\n                    angleOffset = (i * 2 + 1 + angleOffset) % this.cornerCursors.length;\n                    g.el.style.cursor = this.cornerCursors[angleOffset] + '-resize';\n\n                };\n\n                const isVertical = [0, 2].includes(i);\n                g.pointerListener = new BB.PointerListener({\n                    target: this.edges[i].el,\n                    fixScribble: true,\n                    onPointer: (event) => {\n                        event.eventPreventDefault();\n                        if (event.type === 'pointerdown' && event.button === 'left') {\n                            if (isVertical) { // top bottom\n                                isInverted = this.corners[0].y >= this.corners[3].y;\n                            } else { // left right\n                                isInverted = this.corners[0].x >= this.corners[1].x;\n                            }\n                            resetRemainder();\n                        }\n                        if (event.type === 'pointermove' && event.button === 'left') {\n                            const tfD = BB.rotateAround({x: 0, y: 0},\n                                {x: event.dX / this.scale, y: event.dY / this.scale},\n                                -this.transform.angleDeg);\n                            let ti = {\n                                dX: tfD.x,\n                                dY: tfD.y,\n                            };\n                            if (Math.abs(this.transform.angleDeg) % 90 === 0) {\n                                ti = BB.intDxy(pointerRemainder, tfD.x, tfD.y);\n                            }\n\n                            let indexes = [];\n                            if (i === 0) { // top\n                                indexes = [2, 3, 0, 1];\n                            } else if (i === 1) { // right\n                                indexes = [0, 3, 1, 2];\n                            } else if (i === 2) { // bottom\n                                indexes = [0, 1, 2, 3];\n                            } else if (i === 3) { // left\n                                indexes = [1, 2, 0, 3];\n                            }\n\n                            let dimension = isVertical ? 'y' : 'x';\n                            let d = isVertical ? ti.dY : ti.dX;\n\n                            if (isInverted) {\n                                this.corners[indexes[0]][dimension] += d;\n                                this.corners[indexes[1]][dimension] += d;\n                            } else {\n                                this.corners[indexes[2]][dimension] += d;\n                                this.corners[indexes[3]][dimension] += d;\n                            }\n                            if (this.keyListener.isPressed('shift')) {\n                                if (isInverted) {\n                                    this.corners[indexes[2]][dimension] -= d;\n                                    this.corners[indexes[3]][dimension] -= d;\n                                } else {\n                                    this.corners[indexes[0]][dimension] -= d;\n                                    this.corners[indexes[1]][dimension] -= d;\n                                }\n                            }\n\n                            if (isVertical) { // top bottom\n                                this.restoreRatio(false, true);\n                            } else { // left right\n                                this.restoreRatio(true, false);\n                            }\n\n                            this.updateTransformViaCorners();\n\n                        }\n                    }\n                });\n\n            })(i);\n        }\n\n        this.angleGrip = {\n            el: BB.el({\n                css: {\n                    cursor: 'url(' + rotateImg + ') 10 10, move',\n                    width: this.gripSize + 'px',\n                    height: this.gripSize + 'px',\n                    background: '#0ff',\n                    borderRadius: this.gripSize + 'px',\n                    position: 'absolute',\n                    boxShadow: 'inset 0 0 0 2px #000',\n                },\n            }),\n            x: 0,\n            y: 0,\n            snap: false,\n            updateDOM: () => {\n                BB.css(this.angleGrip.el, {\n                    left: (this.angleGrip.x - this.gripSize / 2) + 'px',\n                    top: (this.angleGrip.y - this.gripSize / 2) + 'px',\n                });\n            },\n        };\n        BB.el({\n            parent: this.angleGrip.el,\n            css: {\n                width: '2px',\n                height: '13px',\n                left: (this.gripSize / 2 - 1) + 'px',\n                top: this.gripSize + 'px',\n                background: '#0ff',\n                position: 'absolute'\n            }\n        });\n\n        this.anglePointerListener = new BB.PointerListener({\n            target: this.angleGrip.el,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n\n                    const bounds = this.rootEl.getBoundingClientRect();\n                    const offset = {\n                        x: bounds.left - this.rootEl.scrollLeft,\n                        y: bounds.top - this.rootEl.scrollTop,\n                    };\n                    const iP = {x: (event.clientX - offset.x) / this.scale, y: (event.clientY - offset.y) / this.scale};\n\n                    const a = BB.pointsToAngleDeg({x: this.transform.x, y: this.transform.y}, iP) + 90;\n                    this.transform.angleDeg = a;\n                    const snapDeg = Math.round(a / 360 * 8) * 45;\n                    if (this.keyListener.getComboStr() === 'shift') {\n                        this.transform.angleDeg = snapDeg;\n                    } else if (this.snappingEnabled && Math.abs(snapDeg - a) < 8) {\n                        this.transform.angleDeg = snapDeg;\n                    }\n                    this.updateDOM();\n\n                }\n                if (event.type === 'pointerup') {\n                    if (Math.abs(this.transform.angleDeg) % 90 === 0) {\n                        snapToPixel(this.transform);\n                        this.updateCornerPositions();\n                        this.updateDOM();\n                    }\n                }\n            }\n        });\n\n        snapToPixel(this.transform);\n        this.updateDOM(true);\n        BB.append(this.transEl, [\n            this.boundsEl,\n            this.edges[0].el,\n            this.edges[1].el,\n            this.edges[2].el,\n            this.edges[3].el,\n            this.corners[0].el,\n            this.corners[1].el,\n            this.corners[2].el,\n            this.corners[3].el,\n            this.angleGrip.el,\n        ]);\n\n\n    }\n\n\n\n    getTransform (): ITransform {\n        return copyTransform(this.transform);\n    }\n\n    setConstrained (b: boolean): void {\n        this.isConstrained = !!b;\n        if (b && this.transform.width !== 0 && this.transform.height !== 0) {\n            this.ratio = Math.abs(this.transform.width / this.transform.height);\n        }\n    }\n\n    setSnapping (s: boolean): void {\n        this.snappingEnabled = !!s;\n    }\n\n    setPos (p: IVector2D): void {\n        this.transform.x = p.x;\n        this.transform.y = p.y;\n        this.updateDOM(true);\n    }\n\n    move (dX: number, dY: number): void {\n        this.transform.x += dX;\n        this.transform.y += dY;\n        this.updateDOM(false);\n    }\n\n    setSize (w: number, h: number): void {\n        this.transform.width = w;\n        this.transform.height = h;\n        if (Math.abs(this.transform.angleDeg) % 90 === 0) {\n            snapToPixel(this.transform);\n        }\n        this.updateCornerPositions();\n        this.updateDOM(false);\n    }\n\n    setAngleDeg (a: number): void {\n        this.transform.angleDeg = a;\n        if (Math.abs(this.transform.angleDeg) % 90 === 0) {\n            snapToPixel(this.transform);\n            this.updateCornerPositions();\n        }\n        this.updateDOM(true);\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    getRatio (): number {\n        return this.ratio;\n    }\n\n    destroy (): void {\n        this.keyListener.destroy();\n        this.boundsPointerListener.destroy();\n        this.corners[0].pointerListener.destroy();\n        this.corners[1].pointerListener.destroy();\n        this.corners[2].pointerListener.destroy();\n        this.corners[3].pointerListener.destroy();\n        this.edges[0].pointerListener.destroy();\n        this.edges[1].pointerListener.destroy();\n        this.edges[2].pointerListener.destroy();\n        this.edges[3].pointerListener.destroy();\n        this.anglePointerListener.destroy();\n    }\n\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"045N6\");","import {BB} from '../../../bb/bb';\nimport {KlCanvasPreview} from '../../canvas-ui/canvas-preview';\nimport {FreeTransform} from './free-transform';\nimport {IKlBasicLayer, IMixMode} from '../../kl.types';\n\n/**\n * a basic canvas where you can transform one layer(move around, rotate, scale)\n *\n * @param params\n * @returns {HTMLDivElement}\n * @constructor\n */\nexport function FreeTransformCanvas(params: {\n    elementWidth: number;\n    elementHeight: number;\n    imageWidth: number;\n    imageHeight: number;\n    layers: IKlBasicLayer[];\n    transformIndex: number;\n}) {\n    /*\n    div\n        innerWrapper\n            klCanvasPreview\n            transform.div\n    */\n\n    let previewFit = BB.fitInto(\n        params.imageWidth,\n        params.imageHeight,\n        params.elementWidth - 20,\n        params.elementHeight - 60,\n        1\n    );\n    let scale = previewFit.width / params.imageWidth;\n\n    let div = BB.el({\n        css: {\n            width: params.elementWidth + \"px\",\n            height: params.elementHeight + \"px\",\n            backgroundColor: \"#9e9e9e\",\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n            overflow: \"hidden\",\n            userSelect: \"none\",\n            position: \"relative\",\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            colorScheme: 'only light',\n        }\n    });\n    div.oncontextmenu = function () {\n        return false;\n    };\n\n    let innerWrapper = BB.el({\n        css: {\n            position: 'relative',\n            boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n            width: previewFit.width + 'px',\n            height: previewFit.height + 'px'\n        }\n    });\n    div.appendChild(innerWrapper);\n\n    let previewLayerArr = params.layers.map(item => {\n        return {\n            image: item.image,\n            mixModeStr: item.mixModeStr,\n            opacity: item.opacity,\n        }\n    });\n    previewLayerArr[previewLayerArr.length - 1].image = BB.canvas(\n        scale > 1 ? params.imageWidth : previewFit.width,\n        scale > 1 ? params.imageHeight : previewFit.height,\n    );\n    let klCanvasPreview = new KlCanvasPreview({\n        width: previewFit.width,\n        height: previewFit.height,\n        layers: previewLayerArr\n    });\n    innerWrapper.appendChild(klCanvasPreview.getElement());\n\n    let freeTransform;\n    let initTransform;\n    function updatePreview() {\n        if (!freeTransform) {\n            return;\n        }\n\n        let transform = freeTransform.getTransform();\n        if (scale < 1) {\n            transform.x *= scale;\n            transform.y *= scale;\n            transform.width *= scale;\n            transform.height *= scale;\n        }\n\n        let destCanvas = previewLayerArr[params.transformIndex].image;\n        let ctx = (destCanvas as HTMLCanvasElement).getContext('2d');\n        ctx.save();\n        ctx.clearRect(0, 0, destCanvas.width, destCanvas.height);\n        BB.drawTransformedImageWithBounds(\n            ctx,\n            params.layers[params.transformIndex].image,\n            transform,\n            null,\n            BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\n        );\n        ctx.restore();\n        klCanvasPreview.render();\n    }\n\n    {\n        let transformSize = {\n            width: params.layers[params.transformIndex].image.width * scale,\n            height: params.layers[params.transformIndex].image.height * scale\n        };\n        if (transformSize.width > previewFit.width || transformSize.height > previewFit.height) {\n            transformSize = BB.fitInto(\n                params.layers[params.transformIndex].image.width,\n                params.layers[params.transformIndex].image.height,\n                previewFit.width,\n                previewFit.height,\n                1\n            );\n        }\n        initTransform = {\n            x: params.imageWidth / 2,\n            y: params.imageHeight / 2,\n            width: params.layers[params.transformIndex].image.width,\n            height: params.layers[params.transformIndex].image.height,\n        };\n        freeTransform = new FreeTransform({\n            x: initTransform.x,\n            y: initTransform.y,\n            width: initTransform.width,\n            height: initTransform.height,\n            angleDeg: 0,\n            isConstrained: true,\n            snapX: [0, params.imageWidth],\n            snapY: [0, params.imageHeight],\n            scale: scale,\n            callback: (transform) => {\n                updatePreview();\n            },\n        });\n    }\n    BB.css(freeTransform.getElement(), {\n        position: 'absolute',\n        left: '0',\n        top: '0'\n    });\n    innerWrapper.appendChild(freeTransform.getElement());\n    setTimeout(updatePreview, 0);\n\n\n    // --- interface ---\n\n    this.move = function(dX, dY) {\n        freeTransform.move(dX, dY);\n    };\n    this.reset = function() {\n        let w = params.layers[params.transformIndex].image.width;\n        let h = params.layers[params.transformIndex].image.height;\n\n        freeTransform.setSize(w, h);\n        freeTransform.setPos({x: w / 2, y: h / 2});\n        freeTransform.setAngleDeg(0);\n        updatePreview();\n    };\n    this.setTransformFit = function() {\n\n        let fit = BB.fitInto(\n            params.layers[params.transformIndex].image.width,\n            params.layers[params.transformIndex].image.height,\n            params.imageWidth,\n            params.imageHeight,\n            1\n        );\n\n        freeTransform.setSize(fit.width, fit.height);\n        freeTransform.setPos({x: fit.width / 2, y: fit.height / 2});\n        freeTransform.setAngleDeg(0);\n        updatePreview();\n    };\n    this.setTransformCenter = function() {\n        freeTransform.setPos({x: params.imageWidth / 2, y: params.imageHeight / 2});\n        freeTransform.setAngleDeg(0);\n        updatePreview();\n    };\n    //gives you the transformation in the original scale\n    this.getTransformation = function () {\n        if (!freeTransform) {\n            return false;\n        }\n        return freeTransform.getTransform();\n    };\n    this.getIsPixelated = () => {\n        const transform = freeTransform.getTransform();\n        return BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height);\n    };\n    this.getElement = function() {\n        return div;\n    };\n    this.destroy = function() {\n        freeTransform.destroy();\n    };\n}","import {BB} from '../../../bb/bb';\n\n/*\n\tCropper params\n\t{\n\t\tx: int, //pos in relation zum bild\n\t\ty: int,\n\t\tw: int,\n\t\th: int,\n\t\tscale: float, //zoom\n\t\tcallback: function //wenn sich was ändert\n\t}\n\tthe div that you append this to must be relative\n*/\nexport function Cropper (params) {\n    let x = params.x,\n        y = params.y,\n        width = params.width,\n        height = params.height,\n        scale = params.scale,\n        callback = params.callback,\n        maxW = params.maxW,\n        maxH = params.maxH;\n    let div = document.createElement(\"div\");\n    let gripCursors = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];\n\n    let keyListener = new BB.KeyListener({});\n\n    BB.css(div, {\n        position: \"absolute\",\n        left: (x * scale) + \"px\",\n        top: (y * scale) + \"px\"\n    });\n\n    let outline = document.createElement(\"div\");\n    BB.css(outline, {\n        position: \"absolute\",\n        border: \"1px dashed #fff\",\n        cursor: \"move\"\n    });\n    (outline as any).update = function () {\n        BB.css(outline, {\n            left: (grips[0].x * scale - 1) + \"px\",\n            top: (grips[0].y * scale - 1) + \"px\",\n            width: ((grips[2].x - grips[0].x) * scale) + \"px\",\n            height: ((grips[2].y - grips[0].y) * scale) + \"px\"\n        });\n    };\n    let pointerRemainder = { // needs to be reset after dragging complete\n        x: 0,\n        y: 0,\n    };\n    let outlinePointerListener = new BB.PointerListener({\n        target: outline,\n        onPointer: function(event) {\n            event.eventPreventDefault();\n            if (event.type === 'pointermove' && event.button === 'left') {\n\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\n\n                grips[0].x += dX;\n                grips[0].y += dY;\n                grips[1].x += dX;\n                grips[1].y += dY;\n                grips[2].x += dX;\n                grips[2].y += dY;\n                grips[3].x += dX;\n                grips[3].y += dY;\n\n                update();\n            }\n            if (event.type === 'pointerup') {\n                commit();\n            }\n        }\n    });\n\n    let thirdsHorizontal = document.createElement(\"div\");\n    BB.css(thirdsHorizontal, {\n        position: \"absolute\",\n        borderTop: \"1px solid #0ff\",\n        borderBottom: \"1px solid #0ff\"\n    });\n    (thirdsHorizontal as any).update = function () {\n        BB.css(thirdsHorizontal, {\n            left: (grips[0].x * scale) + \"px\",\n            top: ((grips[0].y + (grips[2].y - grips[0].y) / 3) * scale) + \"px\",\n            width: ((grips[2].x - grips[0].x) * scale) + \"px\",\n            height: ((grips[2].y - grips[0].y) / 3 * scale) + \"px\"\n\n        });\n    };\n    let thirdsVertical = document.createElement(\"div\");\n    BB.css(thirdsVertical, {\n        position: \"absolute\",\n        borderLeft: \"1px solid #0ff\",\n        borderRight: \"1px solid #0ff\"\n    });\n    (thirdsVertical as any).update = function () {\n        BB.css(thirdsVertical, {\n            left: ((grips[0].x + (grips[2].x - grips[0].x) / 3) * scale) + \"px\",\n            top: (grips[0].y * scale) + \"px\",\n            width: ((grips[2].x - grips[0].x) / 3 * scale) + \"px\",\n            height: ((grips[2].y - grips[0].y) * scale) + \"px\"\n\n        });\n    };\n\n    const gripSize = 40;\n    const gripOverlay = 10;\n\n    let grips: {\n        x: number; // int\n        y: number;\n    }[] = [ // aka corner coordinates\n        {x: 0, y: 0}, // top left\n        {x: width, y: 0}, // top right\n        {x: width, y: height}, // bottom right\n        {x: 0, y: height}, //bottom left\n    ];\n\n    function transformTop(dY) {\n        grips[0].y += dY;\n        grips[0].y = Math.max(grips[3].y - maxH, Math.min(grips[3].y - 1, grips[0].y));\n        grips[1].y = grips[0].y;\n    }\n    function transformRight(dX) {\n        grips[1].x += dX;\n        grips[1].x = Math.min(grips[0].x + maxW, Math.max(grips[0].x + 1, grips[1].x));\n        grips[2].x = grips[1].x;\n    }\n    function transformBottom(dY) {\n        grips[2].y += dY;\n        grips[2].y = Math.min(grips[1].y + maxH, Math.max(grips[1].y + 1, grips[2].y));\n        grips[3].y = grips[2].y;\n    }\n    function transformLeft(dX) {\n        grips[0].x += dX;\n        grips[0].x = Math.max(grips[1].x - maxW, Math.min(grips[1].x - 1, grips[0].x));\n        grips[3].x = grips[0].x;\n    }\n\n    function commit() {\n        pointerRemainder.x = 0;\n        pointerRemainder.y = 0;\n        callback(getTransform());\n    }\n\n\n\n\n    let edges = [];\n    for (let i = 0; i < 4; i++) {\n        (function (i) {\n            edges[i] = document.createElement(\"div\");\n            let g = edges[i];\n            g.style.width = gripSize + \"px\";\n            g.style.height = gripSize + \"px\";\n            //g.style.background = \"#0f0\";\n            g.style.position = \"absolute\";\n            g.update = function () {\n                if (i === 0) { //top\n                    g.style.left = (grips[0].x * scale + gripOverlay) + \"px\";\n                    g.style.top = (grips[0].y * scale - gripSize * 2 + gripOverlay) + \"px\";\n                    g.style.width = ((grips[1].x - grips[0].x) * scale - gripOverlay * 2) + \"px\";\n                    g.style.height = (gripSize * 2) + \"px\";\n                } else if (i === 1) { //right\n                    g.style.left = (grips[1].x * scale - gripOverlay) + \"px\";\n                    g.style.top = (grips[1].y * scale + gripOverlay) + \"px\";\n                    g.style.width = (gripSize * 2) + \"px\";\n                    g.style.height = ((grips[2].y - grips[1].y) * scale - gripOverlay * 2) + \"px\";\n                } else if (i === 2) { //bottom\n                    g.style.left = (grips[3].x * scale + gripOverlay) + \"px\";\n                    g.style.top = (grips[3].y * scale - gripOverlay) + \"px\";\n                    g.style.width = ((grips[2].x - grips[3].x) * scale - gripOverlay * 2) + \"px\";\n                    g.style.height = (gripSize * 2) + \"px\";\n                } else if (i === 3) { //left\n                    g.style.left = (grips[0].x * scale - gripSize * 2 + gripOverlay) + \"px\";\n                    g.style.top = (grips[0].y * scale + gripOverlay) + \"px\";\n                    g.style.width = (gripSize * 2) + \"px\";\n                    g.style.height = ((grips[3].y - grips[0].y) * scale - gripOverlay * 2) + \"px\";\n                }\n                let angleOffset = i * 2 + 1;\n                g.style.cursor = gripCursors[angleOffset] + \"-resize\";\n\n            };\n        })(i);\n    }\n\n    let darken = [];\n    for (let i = 0; i < 4; i++) {\n        (function (i) {\n            darken[i] = document.createElement(\"div\");\n            let g = darken[i];\n            g.style.position = \"absolute\";\n            g.style.background = \"#000\";\n            g.style.opacity = \"0.5\";\n            g.update = function () {\n                if (i === 0) {\n                    g.style.left = (grips[0].x * scale) + \"px\";\n                    g.style.top = (grips[0].y * scale - 8000) + \"px\";\n                    g.style.width = ((grips[1].x - grips[0].x) * scale) + \"px\";\n                    g.style.height = \"8000px\";\n                } else if (i === 1) {\n                    g.style.left = (grips[1].x * scale) + \"px\";\n                    g.style.top = (grips[1].y * scale - 8000) + \"px\";\n                    g.style.width = \"8000px\";\n                    g.style.height = 16000 + \"px\";\n                } else if (i === 2) {\n                    g.style.left = (grips[3].x * scale) + \"px\";\n                    g.style.top = (grips[3].y * scale) + \"px\";\n                    g.style.width = ((grips[2].x - grips[3].x) * scale) + \"px\";\n                    g.style.height = \"8000px\";\n                } else if (i === 3) {\n                    g.style.left = (grips[0].x * scale - 8000) + \"px\";\n                    g.style.top = (grips[0].y * scale - 8000) + \"px\";\n                    g.style.width = \"8000px\";\n                    g.style.height = 16000 + \"px\";\n                }\n\n            };\n        })(i);\n    }\n\n    let edge0PointerListener = new BB.PointerListener({\n        target: edges[0],\n        fixScribble: true,\n        onPointer: function (event) {\n            event.eventPreventDefault();\n            if (event.type === 'pointermove' && event.button === 'left') {\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\n                transformTop(dY);\n                if (keyListener.isPressed('shift')) {\n                    transformBottom(-dY);\n                }\n                update();\n            }\n            if (event.type === 'pointerup') {\n                commit();\n            }\n        }\n    });\n    let edge1PointerListener = new BB.PointerListener({\n        target: edges[1],\n        fixScribble: true,\n        onPointer: function (event) {\n            event.eventPreventDefault();\n            if (event.type === 'pointermove' && event.button === 'left') {\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\n                transformRight(dX);\n                if (keyListener.isPressed('shift')) {\n                    transformLeft(-dX);\n                }\n                update();\n            }\n            if (event.type === 'pointerup') {\n                commit();\n            }\n        }\n    });\n    let edge2PointerListener = new BB.PointerListener({\n        target: edges[2],\n        fixScribble: true,\n        onPointer: function (event) {\n            event.eventPreventDefault();\n            if (event.type === 'pointermove' && event.button === 'left') {\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\n                transformBottom(dY);\n                if (keyListener.isPressed('shift')) {\n                    transformTop(-dY);\n                }\n                update();\n            }\n            if (event.type === 'pointerup') {\n                commit();\n            }\n        }\n    });\n    let edge3PointerListener = new BB.PointerListener({\n        target: edges[3],\n        fixScribble: true,\n        onPointer: function (event) {\n            event.eventPreventDefault();\n            if (event.type === 'pointermove' && event.button === 'left') {\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\n                transformLeft(dX);\n                if (keyListener.isPressed('shift')) {\n                    transformRight(-dX);\n                }\n                update();\n            }\n            if (event.type === 'pointerup') {\n                commit();\n            }\n        }\n    });\n\n\n    let cornerElArr = [];\n    (function() {\n        for (let i = 0; i < 4; i++) {\n            (function (i) {\n                cornerElArr[i] = document.createElement(\"div\");\n                let g = cornerElArr[i];\n                BB.css(g, {\n                    //background: '#f00',\n                    width: (gripSize * 2) + 'px',\n                    height: (gripSize * 2) + 'px',\n                    position: 'absolute'\n                });\n                g.style.cursor = ['nwse-resize', 'nesw-resize'][i % 2];\n                g.update = function () {\n                    if (i === 0) { //top left\n                        BB.css(g, {\n                            left: (grips[0].x * scale - gripSize * 2 + gripOverlay) + \"px\",\n                            top: (grips[0].y * scale - gripSize * 2 + gripOverlay) + \"px\"\n                        });\n                    } else if (i === 1) { //top right\n                        BB.css(g, {\n                            left: (grips[1].x * scale - gripOverlay) + \"px\",\n                            top: (grips[1].y * scale - gripSize * 2 + gripOverlay) + \"px\"\n                        });\n                    } else if (i === 2) { //bottom right\n                        BB.css(g, {\n                            left: (grips[1].x * scale - gripOverlay) + \"px\",\n                            top: (grips[2].y * scale - gripOverlay) + \"px\"\n                        });\n                    } else if (i === 3) { //bottom left\n                        BB.css(g, {\n                            left: (grips[0].x * scale - gripSize * 2 + gripOverlay) + \"px\",\n                            top: (grips[2].y * scale - gripOverlay) + \"px\"\n                        });\n                    }\n                };\n            })(i);\n        }\n    })();\n    //top left\n    let corner0PointerListener = new BB.PointerListener({\n        target: cornerElArr[0],\n        fixScribble: true,\n        onPointer: function (event) {\n            event.eventPreventDefault();\n            if (event.type === 'pointermove' && event.button === 'left') {\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\n                transformLeft(dX);\n                transformTop(dY);\n                if (keyListener.isPressed('shift')) {\n                    transformRight(-dX);\n                    transformBottom(-dY);\n                }\n                update();\n            }\n            if (event.type === 'pointerup') {\n                commit();\n            }\n        }\n    });\n    //top right\n    let corner1PointerListener = new BB.PointerListener({\n        target: cornerElArr[1],\n        fixScribble: true,\n        onPointer: function (event) {\n            event.eventPreventDefault();\n            if (event.type === 'pointermove' && event.button === 'left') {\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\n                transformRight(dX);\n                transformTop(dY);\n                if (keyListener.isPressed('shift')) {\n                    transformLeft(-dX);\n                    transformBottom(-dY);\n                }\n                update();\n            }\n            if (event.type === 'pointerup') {\n                commit();\n            }\n        }\n    });\n    //bottom right\n    let corner2PointerListener = new BB.PointerListener({\n        target: cornerElArr[2],\n        fixScribble: true,\n        onPointer: function (event) {\n            event.eventPreventDefault();\n            if (event.type === 'pointermove' && event.button === 'left') {\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\n                transformRight(dX);\n                transformBottom(dY);\n                if (keyListener.isPressed('shift')) {\n                    transformLeft(-dX);\n                    transformTop(-dY);\n                }\n                update();\n            }\n            if (event.type === 'pointerup') {\n                commit();\n            }\n        }\n    });\n    //bottom left\n    let corner3PointerListener = new BB.PointerListener({\n        target: cornerElArr[3],\n        fixScribble: true,\n        onPointer: function (event) {\n            event.eventPreventDefault();\n            if (event.type === 'pointermove' && event.button === 'left') {\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\n                transformLeft(dX);\n                transformBottom(dY);\n                if (keyListener.isPressed('shift')) {\n                    transformRight(-dX);\n                    transformTop(-dY);\n                }\n                update();\n            }\n            if (event.type === 'pointerup') {\n                commit();\n            }\n        }\n    });\n\n\n\n\n    function getTransform() {\n        grips[1].x -= grips[0].x;\n        grips[1].y -= grips[0].y;\n        grips[2].x -= grips[0].x;\n        grips[2].y -= grips[0].y;\n        grips[3].x -= grips[0].x;\n        grips[3].y -= grips[0].y;\n        x += grips[0].x;\n        y += grips[0].y;\n        grips[0].x = 0;\n        grips[0].y = 0;\n        return {\n            x: x,\n            y: y,\n            width: grips[1].x,\n            height: grips[2].y\n        };\n    }\n\n\n    div.append(\n        darken[1],\n        darken[0],\n        darken[2],\n        darken[3],\n        thirdsHorizontal,\n        thirdsVertical,\n        outline,\n\n        edges[1],\n        edges[0],\n        edges[2],\n        edges[3],\n\n        cornerElArr[0],\n        cornerElArr[1],\n        cornerElArr[2],\n        cornerElArr[3],\n    );\n\n\n    function update() {\n\n        edges[0].update();\n        edges[1].update();\n        edges[2].update();\n        edges[3].update();\n        cornerElArr[0].update();\n        cornerElArr[1].update();\n        cornerElArr[2].update();\n        cornerElArr[3].update();\n        darken[0].update();\n        darken[1].update();\n        darken[2].update();\n        darken[3].update();\n        (outline as any).update();\n        (thirdsHorizontal as any).update();\n        (thirdsVertical as any).update();\n    }\n\n    update();\n\n\n    // --- interface ---\n\n    this.getTransform = getTransform;\n\n    this.setTransform = function (p) {\n        x = p.x;\n        y = p.y;\n        width = p.width;\n        height = p.height;\n\n        BB.css(div, {\n            left: (x * scale) + \"px\",\n            top: (y * scale) + \"px\"\n        });\n\n        grips[0].x = 0;\n        grips[0].y = 0;\n        grips[1].x = width;\n        grips[1].y = 0;\n        grips[2].x = width;\n        grips[2].y = height;\n        grips[3].x = 0;\n        grips[3].y = height;\n\n        update();\n        commit();\n    };\n\n    this.setScale = function (s) {\n        scale = s;\n        BB.css(div, {\n            left: (x * scale) + \"px\",\n            top: (y * scale) + \"px\"\n        });\n        update();\n    };\n\n    this.showThirds = function (b) {\n        if (b) {\n            thirdsHorizontal.style.display = \"block\";\n            thirdsVertical.style.display = \"block\";\n        } else {\n            thirdsHorizontal.style.display = \"none\";\n            thirdsVertical.style.display = \"none\";\n        }\n    };\n\n    this.getElement = function() {\n        return div;\n    };\n\n    this.destroy = function() {\n        keyListener.destroy();\n        outlinePointerListener.destroy();\n        corner0PointerListener.destroy();\n        corner1PointerListener.destroy();\n        corner2PointerListener.destroy();\n        corner3PointerListener.destroy();\n        edge0PointerListener.destroy();\n        edge1PointerListener.destroy();\n        edge2PointerListener.destroy();\n        edge3PointerListener.destroy();\n    };\n\n}","import {BB} from '../../../bb/bb';\nimport {klHistory} from '../../history/kl-history';\nimport {LANG} from '../../../language/language';\n\n/**\n * Previews currently active layer\n * thumbnail (hover shows bigger preview), layername, opacity\n *\n * internally listens to kl history. updates when there's a change.\n * but you need to update it when the active layer changed. (different canvas object)\n *\n * update visibility for performance\n *\n * p = {\n *     onClick: function() // when clicking on layer name\n *     klRootEl: klRootEl,\n * }\n *\n * @param p\n * @constructor\n */\nexport function LayerPreview(p) {\n\n    // internally redraws with in an interval. checks history is something changed\n    // this update will be animated\n    // it will not be animated if the resolution changed\n    // also redraws when you call updateLayer - not animated\n\n    // syncs via updateLayer, and internally updates layer opacity via a hack\n\n    let div = BB.el({});\n    let layerObj;\n    let isVisible = true;\n    const height = 40;\n    const canvasSize = height - 10;\n    const largeCanvasSize = 300;\n    let lastDrawnState = -2;\n    let lastDrawnSize = {\n        width: 0,\n        height: 0\n    };\n    let animationCanvas = BB.canvas(); // to help animate the transition\n    let animationCanvasCtx = animationCanvas.getContext('2d');\n    const animationLength = 30;\n    let animationCount = 0; // >0 means it's animating\n    let largeCanvasIsVisible = false;\n    let largeCanvasAnimationTimeout;\n    const largeCanvasAnimationDurationMs = 300;\n    let uiState = 'right'; // 'left' | 'right'\n\n\n    // --- setup dom ---\n    let contentWrapperEl = BB.el({\n        css: {\n            display: 'flex',\n            alignItems: 'center',\n            height: height + 'px',\n            color: '#666',\n        }\n    });\n    let canvasWrapperEl = BB.el({\n        css: {\n            //background: '#f00',\n            minWidth: height + 'px',\n            height: height + 'px',\n            display: 'flex',\n            justifyContent: 'center',\n            alignItems: 'center'\n        }\n    });\n    let canvas = BB.canvas(canvasSize, canvasSize);\n    let canvasCtx = canvas.getContext('2d');\n    canvas.title = LANG('layers-active-layer');\n    BB.css(canvas, {\n        boxShadow: '0 0 0 1px #9e9e9e',\n        colorScheme: 'only light',\n    });\n    let nameWrapper = BB.el({\n        css: {\n            //background: '#ff0',\n            flexGrow: '1',\n            paddingLeft: '10px',\n            fontSize: '13px',\n            overflow: 'hidden',\n            position: 'relative'\n        }\n    });\n    let nameLabelEl = BB.el({\n        content: '',\n        css: {\n            cssFloat: 'left',\n            whiteSpace: 'nowrap'\n        }\n    });\n    let nameFadeEl = BB.el({\n        css: {\n            backgroundImage: 'linear-gradient(to right, rgba(221,221,221,0) 0%, rgba(221,221,221,0.8) 100%)',\n            position: 'absolute',\n            right: \"0\",\n            top: \"0\",\n            width: \"50px\",\n            height: '100%'\n        }\n    });\n    let clickableEl = BB.el({\n        css: {\n            //background: 'rgba(0,255,0,0.6)',\n            position: 'absolute',\n            left: \"10px\",\n            top: \"0\",\n            width: \"90px\",\n            height: '100%'\n        }\n    });\n    if (p.onClick) {\n        BB.addEventListener(clickableEl,'click', function() {\n            p.onClick();\n        });\n        BB.addEventListener(canvas,'click', function() {\n            p.onClick();\n        });\n    }\n    let opacityEl = BB.el({\n        content: LANG('opacity') + '<br>100%',\n        css: {\n            minWidth: '60px',\n            fontSize: '12px',\n            textAlign: 'center',\n            background: '#dddddd',\n            color: '#555'\n        }\n    });\n\n    const largeCanvasWrapper = BB.el({\n        onClick: BB.handleClick,\n        css: {\n            pointerEvents: 'none',\n            background: '#fff',\n            position: 'absolute',\n            right: '280px',\n            top: '10px',\n            border: '1px solid #aaa',\n            boxShadow: '1px 1px 3px rgba(0,0,0,0.3)',\n            transition: 'opacity '+largeCanvasAnimationDurationMs+'ms ease-in-out',\n            userSelect: 'none',\n            display: 'block',\n            webkitTouchCallout: 'none',\n            colorScheme: 'only light',\n        }\n    });\n    let largeCanvas = BB.canvas(largeCanvasSize, largeCanvasSize);\n    largeCanvasWrapper.append(largeCanvas);\n    let largeCanvasCtx = largeCanvas.getContext('2d');\n    BB.css(largeCanvas, {\n        display: 'block',\n    });\n\n    div.appendChild(contentWrapperEl);\n    contentWrapperEl.appendChild(canvasWrapperEl);\n    canvasWrapperEl.appendChild(canvas);\n    contentWrapperEl.appendChild(nameWrapper);\n    nameWrapper.appendChild(nameLabelEl);\n    nameWrapper.appendChild(nameFadeEl);\n    nameWrapper.appendChild(clickableEl);\n    contentWrapperEl.appendChild(opacityEl);\n\n\n    let animationCanvasCheckerPattern = animationCanvasCtx.createPattern(BB.createCheckerCanvas(4), 'repeat');\n    let largeCanvasCheckerPattern = canvasCtx.createPattern(BB.createCheckerCanvas(4), 'repeat');\n\n\n\n    // --- update logic ---\n\n    // cross-fade done via 2 canvases (old and new state)\n    // both have checkerboard background drawn on them, both fully opaque\n    // -> no \"lighter\" is needed for accurate cross-fading\n\n    function animate() {\n        if (animationCount === 0) {\n            return;\n        }\n\n        animationCount--;\n\n        canvasCtx.save();\n        canvasCtx.globalAlpha = Math.pow((animationLength - animationCount) / animationLength, 2);\n        canvasCtx.drawImage(animationCanvas, 0, 0);\n        canvasCtx.restore();\n\n        if (animationCount > 0) {\n            requestAnimationFrame(animate);\n        }\n    }\n\n    function draw(isInstant) {\n\n        if (!isVisible) {\n            return;\n        }\n\n        nameLabelEl.textContent = layerObj.name;\n        opacityEl.innerHTML = LANG('opacity') + '<br>' + Math.round(layerObj.opacity * 100) + '%';\n\n        let layerCanvas = layerObj.context.canvas;\n\n        if (layerCanvas.width !== lastDrawnSize.width || layerCanvas.height !== lastDrawnSize.height) {\n            let canvasDimensions = BB.fitInto(layerCanvas.width, layerCanvas.height, canvasSize, canvasSize, 1);\n            canvas.width = Math.round(canvasDimensions.width);\n            canvas.height = Math.round(canvasDimensions.height);\n\n            isInstant = true;\n        }\n\n        animationCanvas.width = canvas.width;\n        animationCanvas.height = canvas.height;\n\n        animationCanvasCtx.save();\n        animationCanvasCtx.imageSmoothingEnabled = false;\n        animationCanvasCtx.fillStyle = animationCanvasCheckerPattern;\n        animationCanvasCtx.fillRect(0, 0, animationCanvas.width, animationCanvas.height);\n        animationCanvasCtx.drawImage(layerCanvas, 0, 0, animationCanvas.width, animationCanvas.height);\n        animationCanvasCtx.restore();\n\n        if (isInstant) {\n            animationCount = 0;\n            canvasCtx.save();\n            canvasCtx.drawImage(animationCanvas, 0, 0);\n            canvasCtx.restore();\n\n        } else {\n            animationCount = animationLength;\n            animate();\n\n        }\n\n        drawLargeCanvas();\n\n        lastDrawnState = klHistory.getState();\n        lastDrawnSize.width = layerCanvas.width;\n        lastDrawnSize.height = layerCanvas.height;\n    }\n\n    function update() {\n        draw(true);\n    }\n\n    setInterval(function() {\n\n        if (!layerObj) {\n            return;\n        }\n\n        let currentState = klHistory.getState();\n        if (currentState === lastDrawnState) {\n            return;\n        }\n\n        //update opacity w hack\n        layerObj.opacity = layerObj.context.canvas.opacity;\n\n        draw(false);\n\n    }, 2000);\n\n\n    //is always instant\n    function drawLargeCanvas() {\n\n        if (!largeCanvasIsVisible || !layerObj) {\n            return;\n        }\n\n        let layerCanvas = layerObj.context.canvas;\n\n        let canvasDimensions = BB.fitInto(layerCanvas.width, layerCanvas.height, largeCanvasSize, largeCanvasSize, 1);\n        largeCanvas.width = Math.round(canvasDimensions.width);\n        largeCanvas.height = Math.round(canvasDimensions.height);\n        largeCanvasCtx.save();\n        if (largeCanvas.width > layerCanvas.width) {\n            largeCanvasCtx.imageSmoothingEnabled = false;\n        } else {\n            largeCanvasCtx.imageSmoothingEnabled = true;\n            largeCanvasCtx.imageSmoothingQuality = 'high';\n        }\n        largeCanvasCtx.fillStyle = largeCanvasCheckerPattern;\n        largeCanvasCtx.fillRect(0, 0, largeCanvas.width, largeCanvas.height);\n        largeCanvasCtx.drawImage(layerCanvas, 0, 0, largeCanvas.width, largeCanvas.height);\n        largeCanvasCtx.restore();\n\n        const bounds = div.getBoundingClientRect();\n        BB.css(largeCanvasWrapper, {\n            top: Math.max(10, (bounds.top + height / 2 - largeCanvas.height / 2)) + \"px\"\n        });\n\n    }\n\n    function removeLargeCanvas() {\n        try {\n            p.klRootEl.removeChild(largeCanvasWrapper);\n        } catch(e) {\n\n        }\n    }\n\n    function showLargeCanvas(b) {\n        if (largeCanvasIsVisible === b) {\n            return;\n        }\n\n        clearTimeout(largeCanvasAnimationTimeout);\n        largeCanvasIsVisible = b;\n\n        if (b) {\n            largeCanvasAnimationTimeout = setTimeout(function() {\n                drawLargeCanvas();\n                largeCanvasWrapper.style.opacity = '0';\n                p.klRootEl.appendChild(largeCanvasWrapper);\n                setTimeout(function() {\n                    largeCanvasWrapper.style.opacity = '1';\n                }, 20);\n            }, 250);\n\n        } else {\n            largeCanvasWrapper.style.opacity = '0';\n            largeCanvasAnimationTimeout = setTimeout(removeLargeCanvas, largeCanvasAnimationDurationMs + 20);\n        }\n\n    }\n\n    let pointerListener = new BB.PointerListener({\n        target: canvas,\n        onEnterLeave: function(b) {\n            showLargeCanvas(b);\n        }\n    });\n\n\n\n    // --- interface ---\n\n    this.getElement = function() {\n        return div;\n    };\n\n    this.setIsVisible = function(b) {\n        if (isVisible === b) {\n            return;\n        }\n        isVisible = b;\n        contentWrapperEl.style.display = isVisible ? 'flex' : 'none';\n        div.style.marginBottom = isVisible ? '' : '10px';\n\n        let currentState = klHistory.getState();\n        if (b && lastDrawnState !== currentState) {\n            update();\n        }\n    };\n\n    //when the layer might have changed\n    this.setLayer = function(klCanvasLayerObj) {\n        layerObj = klCanvasLayerObj;\n        update();\n    };\n\n    this.setUiState = function(stateStr) {\n        uiState = '' + stateStr;\n\n        if (uiState === 'left') {\n            BB.css(largeCanvasWrapper, {\n                left: '280px',\n                right: ''\n            });\n        } else {\n            BB.css(largeCanvasWrapper, {\n                left: '',\n                right: '280px'\n            });\n        }\n    };\n\n}","import {BB} from '../../../bb/bb';\n\n/**\n * fits image into a size\n * params: {\n *    image: image,\n *    width: int,\n *    height: int\n * }\n *\n * methods:\n * getDiv()\n *\n * @param params\n * @constructor\n */\nexport function FittedImage(params) {\n    let fit = BB.fitInto(params.image.width, params.image.height, params.width, params.height, 1);\n    let w = parseInt('' + fit.width);\n    let h = parseInt('' + fit.height);\n\n    let canvas = BB.canvas(w, h);\n\n    canvas.getContext(\"2d\").drawImage(params.image, 0, 0, w, h);\n    BB.css(canvas, {\n        display: \"block\",\n        boxShadow: \"0 0 0 1px #aaa\"\n    });\n\n    this.getElement = function() {\n        return canvas;\n    };\n}","import {BB} from '../../../bb/bb';\nimport {FreeTransformCanvas} from '../components/free-transform-canvas';\nimport {popup} from './popup';\nimport {KlCanvas} from '../../canvas/kl-canvas';\nimport {IKlBasicLayer} from '../../kl.types';\nimport {LANG} from '../../../language/language';\n\nexport function showImportAsLayerDialog(\n    params: {\n        target: HTMLElement;\n        klCanvas: KlCanvas;\n        importImage: HTMLImageElement | HTMLCanvasElement;\n        callback: (\n            p?: {x: number, y: number, width:number, height: number, angleDeg: number},\n            isPixelated?: boolean\n        ) => void;\n    }\n): void {\n\n    let div = document.createElement(\"div\");\n    BB.appendTextDiv(div, LANG('import-as-layer-description'));\n    if (params.klCanvas.isLayerLimitReached()) {\n        let noteEl = BB.el({\n            content: LANG('import-as-layer-limit-reached'),\n            css: {\n                background: '#ff0',\n                padding: '10px',\n                marginTop: '5px',\n                marginBottom: '5px',\n                border: '1px solid #e7d321',\n                borderRadius: '5px'\n            }\n        });\n        div.appendChild(noteEl);\n    }\n    let isSmall = window.innerWidth < 550;\n\n    let buttonRowEl = BB.el({\n        css: {\n            display: 'flex'\n        }\n    });\n    let originalSizeBtn = BB.el({\n        tagName: 'button',\n        content: '1:1',\n        css: {\n            marginRight: '10px'\n        },\n        onClick: function() {\n            freeTransformCanvas.reset();\n        }\n    });\n    let fitSizeBtn = BB.el({\n        tagName: 'button',\n        content: LANG('import-as-layer-fit'),\n        css: {\n            marginRight: '10px'\n        },\n        onClick: function() {\n            freeTransformCanvas.setTransformFit();\n        }\n    });\n    let centerBtn = BB.el({\n        tagName: 'button',\n        content: LANG('center'),\n        css: {\n            marginRight: '10px'\n        },\n        onClick: function() {\n            freeTransformCanvas.setTransformCenter();\n        }\n    });\n    buttonRowEl.appendChild(originalSizeBtn);\n    buttonRowEl.appendChild(fitSizeBtn);\n    buttonRowEl.appendChild(centerBtn);\n    div.appendChild(buttonRowEl);\n\n\n\n    let layers: IKlBasicLayer[] = [];\n    {\n        let klCanvasLayerArr = params.klCanvas.getLayers();\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\n            layers.push({\n                image: klCanvasLayerArr[i].context.canvas,\n                opacity: klCanvasLayerArr[i].opacity,\n                mixModeStr: klCanvasLayerArr[i].mixModeStr\n            });\n        }\n    }\n    layers.push({\n        image: params.importImage,\n        opacity: 1,\n        mixModeStr: 'source-over'\n    });\n\n\n    let freeTransformCanvas = new FreeTransformCanvas({\n        elementWidth: isSmall ? 340 : 540,\n        elementHeight: isSmall ? 280 : 350,\n        imageWidth: params.klCanvas.getLayerContext(0).canvas.width,\n        imageHeight: params.klCanvas.getLayerContext(0).canvas.height,\n        layers: layers,\n        transformIndex: layers.length - 1,\n    });\n    BB.css(freeTransformCanvas.getElement(), {\n        marginTop: '10px',\n        marginLeft: '-20px',\n    });\n    div.appendChild(freeTransformCanvas.getElement());\n\n    function move(x, y) {\n        freeTransformCanvas.move(x, y);\n    }\n\n    let keyListener = new BB.KeyListener({\n        onDown: function(keyStr) {\n            if (keyStr === 'left') {\n                move(-1, 0);\n            }\n            if (keyStr === 'right') {\n                move(1, 0);\n            }\n            if (keyStr === 'up') {\n                move(0, -1);\n            }\n            if (keyStr === 'down') {\n                move(0, 1);\n            }\n        }\n    });\n\n    popup({\n        target: params.target,\n        message: `<b>${LANG('import-as-layer-title')}</b>`,\n        div: div,\n        style: isSmall ? null : {\n            width: '500px'\n        },\n        buttons: [\"Ok\", \"Cancel\"],\n        clickOnEnter: 'Ok',\n        callback: function(buttonStr) {\n            keyListener.destroy();\n            freeTransformCanvas.destroy();\n            BB.destroyEl(originalSizeBtn);\n            BB.destroyEl(fitSizeBtn);\n            BB.destroyEl(centerBtn);\n            if (buttonStr === 'Ok') {\n                params.callback(freeTransformCanvas.getTransformation(), freeTransformCanvas.getIsPixelated());\n            } else {\n                params.callback();\n            }\n        }\n    });\n\n}","import {BB} from '../../../bb/bb';\n\n/**\n * Not really generalized. UI when you drag/drop an image into window.\n * The moment you create it, it will listen.\n *\n * @param p object {onDrop: func(files, optionStr), target: DOM Element, enabledTest: func -> bool} - optionStr: 'default'|'layer'|'image'\n * @constructor\n */\nexport function KlImageDropper(p) {\n\n    //set up DOM\n    let rootEl = BB.el({\n        content: 'Drop to import',\n        css: {\n            paddingTop: '100px',\n            position: 'fixed',\n            left: '0',\n            top: '0',\n            width: '100%',\n            height: '100%',\n            background: 'rgba(50, 50, 50, 0.7)',\n            color: '#fff',\n            textShadow: '2px 2px #000',\n            textAlign: 'center',\n            fontSize: '25px'\n        }\n    });\n    let wrapperEl = BB.el({\n        css: {\n            'marginTop': '50px',\n            'display': 'flex',\n            'justifyContent': 'center'\n        }\n    });\n    let optionStyle = {\n        width: '200px',\n        padding: '50px',\n        margin: '10px',\n        //opacity: 0.5,\n        borderRadius: '20px',\n        border: '1px dashed #fff',\n        background: '#00aefe',\n        fontWeight: 'bold'\n    };\n    let optionLayerEl = BB.el({\n        content: 'As Layer',\n        css: optionStyle\n    });\n    let optionImageEl = BB.el({\n        content: 'As New Image',\n        css: optionStyle\n    });\n\n    rootEl.appendChild(wrapperEl);\n    wrapperEl.appendChild(optionLayerEl);\n    wrapperEl.appendChild(optionImageEl);\n\n\n    let rootCounter = 0;\n    let optionLayerCounter = 0;\n    let optionImageCounter = 0;\n\n    function destroy() {\n        rootCounter = 0;\n        optionLayerCounter = 0;\n        optionImageCounter = 0;\n        try {\n            p.target.removeChild(rootEl);\n        } catch (e) { }\n    }\n\n    function testAcceptType(event) {\n        try {\n            return !event.dataTransfer.types.includes('text/plain');\n        } catch(e) {\n\n        }\n        return false;\n    }\n\n    function updateOptions() {\n        let boxShadow = '0 0 20px 4px #fff';\n        if (optionLayerCounter > 0) {\n            optionLayerEl.style.boxShadow = boxShadow;\n            optionImageEl.style.boxShadow = '';\n        } else if (optionImageCounter > 0) {\n            optionLayerEl.style.boxShadow = '';\n            optionImageEl.style.boxShadow = boxShadow;\n        } else {\n            optionLayerEl.style.boxShadow = '';\n            optionImageEl.style.boxShadow = '';\n        }\n    }\n\n    BB.addEventListener(optionLayerEl,'dragenter', function() {\n        optionLayerCounter++;\n        updateOptions();\n    });\n    BB.addEventListener(optionLayerEl,'dragleave', function() {\n        optionLayerCounter--;\n        updateOptions();\n    });\n    BB.addEventListener(optionImageEl,'dragenter', function() {\n        optionImageCounter++;\n        updateOptions();\n    });\n    BB.addEventListener(optionImageEl,'dragleave', function() {\n        optionImageCounter--;\n        updateOptions();\n    });\n\n\n    function rootDragOver(event) {\n        if (!testAcceptType(event)) {\n            return;\n        }\n        event.stopPropagation();\n        event.preventDefault();\n    }\n    function rootDragEnter(event) {\n        if (!p.enabledTest() || !testAcceptType(event)) {\n            return;\n        }\n        if (rootCounter === 0) {\n            p.target.appendChild(rootEl);\n        }\n        rootCounter++;\n\n    }\n    function rootDragLeave(event) {\n        if (!testAcceptType(event) || rootCounter === 0) {\n            return;\n        }\n        rootCounter = Math.max(0, rootCounter - 1);\n        if (rootCounter === 0) {\n            p.target.removeChild(rootEl);\n        }\n\n    }\n    function rootDrop(event) {\n        if (!testAcceptType(event) || event.dataTransfer.files.length === 0) {\n            destroy();\n            return;\n        }\n        event.stopPropagation();\n        event.preventDefault();\n\n        let optionStr = 'default';\n        if (optionLayerCounter > 0) {\n            optionStr = 'layer';\n        } else if (optionImageCounter > 0) {\n            optionStr = 'image';\n        }\n\n        p.onDrop(event.dataTransfer.files, optionStr);\n\n\n        if (rootCounter > 0) {\n            p.target.removeChild(rootEl);\n        }\n        rootCounter = 0;\n        optionLayerCounter = 0;\n        optionImageCounter = 0;\n        updateOptions();\n    }\n\n    BB.addEventListener(window,'dragover', rootDragOver, false);\n    BB.addEventListener(window,'dragenter', rootDragEnter, false);\n    BB.addEventListener(window,'dragleave', rootDragLeave, false);\n    BB.addEventListener(window,'drop', rootDrop, false);\n\n    // if something goes wrong and you're stuck with overlay\n    BB.addEventListener(rootEl, 'pointerdown', function() {\n        destroy();\n    });\n    let keyListener = new BB.KeyListener({\n        onDown: function(keyStr) {\n            if (rootCounter > 0 && keyStr === 'esc') {\n                destroy();\n            }\n        }\n    });\n\n}","import {BB} from '../../../bb/bb';\nimport {KlSmallColorSlider} from '../base-components/kl-color-slider-small';\nimport {KlSlider} from '../base-components/kl-slider';\nimport {BrushSettingService} from '../../brushes-ui/brush-setting-service';\nimport {LANG} from '../../../language/language';\n\n/**\n * Compressed HUD toolspace. When you hold ctrl+alt.\n * small color picker, brush settings\n *\n * @param p\n * @constructor\n */\nexport function OverlayToolspace(\n    p: {\n        brushSettingService: BrushSettingService; // to sync with outside\n        enabledTest: () => boolean; // calls to see if it's allowed to show\n    }\n) {\n\n    const sizeObj = {\n        width: 150,\n        svHeight: 90,\n        hHeight: 20,\n        sliderHeight: 25\n    };\n\n    let isVisible = false;\n    const div = BB.el({\n        css: {\n            position: 'absolute',\n            left: '500px',\n            top: '500px',\n            background: 'rgb(221, 221, 221)',\n            display: 'none',\n            border: '1px solid #fff',\n            boxShadow: '0 0 10px rgba(0,0,0,0.5)',\n            colorScheme: 'only light',\n        }\n    });\n    const queuedObj = {\n        color: null,\n        size: null,\n        opacity: null\n    };\n\n\n    // --- inputs ---\n\n    //color selection\n    const colorSlider = new KlSmallColorSlider({\n        width: sizeObj.width,\n        heightSV: sizeObj.svHeight,\n        heightH: sizeObj.hHeight,\n        color: p.brushSettingService.getColor(),\n        callback: function (rgbObj) {\n            selectedColorEl.style.backgroundColor = \"rgb(\" + rgbObj.r + \",\" + rgbObj.g + \",\" + rgbObj.b + \")\";\n            p.brushSettingService.setColor(rgbObj, subscriptionFunc);\n        }\n    });\n    const selectedColorEl = BB.el({\n        css: {\n            width: sizeObj.width + 'px',\n            height: sizeObj.hHeight + 'px',\n            pointerEvents: 'none'\n        }\n    });\n    {\n        const initialColor = p.brushSettingService.getColor();\n        selectedColorEl.style.backgroundColor = \"rgb(\" + initialColor.r + \",\" + initialColor.g + \",\" + initialColor.b + \")\";\n    }\n\n    div.appendChild(selectedColorEl);\n    div.appendChild(colorSlider.getElement());\n\n\n    function updateColor(rgbObj) {\n        colorSlider.setColor(rgbObj);\n        selectedColorEl.style.backgroundColor = \"rgb(\" + rgbObj.r + \",\" + rgbObj.g + \",\" + rgbObj.b + \")\";\n    }\n\n\n\n\n\n    //brushsize slider\n\n    const sizeSlider = new KlSlider({\n        label: LANG('brush-size'),\n        width: sizeObj.width,\n        height: sizeObj.sliderHeight,\n        min: 0,\n        max: 500,\n        value: 50,\n        resolution: 225,\n        eventResMs: 1000 / 30,\n        toDisplayValue: (val) => val * 2,\n        toValue: (displayValue) => displayValue / 2,\n        onChange: function(v) {\n            p.brushSettingService.setSize(v);\n        },\n        formatFunc: (displayValue) => {\n            if (displayValue < 10) {\n                return BB.round(displayValue, 1);\n            } else {\n                return Math.round(displayValue);\n            }\n        },\n    });\n    BB.css(sizeSlider.getElement(), {\n        marginTop: '2px'\n    });\n    div.appendChild(sizeSlider.getElement());\n\n    const opacitySlider = new KlSlider({\n        label: LANG('opacity'),\n        width: sizeObj.width,\n        height: sizeObj.sliderHeight,\n        min: 0,\n        max: 1,\n        value: 1,\n        resolution: 225,\n        eventResMs: 1000 / 30,\n        toDisplayValue: (val) => val * 100,\n        toValue: (displayValue) => displayValue / 100,\n        onChange: function(v) {\n            p.brushSettingService.setOpacity(v);\n        },\n    });\n    BB.css(opacitySlider.getElement(), {\n        margin: '2px 0'\n    });\n    div.appendChild(opacitySlider.getElement());\n\n\n\n    // --- general setup ---\n\n    const subscriptionFunc = function(event) {\n        if (event.type === 'color') {\n            if (!isVisible) {\n                queuedObj.color = event.value;\n            } else {\n                updateColor(event.value);\n            }\n        }\n        if (event.type === 'size') {\n            if (!isVisible) {\n                queuedObj.size = event.value;\n            } else {\n                sizeSlider.setValue(event.value);\n            }\n        }\n        if (event.type === 'opacity') {\n            if (!isVisible) {\n                queuedObj.opacity = event.value;\n            } else {\n                opacitySlider.setValue(event.value);\n            }\n        }\n        if (event.type === 'sliderConfig') {\n            sizeSlider.update(event.value.sizeSlider);\n            opacitySlider.update(event.value.opacitySlider);\n        }\n    };\n    p.brushSettingService.subscribe(subscriptionFunc);\n    {\n        const sliderConfig = p.brushSettingService.getSliderConfig();\n        sizeSlider.update(sliderConfig.sizeSlider);\n        opacitySlider.update(sliderConfig.opacitySlider);\n        sizeSlider.setValue(p.brushSettingService.getSize());\n        opacitySlider.setValue(p.brushSettingService.getOpacity());\n    }\n\n    function updateUI() {\n\n        // unfocus manual slider input\n        BB.unfocusAnyInput();\n\n        div.style.display = isVisible ? 'block' : 'none';\n        if (isVisible && mousePos) {\n            div.style.left = (mousePos.x - Math.round(sizeObj.width / 2)) + 'px';\n            div.style.top = (mousePos.y - Math.round(sizeObj.svHeight + sizeObj.hHeight * 3 / 2)) + 'px';\n        }\n    }\n\n    let mousePos = null;\n    BB.addEventListener(document, 'pointermove', function(event) {\n        mousePos = {\n            x: event.pageX,\n            y: event.pageY,\n        };\n    });\n\n    const keyListener = new BB.KeyListener({\n        onDown: function(keyStr, event, comboStr, isRepeat) {\n            if (isRepeat) {\n                return;\n            }\n            if (isVisible) {\n                isVisible = false;\n                updateUI();\n                return;\n            }\n\n            if (!p.enabledTest() || !mousePos) {\n                return;\n            }\n\n            if (['ctrl+alt', 'cmd+alt', 'alt+ctrl', 'alt+cmd'].includes(comboStr)) {\n                event.preventDefault();\n                isVisible = true;\n\n                if (queuedObj.color !== null) {\n                    updateColor(queuedObj.color);\n                    queuedObj.color = null;\n                }\n                if (queuedObj.size !== null) {\n                    sizeSlider.setValue(queuedObj.size);\n                    queuedObj.size = null;\n                }\n                if (queuedObj.opacity !== null) {\n                    opacitySlider.setValue(queuedObj.opacity);\n                    queuedObj.opacity = null;\n                }\n\n                updateUI();\n            }\n\n        },\n        onUp: function(keyStr, event, oldComboStr) {\n            if (['ctrl+alt', 'cmd+alt', 'alt+ctrl', 'alt+cmd'].includes(oldComboStr) && isVisible) {\n                isVisible = false;\n                colorSlider.end();\n                updateUI();\n            }\n        },\n        onBlur: function() {\n            if (isVisible) {\n                isVisible = false;\n                colorSlider.end();\n                updateUI();\n            }\n        }\n    });\n\n    // --- interface ---\n    this.getElement = function() {\n        return div;\n    };\n\n}","import {BB} from '../../../bb/bb';\n// @ts-ignore\nimport klecksLogoImg from 'url:~/src/app/img/klecks-logo.png';\n// @ts-ignore\nimport newImageImg from 'url:~/src/app/img/ui/new-image.svg';\n// @ts-ignore\nimport importImg from 'url:~/src/app/img/ui/import.svg';\n// @ts-ignore\nimport exportImg from 'url:~/src/app/img/ui/export.svg';\n// @ts-ignore\nimport shareImg from 'url:~/src/app/img/ui/share.svg';\n// @ts-ignore\nimport helpImg from 'url:~/src/app/img/ui/help.svg';\nimport {LANG} from '../../../language/language';\n\n\n/**\n * Topmost row of buttons in toolspace (with the app logo)\n *\n * p = { // button click callbacks\n *      logoImg: img,\n *     onLogo: function(),\n *     onNew: function(),\n *     onImport: function(),\n *     onSave: function(),\n *     onShare: function(),\n *     onHelp: function()\n * }\n *\n * @param p\n * @constructor\n */\nexport function ToolspaceTopRow(p) {\n    let div = document.createElement('div');\n    BB.css(div, {\n        height: '36px',\n        //background: '#f00',\n        display: 'flex',\n        backgroundImage: 'linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)'\n    });\n\n    function createButton(p) {\n        let padding = 6 + (p.extraPadding ? p.extraPadding : 0);\n        let result = BB.el({\n            className: 'toolspace-row-button nohighlight',\n            title: p.title,\n            onClick: p.onClick,\n            css: {\n                padding: p.contain ? padding + 'px 0' : ''\n            }\n        });\n        let im = BB.el({\n            css: {\n                backgroundImage: 'url(\\'' + p.image + '\\')',\n                backgroundRepeat: 'no-repeat',\n                backgroundPosition: 'center',\n                backgroundSize: p.contain ? 'contain' : '',\n                //filter: 'grayscale(1)',\n                height: '100%'\n            }\n        });\n        im.style.pointerEvents = 'none';\n        result.appendChild(im);\n        (result as any).pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\n            target: result,\n            onEnterLeave: function(isOver) {\n                result.classList.toggle('toolspace-row-button-hover', isOver);\n            }\n        });\n        return result;\n    }\n\n    let logoButton = createButton({\n        onClick: p.onLogo,\n        title: LANG('home'),\n        image: p.logoImg ? p.logoImg : klecksLogoImg,\n        contain: true\n    });\n    logoButton.style.width = '45px';\n    logoButton.style.borderRight = '1px solid rgb(212, 212, 212)';\n    let newButton = createButton({\n        onClick: p.onNew,\n        title: LANG('file-new'),\n        image: newImageImg,\n        extraPadding: 1,\n        contain: true\n    });\n    let importButton = createButton({\n        onClick: p.onImport,\n        title: LANG('file-import'),\n        image: importImg,\n        extraPadding: 1,\n        contain: true\n    });\n    let saveButton = createButton({\n        onClick: p.onSave,\n        title: LANG('file-save'),\n        image: exportImg,\n        extraPadding: 1,\n        contain: true\n    });\n\n    let shareButton = null;\n    if (BB.canShareFiles()) {\n        shareButton = createButton({\n            onClick: p.onShare,\n            title: LANG('file-share'),\n            image: shareImg,\n            contain: true\n        });\n    }\n    let helpButton = createButton({\n        onClick: p.onHelp,\n        title: LANG('help'),\n        image: helpImg,\n        contain: true\n    });\n\n    div.appendChild(logoButton);\n    div.appendChild(newButton);\n    div.appendChild(importButton);\n    div.appendChild(saveButton);\n    if (shareButton) {\n        div.appendChild(shareButton);\n    }\n    div.appendChild(helpButton);\n\n\n    // --- interface ---\n    this.getElement = function() {\n        return div;\n    }\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eHdqz\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"3x5dR\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hbDTd\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"16iGk\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"2ME3z\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hZnSk\");","import {BB} from '../../../bb/bb';\nimport {dialogCounter} from '../modals/modal-count';\n// @ts-ignore\nimport toolPaintImg from 'url:~/src/app/img/ui/tool-paint.svg';\n// @ts-ignore\nimport toolFillImg from 'url:~/src/app/img/ui/tool-fill.svg';\n// @ts-ignore\nimport toolGradientImg from 'url:~/src/app/img/ui/tool-gradient.svg';\n// @ts-ignore\nimport toolTextImg from 'url:~/src/app/img/ui/tool-text.svg';\n// @ts-ignore\nimport toolShapeImg from 'url:~/src/app/img/ui/tool-shape.svg';\n// @ts-ignore\nimport caretDownImg from 'url:~/src/app/img/ui/caret-down.svg';\nimport {LANG} from '../../../language/language';\n\n/**\n * Toolrow Dropdown. The button where you select: brush, fill, select, transform, etc.\n *\n * p = {\n *     onChange: func(activeStr)\n * }\n *\n * activeStr = 'draw' | 'fill' | 'text' | 'shape' | 'gradient'\n *\n * @param p\n * @constructor\n */\nexport function ToolDropdown(p) {\n\n    let optionArr = ['draw', 'fill', 'gradient', 'text', 'shape'];\n    let imArr = [\n        toolPaintImg,\n        toolFillImg,\n        toolGradientImg,\n        toolTextImg,\n        toolShapeImg\n    ];\n    let titleArr = [\n        `${LANG('tool-brush')} [B]`,\n        `${LANG('tool-paint-bucket')} [G]`,\n        `${LANG('tool-gradient')} [G]`,\n        `${LANG('tool-text')} [T]`,\n        `${LANG('tool-shape')} [U]`,\n    ];\n    let currentActiveIndex = 0;\n    let isActive = true;\n    let isOpen = false;\n\n    //preload images\n    setTimeout(function() {\n        for (let i = 1; i < imArr.length; i++) {\n            let im = new Image();\n            im.src = imArr[i];\n        }\n    }, 100);\n\n    let smallMargin = '6px 0';\n    let div = BB.el({\n        css: {\n            position: 'relative',\n            flexGrow: '1'\n        }\n    });\n\n    let openTimeout;\n    let isDragging = false;\n    let startX, startY;\n    let pointerListener;\n    if (BB.hasPointerEvents) {\n        pointerListener = new BB.PointerListener({\n            target: div,\n            maxPointers: 1,\n            onPointer: function(event) {\n                if (event.type === 'pointerdown') {\n                    if (isOpen) {\n                        return;\n                    }\n\n                    openTimeout = setTimeout(function() {\n                        showDropdown();\n                    }, 400);\n                    isDragging = true;\n                    startX = event.pageX;\n                    startY = event.pageY;\n\n                } else if (event.type === 'pointermove') {\n                    if (isDragging && !isOpen && BB.dist(startX, startY, event.pageX, event.pageY) > 5) {\n                        clearTimeout(openTimeout);\n                        showDropdown();\n                    }\n\n                } else if (event.type === 'pointerup') {\n                    clearTimeout(openTimeout);\n                    if (isOpen && isDragging) {\n                        let target = document.elementFromPoint(event.pageX, event.pageY);\n                        for (let i = 0; i < dropdownBtnArr.length; i++) {\n                            if (target === dropdownBtnArr[i].wrapper) {\n                                closeDropdown();\n                                isActive = true;\n                                currentActiveIndex = i;\n                                updateButton();\n                                p.onChange(optionArr[currentActiveIndex]);\n                                break;\n                            }\n                        }\n                    }\n                    isDragging = false;\n                }\n            }\n        });\n    }\n\n    let activeButton = BB.el({\n        parent: div,\n        className: 'toolspace-row-button nohighlight toolspace-row-button-activated',\n        title: titleArr[currentActiveIndex],\n        onClick: function(e) {\n            if (isActive && !isOpen) {\n                e.preventDefault();\n                e.stopPropagation();\n                showDropdown();\n                return;\n            }\n\n            isActive = true;\n            p.onChange(optionArr[currentActiveIndex]);\n            if (isOpen) {\n                closeDropdown();\n            }\n        },\n        css: {\n            padding: '10px 0',\n            pointerEvents: 'auto',\n            height: '100%',\n            boxSizing: 'border-box'\n        }\n    });\n\n    let activeButtonIm = BB.el({\n        parent: activeButton,\n        css: {\n            backgroundRepeat: 'no-repeat',\n            backgroundPosition: 'center',\n            backgroundSize: 'contain',\n            width: 'calc(100% - 7px)',\n            height: '100%',\n            pointerEvents: 'none',\n            opacity: '0.75',\n        }\n    });\n\n    let arrowButton = BB.el({\n        parent: activeButton,\n        css: {\n            position: 'absolute',\n            right: '1px',\n            bottom: '1px',\n            width: '18px',\n            height: '18px',\n            //background: '#aaa',\n            //borderRadius: '2px',\n            cursor: 'pointer',\n\n            backgroundImage: 'url(\\'' + caretDownImg + '\\')',\n            backgroundRepeat: 'no-repeat',\n            backgroundPosition: 'center',\n            backgroundSize: '60%'\n        },\n        title: 'More Tools',\n        onClick: function(e) {\n            e.preventDefault();\n            e.stopPropagation();\n            showDropdown();\n        }\n    });\n\n\n    let overlay = BB.el({\n        css: {\n            position: 'absolute',\n            //background: 'rgba(255,0,0,0.5)',\n            left: '0',\n            top: '0',\n            right: '0',\n            bottom: '0'\n        }\n    });\n    let overlayPointerListener = new BB.PointerListener({\n        target: overlay,\n        pointers: 1,\n        onPointer: function(e) {\n            if (e.type === 'pointerdown') {\n                e.eventPreventDefault();\n                closeDropdown();\n            }\n        }\n    });\n\n    let dropdownWrapper = BB.el({\n        className: 'tool-dropdown-wrapper',\n        css: {\n            position: 'absolute',\n            width: '100%',\n            height: (100 * (optionArr.length - 1)) + '%',\n            top: '100%',\n            left: '0',\n            zIndex: '1',\n            boxSizing: 'border-box',\n            cursor: 'pointer',\n            transition: 'height 0.1s ease-in-out, opacity 0.1s ease-in-out',\n            borderBottomLeftRadius: '5px',\n            borderBottomRightRadius: '5px',\n            overflow: 'hidden',\n        }\n    });\n\n    let dropdownBtnArr = [];\n\n    function createDropdownButton(p) {\n        let result = {};\n\n        let wrapper = BB.el({\n            parent: dropdownWrapper,\n            className: 'tool-dropdown-button',\n            title: p.title,\n            css: {\n                padding: '10px 0',\n                height: (100 / (optionArr.length - 1)) + '%',\n                boxSizing: 'border-box'\n            },\n            onClick: function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n                p.onClick(p.index, p.id);\n            }\n        });\n        (result as any).wrapper = wrapper;\n        let im = BB.el({\n            parent: wrapper,\n            css: {\n                backgroundImage: 'url(\\'' + p.image + '\\')',\n                backgroundRepeat: 'no-repeat',\n                backgroundPosition: 'center',\n                backgroundSize: 'contain',\n                height: '100%',\n                pointerEvents: 'none',\n                opacity: '0.75'\n            }\n        });\n\n        // --- interface ---\n        (result as any).show = function(b) {\n            wrapper.style.display = b ? 'block' : 'none';\n        };\n\n        (result as any).setIsSmall = function(b) {\n            wrapper.style.padding = b ? smallMargin : '10px 0';\n        };\n\n        return result;\n    }\n\n    function onClickDropdownBtn(index, id) {\n        closeDropdown();\n\n        isActive = true;\n        currentActiveIndex = index;\n\n        updateButton();\n\n        p.onChange(optionArr[currentActiveIndex]);\n    }\n\n    for (let i = 0; i < optionArr.length; i++) {\n        dropdownBtnArr.push(createDropdownButton({\n            index: i,\n            id: optionArr[i],\n            image: imArr[i],\n            title: titleArr[i],\n            onClick: onClickDropdownBtn\n        }));\n    }\n\n    function showDropdown() {\n        dialogCounter.increase(0.5);\n        isOpen = true;\n\n        for (let i = 0; i < optionArr.length; i++) {\n            dropdownBtnArr[i].show(currentActiveIndex !== i);\n        }\n\n        arrowButton.style.display = 'none';\n        div.style.zIndex = '1';\n        document.body.appendChild(overlay);\n        div.appendChild(dropdownWrapper);\n    }\n\n    function closeDropdown() {\n        dialogCounter.decrease(0.5);\n        isOpen = false;\n        arrowButton.style.removeProperty('display');\n        div.style.removeProperty('z-index');\n        document.body.removeChild(overlay);\n\n        div.removeChild(dropdownWrapper);\n    }\n\n    function updateButton() {\n        activeButton.title = titleArr[currentActiveIndex];\n        activeButtonIm.style.backgroundImage = 'url(\\'' + imArr[currentActiveIndex] + '\\')';\n    }\n    updateButton();\n\n\n    // --- interface ---\n\n    this.setIsSmall = function(b) {\n        activeButton.style.padding = b ? smallMargin : '10px 0';\n        for (let i = 0; i < optionArr.length; i++) {\n            dropdownBtnArr[i].setIsSmall(b);\n        }\n        if (b) {\n            arrowButton.style.width = '14px';\n            arrowButton.style.height = '14px';\n        } else {\n            arrowButton.style.width = '18px';\n            arrowButton.style.height = '18px';\n        }\n    };\n\n    this.setActive = function(activeStr) {\n        if (optionArr.includes(activeStr)) {\n            isActive = true;\n            for (let i = 0; i < optionArr.length; i++) {\n                if (optionArr[i] === activeStr) {\n                    currentActiveIndex = i;\n                    break;\n                }\n            }\n            activeButton.classList.add('toolspace-row-button-activated');\n            updateButton();\n        } else {\n            isActive = false;\n            activeButton.classList.remove('toolspace-row-button-activated');\n        }\n    };\n\n    this.getActive = function() {\n        return optionArr[currentActiveIndex];\n    };\n\n    this.getElement = function() {\n        return div;\n    };\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6mHrC\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hS5Hj\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"4KGfM\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"doX4v\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"7NqHO\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"dz3mY\");","import {BB} from '../../../bb/bb';\nimport {ToolDropdown} from './tool-dropdown';\n// @ts-ignore\nimport toolHandImg from 'url:~/src/app/img/ui/tool-hand.svg';\n// @ts-ignore\nimport toolZoomInImg from 'url:~/src/app/img/ui/tool-zoom-in.svg';\n// @ts-ignore\nimport toolZoomOutImg from 'url:~/src/app/img/ui/tool-zoom-out.svg';\n// @ts-ignore\nimport toolUndoImg from 'url:~/src/app/img/ui/tool-undo.svg';\nimport {LANG} from '../../../language/language';\n\n\n/**\n * Row of buttons in toolspace. image-operations (draw, hand), zoom, undo/redo\n * Need to do syncing. So tool is correct, and zoom/undo/redo buttons are properly enabled/disabled\n * heights: 54px tall, 36px small -> via setIsSmall\n *\n * p = {\n *     onActivate: function(activeStr), // clicking on tool button - activating it\n *     onZoomIn: function(),\n *     onZoomOut: function(),\n *     onUndo: function(),\n *     onRedo: function(),\n * }\n *\n * activeStr = 'draw' | 'hand' | 'fill' | 'text'\n *\n * @param p\n * @constructor\n */\nexport function ToolspaceToolRow(p) {\n    let div = document.createElement('div');\n    BB.css(div, {\n        height: '54px',\n        //height: '36px',\n        display: 'flex',\n        backgroundImage: 'linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)'\n    });\n\n    let currentActiveStr = 'draw'; // 'draw' | 'hand' | 'fill'\n\n    function setActive(activeStr, doEmit?) {\n        if (currentActiveStr === activeStr) {\n            return;\n        }\n\n        currentActiveStr = activeStr;\n\n        toolDropdown.setActive(currentActiveStr);\n        handButton.classList.toggle('toolspace-row-button-activated', currentActiveStr === 'hand');\n\n        if (doEmit) {\n            p.onActivate(currentActiveStr);\n        }\n    }\n\n    function createButton(p) {\n\n        let smallMargin = p.doLighten ? '6px 0' : '8px 0';\n\n        let result = BB.el({\n            className: 'toolspace-row-button nohighlight',\n            //title: p.title,\n            onClick: p.onClick,\n            css: {\n                padding: p.contain ? '10px 0' : ''\n            }\n        });\n        let im = BB.el({\n            css: {\n                backgroundImage: 'url(\\'' + p.image + '\\')',\n                backgroundRepeat: 'no-repeat',\n                backgroundPosition: 'center',\n                backgroundSize: p.contain ? 'contain' : '',\n                //filter: 'grayscale(1)',\n                height: '100%',\n                transform: p.doMirror ? 'scale(-1, 1)' : '',\n                pointerEvents: 'none',\n                opacity: p.doLighten ? '0.75' : '1'\n            }\n        });\n        result.appendChild(im);\n        (result as any).pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\n            target: result,\n            onEnterLeave: function(isOver) {\n                result.classList.toggle('toolspace-row-button-hover', isOver);\n            }\n        });\n        (result as any).setIsSmall = function(b) {\n            result.style.padding = p.contain ? (b ? smallMargin : '10px 0') : '';\n        }\n        return result;\n    }\n\n\n    function createTriangleButton(p) { // because IE and Edge don't support clip path\n\n        let result = document.createElement('div');\n        BB.css(result, {\n            flexGrow: '1',\n            position: 'relative'\n        });\n\n        let svg = BB.createSvg({\n            elementType: 'svg',\n            width: '67px', // can't think of a way doing with percentage\n            height: '54px',\n            viewBox: '0 0 100 100',\n            preserveAspectRatio: 'none'\n        });\n        BB.css(svg, {\n            position: 'absolute',\n            left: '0',\n            top: '0'\n        });\n\n        let blurRadius = 10;\n        let blurOffsetX = 2;\n        let blurOffsetY = 2;\n\n        let defs = BB.createSvg( { // inset shadow via svg\n            elementType: 'defs',\n            childrenArr: [\n                {\n                    elementType: 'filter',\n                    id: 'innershadow',\n                    x0: '-50%',\n                    y0: '-50%',\n                    width: '200%',\n                    height: '200%',\n                    childrenArr: [\n                        {\n                            elementType: 'feGaussianBlur',\n                            in: 'SourceAlpha',\n                            stdDeviation: '' + blurRadius,\n                            result: 'blur'\n                        }, {\n                            elementType: 'feOffset',\n                            dx: '' + blurOffsetX,\n                            dy: '' + blurOffsetY\n                        }, {\n                            elementType: 'feComposite',\n                            in2: 'SourceAlpha',\n                            operator: 'arithmetic',\n                            k2: '-1',\n                            k3: '1',\n                            result: 'shadowDiff'\n                        },\n\n                        {\n                            elementType: 'feFlood',\n                            'flood-color': '#000',\n                            'flood-opacity': '0.2'\n                        }, {\n                            elementType: 'feComposite',\n                            in2: 'shadowDiff',\n                            operator: 'in'\n                        }, {\n                            elementType: 'feComposite',\n                            in2: 'SourceGraphic',\n                            operator: 'over',\n                            result: 'firstfilter'\n                        },\n\n                        {\n                            elementType: 'feGaussianBlur',\n                            in: 'firstfilter',\n                            stdDeviation: '' + blurRadius,\n                            result: 'blur2'\n                        }, {\n                            elementType: 'feOffset',\n                            dx: '' + blurOffsetX,\n                            dy: '' + blurOffsetY\n                        }, {\n                            elementType: 'feComposite',\n                            in2: 'firstfilter',\n                            operator: 'arithmetic',\n                            k2: '-1',\n                            k3: '1',\n                            result: 'shadowDiff'\n                        },\n\n                        {\n                            elementType: 'feFlood',\n                            'flood-color': '#000',\n                            'flood-opacity': '0.2'\n                        }, {\n                            elementType: 'feComposite',\n                            in2: 'shadowDiff',\n                            operator: 'in'\n                        }, {\n                            elementType: 'feComposite',\n                            in2: 'firstfilter',\n                            operator: 'over'\n                        }\n                    ]\n                }\n            ]\n        });\n\n\n        let svgTriangleLeft = BB.createSvg({\n            elementType: 'path',\n            'vector-effect': 'non-scaling-stroke',\n            d: 'M0,0 L 100,0 0,100 z',\n            fill: 'rgba(0,0,0,0)',\n            class: 'toolspace-svg-triangle-button'\n        });\n        svgTriangleLeft.onclick = function() {\n            p.onLeft();\n            svgTriangleLeft.classList.remove('toolspace-svg-triangle-button-hover');\n        };\n\n        let svgTriangleRight = BB.createSvg({\n            elementType: 'path',\n            'vector-effect': 'non-scaling-stroke',\n            d: 'M100,100 L 100,0 0,100 z',\n            fill: 'rgba(0,0,0,0)',\n            class: 'toolspace-svg-triangle-button'\n        });\n        svgTriangleRight.onclick = function() {\n            p.onRight();\n            svgTriangleRight.classList.remove('toolspace-svg-triangle-button-hover');\n        };\n\n        // because :hover causes problems w touch\n        (result as any).leftPointerListener = new BB.PointerListener({\n            target: svgTriangleLeft,\n            onEnterLeave: function(isOver) {\n                svgTriangleLeft.classList.toggle('toolspace-svg-triangle-button-hover', isOver);\n            }\n        });\n        (result as any).rightPointerListener = new BB.PointerListener({\n            target: svgTriangleRight,\n            onEnterLeave: function(isOver) {\n                svgTriangleRight.classList.toggle('toolspace-svg-triangle-button-hover', isOver);\n            }\n        });\n\n\n        svg.appendChild(defs);\n        svg.appendChild(svgTriangleLeft);\n        svg.appendChild(svgTriangleRight);\n        result.appendChild(svg);\n\n\n        let leftIm = BB.el({\n            css: {\n                backgroundImage: 'url(\\'' + p.leftImage + '\\')',\n                backgroundRepeat: 'no-repeat',\n                backgroundSize: 'contain',\n                width: '20px',\n                height: '20px',\n                position: 'absolute',\n                left: '10px',\n                top: '8px',\n                //transform: p.doMirror ? 'scale(-1, 1)' : '',\n                pointerEvents: 'none'\n            }\n        });\n        result.appendChild(leftIm);\n\n\n        let rightIm = BB.el({\n            css: {\n                backgroundImage: 'url(\\'' + (p.rightImage ? p.rightImage : p.leftImage) + '\\')',\n                backgroundRepeat: 'no-repeat',\n                backgroundSize: 'contain',\n                width: '20px',\n                height: '20px',\n                position: 'absolute',\n                right: '10px',\n                bottom: '8px',\n                transform: p.rightImage ? '' : 'scale(-1, 1)',\n                pointerEvents: 'none'\n            }\n        });\n        result.appendChild(rightIm);\n\n\n\n\n\n        (result as any).setIsEnabledLeft = function(b) {\n            svgTriangleLeft.classList.toggle('toolspace-row-button-disabled', !b);\n            leftIm.classList.toggle('toolspace-row-button-disabled', !b);\n        };\n        (result as any).setIsEnabledRight = function(b) {\n            svgTriangleRight.classList.toggle('toolspace-row-button-disabled', !b);\n            rightIm.classList.toggle('toolspace-row-button-disabled', !b);\n        };\n\n        return result;\n    }\n\n    function createTriangleButtonViaClipPath(p) {\n        let result = document.createElement('div');\n        BB.css(result, {\n            flexGrow: '1',\n            position: 'relative'\n        });\n\n\n        let leftButton = BB.el({\n            className: 'toolspace-triangle-button',\n            onClick: p.onLeft,\n            css: {\n                clipPath: 'polygon(0% 0%, 100% 0%, 100% 0%, 0% 100%)'\n            }\n        });\n\n        let leftIm = BB.el({\n            css: {\n                backgroundImage: 'url(\\'' + p.leftImage + '\\')',\n                backgroundRepeat: 'no-repeat',\n                backgroundSize: 'contain',\n                width: '20px',\n                height: '20px',\n                position: 'absolute',\n                left: '10px',\n                top: '8px',\n                //transform: p.doMirror ? 'scale(-1, 1)' : '',\n                pointerEvents: 'none'\n            }\n        });\n        leftButton.appendChild(leftIm);\n\n\n\n        let rightButton = BB.el({\n            className: 'toolspace-triangle-button',\n            onClick: p.onRight,\n            css: {\n                clipPath: 'polygon(0% 100%, 100% 0%, 100% 100%, 0% 100%)'\n            }\n        });\n\n        let rightIm = BB.el({\n            css: {\n                backgroundImage: 'url(\\'' + (p.rightImage ? p.rightImage : p.leftImage) + '\\')',\n                backgroundRepeat: 'no-repeat',\n                backgroundSize: 'contain',\n                width: '20px',\n                height: '20px',\n                position: 'absolute',\n                right: '10px',\n                bottom: '8px',\n                transform: p.rightImage ? '' : 'scale(-1, 1)',\n                pointerEvents: 'none'\n            }\n        });\n        rightButton.appendChild(rightIm);\n\n\n\n        result.appendChild(leftButton);\n        result.appendChild(rightButton);\n\n\n        // because :hover causes problems w touch\n        (result as any).leftPointerListener = new BB.PointerListener({\n            target: leftButton,\n            onEnterLeave: function(isOver) {\n                leftButton.classList.toggle('toolspace-row-button-hover', isOver);\n            }\n        });\n        (result as any).rightPointerListener = new BB.PointerListener({\n            target: rightButton,\n            onEnterLeave: function(isOver) {\n                rightButton.classList.toggle('toolspace-row-button-hover', isOver);\n            }\n        });\n\n\n\n        (result as any).setIsEnabledLeft = function(b) {\n            leftButton.classList.toggle('toolspace-row-button-disabled', !b);\n        };\n        (result as any).setIsEnabledRight = function(b) {\n            rightButton.classList.toggle('toolspace-row-button-disabled', !b);\n        };\n        return result;\n    }\n\n    let toolDropdown = new ToolDropdown({\n        onChange: function(activeStr) {\n            setActive(activeStr, true);\n        }\n    });\n    div.appendChild(toolDropdown.getElement());\n\n    let handButton = createButton({\n        onClick: function() {\n            setActive('hand', true);\n        },\n        image: toolHandImg,\n        contain: true,\n        doLighten: true\n    });\n    handButton.style.borderRight = '1px solid rgb(212, 212, 212)';\n    handButton.title = LANG('tool-hand');\n    div.appendChild(handButton);\n\n    let zoomInNOutButton = createTriangleButton({\n        onLeft: p.onZoomIn,\n        onRight: p.onZoomOut,\n        leftImage: toolZoomInImg,\n        rightImage: toolZoomOutImg,\n    });\n    zoomInNOutButton.title = LANG('tool-zoom');\n    div.appendChild(zoomInNOutButton);\n\n    let zoomInButton = createButton({\n        onClick: p.onZoomIn,\n        image: toolZoomInImg,\n        contain: true\n    });\n    zoomInButton.title = LANG('zoom-in');\n    div.appendChild(zoomInButton);\n\n    let zoomOutButton = createButton({\n        onClick: p.onZoomOut,\n        image: toolZoomOutImg,\n        contain: true\n    });\n    zoomOutButton.title = LANG('zoom-out');\n    div.appendChild(zoomOutButton);\n\n    let undoNRedoButton = createTriangleButton({\n        onLeft: p.onUndo,\n        onRight: p.onRedo,\n        leftImage: toolUndoImg,\n        rightImage: null,\n    });\n    undoNRedoButton.title = LANG('tool-undo-redo');\n    (undoNRedoButton as any).setIsEnabledLeft(false);\n    (undoNRedoButton as any).setIsEnabledRight(false);\n    div.appendChild(undoNRedoButton);\n\n    let undoButton = createButton({\n        onClick: p.onUndo,\n        image: toolUndoImg,\n        contain: true\n    });\n    undoButton.title = LANG('undo');\n    undoButton.classList.add('toolspace-row-button-disabled');\n    div.appendChild(undoButton);\n\n    let redoButton = createButton({\n        onClick: p.onRedo,\n        image: toolUndoImg,\n        contain: true,\n        doMirror: true\n    });\n    redoButton.title = LANG('redo');\n    redoButton.classList.add('toolspace-row-button-disabled');\n    div.appendChild(redoButton);\n\n    zoomInButton.style.display = 'none';\n    zoomOutButton.style.display = 'none';\n    undoButton.style.display = 'none';\n    redoButton.style.display = 'none';\n\n\n\n\n\n\n    // --- interface ---\n    this.getElement = function() {\n        return div;\n    };\n    this.setIsSmall = function(b) {\n        BB.css(div, {\n            height: b ? '36px' : '54px'\n        });\n\n        toolDropdown.setIsSmall(b);\n        (handButton as any).setIsSmall(b);\n        (zoomInButton as any).setIsSmall(b);\n        (zoomOutButton as any).setIsSmall(b);\n        (undoButton as any).setIsSmall(b);\n        (redoButton as any).setIsSmall(b);\n\n        if (b) {\n            zoomInNOutButton.style.display = 'none';\n            undoNRedoButton.style.display = 'none';\n            zoomInButton.style.display = 'block';\n            zoomOutButton.style.display = 'block';\n            undoButton.style.display = 'block';\n            redoButton.style.display = 'block';\n        } else {\n            zoomInNOutButton.style.display = 'block';\n            undoNRedoButton.style.display = 'block';\n            zoomInButton.style.display = 'none';\n            zoomOutButton.style.display = 'none';\n            undoButton.style.display = 'none';\n            redoButton.style.display = 'none';\n        }\n\n    };\n\n    this.setEnableZoomIn = function(b) {\n        zoomInButton.classList.toggle('toolspace-row-button-disabled', !b);\n        (zoomInNOutButton as any).setIsEnabledLeft(b);\n    };\n    this.setEnableZoomOut = function(b) {\n        zoomOutButton.classList.toggle('toolspace-row-button-disabled', !b);\n        (zoomInNOutButton as any).setIsEnabledRight(b);\n    };\n    this.setEnableUndo = function(b) {\n        undoButton.classList.toggle('toolspace-row-button-disabled', !b);\n        (undoNRedoButton as any).setIsEnabledLeft(b);\n    };\n    this.setEnableRedo = function(b) {\n        redoButton.classList.toggle('toolspace-row-button-disabled', !b);\n        (undoNRedoButton as any).setIsEnabledRight(b);\n    };\n    this.setActive = function(activeStr) {\n        setActive(activeStr);\n    };\n    this.getActive = function() {\n        return currentActiveStr;\n    };\n\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"2gZH2\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"04ZZm\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"j9xio\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"AnO0a\");","import {BB} from '../../../bb/bb';\nimport {Select} from '../base-components/select';\nimport {LANG} from '../../../language/language';\n\n/**\n * Ui to select stabilizer level. 4 options. returned as 0-3\n *\n * p = {\n *     smoothing: number, // initial level 0-3\n *     onSelect: function(level number) // 0-3, when level changes\n * }\n *\n * @param p\n * @constructor\n */\nexport function ToolspaceStabilizerRow(p) {\n\n    let div = BB.el({\n        tagName: 'label',\n        content: LANG('stabilizer') + '&nbsp;',\n        title: LANG('stabilizer-title'),\n        css: {\n            display: 'flex',\n            alignItems: 'center',\n            fontSize: '13px',\n            color: 'rgba(0,0,0,0.6)'\n        }\n    });\n\n    let strengthSelect = new Select({\n        optionArr: [\n            ['0', '0'],\n            ['1', '1'],\n            ['2', '2'],\n            ['3', '3'],\n            ['4', '4'],\n            ['5', '5']\n        ],\n        initValue: p.smoothing,\n        onChange: function(val) {\n            p.onSelect(parseInt(val));\n        }\n    });\n    div.appendChild(strengthSelect.getElement());\n\n    let pointerListener = new BB.PointerListener({\n        target: div,\n        onWheel: function(e) {\n            strengthSelect.setDeltaValue(e.deltaY);\n        }\n    });\n\n\n    // --- interface ---\n    this.getElement = function() {\n        return div;\n    };\n}","import {BB} from '../../../bb/bb';\n// @ts-ignore\nimport invertedBorderImg from 'url:~/src/app/img/ui/inverted-border.svg';\n\n/**\n * row of tabs. uses css class .tabrow-tab\n *\n * p = {\n *     initialId: string, // e.g. 'draw'\n *     useAccent: boolean,\n *     tabArr: [\n *         {\n *             id: string, // e.g. 'draw',\n *             label: string, // optional\n *             image: string, // optional background image\n *             title: string, // optional\n *             isVisible: boolean, // optional - default is true\n *             onOpen: function(),\n *             onClose: function(),\n *             css: {...},\n *         }\n *     ]\n * }\n *\n * @param p\n * @constructor\n */\nexport function TabRow(p) {\n    let _this = this;\n    let height = 35;\n    let div = BB.el({\n        className: 'tabrow',\n        css: {\n            height: height + 'px'\n        }\n    });\n\n    let tabArr = []; //creates its own internal arr\n    let openedTabObj = null;\n\n    const roundSize = 10;\n    const roundRight = BB.el({\n        css: {\n            width: roundSize + 'px',\n            height: roundSize + 'px',\n            backgroundImage: `url('${invertedBorderImg}')`,\n            backgroundSize: 'cover',\n            position: 'absolute',\n            right: -roundSize + 'px',\n            bottom: '0',\n            pointerEvents: 'none',\n        }\n    });\n    const roundLeft = BB.el({\n        css: {\n            width: roundSize + 'px',\n            height: roundSize + 'px',\n            backgroundImage: `url('${invertedBorderImg}')`,\n            backgroundSize: 'cover',\n            position: 'absolute',\n            left: -roundSize + 'px',\n            bottom: '0',\n            transform: 'scale(-1,1)',\n            pointerEvents: 'none',\n        }\n    });\n\n    function createTab(pTabObj, initialId, useAccent) {\n        let result: any = {\n            id: pTabObj.id,\n            isVisible: 'isVisible' in pTabObj ? pTabObj.isVisible : true,\n            onOpen: pTabObj.onOpen,\n            onClose: pTabObj.onClose,\n            update: function(openedTabObj) {\n                tabDiv.className = openedTabObj === result ? (useAccent ? 'tabrow-tab tabrow-tab-opened-accented' : 'tabrow-tab tabrow-tab-opened') : 'tabrow-tab';\n                tabDiv.style.display = result.isVisible ? 'block' : 'none';\n            }\n        };\n        let tabDiv = BB.el({\n            content: 'label' in pTabObj ? pTabObj.label : '',\n            title: 'title' in pTabObj ? pTabObj.title : undefined,\n            className: initialId === result.id ? (useAccent ? 'tabrow-tab tabrow-tab-opened-accented' : 'tabrow-tab tabrow-tab-opened') : 'tabrow-tab',\n            css: {\n                lineHeight: height + 'px',\n                display: result.isVisible ? 'block' : 'none',\n                zIndex: '0',\n            },\n            onClick: function() {\n                if (openedTabObj === result) {\n                    return;\n                }\n                _this.open(result.id);\n            }\n        });\n        result.div = tabDiv;\n        if ('image' in pTabObj) {\n            BB.css(tabDiv, {\n                backgroundImage: 'url(\\'' + pTabObj.image + '\\')',\n                backgroundSize: (height - 7) + 'px'\n            });\n        }\n        if ('css' in pTabObj) {\n            BB.css(tabDiv, pTabObj.css);\n        }\n        div.appendChild(tabDiv);\n\n        let pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\n            target: tabDiv,\n            onEnterLeave: function(isOver) {\n                tabDiv.classList.toggle('tabrow-tab-hover', isOver);\n            }\n        });\n\n        if (initialId === result.id) {\n            result.onOpen();\n            result.div.appendChild(roundRight);\n            result.div.appendChild(roundLeft);\n        } else {\n            result.onClose();\n        }\n\n        return result;\n    }\n\n    for (let i = 0; i < p.tabArr.length; i++) {\n        tabArr.push(createTab(p.tabArr[i], p.initialId, p.useAccent));\n    }\n\n    for (let i = 0; i < tabArr.length; i++) {\n        if (tabArr[i].id === p.initialId) {\n            openedTabObj = tabArr[i];\n        }\n    }\n    if (openedTabObj === null) {\n        throw 'invalid initialId';\n    }\n\n    function update() {\n        for (let i = 0; i < tabArr.length; i++) {\n            tabArr[i].update(openedTabObj);\n        }\n    }\n\n    // --- interface ---\n    this.getElement = function() {\n        return div;\n    };\n\n    this.open = function(tabId) {\n        for (let i = 0; i < tabArr.length; i++) {\n            if (tabArr[i].id === tabId) {\n                if (openedTabObj === tabArr[i]) { // already open\n                    return;\n                }\n                openedTabObj.onClose();\n                openedTabObj = tabArr[i];\n                openedTabObj.onOpen();\n                openedTabObj.div.appendChild(roundRight);\n                openedTabObj.div.appendChild(roundLeft);\n                update();\n                return;\n            }\n        }\n        throw 'TabRow.open - invalid tabId';\n    };\n\n    this.getOpenedTabId = function() {\n        return '' + openedTabObj.id;\n    };\n\n    this.setIsVisible = function(tabId, isVisible) {\n        for (let i = 0; i < tabArr.length; i++) {\n            if (tabArr[i].id === tabId) {\n                tabArr[i].isVisible = !!isVisible;\n                update();\n                return;\n            }\n        }\n        throw 'TabRow.setIsVisible - invalid tabId';\n    };\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"nTvP2\");","import {BB} from '../../../bb/bb';\n// @ts-ignore\nimport angleImg from 'url:~/src/app/img/ui/angle.svg';\n// @ts-ignore\nimport rotateImg from 'url:~/src/app/img/ui/edit-rotate.svg';\nimport {LANG} from '../../../language/language';\n\n/**\n * Ui, when hand tool tab is open.\n *\n * p = {\n *     scale: number, // initial value\n *     angleDeg: number, // initial value\n *     onReset: function(),\n *     onFit: function(),\n *     onAngleChange: function(angleDeg number, isRelative number)\n * }\n *\n * @param p\n * @constructor\n */\nexport function HandUi(p) {\n    let div = BB.el({\n        css: {\n            margin: '10px'\n        }\n    });\n    let isVisible = true;\n    let scale = p.scale;\n    let angleDeg = p.angleDeg;\n\n    let row1 = BB.el({\n        css: {\n            marginBottom: '10px',\n            display: 'flex'\n        }\n    });\n    let row2 = BB.el({\n        css: {\n            display: 'flex',\n            marginBottom: '10px',\n        }\n    });\n    let row3 = BB.el({\n        css: {\n            display: 'flex'\n        }\n    });\n    div.append(row1, row2, row3);\n\n\n    let scaleEl = BB.el({\n        css: {\n            width: '55px',\n            userSelect: 'none'\n        }\n    });\n    row1.appendChild(scaleEl);\n\n    let angleIm = new Image();\n    angleIm.src = angleImg;\n    BB.css(angleIm, {\n        verticalAlign: 'bottom',\n        width: '20px',\n        height: '20px',\n        marginRight: '5px',\n        borderRadius: '10px',\n        background: 'rgba(0,0,0,0.2)',\n        userSelect: 'none'\n    });\n    row1.appendChild(angleIm);\n\n    let angleEl = BB.el({\n        css: {\n            userSelect: 'none'\n        }\n    });\n    row1.appendChild(angleEl);\n\n\n    function update() {\n        scaleEl.innerHTML = Math.round(scale * 100) + '%';\n        angleEl.innerHTML =  Math.round(angleDeg) + '°';\n\n\n        angleIm.style.transform = 'rotate(' + angleDeg + 'deg)';\n        if (angleDeg % 90 === 0) {\n            angleIm.style.boxShadow = 'inset 0 0 0 1px rgba(255,255,255, 1), 0 0 0 1px rgba(0, 0, 0, 0.3)';\n        } else {\n            angleIm.style.boxShadow = '';\n        }\n    }\n    update();\n\n\n    let resetButton = BB.el({\n        tagName: 'button',\n        content: LANG('hand-reset'),\n        onClick: p.onReset\n    });\n    BB.makeUnfocusable(resetButton);\n\n    let fitButton = BB.el({\n        tagName: 'button',\n        content: LANG('hand-fit'),\n        css: {\n            marginLeft: '10px'\n        },\n        onClick: p.onFit\n    });\n    BB.makeUnfocusable(fitButton);\n    row2.append(resetButton, fitButton);\n\n    let leftRotateButton = BB.el({\n        tagName: 'button',\n        content: '<img height=\"20\" src=\"' + rotateImg + '\" alt=\"Rotate\" style=\"transform: scale(-1, 1)\"/>',\n        onClick: function() {\n            p.onAngleChange(-15, true);\n        }\n    });\n    BB.makeUnfocusable(leftRotateButton);\n\n    let resetAngleButton = BB.el({\n        tagName: 'button',\n        content: '0°',\n        css: {\n            marginLeft: '10px'\n        },\n        onClick: function() {\n            p.onAngleChange(0);\n        }\n    });\n    BB.makeUnfocusable(resetAngleButton);\n\n    let rightRotateButton = BB.el({\n        tagName: 'button',\n        content: '<img height=\"20\" src=\"' + rotateImg + '\" alt=\"Rotate\"/>',\n        css: {\n            marginLeft: '10px'\n        },\n        onClick: function() {\n            p.onAngleChange(15, true);\n        }\n    });\n    BB.makeUnfocusable(rightRotateButton);\n    row3.append(leftRotateButton, resetAngleButton, rightRotateButton);\n\n\n\n    // --- interface ---\n    this.getElement = function() {\n        return div;\n    };\n    this.setIsVisible = function(pIsVisible) {\n        isVisible = !!pIsVisible;\n        div.style.display = isVisible ? 'block' : 'none';\n        if (isVisible) {\n            update();\n        }\n    };\n    this.update = function(pScale, pAngleDeg) {\n        scale = pScale;\n        angleDeg = pAngleDeg;\n        if (isVisible) {\n            update();\n        }\n    };\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6toXQ\");","import {BB} from '../../../bb/bb';\nimport {KlSlider} from '../base-components/kl-slider';\nimport {Select} from '../base-components/select';\nimport {Checkbox} from '../base-components/checkbox';\nimport {LANG} from '../../../language/language';\n\n/**\n * Paint Bucket tab contents (color slider, opacity slider, etc)\n *\n * p = {\n *     colorSlider: KlColorSlider// when opening tab, inserts it (snatches it from where else it was)\n * }\n *\n * @param p\n * @constructor\n */\nexport function FillUi(p) {\n    let div = BB.el({\n        css: {\n            margin: '10px'\n        }\n    });\n    let isVisible = true;\n\n    let colorDiv = BB.el({\n        parent: div,\n        css: {\n            marginBottom: '10px'\n        }\n    });\n\n    let opacitySlider = new KlSlider({\n        label: LANG('opacity'),\n        width: 250,\n        height: 30,\n        min: 1 / 100,\n        max: 1,\n        value: 1,\n        toValue: (displayValue) => displayValue / 100,\n        toDisplayValue: (value) => value * 100,\n    });\n    div.appendChild(opacitySlider.getElement());\n\n    let toleranceSlider = new KlSlider({\n        label: LANG('bucket-tolerance'),\n        width: 250,\n        height: 30,\n        min: 0,\n        max: 255,\n        value: 20 * (255 / 100),\n        toValue: (displayValue) => displayValue * (255 / 100),\n        toDisplayValue: (value) => value / (255 / 100),\n    });\n    BB.css(toleranceSlider.getElement(), {\n        marginTop: '10px'\n    });\n    div.appendChild(toleranceSlider.getElement());\n\n    let selectRow = BB.el({\n        parent: div,\n        css: {\n            display: 'flex',\n            marginTop: '10px'\n        }\n    });\n\n    let modeWrapper;\n    let modeSelect;\n    modeWrapper = BB.el({\n        content: LANG('bucket-sample') + '&nbsp;',\n        title: LANG('bucket-sample-title'),\n        css: {\n            fontSize: '15px'\n        }\n    });\n    modeSelect = new Select({\n        optionArr: [\n            ['all', LANG('bucket-sample-all')],\n            ['current', LANG('bucket-sample-active')],\n            ['above', LANG('bucket-sample-above')]\n        ],\n        initValue: 'all',\n        onChange: function(val) {}\n    });\n    let modePointerListener = new BB.PointerListener({\n        target: modeSelect.getElement(),\n        onWheel: function(e) {\n            modeSelect.setDeltaValue(e.deltaY);\n        }\n    });\n    modeWrapper.appendChild(modeSelect.getElement());\n    selectRow.appendChild(modeWrapper);\n\n    let growWrapper;\n    let growSelect;\n    growWrapper = BB.el({\n        content: LANG('bucket-grow') + '&nbsp;',\n        title: LANG('bucket-grow-title'),\n        css: {\n            fontSize: '15px',\n            marginLeft: '10px'\n        }\n    });\n    growSelect = new Select({\n        optionArr: [\n            ['0', '0'],\n            ['1', '1'],\n            ['2', '2'],\n            ['3', '3'],\n            ['4', '4'],\n            ['5', '5'],\n            ['6', '6'],\n            ['7', '7'],\n        ],\n        initValue: '0',\n        onChange: function(val) {}\n    });\n    let growPointerListener = new BB.PointerListener({\n        target: growSelect.getElement(),\n        onWheel: function(e) {\n            growSelect.setDeltaValue(e.deltaY);\n        }\n    });\n    growWrapper.appendChild(growSelect.getElement());\n    selectRow.appendChild(growWrapper);\n\n\n    let isContiguous = true;\n    let contiguousToggle = new Checkbox({\n        init: true,\n        label: LANG('bucket-contiguous'),\n        title: LANG('bucket-contiguous-title'),\n        callback: function (b) {\n            isContiguous = b;\n        },\n        css: {\n            paddingRight: '5px',\n            display: 'inline-block',\n            width: '50%',\n        }\n    });\n\n    let eraserToggle = new Checkbox({\n        init: false,\n        label: LANG('eraser'),\n        callback: function (b) {},\n        css: {\n\n            paddingRight: '5px',\n            display: 'inline-block',\n            width: '50%',\n        }\n    });\n\n    div.append(BB.el({\n        content: [\n            contiguousToggle.getElement(),\n            eraserToggle.getElement(),\n        ],\n        css: {\n            display: 'flex',\n            marginTop: '10px',\n        }\n    }));\n\n\n    // --- interface ---\n\n    this.getElement = function() {\n        return div;\n    };\n\n    this.setIsVisible = function(pIsVisible) {\n        isVisible = !!pIsVisible;\n        div.style.display = isVisible ? 'block' : 'none';\n        if (isVisible) {\n            colorDiv.appendChild(p.colorSlider.getElement());\n            colorDiv.appendChild(p.colorSlider.getOutputElement());\n        }\n    };\n\n    this.getTolerance = function() {\n        return toleranceSlider.getValue();\n    };\n\n    this.getOpacity = function() {\n        return opacitySlider.getValue();\n    };\n\n    /**\n     * returns string 'current' | 'all' | 'above'\n     */\n    this.getSample = function() {\n        return modeSelect.getValue();\n    };\n\n    this.getGrow = function() {\n        return parseInt(growSelect.getValue(), 10);\n    }\n\n    this.getContiguous = () => isContiguous;\n\n    this.getIsEraser = () => eraserToggle.getValue();\n\n}","import {BB} from '../../../bb/bb';\nimport {LANG} from '../../../language/language';\n\n/**\n * Text Tool tab contents (color slider)\n *\n * p = {\n *     colorSlider: KlColorSlider// when opening tab, inserts it (snatches it from where else it was)\n * }\n *\n * @param p\n * @constructor\n */\nexport function TextUi(p) {\n    let div = BB.el({\n        css: {\n            margin: '10px'\n        }\n    });\n    let isVisible = true;\n\n    let colorDiv = BB.el({\n        parent: div,\n        css: {\n            marginBottom: '10px'\n        }\n    });\n\n    let hint = BB.el({\n        parent: div,\n        content: LANG('text-instruction'),\n    });\n\n\n    // --- interface ---\n\n    this.getElement = function() {\n        return div;\n    };\n\n    this.setIsVisible = function(pIsVisible) {\n        isVisible = !!pIsVisible;\n        div.style.display = isVisible ? 'block' : 'none';\n        if (isVisible) {\n            colorDiv.appendChild(p.colorSlider.getElement());\n            colorDiv.appendChild(p.colorSlider.getOutputElement());\n            //update();\n        }\n    };\n\n}","import {BB} from '../../../bb/bb';\nimport {Options} from '../base-components/options';\nimport {Checkbox} from '../base-components/checkbox';\nimport {KlSlider} from '../base-components/kl-slider';\nimport {LANG} from '../../../language/language';\n\n/**\n * Shape Tool tab contents\n *\n * p = {\n *     colorSlider: KlColorSlider// when opening tab, inserts it (snatches it from where else it was)\n * }\n *\n * @param p\n * @constructor\n */\nexport function ShapeUi(p) {\n    let div = BB.el({\n        css: {\n            margin: '10px'\n        }\n    });\n    let isVisible = true;\n\n    let colorDiv = BB.el({\n        parent: div,\n        css: {\n            marginBottom: '10px'\n        }\n    });\n\n    let previewSize = 35;\n    let previewPadding = 8;\n    let shape; // 'rect'|'ellipse'|'line'\n    let mode; // 'stroke'|'fill'\n\n\n    let rectStrokeSvgRect = BB.createSvg({\n        elementType: 'rect',\n        x: '' + previewPadding,\n        width: '' + (previewSize - previewPadding * 2)\n    });\n    let rectStrokeSvg = BB.createSvg({\n        elementType: 'svg',\n        width: '' + previewSize,\n        height: '' + previewSize\n    });\n    rectStrokeSvg.appendChild(rectStrokeSvgRect);\n    BB.css(rectStrokeSvg, {\n        display: 'block'\n    });\n\n    let rectFilledSvgRect = BB.createSvg({\n        elementType: 'rect',\n        x: '' + previewPadding,\n        width: '' + (previewSize - previewPadding * 2)\n    });\n    let rectFilledSvg = BB.createSvg({\n        elementType: 'svg',\n        width: '' + previewSize,\n        height: '' + previewSize\n    });\n    rectFilledSvg.appendChild(rectFilledSvgRect);\n    BB.css(rectFilledSvg, {\n        display: 'block'\n    });\n\n\n    let ellipseStrokeSvgEllipse = BB.createSvg({\n        elementType: 'ellipse',\n        cx: '' + (previewSize / 2),\n        cy: '' + (previewSize / 2),\n        rx: '' + (previewSize / 2 - previewPadding)\n    });\n    let ellipseStrokeSvg = BB.createSvg({\n        elementType: 'svg',\n        width: '' + previewSize,\n        height: '' + previewSize,\n    });\n    ellipseStrokeSvg.appendChild(ellipseStrokeSvgEllipse);\n    BB.css(ellipseStrokeSvg, {\n        display: 'block'\n    });\n\n    let ellipseFilledSvgEllipse = BB.createSvg({\n        elementType: 'ellipse',\n        cx: '' + (previewSize / 2),\n        cy: '' + (previewSize / 2),\n        rx: '' + (previewSize / 2 - previewPadding)\n    });\n    let ellipseFilledSvg = BB.createSvg({\n        elementType: 'svg',\n        width: '' + previewSize,\n        height: '' + previewSize,\n    });\n    ellipseFilledSvg.appendChild(ellipseFilledSvgEllipse);\n    BB.css(ellipseFilledSvg, {\n        display: 'block'\n    });\n\n\n    let lineSvgLine = BB.createSvg({\n        elementType: 'line',\n        x1: '' + previewPadding,\n        x2: '' + (previewSize - previewPadding)\n    });\n    let lineSvg = BB.createSvg({\n        elementType: 'svg',\n        width: '' + previewSize,\n        height: '' + previewSize\n    });\n    lineSvg.appendChild(lineSvgLine);\n    BB.css(lineSvg, {\n        display: 'block'\n    });\n\n    function updatePreviews() {\n        let strokeWidth = BB.clamp(Math.round(lineWidthSlider.getValue() / 10), 1, 10) + 'px';\n\n        let squish = 1.35;\n\n        BB.css(rectStrokeSvgRect, { fill: 'none', stroke: 'black', strokeWidth: strokeWidth });\n        BB.css(rectFilledSvgRect, { fill: 'black', stroke: 'none' });\n\n        BB.css(ellipseStrokeSvgEllipse, { fill: 'none', stroke: 'black', strokeWidth: strokeWidth });\n        BB.css(ellipseFilledSvgEllipse, { fill: 'black', stroke: 'none' });\n\n        BB.css(\n            lineSvgLine,\n            { fill: 'none', stroke: 'black', strokeWidth: strokeWidth }\n        );\n\n        if ((fixedToggle as any).getValue()) {\n            rectStrokeSvgRect.setAttribute('y', '' + previewPadding);\n            rectStrokeSvgRect.setAttribute('height', '' + (previewSize - previewPadding * 2));\n            rectFilledSvgRect.setAttribute('y', '' + previewPadding);\n            rectFilledSvgRect.setAttribute('height', '' + (previewSize - previewPadding * 2));\n\n            ellipseStrokeSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding));\n            ellipseFilledSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding));\n        } else {\n            rectStrokeSvgRect.setAttribute('y', '' + (previewPadding * squish));\n            rectStrokeSvgRect.setAttribute('height', '' + (previewSize - previewPadding * squish * 2));\n            rectFilledSvgRect.setAttribute('y', '' + (previewPadding * squish));\n            rectFilledSvgRect.setAttribute('height', '' + (previewSize - previewPadding * squish * 2));\n\n            ellipseStrokeSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding * squish));\n            ellipseFilledSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding * squish));\n        }\n\n        if ((snapToggle as any).getValue()) {\n            lineSvgLine.setAttribute('y1', '' + (previewSize - previewPadding));\n            lineSvgLine.setAttribute('y2', '' + previewPadding);\n        } else {\n            lineSvgLine.setAttribute('y1', '' + (previewSize - previewPadding * squish));\n            lineSvgLine.setAttribute('y2', '' + (previewPadding * squish));\n        }\n    }\n\n    let row1 = BB.el({\n        parent: div,\n        css: {\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'start'\n        }\n    });\n\n    let shapeOptions = new Options({\n        optionArr: [\n            {\n                id: 'rect-stroke',\n                label: rectStrokeSvg,\n                title: LANG('shape-rect') + ' ' + LANG('shape-stroke'),\n            },\n            {\n                id: 'ellipse-stroke',\n                label: ellipseStrokeSvg,\n                title: LANG('shape-ellipse') + ' ' + LANG('shape-stroke'),\n            },\n            {\n                id: 'line',\n                label: lineSvg,\n                title: LANG('shape-line'),\n            },\n            {\n                id: 'rect-fill',\n                label: rectFilledSvg,\n                title: LANG('shape-rect') + ' ' + LANG('shape-fill'),\n            },\n            {\n                id: 'ellipse-fill',\n                label: ellipseFilledSvg,\n                title: LANG('shape-ellipse') + ' ' + LANG('shape-fill'),\n            },\n        ],\n        initId: 'rect',\n        onChange: function(id) {\n            let split = id.split('-');\n            shape = split[0];\n            mode = split[1];\n\n            BB.css(fixedToggle.getElement(), {\n                display: shape === 'line' ? 'none' : null\n            });\n            BB.css(snapToggle.getElement(), {\n                display: shape === 'line' ? null : 'none'\n            });\n            BB.css(lineWidthSlider.getElement(), {\n                display: (shape !== 'line' && mode === 'fill') ? 'none' : null\n            });\n        },\n        changeOnInit: true\n    });\n    shapeOptions.getElement().style.width = '120px';\n    row1.appendChild(shapeOptions.getElement());\n\n    const eraserToggle = new Checkbox({\n        init: false,\n        label: LANG('eraser'),\n        callback: function(b) {\n            updatePreviews();\n        }\n    });\n\n    const lockAlphaToggle = new Checkbox({\n        init: false,\n        label: LANG('lock-alpha'),\n        title: LANG('lock-alpha-title'),\n        callback: (b) => {\n        },\n        doHighlight: true,\n    });\n    lockAlphaToggle.getElement().style.marginTop = '10px';\n\n    row1.append(BB.el({\n        content: [\n            eraserToggle.getElement(),\n            lockAlphaToggle.getElement(),\n        ]\n    }));\n\n    let lineWidthSlider = new KlSlider({\n        label: LANG('shape-line-width'),\n        width: 250,\n        height: 30,\n        min: 1,\n        max: 200,\n        value: 4,\n        curve: 'quadratic',\n        onChange: (val) => {\n            updatePreviews();\n        },\n    });\n    BB.css(lineWidthSlider.getElement(), {\n        marginTop: '10px'\n    });\n    div.appendChild(lineWidthSlider.getElement());\n\n    let opacitySlider = new KlSlider({\n        label: LANG('opacity'),\n        width: 250,\n        height: 30,\n        min: 1 / 100,\n        max: 1,\n        value: 1,\n        toValue: (displayValue) => displayValue / 100,\n        toDisplayValue: (value) => value * 100,\n    });\n    BB.css(opacitySlider.getElement(), {\n        marginTop: '10px'\n    });\n    div.appendChild(opacitySlider.getElement());\n\n    let row2 = BB.el({\n        parent: div,\n        css: {\n            display: 'flex',\n            alignItems: 'center',\n            marginTop: '10px'\n        }\n    });\n\n    let outwardsToggle = new Checkbox({\n        init: false,\n        label: LANG('shape-outwards'),\n        callback: function(b) {},\n        css: {\n            width: '50%',\n            marginRight: '10px',\n        }\n    });\n    row2.appendChild(outwardsToggle.getElement());\n\n    let fixedToggle = new Checkbox({\n        init: false,\n        label: LANG('shape-fixed'),\n        callback: function(b) {\n            updatePreviews();\n        },\n        css: {\n            flexGrow: '1',\n        }\n    });\n    row2.appendChild(fixedToggle.getElement());\n\n    let snapToggle = new Checkbox({\n        init: false,\n        label: LANG('angle-snap'),\n        title: LANG('angle-snap-title'),\n        callback: function(b) {\n            updatePreviews();\n        },\n        css: {\n            flexGrow: '1',\n        }\n    });\n    row2.appendChild(snapToggle.getElement());\n\n\n    updatePreviews();\n\n    // --- interface ---\n\n    this.getElement = function() {\n        return div;\n    };\n\n    this.setIsVisible = function(pIsVisible) {\n        isVisible = !!pIsVisible;\n        div.style.display = isVisible ? 'block' : 'none';\n        if (isVisible) {\n            colorDiv.appendChild(p.colorSlider.getElement());\n            colorDiv.appendChild(p.colorSlider.getOutputElement());\n            //update();\n        }\n    };\n\n    this.getShape = function() {\n        return shape;\n    };\n\n    this.getMode = function() {\n        return mode;\n    };\n\n    this.getIsEraser = function() {\n        return (eraserToggle as any).getValue();\n    };\n\n    this.getOpacity = function() {\n        return opacitySlider.getValue();\n    };\n\n    this.getLineWidth = function() {\n        return lineWidthSlider.getValue();\n    };\n\n    this.getIsOutwards = function() {\n        return (outwardsToggle as any).getValue();\n    };\n\n    this.getIsFixed = function() {\n        return (fixedToggle as any).getValue();\n    };\n\n    this.getIsSnap = function() {\n        return (snapToggle as any).getValue();\n    };\n\n    this.getDoLockAlpha = () => {\n        return lockAlphaToggle.getValue();\n    };\n\n}","import {BB} from '../../../bb/bb';\nimport {Select} from '../base-components/select';\nimport {ColorOptions} from '../base-components/color-options';\nimport {popup} from './popup';\nimport {LANG} from '../../../language/language';\n\n/**\n * P = {\n *     currentColor: RGB, // current color\n *     secondaryColor: RGB,\n *     maxCanvasSize: number,\n *     canvasWidth: number, // current canvas size\n *     canvasHeight: number, // current canvas size\n *     workspaceWidth: number,\n *     workspaceHeight: number,\n *     onConfirm: function(width number, height number, color RGBA),\n *     onCancel: function()\n * }\n *\n * @param p\n */\nexport function newImageDialog(p) {\n\n    let currentColor = p.currentColor;\n    let secondaryColor = p.secondaryColor;\n    let maxCanvasSize = p.maxCanvasSize;\n    let canvasWidth = p.canvasWidth;\n    let canvasHeight = p.canvasHeight;\n    let workspaceWidth = p.workspaceWidth;\n    let workspaceHeight = p.workspaceHeight;\n    let onConfirm = p.onConfirm;\n    let onCancel = p.onCancel;\n\n\n    function createRatioSize(ratioX, ratioY, width, height, padding) {\n        return BB.fitInto(ratioX, ratioY, Math.min(maxCanvasSize, width - padding), Math.min(maxCanvasSize, height - padding), 1);\n    }\n\n    let newImDiv = document.createElement(\"div\");\n    let widthWrapper = document.createElement(\"div\");\n    let heightWrapper = document.createElement(\"div\");\n    let widthInput = document.createElement(\"input\");\n    let widthUnit = document.createElement(\"div\");\n    let heightInput = document.createElement(\"input\");\n    let heightUnit = document.createElement(\"div\");\n    widthWrapper.style.position = \"relative\";\n    widthWrapper.style.width = \"145px\";\n    widthWrapper.style.height = \"35px\";\n    widthWrapper.style.lineHeight = \"30px\";\n    heightWrapper.style.width = \"145px\";\n    heightWrapper.style.height = \"35px\";\n    heightWrapper.style.lineHeight = \"30px\";\n\n    widthUnit.innerText = LANG('new-px');\n    widthUnit.style.color = '#888';\n    widthUnit.style.fontSize = \"12px\";\n    widthUnit.style.marginLeft = \"5px\";\n    widthUnit.style.cssFloat = \"right\";\n\n    heightUnit.innerText = LANG('new-px');\n    heightUnit.style.color = '#888';\n    heightUnit.style.fontSize = \"12px\";\n    heightUnit.style.marginLeft = \"5px\";\n    heightUnit.style.cssFloat = \"right\";\n\n    widthInput.setAttribute('data-ignore-focus', 'true');\n    heightInput.setAttribute('data-ignore-focus', 'true');\n\n    widthInput.type = 'number';\n    widthInput.min = '1';\n    widthInput.max = maxCanvasSize;\n    widthInput.style.cssFloat = \"right\";\n    widthInput.style.width = \"70px\";\n\n    heightInput.type = 'number';\n    heightInput.min = '1';\n    heightInput.max = maxCanvasSize;\n    heightInput.style.cssFloat = \"right\";\n    heightInput.style.width = \"70px\";\n    widthInput.value = canvasWidth;\n    heightInput.value = canvasHeight;\n    widthInput.onclick = function () {\n        (this as any).focus();\n        updateRatio();\n    };\n    heightInput.onclick = function () {\n        (this as any).focus();\n        updateRatio();\n    };\n    widthWrapper.appendChild(widthUnit);\n    widthWrapper.appendChild(widthInput);\n    BB.appendTextDiv(widthWrapper, LANG('width') + \": \");\n    heightWrapper.appendChild(heightUnit);\n    heightWrapper.appendChild(heightInput);\n    BB.appendTextDiv(heightWrapper, LANG('height') + \": \");\n    let ratioWrapper = document.createElement(\"div\");\n    ratioWrapper.style.marginTop = '5px';\n    ratioWrapper.style.color = '#888';\n\n    let templateWrapper = document.createElement(\"div\");\n    //BB.appendTextDiv(templateWrapper, \"Preset Resolutions: <br />\");\n    let presetFitBtn = document.createElement(\"button\");\n    templateWrapper.style.marginBottom = \"10px\";\n    let presetCurrentBtn = document.createElement(\"button\");\n    let presetSquareBtn = document.createElement(\"button\");\n    let presetLandscapeBtn = document.createElement(\"button\");\n    let presetPortraitBtn = document.createElement(\"button\");\n    let presetOversizeBtn = document.createElement(\"button\");\n\n    presetCurrentBtn.textContent = LANG('new-current');\n    presetFitBtn.textContent = LANG('new-fit');\n    presetOversizeBtn.textContent = LANG('new-oversize');\n    presetLandscapeBtn.textContent = LANG('new-landscape');\n    presetPortraitBtn.textContent = LANG('new-portrait');\n    presetSquareBtn.textContent = LANG('new-square');\n\n    presetCurrentBtn.style.marginRight = \"5px\";\n    presetFitBtn.style.marginRight = \"5px\";\n    presetOversizeBtn.style.marginRight = \"5px\";\n    presetLandscapeBtn.style.marginTop = \"5px\";\n    presetLandscapeBtn.style.marginRight = \"5px\";\n    presetPortraitBtn.style.marginTop = \"5px\";\n    presetPortraitBtn.style.marginRight = \"5px\";\n\n    templateWrapper.appendChild(presetCurrentBtn);\n    templateWrapper.appendChild(presetFitBtn);\n    templateWrapper.appendChild(presetOversizeBtn);\n    templateWrapper.appendChild(presetSquareBtn);\n    templateWrapper.appendChild(presetLandscapeBtn);\n    templateWrapper.appendChild(presetPortraitBtn);\n\n    let templatePadding = 0;\n\n    presetCurrentBtn.onclick = function () {\n        widthInput.value = canvasWidth;\n        heightInput.value = canvasHeight;\n        updateRatio();\n    };\n    presetFitBtn.onclick = function () {\n        widthInput.value = workspaceWidth;\n        heightInput.value = workspaceHeight;\n        updateRatio();\n    };\n    presetOversizeBtn.onclick = function () {\n        widthInput.value = workspaceWidth + 500;\n        heightInput.value = workspaceHeight + 500;\n        updateRatio();\n    };\n    presetSquareBtn.onclick = function () {\n        let sizeObj = createRatioSize(1, 1, workspaceWidth, workspaceHeight, templatePadding);\n        widthInput.value = '' + Math.round(sizeObj.width);\n        heightInput.value = '' + Math.round(sizeObj.height);\n        updateRatio();\n    };\n    presetLandscapeBtn.onclick = function () {\n        let sizeObj = createRatioSize(4, 3, workspaceWidth, workspaceHeight, templatePadding);\n        widthInput.value = '' + Math.round(sizeObj.width);\n        heightInput.value = '' + Math.round(sizeObj.height);\n        updateRatio();\n    };\n    presetPortraitBtn.onclick = function () {\n        let sizeObj = createRatioSize(3, 4, workspaceWidth, workspaceHeight, templatePadding);\n        widthInput.value = '' + Math.round(sizeObj.width);\n        heightInput.value = '' + Math.round(sizeObj.height);\n        updateRatio();\n    };\n\n    let select = new Select({\n        isFocusable: true,\n        optionArr: [\n            ['screen', LANG('new-screen')],\n            ['16 9', LANG('new-video') + ' 16:9'],\n            ['3 2', '3:2'],\n            ['5 3', '5:3'],\n            ['2 1', '2:1'],\n            ['paper', LANG('new-din-paper') + ' √2:1'],\n            ['9 16', '9:16'],\n            ['2 3', '2:3'],\n            ['3 5', '3:5'],\n            ['1 2', '1:2'],\n            ['1 1.4142135623730951', '1:√2']\n        ],\n        onChange: function(val) {\n            if (val === 'screen') {\n                widthInput.value = '' + window.screen.width;\n                heightInput.value = '' + window.screen.height;\n            } else if (val === 'paper') {\n                let sizeObj = createRatioSize(Math.sqrt(2), 1, workspaceWidth, workspaceHeight, templatePadding);\n                widthInput.value = '' + Math.round(sizeObj.width);\n                heightInput.value = '' + Math.round(sizeObj.height);\n            } else {\n                let split = val.split(' ');\n                let sizeObj = createRatioSize(parseFloat(split[0]), parseFloat(split[1]), workspaceWidth, workspaceHeight, templatePadding);\n                widthInput.value = '' + Math.round(sizeObj.width);\n                heightInput.value = '' + Math.round(sizeObj.height);\n            }\n            updateRatio();\n            select.setValue(null);\n        }\n    });\n    setTimeout(() => {\n        // safari: not empty without also setting it to null via timeout\n        select.setValue(null);\n    }, 0);\n    BB.css(select.getElement(), {\n        width: '80px',\n    });\n    templateWrapper.appendChild(select.getElement());\n\n\n\n    let backgroundRGBA = {r: 255, g: 255, b: 255, a: 1};\n\n    let colorOptionsArr = [\n        {r: 255, g: 255, b: 255, a: 1},\n        {r: 0, g: 0, b: 0, a: 1},\n        {r: 0, g: 0, b: 0, a: 0}\n    ];\n    colorOptionsArr.push({\n        r: currentColor.r,\n        g: currentColor.g,\n        b: currentColor.b,\n        a: 1\n    });\n    colorOptionsArr.push({\n        r: secondaryColor.r,\n        g: secondaryColor.g,\n        b: secondaryColor.b,\n        a: 1\n    });\n\n    let colorOptions = new ColorOptions({\n        colorArr: colorOptionsArr,\n        onChange: function(rgbaObj) {\n            backgroundRGBA = rgbaObj;\n            preview.style.backgroundColor = \"rgba(\" + rgbaObj.r + \",\" + rgbaObj.g + \",\" + rgbaObj.b + \", \" + rgbaObj.a + \")\";\n        }\n    });\n\n    let previewWrapper = document.createElement(\"div\");\n    BB.css(previewWrapper, {\n        boxSizing: 'border-box',\n        width: '340px',\n        height: '140px',\n        display: 'table',\n        backgroundColor: '#9e9e9e',\n        padding: '10px',\n        marginTop: '10px',\n        boxShadow: 'rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset',\n        marginLeft: '-20px',\n        colorScheme: 'only light',\n    });\n    let preview = document.createElement(\"div\");\n    BB.css(preview, {\n        width: 200 + \"px\",\n        height: 100 + \"px\",\n        backgroundColor: \"#fff\",\n        marginLeft: \"auto\",\n        marginRight: \"auto\",\n        color: \"#aaa\",\n        fontSize: \"16px\",\n        fontWeight: \"bold\",\n        textAlign: \"center\",\n        verticalAlign: \"center\",\n        display: \"table\",\n        overflow: \"hidden\",\n        boxShadow: \"0px 0px 3px rgba(0,0,0,0.5)\"\n    });\n    let previewcell = document.createElement(\"div\");\n    previewcell.style.display = \"table-cell\";\n    previewcell.style.verticalAlign = \"middle\";\n    previewcell.appendChild(preview);\n    previewWrapper.appendChild(previewcell);\n    let cell = BB.appendTextDiv(preview, \"\");\n    //let ratio = BB.appendTextDiv(cell, \"1:2\");\n    cell.style.display = \"table-cell\";\n    cell.style.verticalAlign = \"middle\";\n    let prevW = parseInt(widthInput.value);\n    let prevH = parseInt(heightInput.value);\n\n    function updateRatio() {\n        widthInput.value = '' + Math.min(maxCanvasSize, parseInt(widthInput.value));\n        heightInput.value = '' + Math.min(maxCanvasSize, parseInt(heightInput.value));\n\n        function HCF(u, v) {\n            let U = u, V = v;\n            while (true) {\n                if (!(U %= V))\n                    return V;\n                if (!(V %= U))\n                    return U;\n            }\n        }\n\n        let w = parseInt(widthInput.value);\n        let h = parseInt(heightInput.value);\n        if (w < 1 || w > maxCanvasSize || h < 1 || h > maxCanvasSize) {\n            if (w > maxCanvasSize)\n                w = maxCanvasSize;\n            else if (h > maxCanvasSize)\n                h = maxCanvasSize;\n\n            widthInput.value = '' + w;\n            heightInput.value = '' + h;\n        }\n\n        //generated canvas size doesn't always match ratio. so check if a common ratio is very close\n        let commonRatios = [\n            [1, 2], [2, 1],\n            [2, 3], [3, 2],\n            [3, 4], [4, 3],\n            [4, 5], [5, 4],\n            [16, 9], [9, 16],\n            [3, 2], [2, 3],\n            [5, 3], [3, 5],\n            [2, 1], [1, 2],\n            [1.414, 1], [1, 1.414],\n        ];\n        let reducedArr = BB.reduce(w, h);\n        let closestRatio = null;\n        let closestDistance = null;\n        for (let i = 0; i < commonRatios.length; i++) {\n            if (i === 0 || Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]) < closestDistance) {\n                closestRatio = commonRatios[i];\n                closestDistance = Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]);\n            }\n        }\n        //display ratio\n        if (closestDistance > 0 && closestDistance < 0.005) {\n            ratioWrapper.innerText = LANG('new-ratio') + ': ~' + closestRatio[0] + ':' + closestRatio[1];\n        } else {\n            ratioWrapper.innerText = LANG('new-ratio') + ': ' + reducedArr[0] + ':' + reducedArr[1];\n        }\n\n        prevW = w;\n        prevH = h;\n        let realw = w;\n        let T = HCF(w, h);\n        w /= T;\n        h /= T;\n        w *= 260;\n        h *= 260;\n        if (w > 260) {\n            h = 260 / w * h;\n            w = 260;\n        }\n        if (h > 100) {\n            w = 100 / h * w;\n            h = 100;\n\n        }\n\n        preview.style.width = w + \"px\";\n        preview.style.height = h + \"px\";\n        BB.createCheckerDataUrl(parseInt('' + (30 * (w / realw))), function (url) {\n            previewWrapper.style.background = \"url(\" + url + \")\";\n        });\n    }\n\n    widthInput.onchange = function () {\n        if (widthInput.value === '' || parseInt(widthInput.value) < 0) {\n            widthInput.value = '1';\n        }\n        updateRatio();\n    };\n    widthInput.onkeyup = function () {\n        updateRatio();\n    };\n    heightInput.onchange = function () {\n        if (heightInput.value === '' || parseFloat(heightInput.value) < 0) {\n            heightInput.value = '1';\n        }\n        updateRatio();\n    };\n    heightInput.onkeyup = function () {\n        updateRatio();\n    };\n    updateRatio();\n\n    newImDiv.appendChild(templateWrapper);\n    let secondRow = BB.el({\n        parent: newImDiv,\n        css: {\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'flex-end'\n        }\n    });\n    let secondRowLeft = BB.el({\n        parent: secondRow\n    });\n    secondRowLeft.appendChild(widthWrapper);\n    secondRowLeft.appendChild(heightWrapper);\n    secondRowLeft.appendChild(ratioWrapper);\n    secondRow.appendChild(colorOptions.getElement());\n\n    newImDiv.appendChild(previewWrapper);\n\n    popup({\n        target: document.body,\n        message: `<b>${LANG('new-title')}</b>`,\n        div: newImDiv,\n        buttons: ['Ok', 'Cancel'],\n        callback: function (result) {\n            widthInput.onclick = null;\n            heightInput.onclick = null;\n            presetCurrentBtn.onclick = null;\n            presetFitBtn.onclick = null;\n            presetOversizeBtn.onclick = null;\n            presetSquareBtn.onclick = null;\n            presetLandscapeBtn.onclick = null;\n            presetPortraitBtn.onclick = null;\n            widthInput.onchange = null;\n            widthInput.onkeyup = null;\n            heightInput.onchange = null;\n            heightInput.onkeyup = null;\n            select.destroy();\n            colorOptions.destroy();\n\n            if (result === \"Cancel\" || parseInt(widthInput.value) <= 0 || parseInt(heightInput.value) <= 0 || isNaN(parseInt(widthInput.value)) || isNaN(parseInt(heightInput.value))) {\n                onCancel();\n                return;\n            }\n            onConfirm(parseInt(widthInput.value), parseInt(heightInput.value), backgroundRGBA);\n        },\n        clickOnEnter: 'Ok'\n    });\n\n}","import {BB} from '../../../bb/bb';\n// @ts-ignore\nimport collapseImg from 'url:~/src/app/img/ui/ui-collapse.svg';\nimport {LANG} from \"../../../language/language\";\n\n/**\n * button that allows to collapse toolspace (for mobile)\n *\n * p = {\n *     onChange: function()\n * }\n *\n * @param p\n * @constructor\n */\nexport function ToolspaceCollapser(p) {\n    let isOpen = true;\n    let directionStr = 'right'; // 'left' | 'right'\n\n    function update() {\n        if (directionStr === 'left') {\n            icon.style.transform = isOpen ? 'rotate(180deg)' : '';\n        } else {\n            icon.style.transform = isOpen ? '' : 'rotate(180deg)';\n        }\n    }\n\n    let div = BB.el({\n        css: {\n            width: '36px',\n            height: '36px',\n            background: 'rgba(100, 100, 100, 0.9)',\n            color: '#fff',\n            position: 'absolute',\n            top: '0',\n            textAlign: 'center',\n            lineHeight: '36px',\n            cursor: 'pointer',\n            userSelect: 'none',\n            padding: '6px',\n            boxSizing: 'border-box'\n        },\n        title: LANG('toggle-show-tools'),\n        onClick: function(e) {\n            e.preventDefault();\n            isOpen = !isOpen;\n            update();\n            p.onChange();\n        }\n    });\n\n    let icon = BB.el({\n        parent: div,\n        css: {\n            backgroundImage: `url(${collapseImg})`,\n            width: '100%',\n            height: '100%',\n            backgroundSize: 'contain',\n            backgroundRepeat: 'no-repeat',\n            backgroundPosition: 'center',\n            userSelect: 'none'\n        }\n    });\n    div.oncontextmenu = function () {\n        return false;\n    };\n\n    // --- interface ---\n    this.isOpen = function() {\n        return isOpen;\n    };\n\n    /**\n     *\n     * @param dirStr\n     */\n    this.setDirection = function(dirStr) {\n        directionStr = dirStr;\n        update();\n    };\n\n    this.getElement = function() {\n        return div;\n    };\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"b1UMP\");","import {BB} from '../../../bb/bb';\nimport {renderText} from '../../image-operations/render-text';\nimport {ColorOptions} from '../base-components/color-options';\nimport {Select} from '../base-components/select';\nimport {ImageRadioList} from '../base-components/image-radio-list';\nimport {ImageToggle} from '../base-components/image-toggle';\nimport {KlSlider} from '../base-components/kl-slider';\nimport {popup} from './popup';\n// @ts-ignore\nimport alignLeftImg from 'url:~/src/app/img/ui/align-left.svg';\n// @ts-ignore\nimport alignCenterImg from 'url:~/src/app/img/ui/align-center.svg';\n// @ts-ignore\nimport alignRightImg from 'url:~/src/app/img/ui/align-right.svg';\n// @ts-ignore\nimport typoItalicImg from 'url:~/src/app/img/ui/typo-italic.svg';\n// @ts-ignore\nimport typoBoldImg from 'url:~/src/app/img/ui/typo-bold.svg';\n// @ts-ignore\nimport toolZoomInImg from 'url:~/src/app/img/ui/tool-zoom-in.svg';\n// @ts-ignore\nimport toolZoomOutImg from 'url:~/src/app/img/ui/tool-zoom-out.svg';\nimport {IRGB} from '../../kl.types';\nimport {KlCanvas} from '../../canvas/kl-canvas';\nimport {LANG} from '../../../language/language';\n\n/**\n * Text Tool dialog\n *\n * confirmP = {\n *     x: number,\n *     y: number,\n *     textStr: string,\n *     align: 'left' | 'center' | 'right',\n *     isItalic: boolean,\n *     isBold: boolean,\n *     color: rgb,\n *     size: number, // px\n *     font: 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy',\n *     opacity: number, // 0 - 1\n * }\n *\n * @param p\n */\nexport function textToolDialog(\n    p: {\n        klCanvas: KlCanvas;\n        layerIndex: number;\n        x: number;\n        y: number;\n        angleRad: number;\n        color: IRGB;\n        secondaryColor: IRGB;\n        size: number; // px\n        align: 'left' | 'center' | 'right'; // default 'left'\n        isBold: boolean; // default false\n        isItalic: boolean; // default false\n        font: 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy'; // default sans-serif\n        opacity: number; // 0 - 1; default 1\n        onConfirm: (confirmP) => void;\n    }\n) {\n\n    let div = BB.el({});\n\n    let isSmallWidth = window.innerWidth < 550;\n    let isSmallHeight = window.innerHeight < 630;\n\n    // --- preview ---\n    // Text drawn on klCanvas-sized canvas: textCanvas\n    // LayerArr[target].canvas & textCanvas then drawn on targetCanvas\n    //      they are transformed. canvas size of final preview\n    // All layers and targetCanvas drawn on layersCanvas. transformed and size of final preview\n    // Checkerboard, layersCanvas, and outline then drawn on previewCanvas\n\n    let width = isSmallWidth ? 340 : 540;\n    let height = isSmallWidth ? (isSmallHeight ? 210 : 260) : (isSmallHeight ? 230 : 350);\n    let scale = 1;\n\n    let layerArr = p.klCanvas.getLayersFast();\n    let textCanvas = BB.canvas(p.klCanvas.getWidth(), p.klCanvas.getHeight());\n    let textCtx = textCanvas.getContext('2d');\n    let targetCanvas = BB.canvas(width, height);\n    let targetCtx = targetCanvas.getContext('2d');\n    let layersCanvas = BB.canvas(width, height);\n    let layersCtx = layersCanvas.getContext('2d');\n    let previewCanvas = BB.canvas(width, height); // the one that is visible\n    let previewCtx = previewCanvas.getContext('2d');\n    BB.css(previewCanvas, {\n        display: 'block'\n    });\n    let previewWrapper = BB.el({\n        parent: div,\n        css: {\n            position: 'relative',\n            width: width + 'px',\n            marginLeft: '-20px',\n            cursor: 'move',\n            colorScheme: 'only light',\n            touchAction: 'none',\n        },\n        onClick: function() {\n            textInput.focus();\n        }\n    });\n    BB.el({ // inset shadow on preview\n        parent: previewWrapper,\n        css: {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n            right: '0',\n            bottom: '0',\n            boxShadow: 'rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset',\n            pointerEvents: 'none',\n        }\n    });\n    previewWrapper.appendChild(previewCanvas);\n    let checkerPattern = previewCtx.createPattern(BB.createCheckerCanvas(8), 'repeat');\n    let emptyCanvas = BB.canvas(1, 1);\n    {\n        let ctx = emptyCanvas.getContext('2d');\n        ctx.fillRect(0, 0, 1, 1);\n    }\n\n    function updatePreview() {\n\n        // try to draw very much like klCanvasWorkspace\n\n        // --- draw text ---\n        textCtx.clearRect(0, 0, textCanvas.width, textCanvas.height);\n        let colorRGBA = {\n            ...p.color,\n            a: opacitySlider.getValue(),\n        };\n        let bounds = renderText(textCanvas, {\n            x: p.x,\n            y: p.y,\n            textStr: textInput.value,\n            align: alignRadioList.getValue(),\n            isItalic: italicToggle.getValue(),\n            isBold: boldToggle.getValue(),\n            size: parseFloat(sizeInput.value),\n            font: fontSelect.getValue(),\n            color: BB.ColorConverter.toRgbaStr(colorRGBA),\n            angleRad: p.angleRad\n        });\n\n\n        // --- determine transformation of viewport ---\n        // text should always be visible\n        bounds.width = Math.max(bounds.width, 1);\n        bounds.height = Math.max(bounds.height, 1);\n        let rotatedXY = BB.rotate(bounds.x, bounds.y, -p.angleRad / Math.PI * 180);\n        let rotatedWH = BB.rotate(bounds.width, bounds.height, -p.angleRad / Math.PI * 180);\n        let centerX = p.x + rotatedXY.x + rotatedWH.x / 2;\n        let centerY = p.y + rotatedXY.y + rotatedWH.y / 2;\n\n        let padding = 100;\n        let fitBounds = BB.fitInto(bounds.width, bounds.height, width - padding, height - padding);\n        scale = Math.min(1, fitBounds.width / bounds.width);\n        scale = Math.min(4, scale * Math.pow(2, zoomFac));\n\n\n        // --- compose text and target layer ---\n        targetCtx.save();\n\n        if (scale >= 4) {\n            targetCtx.imageSmoothingEnabled = false;\n        } else {\n            targetCtx.imageSmoothingEnabled = true;\n            targetCtx.imageSmoothingQuality  = scale >= 1 ? 'low' : 'medium';\n        }\n\n        targetCtx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);\n        targetCtx.translate(width / 2, height / 2);\n        targetCtx.scale(scale, scale);\n        targetCtx.rotate(p.angleRad);\n        targetCtx.drawImage(layerArr[p.layerIndex].canvas, -centerX, -centerY);\n        targetCtx.drawImage(textCanvas, -centerX, -centerY);\n        targetCtx.restore();\n\n\n        // --- layers ---\n        layersCtx.save();\n\n        layersCtx.fillStyle = 'rgb(158,158,158)';\n        layersCtx.fillRect(0, 0, width, height);\n\n        { // bg\n            layersCtx.save();\n\n            layersCtx.translate(width / 2, height / 2);\n            layersCtx.scale(scale, scale);\n            layersCtx.rotate(p.angleRad);\n\n            layersCtx.imageSmoothingEnabled = false;\n\n            //outline\n            let borderSize = 1 / scale;\n            layersCtx.globalAlpha = 0.2;\n            layersCtx.drawImage(emptyCanvas, -centerX - borderSize, -centerY - borderSize, textCanvas.width + borderSize * 2, textCanvas.height + borderSize * 2);\n            layersCtx.globalAlpha = 1;\n\n            //erase\n            layersCtx.globalCompositeOperation = 'destination-out';\n            layersCtx.drawImage(emptyCanvas, -centerX, -centerY, textCanvas.width, textCanvas.height);\n\n            layersCtx.restore();\n        }\n\n        { // individual layers\n\n            if (scale >= 4) {\n                layersCtx.imageSmoothingEnabled = false;\n            } else {\n                layersCtx.imageSmoothingEnabled = true;\n                layersCtx.imageSmoothingQuality  = scale >= 1 ? 'low' : 'medium';\n            }\n\n            // layers below\n            layersCtx.save();\n            layersCtx.translate(width / 2, height / 2);\n            layersCtx.scale(scale, scale);\n            layersCtx.rotate(p.angleRad);\n            for (var i = 0; i < p.layerIndex; i++) {\n                if (layerArr[i].opacity > 0) {\n                    layersCtx.globalAlpha = layerArr[i].opacity;\n                    layersCtx.globalCompositeOperation = layerArr[i].mixModeStr;\n                    layersCtx.drawImage(layerArr[i].canvas, -centerX, -centerY);\n                }\n            }\n            layersCtx.restore();\n\n            // target layer\n            layersCtx.globalAlpha = layerArr[p.layerIndex].opacity;\n            layersCtx.globalCompositeOperation = layerArr[p.layerIndex].mixModeStr;\n            layersCtx.drawImage(targetCanvas, 0, 0);\n\n            // layers above\n            layersCtx.save();\n            layersCtx.translate(width / 2, height / 2);\n            layersCtx.scale(scale, scale);\n            layersCtx.rotate(p.angleRad);\n            for (let i = p.layerIndex + 1; i < layerArr.length; i++) {\n                if (layerArr[i].opacity > 0) {\n                    layersCtx.globalAlpha = layerArr[i].opacity;\n                    layersCtx.globalCompositeOperation = layerArr[i].mixModeStr;\n                    layersCtx.drawImage(layerArr[i].canvas, -centerX, -centerY);\n                }\n            }\n            layersCtx.restore();\n\n        }\n\n        layersCtx.restore();\n\n\n\n        // --- final composite ---\n        previewCtx.save();\n        previewCtx.fillStyle = checkerPattern;\n        previewCtx.fillRect(0, 0, previewCanvas.width, previewCanvas.height);\n        previewCtx.drawImage(layersCanvas, 0, 0);\n        previewCtx.restore();\n\n        // bounds\n        previewCtx.save();\n        previewCtx.globalCompositeOperation = 'difference';\n        previewCtx.strokeStyle = '#fff';\n        previewCtx.lineWidth = 1;\n        // centerX = p.x + bounds.x + bounds.width / 2;\n        // centerY = p.y + bounds.y + bounds.height / 2;\n        previewCtx.strokeRect(\n            Math.round(width / 2 - (bounds.width / 2) * scale),\n            Math.round(height / 2 - (bounds.height / 2) * scale),\n            Math.round(bounds.width * scale),\n            Math.round(bounds.height * scale)\n        );\n        previewCtx.restore();\n\n    }\n\n    function move(x, y) {\n        let rotated = BB.rotate(x, y, -p.angleRad / Math.PI * 180);\n        p.x += rotated.x / scale;\n        p.y += rotated.y / scale;\n        updatePreview();\n    }\n\n    let previewPointerListener = new BB.PointerListener({\n        target: previewCanvas,\n        pointers: 1,\n        onPointer: function(e) {\n            if (e.type === 'pointermove' && e.button) {\n                e.eventPreventDefault();\n                move(-e.dX, -e.dY);\n            }\n        },\n        onWheel: function(e) {\n            changeZoomFac(-e.deltaY);\n        }\n    });\n\n    const wheelPrevent = (event) => {\n        event.preventDefault();\n    }\n    BB.addEventListener(previewCanvas, 'wheel', wheelPrevent);\n\n\n\n    let row1 = BB.el({\n        parent: div,\n        css: {\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'center',\n            marginTop: '10px'\n        }\n    });\n    let row2n3Wrapper = BB.el({\n        parent: div,\n        css: isSmallWidth ? {} : {\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'space-between'\n        }\n    });\n    let row2 = BB.el({\n        parent: row2n3Wrapper,\n        css: {\n            display: 'flex',\n            alignItems: 'center',\n            marginTop: '5px'\n        }\n    });\n    let row3 = BB.el({\n        parent: row2n3Wrapper,\n        css: {\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'space-between',\n            marginTop: '5px',\n            width: isSmallWidth ? '' : '300px'\n        }\n    });\n\n    // --- row 1 ---\n\n    // color\n    let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\n    let colorOptionsArr = [\n        {r: 0, g: 0, b: 0, a: 1},\n        {r: 255, g: 255, b: 255, a: 1}\n    ];\n    colorOptionsArr.unshift({\n        r: p.secondaryColor.r,\n        g: p.secondaryColor.g,\n        b: p.secondaryColor.b,\n        a: 1,\n    });\n    colorOptionsArr.unshift({\n        r: p.color.r,\n        g: p.color.g,\n        b: p.color.b,\n        a: 1,\n    });\n\n    let colorOptions = new ColorOptions({\n        colorArr: colorOptionsArr,\n        initialIndex: 0,\n        onChange: function(rgbaObj) {\n            p.color = rgbaObj;\n            updatePreview();\n        }\n    });\n    colorOptions.getElement().title = LANG('text-color');\n    colorOptions.getElement().style.marginLeft = '-5px';\n    row1.appendChild(colorOptions.getElement());\n\n\n    let zoomFac = 0;\n    function changeZoomFac(d) {\n        zoomFac = Math.min(2, Math.max(-2, zoomFac + d));\n        updatePreview();\n        zoomInBtn.disabled = !canZoom(1);\n        zoomOutBtn.disabled = !canZoom(-1);\n    }\n    function canZoom(d) {\n        return zoomFac !== Math.min(2, Math.max(-2, zoomFac + d));\n    }\n\n    let zoomWrapper = BB.el({\n        parent: row1,\n        css: {\n\n        }\n    })\n\n    let zoomInBtn = BB.el({\n        parent: zoomWrapper,\n        content: `<img height=\"20\" src=\"${toolZoomInImg}\">`,\n        title: LANG('zoom-in'),\n        tagName: 'button',\n        onClick: function() {\n            changeZoomFac(1);\n        },\n        css: {\n            fontWeight: 'bold'\n        }\n    }) as HTMLButtonElement;\n    let zoomOutBtn = BB.el({\n        parent: zoomWrapper,\n        content: `<img height=\"20\" src=\"${toolZoomOutImg}\">`,\n        title: LANG('zoom-out'),\n        tagName: 'button',\n        onClick: function() {\n            changeZoomFac(-1);\n        },\n        css: {\n            fontWeight: 'bold',\n            marginLeft: '5px'\n        }\n    }) as HTMLButtonElement;\n\n\n\n    // --- row 2 ---\n    let sizeInput = BB.el({\n        parent: row2,\n        tagName: 'input',\n        title: LANG('text-size'),\n        custom: {\n            type: 'number',\n            min: 1,\n            max: 10000,\n            value: p.size\n        },\n        css: {\n            width: '60px'\n        },\n        onChange: function() {\n            sizeInput.value = '' + Math.max(1, Math.min(10000, parseInt(sizeInput.value)));\n            updatePreview();\n        }\n    }) as HTMLInputElement;\n    let sizePointerListener = new BB.PointerListener({\n        target: sizeInput,\n        onWheel: function(e) {\n            sizeInput.value = '' + Math.max(1, Math.min(1000, parseInt(sizeInput.value) - e.deltaY));\n            updatePreview();\n        }\n    });\n\n    let modeWrapper;\n    let fontSelect;\n    let fontPointerListener;\n    {\n        modeWrapper = BB.el({\n            css: {\n                fontSize: '15px',\n                marginLeft: '10px'\n            }\n        });\n        fontSelect = new Select({\n            isFocusable: true,\n            optionArr: [\n                ['sans-serif', 'Sans-serif'],\n                ['serif', 'Serif'],\n                ['monospace', 'Monospace'],\n                ['cursive', 'Cursive'],\n                ['fantasy', 'Fantasy'],\n            ],\n            initValue: p.font,\n            onChange: function(val) {\n                updatePreview();\n            },\n        });\n\n        modeWrapper.appendChild(fontSelect.getElement());\n        row2.appendChild(modeWrapper);\n\n        fontPointerListener = new BB.PointerListener({\n            target: fontSelect.getElement(),\n            onWheel: function(e) {\n                fontSelect.setDeltaValue(e.deltaY);\n            }\n        });\n\n    }\n\n\n    // --- row 3 ---\n\n    let alignRadioList = new ImageRadioList({\n        optionArr: [\n            {\n                id: 'left',\n                title: LANG('text-left'),\n                image: alignLeftImg,\n            },\n            {\n                id: 'center',\n                title: LANG('text-center'),\n                image: alignCenterImg,\n            },\n            {\n                id: 'right',\n                title: LANG('text-right'),\n                image: alignRightImg,\n            }\n        ],\n        initId: p.align,\n        onChange: function(id) {\n            updatePreview();\n        }\n    });\n    row3.appendChild(alignRadioList.getElement());\n\n    let italicToggle = new ImageToggle({\n        image: typoItalicImg,\n        title: LANG('text-italic'),\n        initValue: p.isItalic,\n        onChange: function(b) {\n            updatePreview();\n        }\n    });\n    row3.appendChild(italicToggle.getElement());\n\n    let boldToggle = new ImageToggle({\n        image: typoBoldImg,\n        title: LANG('text-bold'),\n        initValue: p.isBold,\n        onChange: function(b) {\n            updatePreview();\n        }\n    });\n    row3.appendChild(boldToggle.getElement());\n\n\n\n    let opacitySlider = new KlSlider({\n        label: LANG('opacity'),\n        width: 150,\n        height: 30,\n        min: 1 / 100,\n        max: 1,\n        value: p.opacity,\n        resolution: 225,\n        eventResMs: 1000 / 30,\n        toValue: (displayValue) => displayValue / 100,\n        toDisplayValue: (value) => value * 100,\n        onChange: function(v) {\n            updatePreview();\n        },\n    });\n    row3.appendChild(opacitySlider.getElement());\n\n\n\n    let textInput = BB.el({\n        parent: div,\n        tagName: 'textarea',\n        custom: {\n            placeholder: LANG('text-placeholder'),\n            'data-ignore-focus': 'true',\n        },\n        css: {\n            whiteSpace: 'pre',\n            overflow: 'auto',\n            width: '100%',\n            height: '70px',\n            resize: 'vertical',\n            marginTop: '10px'\n        },\n        onChange: function() {\n            updatePreview();\n        }\n    }) as HTMLTextAreaElement;\n    textInput.addEventListener('input', updatePreview);\n    setTimeout(function() {\n        textInput.focus();\n        textInput.select();\n    });\n    let closefunc;\n    let keyListener = new BB.KeyListener({\n        onDown: function(keyStr, e, comboStr) {\n            if (BB.isInputFocused(true)) {\n                return;\n            }\n            if (keyStr === 'left') {\n                move(-1, 0);\n            }\n            if (keyStr === 'right') {\n                move(1, 0);\n            }\n            if (keyStr === 'up') {\n                move(0, -1);\n            }\n            if (keyStr === 'down') {\n                move(0, 1);\n            }\n        }\n    });\n\n    // prevent mobile keyboards scrolling page\n    function onScroll() {\n        window.scrollTo(0, 0);\n    }\n    window.addEventListener('scroll', onScroll);\n\n\n    popup({\n        target: document.body,\n        message: `<b>${LANG('text-title')}</b>`,\n        div: div,\n        buttons: [\"Ok\", \"Cancel\"],\n        style: isSmallWidth ? {} : {\n            width: '500px'\n        },\n        callback: function(val) {\n            let result = {\n                x: p.x,\n                y: p.y,\n                textStr: textInput.value,\n                align: alignRadioList.getValue(),\n                isItalic: italicToggle.getValue(),\n                isBold: boldToggle.getValue(),\n                color: p.color,\n                size: sizeInput.value,\n                font: fontSelect.getValue(),\n                opacity: opacitySlider.getValue(),\n            };\n\n            window.removeEventListener('scroll', onScroll);\n            textInput.removeEventListener('input', updatePreview);\n            BB.destroyEl(textInput);\n            previewPointerListener.destroy();\n            sizePointerListener.destroy();\n            fontPointerListener.destroy();\n            BB.removeEventListener(previewCanvas, 'wheel', wheelPrevent);\n            BB.destroyEl(previewWrapper);\n            BB.destroyEl(zoomInBtn);\n            BB.destroyEl(zoomOutBtn);\n            BB.destroyEl(sizeInput);\n            colorOptions.destroy();\n            fontSelect.destroy();\n            keyListener.destroy();\n            alignRadioList.destroy();\n            italicToggle.destroy();\n            boldToggle.destroy();\n            opacitySlider.destroy();\n            if (val === 'Ok') {\n                p.onConfirm(result);\n            }\n        },\n        autoFocus: false,\n        clickOnEnter: 'Ok',\n        ignoreBackground: true,\n        closefunc: function (func) {\n            closefunc = func;\n        },\n    });\n\n    updatePreview();\n\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"lvwQ5\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"imAvm\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"dC0sF\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"h3hPo\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1pAeY\");","import {BB} from '../../../bb/bb';\nimport {CropCopy} from '../components/crop-copy';\nimport {Checkbox} from '../base-components/checkbox';\nimport {popup} from './popup';\nimport {LANG} from '../../../language/language';\n\n/**\n *\n * p = {\n *     image: convertedPsd | {type: 'image', width: number, height: number, canvas: image | canvas},\n *     maxSize: number,\n *     target: htmlElement,\n *     callback: func(\n *         {\n *             type: 'as-image',\n *             image: image | canvas,\n *         } | {\n *             type: 'as-image-psd',\n *             image: convertedPsd,\n *             cropObj: {x: number, y: number, width: number, height: number}\n *         } | {\n *             type: 'as-layer',\n *             image: image | canvas,\n *         } | {\n *             type: 'cancel',\n *         }\n *     )\n * }\n *\n * @param p {}\n */\nexport function showImportImageDialog(p) {\n    const div = BB.el({});\n\n    const isSmall = window.innerWidth < 550 || window.innerHeight < 550;\n    const style = isSmall ? {} : { width: '500px' };\n    let resolutionEl;\n    const cropCopy = new CropCopy({\n        width: isSmall ? 340 : 540,\n        height: isSmall ? 300 : 400,\n        canvas: p.image.canvas,\n        isNotCopy: true,\n        onChange: function(width, height) {\n            if (!resolutionEl) {\n                return;\n            }\n            updateResolution(width, height);\n        }\n    });\n    BB.css(cropCopy.getEl(), {\n        marginLeft: '-20px',\n        borderTop: '1px solid #bbb',\n        borderBottom: '1px solid #bbb'\n    });\n    cropCopy.getEl().title = LANG('crop-drag-to-crop');\n    div.appendChild(cropCopy.getEl());\n\n\n    resolutionEl = BB.el({\n        parent: div,\n        css: {\n            marginTop: '10px',\n            textAlign: 'center',\n            color: '#888',\n            lineHeight: '20px',\n        }\n    });\n    function updateResolution(w: number, h: number) {\n        const fit = BB.fitInto(w, h, p.maxSize, p.maxSize);\n\n        if (fit.width < w) {\n            resolutionEl.innerHTML = `<span style=\"color:#f00\">${w} X ${h}</span> ⟶ ${Math.round(fit.width)} X ${Math.round(fit.height)}`;\n            resolutionEl.title = LANG('import-too-large');\n        } else {\n            resolutionEl.innerHTML = `${w} X ${h}`;\n            resolutionEl.title = '';\n        }\n    }\n    updateResolution(p.image.width, p.image.height);\n\n\n    let doFlatten = false;\n    function showWarnings(psdWarningArr) {\n        let contentArr = [];\n        let warningMap = {\n            'mask': 'Masks not supported. Mask was applied.',\n            'clipping': 'Clipping not supported. Clipping layers were merged.',\n            'group': 'Groups not supported. Layers were ungrouped.',\n            'adjustment': 'Adjustment layers not supported.',\n            'layer-effect': 'Layer effects not supported.',\n            'smart-object': 'Smart objects not supported.',\n            'blend-mode': 'Unsupported layer blend mode.',\n            'bits-per-channel': 'Unsupported color depth. Only 8bit per channel supported.',\n        };\n        for (let i = 0; i < psdWarningArr.length; i++) {\n            contentArr.push('- ' + warningMap[psdWarningArr[i]]);\n        }\n        alert(contentArr.join(\"\\n\"));\n    }\n\n    let flattenCheckbox;\n    if (p.image.type === 'psd') {\n        const noteStyle = {\n            background: 'rgba(255,255,0,0.5)',\n            padding: '10px',\n            marginTop: '5px',\n            marginBottom: '5px',\n            border: '1px solid #e7d321',\n            borderRadius: '5px'\n        };\n        if (p.image.layers) {\n            flattenCheckbox = new Checkbox({\n                init: doFlatten,\n                label: LANG('import-flatten'),\n                callback: function(b) {\n                    doFlatten = b;\n                }\n            });\n            div.appendChild(flattenCheckbox.getElement());\n\n            if (p.image.warningArr) {\n                const noteEl = BB.el({\n                    content: LANG('import-psd-limited-support'),\n                    css: noteStyle\n                });\n                noteEl.appendChild(BB.el({\n                    tagName: 'a',\n                    content: 'Details',\n                    onClick: function() {\n                        showWarnings(p.image.warningArr);\n                    }\n                }));\n                div.appendChild(noteEl);\n            }\n        } else {\n            const noteEl = BB.el({\n                content: LANG('import-psd-unsupported'),\n                css: noteStyle\n            });\n            div.appendChild(noteEl);\n        }\n    }\n\n    function callback(result) {\n        const croppedImage = cropCopy.getCroppedImage();\n        const cropRect = cropCopy.getRect();\n        const isCropped = p.image.width !== cropRect.width && p.image.height !== cropRect.height;\n        cropCopy.destroy();\n        if (flattenCheckbox) {\n            flattenCheckbox.destroy();\n        }\n\n        if (result === LANG('import-btn-as-layer')) {\n            p.callback({\n                type: 'as-layer',\n                image: isCropped ? croppedImage : p.image.canvas,\n            });\n\n        } else if (result === LANG('import-btn-as-image')) {\n            if (p.image.type === 'psd') {\n                if (doFlatten) {\n                    p.image.layers = null;\n                }\n                p.callback({\n                    type: 'as-image-psd',\n                    image: p.image,\n                    cropObj: cropRect\n                });\n            } else if (p.image.type === 'image') {\n                p.callback({\n                    type: 'as-image',\n                    image: croppedImage\n                });\n            }\n        } else {\n            p.callback({\n                type: 'cancel'\n            });\n        }\n    }\n    popup({\n        target: p.target,\n        message: `<b>${LANG('import-title')}</b>`,\n        div: div,\n        style,\n        buttons: [LANG('import-btn-as-layer'), LANG('import-btn-as-image'), \"Cancel\"],\n        primaries: [LANG('import-btn-as-layer'), LANG('import-btn-as-image')],\n        callback: callback,\n        autoFocus: 'As Image'\n    });\n}","import {createCanvas} from '../../bb/base/create-canvas';\nimport {Psd} from 'ag-psd/dist/psd';\nimport {IKlProject, IKlPsd, IMixMode} from '../kl.types';\nimport {LANG} from '../../language/language';\nimport {MAX_LAYERS} from '../canvas/kl-canvas';\n\nlet kl2PsdMap;\nlet psd2KlMap;\n\nfunction init() {\n    if (kl2PsdMap) {\n        return;\n    }\n\n    kl2PsdMap = {\n        'source-over': 'normal',\n\n        'darken': 'darken',\n        'multiply': 'multiply',\n        'color-burn': 'color burn',\n\n        'lighten': 'lighten',\n        'screen': 'screen',\n        'color-dodge': 'color dodge',\n\n        'overlay': 'overlay',\n        'soft-light': 'soft light',\n        'hard-light': 'hard light',\n\n        'difference': 'difference',\n        'exclusion': 'exclusion',\n\n        'hue': 'hue',\n        'saturation': 'saturation',\n        'color': 'color',\n        'luminosity': 'luminosity',\n    };\n\n    psd2KlMap = {};\n    let keys = Object.keys(kl2PsdMap);\n    for (let i = 0; i < keys.length; i++) {\n        psd2KlMap[kl2PsdMap[keys[i]]] = keys[i];\n    }\n}\n\nexport function blendPsdToKl(str: string): IMixMode {\n    init();\n    return psd2KlMap[str];\n}\n\nexport function blendKlToPsd(str: string): string {\n    init();\n    return kl2PsdMap[str];\n}\n\n\n/**\n * Converts ag-psd object into something that KlCanvas can represent\n * @param psdObj\n */\nexport function readPsd(psdObj: Psd): IKlPsd {\n    let result: IKlPsd = {\n        type: 'psd',\n        canvas: psdObj.canvas,\n        width: psdObj.width,\n        height: psdObj.height\n    };\n\n    function addWarning(warningStr) {\n        if (!result.warningArr) {\n            result.warningArr = [];\n        }\n        if (result.warningArr.includes(warningStr)) {\n            return;\n        }\n        result.warningArr.push(warningStr);\n    }\n\n    function getMixModeStr(blendMode): IMixMode {\n        let mixModeStr: IMixMode = blendPsdToKl(blendMode);\n        if (!mixModeStr) {\n            addWarning('blend-mode');\n            mixModeStr = 'source-over';\n        }\n        return mixModeStr;\n    }\n\n    if (psdObj.bitsPerChannel !== 8) {\n        addWarning('bits-per-channel');\n    }\n\n    if (!psdObj.children) {\n        result.error = true;\n        return result;\n    }\n\n    // count resulting layers\n    let maxLayers = MAX_LAYERS;\n    let layerCount = 0;\n    function countWithinGroup(groupObj) {\n        let result = 0;\n        if (groupObj.blendMode) {\n            let mixModeStr = blendPsdToKl(groupObj.blendMode);\n            if (mixModeStr && mixModeStr !== 'source-over') {\n                return 1;\n            }\n        }\n        for (let i = 0; i < groupObj.children.length; i++) {\n            let item = groupObj.children[i];\n            if (item.clipping || item.adjustment) {\n                continue;\n            }\n\n            if (item.children) {\n                addWarning('group');\n                result += countWithinGroup(item);\n            } else {\n                result++;\n            }\n        }\n        return result;\n    }\n    layerCount += countWithinGroup(psdObj);\n    if (layerCount > maxLayers) {\n        result.error = true;\n        return result;\n    }\n\n    result.layers = [];\n\n    function prepareMask(maskCanvas, defaultColor) {\n        const groupMaskCtx = maskCanvas.getContext('2d');\n        let imData = groupMaskCtx.getImageData(0, 0, maskCanvas.width, maskCanvas.height);\n        if (defaultColor === 0) {\n            for (let i = 0; i < imData.data.length; i += 4) {\n                imData.data[i + 3] = imData.data[i];\n            }\n        } else {\n            for (let i = 0; i < imData.data.length; i += 4) {\n                imData.data[i + 3] = 255 - imData.data[i];\n            }\n        }\n        groupMaskCtx.putImageData(imData, 0, 0);\n    }\n\n    function convertGroup(psdGroupObj): {\n        name: string;\n        mixModeStr: IMixMode;\n        opacity: number;\n        image: HTMLCanvasElement;\n    }[] {\n\n        let resultArr: {\n            name: string;\n            mixModeStr: IMixMode;\n            opacity: number;\n            image: HTMLCanvasElement;\n        }[] = [];\n        let groupOpacity = psdGroupObj.hidden ? 0 : psdGroupObj.opacity;\n        let groupMixModeStr = getMixModeStr(psdGroupObj.blendMode);\n        let groupCanvas;\n        let groupCtx;\n        if (groupMixModeStr !== 'source-over') {\n            groupCanvas = createCanvas(result.width, result.height);\n            groupCtx = groupCanvas.getContext('2d');\n        }\n\n\n        // prepare group mask\n        if (psdGroupObj.mask) {\n            addWarning('mask');\n            prepareMask(psdGroupObj.mask.canvas, psdGroupObj.mask.defaultColor);\n        }\n\n\n        for (let i = 0; i < psdGroupObj.children.length; i++) {\n            let item = psdGroupObj.children[i];\n            if (item.clipping) {\n                continue;\n            }\n            if (item.adjustment) {\n                addWarning('adjustment');\n                continue;\n            }\n\n            let hasClipping = (item.children || item.canvas) && psdGroupObj.children[i + 1] && psdGroupObj.children[i + 1].clipping;\n            if (hasClipping) {\n                addWarning('clipping');\n            }\n\n            if (item.children) {\n                let innerArr = convertGroup(item);\n\n                for (let e = 0; e < innerArr.length; e++) {\n                    let innerItem = innerArr[e];\n                    let innerCtx = innerItem.image.getContext('2d');\n\n                    // clipping\n                    if (hasClipping) {\n                        let clippingCanvas = createCanvas(result.width, result.height);\n                        let clippingCtx = clippingCanvas.getContext('2d');\n                        clippingCtx.drawImage(innerItem.image, 0, 0);\n\n                        for (let f = i + 1; f < psdGroupObj.children.length && psdGroupObj.children[f].clipping; f++) {\n                            let clippingItem = psdGroupObj.children[f];\n                            if (clippingItem.opacity === 0 || clippingItem.hidden) {\n                                continue;\n                            }\n                            clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\n                            clippingCtx.globalAlpha = clippingItem.opacity;\n                            clippingCtx.drawImage(clippingItem.canvas, clippingItem.left, clippingItem.top);\n                        }\n\n                        innerCtx.globalCompositeOperation = 'source-atop';\n                        innerCtx.drawImage(clippingCanvas, 0, 0);\n                    }\n\n\n\n                    // group mask\n                    if (psdGroupObj.mask) {\n                        innerCtx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\n                        innerCtx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\n                    }\n\n                    if (groupCanvas) {\n                        groupCtx.globalCompositeOperation = innerItem.mixModeStr;\n                        groupCtx.globalAlpha = innerItem.opacity;\n                        groupCtx.drawImage(innerItem.image, 0, 0);\n\n                    } else {\n                        innerItem.opacity = innerItem.opacity * groupOpacity;\n                        resultArr.push(innerItem);\n                    }\n                }\n\n                continue;\n            }\n\n            let canvas = createCanvas(result.width, result.height);\n            let ctx = canvas.getContext('2d');\n            if (item.canvas) { // if a layer is empty it has no canvas\n                ctx.drawImage(item.canvas, item.left, item.top);\n            }\n\n            // effects\n            if (item.effects) {\n                addWarning('layer-effect');\n            }\n\n            // mask\n            if (item.mask) {\n                addWarning('mask');\n                prepareMask(item.mask.canvas, item.mask.defaultColor);\n\n                ctx.globalCompositeOperation = item.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\n                ctx.drawImage(item.mask.canvas, item.mask.left, item.mask.top);\n            }\n\n            // clipping\n            if (hasClipping) {\n                let clippingCanvas = createCanvas(item.right - item.left, item.bottom - item.top);\n                let clippingCtx = clippingCanvas.getContext('2d');\n                clippingCtx.drawImage(item.canvas, 0, 0);\n\n                for (let e = i + 1; e < psdGroupObj.children.length && psdGroupObj.children[e].clipping; e++) {\n                    let clippingItem = psdGroupObj.children[e];\n                    if (clippingItem.opacity === 0 || clippingItem.hidden) {\n                        continue;\n                    }\n                    clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\n                    clippingCtx.globalAlpha = clippingItem.opacity;\n                    clippingCtx.drawImage(clippingItem.canvas, clippingItem.left - item.left, clippingItem.top - item.top);\n                }\n\n                ctx.globalCompositeOperation = 'source-atop';\n                ctx.drawImage(clippingCanvas, item.left, item.top);\n            }\n\n            // group mask\n            if (psdGroupObj.mask) {\n                ctx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\n                ctx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\n            }\n\n            if (groupCanvas) {\n                if (groupOpacity > 0) {\n                    groupCtx.globalCompositeOperation = getMixModeStr(item.blendMode);\n                    groupCtx.globalAlpha = item.hidden ? 0 : item.opacity;\n                    groupCtx.drawImage(canvas, 0, 0);\n                }\n\n            } else {\n                resultArr.push({\n                    name: item.name,\n                    opacity: (item.hidden ? 0 : item.opacity) * groupOpacity,\n                    mixModeStr: getMixModeStr(item.blendMode),\n                    image: canvas,\n                });\n            }\n        }\n\n        if (groupCanvas) {\n            resultArr = [\n                {\n                    name: psdGroupObj.name,\n                    opacity: groupOpacity,\n                    mixModeStr: groupMixModeStr,\n                    image: groupCanvas,\n                }\n            ];\n        }\n\n        return resultArr;\n    }\n\n    result.layers = convertGroup({\n        name: 'root',\n        opacity: 1,\n        blendMode: 'normal',\n        children: psdObj.children\n    });\n\n    return result;\n}\n\nexport function klPsdToKlProject(klPsd: IKlPsd): IKlProject {\n    // only share references to Canvas elements\n    const result: IKlProject = {\n        width: klPsd.width,\n        height: klPsd.height,\n        layers: [],\n    };\n    if (klPsd.layers) {\n        result.layers = result.layers.concat(klPsd.layers.map(item => {\n            return {\n                name: item.name,\n                opacity: item.opacity,\n                mixModeStr: item.mixModeStr,\n                image: item.image,\n            };\n        }));\n    } else {\n        // flattened\n        result.layers.push({\n            name: LANG('background'),\n            opacity: 1,\n            mixModeStr: 'source-over',\n            image: klPsd.canvas,\n        });\n    }\n    return result;\n}","//browser storage indexedDB\n\n\nimport {IKlStorageProject} from '../kl.types';\n\nconst indexedDbIsSupported = !!window.indexedDB;\nlet dbNameStr = 'Klecks';\nconst storageNameStr = 'ProjectStore';\n\nexport function setDbName(name: string) {\n    dbNameStr = '' + name;\n}\n\n/**\n * connects to db dbNameStr, then executes transaction on storageNameStr storage\n * with index 'id'\n *\n * @param actionFunction function(storeObj) - what you want to execute during transaction\n * @param successCallback function() - on succesful transaction\n * @param errorCallback function(errorStr) - on error\n */\nfunction execIndexedDBTransaction(actionFunction, successCallback, errorCallback) {\n\n    let hasFinished = false;\n\n    function onSuccess() {\n        if (hasFinished) {\n            return;\n        }\n        hasFinished = true;\n        successCallback();\n    }\n\n    function onError(errorStr) {\n        if (hasFinished) {\n            return;\n        }\n        hasFinished = true;\n        errorCallback(errorStr);\n    }\n\n    if (!indexedDbIsSupported) {\n        setTimeout(function () {\n            onError('no indexed db available');\n        }, 0);\n        return;\n    }\n    let requestObj;\n\n    try {\n        requestObj = window.indexedDB.open(dbNameStr, 1);\n    } catch (e) {\n        onError(e.message);\n        return;\n    }\n\n    requestObj.onupgradeneeded = function (e) {\n        try {\n            let db = requestObj.result;\n            let store = db.createObjectStore(storageNameStr, {keyPath: 'id'});\n            store.createIndex('id', 'id', {unique: true});\n        } catch (e) {\n            onError(e.message);\n        }\n    };\n    requestObj.onerror = function (e) {\n        onError('indexedDB.open failed, ' + requestObj.error);\n    };\n    requestObj.onsuccess = function (e) {\n        let databaseObj;\n        let transactionObj;\n        let storeObj;\n\n        try {\n            databaseObj = requestObj.result;\n            if (!databaseObj.objectStoreNames.contains(storageNameStr)) {\n                //someone maybe messed with the db, or creation failed earlier\n                //it's broken -> destroy\n                window.indexedDB.deleteDatabase(dbNameStr);\n                onError('object store ' + storageNameStr + ' missing. destroying db');\n                return;\n            }\n            transactionObj = databaseObj.transaction(storageNameStr, 'readwrite');\n            storeObj = transactionObj.objectStore(storageNameStr);\n            storeObj.index('id');\n        } catch (e) {\n            onError(e.message);\n            return;\n        }\n\n        databaseObj.onerror = function (e) {\n            onError('database error, ' + databaseObj.error);\n        };\n\n        try {\n            actionFunction(storeObj);\n        } catch (e) {\n            onError(e.message);\n            return;\n        }\n\n        transactionObj.oncomplete = function () {\n            onSuccess();\n            databaseObj.close();\n        };\n        transactionObj.onerror = function () {\n            onError('transaction error, ' + transactionObj.error);\n        };\n    };\n}\n\n/**\n * getKlProjectObj {\n *     width: int,\n *     height: int,\n *     layers: {\n *        name: string,\n *        opacity: float (0 - 1),\n *        mixModeStr: string,\n *        image: image object                <--------- image already loaded!\n *     }[]\n * }\n *\n * @param successCallback function - called when succesfully queried. passes KlProjectObj\n * @param errorCallback - function(errorStr) - called when error during query\n */\nexport function getKlProjectObj(successCallback, errorCallback) {\n    if (indexedDbIsSupported) {\n        let query;\n        execIndexedDBTransaction(function (storeObj) {\n            query = storeObj.get(1);\n        }, function () {\n            successCallback(query.result);\n        }, function (errorStr) {\n            errorCallback('execIndexedDBTransaction error, ' + errorStr);\n        });\n    } else {\n        successCallback(null);\n    }\n}\n\n/**\n * stores a klProjectObj into id = 1 in database:dbNameStr > storage: storageNameStr\n *\n * KlProjectObj {\n *     width: int,\n *     height: int,\n *     layers: {\n *        name: string,\n *        opacity: float (0 - 1),\n *        mixModeStr: string,\n *        blob: blob object                 <--------- blob!\n *     }[]\n * }\n *\n * @param storageProject IKlStorageProject - project to be stored\n * @param successCallback function() - on successful transaction\n * @param errorCallback function(errorStr) - on error\n */\nexport function storeKlProjectObj(storageProject: IKlStorageProject, successCallback, errorCallback) {\n    execIndexedDBTransaction(function (storeObj) {\n        storeObj.put(storageProject);\n    }, function () {\n        successCallback();\n    }, function (errorStr) {\n        errorCallback(errorStr);\n    });\n\n}\n\n/**\n * removes id = 1 from database:dbNameStr > storage: storageNameStr\n *\n * @param successCallback function() - on successful transaction\n * @param errorCallback function(error) - on error\n */\nexport function clear(successCallback, errorCallback) {\n    execIndexedDBTransaction(function (storeObj) {\n        storeObj.delete(1);\n    }, function () {\n        successCallback();\n    }, function (error) {\n        errorCallback(error);\n    });\n\n}\n","import {IFilter} from '../kl.types';\n// @ts-ignore\nimport glBrightnessContrastImg from 'url:~/src/app/img/ui/edit-brightness-contrast.svg';\n// @ts-ignore\nimport cropExtendImg from 'url:~/src/app/img/ui/edit-crop.svg';\n// @ts-ignore\nimport glCurvesImg from 'url:~/src/app/img/ui/edit-curves.svg';\n// @ts-ignore\nimport flipImg from 'url:~/src/app/img/ui/edit-flip.svg';\n// @ts-ignore\nimport glHueSaturationImg from 'url:~/src/app/img/ui/edit-hue-saturation.svg';\n// @ts-ignore\nimport invertImg from 'url:~/src/app/img/ui/edit-invert.png';\n// @ts-ignore\nimport glPerspectiveImg from 'url:~/src/app/img/ui/edit-perspective.svg';\n// @ts-ignore\nimport resizeImg from 'url:~/src/app/img/ui/edit-resize.svg';\n// @ts-ignore\nimport rotateImg from 'url:~/src/app/img/ui/edit-rotate.svg';\n// @ts-ignore\nimport glTiltShiftImg from 'url:~/src/app/img/ui/edit-tilt-shift.png';\n// @ts-ignore\nimport toAlphaImg from 'url:~/src/app/img/ui/edit-to-alpha.svg';\n// @ts-ignore\nimport transformImg from 'url:~/src/app/img/ui/edit-transform.svg';\n// @ts-ignore\nimport glBlurImg from 'url:~/src/app/img/ui/edit-triangle-blur.png';\n// @ts-ignore\nimport glUnsharpMaskImg from 'url:~/src/app/img/ui/edit-unsharp-mask.png';\n// @ts-ignore\nimport gridImg from 'url:~/src/app/img/ui/edit-grid.svg';\n// @ts-ignore\nimport noiseImg from 'url:~/src/app/img/ui/edit-noise.svg';\n// @ts-ignore\nimport patternImg from 'url:~/src/app/img/ui/edit-pattern.svg';\n// @ts-ignore\nimport vanishPointImg from 'url:~/src/app/img/ui/edit-vanish-point.svg';\n// @ts-ignore\nimport distortImg from 'url:~/src/app/img/ui/edit-distort.svg';\n\n\nexport const filterLibStatus = {\n    isLoaded: false,\n};\nexport const filterLib: {\n    [key:string]: IFilter;\n} = {\n    brightnessContrast: {\n        lang: {name: 'filter-bright-contrast-title', button: 'filter-bright-contrast'},\n        icon: glBrightnessContrastImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    cropExtend: {\n        lang: {name: 'filter-crop-title', button: 'filter-crop-extend'},\n        icon: cropExtendImg,\n        updatePos: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: false,\n    },\n    curves: {\n        lang: {name: 'filter-curves-title', button: 'filter-curves'},\n        icon: glCurvesImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    distort: {\n        lang: {name: 'filter-distort', button: 'filter-distort'},\n        icon: distortImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    flip: {\n        lang: {name: 'filter-flip-title', button: 'filter-flip'},\n        icon: flipImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    hueSaturation: {\n        lang: {name: 'filter-hue-sat-title', button: 'filter-hue-sat'},\n        icon: glHueSaturationImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    invert: {\n        lang: {name: 'filter-invert', button: 'filter-invert'},\n        icon: invertImg,\n        updatePos: false,\n        isInstant: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    perspective: {\n        lang: {name: 'filter-perspective-title', button: 'filter-perspective'},\n        icon: glPerspectiveImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    resize: {\n        lang: {name: 'filter-resize-title', button: 'filter-resize'},\n        icon: resizeImg,\n        updatePos: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: false,\n    },\n    rotate: {\n        lang: {name: 'filter-rotate-title', button: 'filter-rotate'},\n        icon: rotateImg,\n        updatePos: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: false,\n    },\n    tiltShift: {\n        lang: {name: 'filter-tilt-shift-title', button: 'filter-tilt-shift'},\n        icon: glTiltShiftImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    toAlpha: {\n        lang: {name: 'filter-to-alpha-title', button: 'filter-to-alpha'},\n        icon: toAlphaImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    transform: {\n        lang: {name: 'filter-transform-title', button: 'filter-transform'},\n        icon: transformImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    blur: {\n        lang: {name: 'filter-triangle-blur-title', button: 'filter-triangle-blur'},\n        icon: glBlurImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    unsharpMask: {\n        lang: {name: 'filter-unsharp-mask-title', button: 'filter-unsharp-mask'},\n        icon: glUnsharpMaskImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    grid: {\n        lang: {name: 'filter-grid', button: 'filter-grid'},\n        icon: gridImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    noise: {\n        lang: {name: 'filter-noise', button: 'filter-noise'},\n        icon: noiseImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    pattern: {\n        lang: {name: 'filter-pattern', button: 'filter-pattern'},\n        icon: patternImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    vanishPoint: {\n        lang: {name: 'filter-vanish-point-title', button: 'filter-vanish-point'},\n        icon: vanishPointImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n};\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"5tPq3\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"cazOx\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"245NA\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1hkCG\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"k2eFf\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"krKGd\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"ehfxY\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"beOjS\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"Gk9bV\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"csed7\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"equSE\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"h1dN3\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"LfAXI\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"cB6q6\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"S9ano\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"4eqRj\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"8mvSV\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kbc0v\");","import {PenBrush} from './pen-brush';\nimport {BlendBrush} from './blend-brush';\nimport {SketchyBrush} from './sketchy-brush';\nimport {PixelBrush} from './pixel-brush';\nimport {EraserBrush} from './eraser-brush';\nimport {SmudgeBrush} from './smudge-brush';\nimport {ChemyBrush} from './chemy-brush';\n\nexport const brushes = {\n    PenBrush,\n    BlendBrush,\n    SketchyBrush,\n    PixelBrush,\n    ChemyBrush,\n    SmudgeBrush,\n    EraserBrush,\n}","import {BB} from '../../bb/bb';\nimport {alphaImArr} from './brushes-common';\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\nimport {KL} from '../kl';\n\n\nexport function PenBrush() {\n\n    let context;\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\n    let historyEntry: IHistoryEntry;\n\n    let settingColor, settingSize = 2, settingSpacing = 0.8489, settingOpacity = 1;\n    let settingColorStr;\n    let settingHasSizePressure = true, settingHasOpacityPressure = false;\n    let settingLockLayerAlpha = false;\n    let ALPHA_CIRCLE = 0, ALPHA_CHALK = 1, ALPHA_CAL = 2, ALPHA_SQUARE = 3;\n    let settingAlphaId = ALPHA_CIRCLE;\n\n    let lineToolLastDot;\n    let lastInput = {x: 0, y: 0, pressure: 0};\n    let lastInput2 = {x: 0, y: 0, pressure: 0};\n\n    let isDrawing = false;\n    let alphaOpacityArr = [1, 0.9, 1, 1];\n\n    //mipmapping\n    let alphaCanvas128 = BB.canvas(128, 128);\n    let alphaCanvas64 = BB.canvas(64, 64);\n    let alphaCanvas32 = BB.canvas(32, 32);\n\n    let bezierLine = null;\n\n    let twoPI = Math.PI * 2;\n    let hasDrawnDot = false; // current stroke has drawn at least one dot\n    let inputArr: {x: number, y: number, pressure: number}[];\n\n    // pressure: 0-1\n    function calcOpacity(pressure: number) {\n        return settingOpacity * (settingHasOpacityPressure ? pressure * pressure : 1);\n    }\n\n    function updateAlphaCanvas() {\n        if (settingAlphaId === ALPHA_CIRCLE || settingAlphaId === ALPHA_SQUARE) {\n            return;\n        }\n\n        let instructionArr = [\n            [alphaCanvas128, 128],\n            [alphaCanvas64, 64],\n            [alphaCanvas32, 32]\n        ];\n\n        let ctx;\n\n        for (let i = 0; i < instructionArr.length; i++) {\n            ctx = (instructionArr[i][0] as any).getContext(\"2d\");\n\n            ctx.save();\n            ctx.clearRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\n\n            ctx.fillStyle = \"rgba(\" + settingColor.r + \", \" + settingColor.g + \", \" + settingColor.b + \", \" + alphaOpacityArr[settingAlphaId] + \")\";\n            ctx.fillRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\n\n            ctx.globalCompositeOperation = \"destination-in\";\n            ctx.imageSmoothingQuality = 'high';\n            ctx.drawImage(alphaImArr[settingAlphaId], 0, 0, instructionArr[i][1], instructionArr[i][1]);\n\n            ctx.restore();\n        }\n    }\n\n    /**\n     *\n     *\n     * @param x\n     * @param y\n     * @param size\n     * @param opacity\n     * @param angle\n     * @param before - [x, y, size, opacity, angle] the drawDot call before\n     */\n    function drawDot(x, y, size, opacity, angle?, before?) {\n        if (size <= 0) {\n            return;\n        }\n\n        if (settingLockLayerAlpha) {\n            context.globalCompositeOperation = \"source-atop\";\n        }\n\n        if (!before || before[3] !== opacity) {\n            context.globalAlpha = opacity;\n        }\n\n        if (!before && (settingAlphaId === ALPHA_CIRCLE || settingAlphaId === ALPHA_SQUARE)) {\n            context.fillStyle = settingColorStr;\n        }\n\n        if (settingAlphaId === ALPHA_CIRCLE) {\n            context.beginPath();\n            context.arc(x, y, size, 0, twoPI);\n            context.closePath();\n            context.fill();\n            hasDrawnDot = true;\n\n        } else if (settingAlphaId === ALPHA_SQUARE) {\n            if (angle !== undefined) {\n                context.save();\n                context.translate(x, y);\n                context.rotate(angle / 180 * Math.PI);\n                context.fillRect(-size, -size, size * 2, size * 2);\n                context.restore();\n                hasDrawnDot = true;\n            }\n\n        } else { // other brush alphas\n            context.save();\n            context.translate(x, y);\n            let targetMipmap = alphaCanvas128;\n            if (size <= 32 && size > 16) {\n                targetMipmap = alphaCanvas64;\n            } else if (size <= 16) {\n                targetMipmap = alphaCanvas32;\n            }\n            context.scale(size, size);\n            if (settingAlphaId === ALPHA_CHALK) {\n                context.rotate(((x + y) * 53123) % twoPI); // without mod it sometimes looks different\n            }\n            context.drawImage(targetMipmap, -1, -1, 2, 2);\n\n            context.restore();\n            hasDrawnDot = true;\n        }\n    }\n\n    function continueLine(x, y, size, pressure) {\n        if (bezierLine === null) {\n            bezierLine = new BB.BezierLine();\n            bezierLine.add(lastInput.x, lastInput.y, 0, function(){});\n        }\n\n        let drawArr = []; //draw instructions. will be all drawn at once\n\n        function dotCallback(val) {\n            let localPressure = BB.mix(lastInput2.pressure, pressure, val.t);\n            let localOpacity = calcOpacity(localPressure);\n            let localSize = Math.max(0.1, settingSize * (settingHasSizePressure ? localPressure : 1));\n            drawArr.push([val.x, val.y, localSize, localOpacity, val.angle]);\n        }\n\n        let localSpacing = size * settingSpacing;\n        if (x === null) {\n            bezierLine.addFinal(localSpacing, dotCallback);\n        } else {\n            bezierLine.add(x, y, localSpacing, dotCallback);\n        }\n\n        // execute draw instructions\n        context.save();\n        let before;\n        for (let i = 0; i < drawArr.length; i++) {\n            let item = drawArr[i];\n            drawDot(item[0], item[1], item[2], item[3], item[4], before);\n            before = item;\n        }\n        context.restore();\n    }\n\n    //------------------ interface ---------------------------------------------------\n\n\n    this.startLine = function (x, y, p) {\n        historyEntry = {\n            tool: [\"brush\", \"PenBrush\"],\n            actions: []\n        };\n        historyEntry.actions.push({\n            action: \"opacityPressure\",\n            params: [settingHasOpacityPressure]\n        });\n        historyEntry.actions.push({\n            action: \"sizePressure\",\n            params: [settingHasSizePressure]\n        });\n        historyEntry.actions.push({\n            action: \"setSize\",\n            params: [settingSize]\n        });\n        historyEntry.actions.push({\n            action: \"setSpacing\",\n            params: [settingSpacing]\n        });\n        historyEntry.actions.push({\n            action: \"setOpacity\",\n            params: [settingOpacity]\n        });\n        historyEntry.actions.push({\n            action: \"setColor\",\n            params: [settingColor]\n        });\n        historyEntry.actions.push({\n            action: \"setAlpha\",\n            params: [settingAlphaId]\n        });\n        historyEntry.actions.push({\n            action: \"setLockAlpha\",\n            params: [settingLockLayerAlpha]\n        });\n\n        p = BB.clamp(p, 0, 1);\n        let localOpacity = calcOpacity(p);\n        let localSize = settingHasSizePressure ? Math.max(0.1, p * settingSize) : Math.max(0.1, settingSize);\n\n        hasDrawnDot = false;\n\n        isDrawing = true;\n        context.save();\n        drawDot(x, y, localSize, localOpacity);\n        context.restore();\n\n        lineToolLastDot = localSize * settingSpacing;\n        lastInput.x = x;\n        lastInput.y = y;\n        lastInput.pressure = p;\n        lastInput2.pressure = p;\n\n        inputArr = [{\n            x,\n            y,\n            pressure: p,\n        }];\n\n        historyEntry.actions.push({\n            action: \"startLine\",\n            params: [x, y, p]\n        });\n    };\n\n    this.goLine = function (x, y, p) {\n        if (!isDrawing) {\n            return;\n        }\n        historyEntry.actions.push({\n            action: \"goLine\",\n            params: [x, y, p]\n        });\n\n        let pressure = BB.clamp(p, 0, 1);\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\n\n        context.save();\n        continueLine(x, y, localSize, lastInput.pressure);\n\n        /*context.fillStyle = 'red';\n        context.fillRect(Math.floor(x), Math.floor(y - 10), 1, 20);\n        context.fillRect(Math.floor(x - 10), Math.floor(y), 20, 1);*/\n\n        context.restore();\n\n        lastInput.x = x;\n        lastInput.y = y;\n        lastInput2.pressure = lastInput.pressure;\n        lastInput.pressure = pressure;\n\n        inputArr.push({\n            x,\n            y,\n            pressure: p,\n        });\n    };\n\n    this.endLine = function (x, y) {\n\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\n        context.save();\n        continueLine(null, null, localSize, lastInput.pressure);\n        context.restore();\n\n        isDrawing = false;\n\n        if (settingAlphaId === ALPHA_SQUARE && !hasDrawnDot) {\n            // find max pressure input, use that one\n            let maxInput = inputArr[0];\n            inputArr.forEach(item => {\n                if (item.pressure > maxInput.pressure) {\n                    maxInput = item;\n                }\n            })\n\n            context.save();\n            let p = BB.clamp(maxInput.pressure, 0, 1);\n            let localOpacity = calcOpacity(p);\n            drawDot(maxInput.x, maxInput.y, localSize, localOpacity, 0);\n            context.restore();\n        }\n\n        bezierLine = null;\n\n        if (historyEntry) {\n            historyEntry.actions.push({\n                action: \"endLine\",\n                params: [x, y]\n            });\n            history.push(historyEntry);\n            historyEntry = undefined;\n        }\n\n        hasDrawnDot = false;\n        inputArr = [];\n    };\n    //cheap n' ugly\n    this.drawLineSegment = function (x1, y1, x2, y2) {\n        lastInput.x = x2;\n        lastInput.y = y2;\n        lastInput.pressure = 1;\n\n        if (isDrawing || x1 === undefined) {\n            return;\n        }\n\n        let angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n        let eX = (x2 - x1) / mouseDist;\n        let eY = (y2 - y1) / mouseDist;\n        let loopDist;\n        let bdist = settingSize * settingSpacing;\n        lineToolLastDot = settingSize * settingSpacing;\n        context.save();\n        for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity, angle);\n        }\n        context.restore();\n\n\n        let historyEntry = {\n            tool: [\"brush\", \"PenBrush\"],\n            actions: []\n        };\n        historyEntry.actions.push({\n            action: \"opacityPressure\",\n            params: [settingHasOpacityPressure]\n        });\n        historyEntry.actions.push({\n            action: \"sizePressure\",\n            params: [settingHasSizePressure]\n        });\n        historyEntry.actions.push({\n            action: \"setSize\",\n            params: [settingSize]\n        });\n        historyEntry.actions.push({\n            action: \"setSpacing\",\n            params: [settingSpacing]\n        });\n        historyEntry.actions.push({\n            action: \"setOpacity\",\n            params: [settingOpacity]\n        });\n        historyEntry.actions.push({\n            action: \"setColor\",\n            params: [settingColor]\n        });\n        historyEntry.actions.push({\n            action: \"setAlpha\",\n            params: [settingAlphaId]\n        });\n        historyEntry.actions.push({\n            action: \"setLockAlpha\",\n            params: [settingLockLayerAlpha]\n        });\n\n        historyEntry.actions.push({\n            action: \"drawLineSegment\",\n            params: [x1, y1, x2, y2]\n        });\n        history.push(historyEntry);\n    };\n\n    //IS\n    this.isDrawing = function () {\n        return isDrawing;\n    };\n    //SET\n    this.setAlpha = function (a) {\n        if (settingAlphaId === a) {\n            return;\n        }\n        settingAlphaId = a;\n        updateAlphaCanvas();\n    };\n    this.setColor = function (c) {\n        if (settingColor === c) {\n            return;\n        }\n        settingColor = {r: c.r, g: c.g, b: c.b};\n        settingColorStr = \"rgb(\" + settingColor.r + \",\" + settingColor.g + \",\" + settingColor.b + \")\";\n        updateAlphaCanvas();\n    };\n    this.setContext = function (c) {\n        context = c;\n    };\n    this.setHistory = function (l: KlHistoryInterface) {\n        history = l;\n    };\n    this.setSize = function (s) {\n        settingSize = s;\n    };\n    this.setOpacity = function (o) {\n        settingOpacity = o;\n    };\n    this.setSpacing = function (s) {\n        settingSpacing = s;\n    };\n    this.sizePressure = function (b) {\n        settingHasSizePressure = b;\n    };\n    this.opacityPressure = function (b) {\n        settingHasOpacityPressure = b;\n    };\n    this.setLockAlpha = function (b) {\n        settingLockLayerAlpha = b;\n    };\n    //GET\n    this.getSpacing = function () {\n        return settingSpacing;\n    };\n    this.getSize = function () {\n        return settingSize;\n    };\n    this.getOpacity = function () {\n        return settingOpacity;\n    };\n    this.getLockAlpha = function (b) {\n        return settingLockLayerAlpha;\n    };\n}","import {genBrushAlpha01, genBrushAlpha02} from './alphas/brush-alphas';\n\nexport const alphaImArr = []; //used by default brush\nalphaImArr[1] = genBrushAlpha01(128);\nalphaImArr[2] = genBrushAlpha02(128);","import {BB} from '../../../bb/bb';\nimport {noise} from '../../../bb/math/perlin';\nimport {IVector2D} from '../../../bb/bb.types';\n\n// chalk\nexport function genBrushAlpha01(w: number): HTMLCanvasElement {\n\n    const scaleFac = w / 500;\n    const h = w;\n    const canvas = BB.canvas(w, h);\n    const ctx = canvas.getContext('2d');\n    const imData = ctx.createImageData(w, h);\n    for (let x = 0; x < w; x++) {\n        for (let y = 0; y < h; y++) {\n            let i = (y * w + x) * 4;\n\n            // base noise\n            const sFac2 = scaleFac + noise.simplex2(x / 50 / scaleFac, y / 50 / scaleFac) * 0.04;\n            let noisePattern = 100 + (noise.simplex2(x / 50 / sFac2, y / 50 / sFac2) + 1) / 2 * 100;\n            noisePattern -= (noise.simplex2(x / 10 / scaleFac, y / 10 / scaleFac) + 1) / 2 * 100;\n\n            // fade out in circular shape\n            const centerDist = BB.dist(w / 2, h / 2, x, y);\n            let falloff = BB.clamp(\n                1 - ((centerDist - (w / 2.5)) / (w / 14) + noise.simplex2(x / 22 / sFac2, y / 22 / sFac2)),\n                0,\n                1);\n            noisePattern = noisePattern * falloff;\n\n            // make the middle darker\n            const falloff2 = BB.clamp(1 - centerDist / w, 0, 1) * 2;\n            noisePattern = noisePattern * falloff2;\n\n            imData.data[i] = 0;\n            imData.data[i + 1] = 0;\n            imData.data[i + 2] = 0;\n            imData.data[i + 3] = BB.clamp(noisePattern, 0, 255);\n        }\n    }\n\n    ctx.putImageData(imData, 0, 0);\n    return canvas;\n}\n\n// https://www.shadertoy.com/view/3tdSDj\nfunction udSegment( p: IVector2D, a: IVector2D, b: IVector2D ) {\n    let ba = BB.Vec2.sub(b, a);\n    let pa = BB.Vec2.sub(p, a);\n    let h = BB.clamp( BB.Vec2.dot(pa,ba) / BB.Vec2.dot(ba,ba), 0.0, 1.0 );\n    return BB.Vec2.len(BB.Vec2.sub(pa, BB.Vec2.mul(ba, h)));\n}\n\n// calligraphy\nexport function genBrushAlpha02(w: number): HTMLCanvasElement {\n\n    const pDist = 1 / 4;\n    let centerSize = 2 / 3;\n    let transitionSize = 1 / 3;\n    centerSize *= pDist;\n    transitionSize *= pDist;\n    const p1 = {x: pDist * w, y: w - (w * pDist)};\n    const p2 = {x: w - (w * pDist), y: pDist * w};\n\n    const h = w;\n    const canvas = BB.canvas(w, h);\n    let ctx = canvas.getContext('2d');\n    const imData = ctx.createImageData(w, h);\n    for (let x = 0; x < w; x++) {\n        for (let y = 0; y < h; y++) {\n            const i = (y * w + x) * 4;\n\n            let col = udSegment({x: x, y: y}, p1, p2);\n\n            col = BB.clamp(\n                255 - ((col - (w * centerSize)) / (w * transitionSize) * 255),\n                0,\n                255\n            );\n\n            imData.data[i] = 0;\n            imData.data[i + 1] = 0;\n            imData.data[i + 2] = 0;\n            imData.data[i + 3] = col;\n        }\n    }\n\n    ctx.putImageData(imData, 0, 0);\n    return canvas;\n}","/*\n * A speed-improved perlin and simplex noise algorithms for 2D.\n *\n * Based on example code by Stefan Gustavson (stegu@itn.liu.se).\n * Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\n * Better rank ordering method by Stefan Gustavson in 2012.\n * Converted to Javascript by Joseph Gentle.\n *\n * Version 2012-03-09\n *\n * This code was placed in the public domain by its original author,\n * Stefan Gustavson. You may use it as you see fit, but\n * attribution is appreciated.\n *\n */\n\nconst myModule = {} as any;\n\n\nfunction Grad(x, y, z) {\n    this.x = x; this.y = y; this.z = z;\n}\n\nGrad.prototype.dot2 = function(x, y) {\n    return this.x*x + this.y*y;\n};\n/*\nGrad.prototype.dot3 = function(x, y, z) {\n    return this.x*x + this.y*y + this.z*z;\n};*/\n\nlet grad3 = [new Grad(1,1,0),new Grad(-1,1,0),new Grad(1,-1,0),new Grad(-1,-1,0),\n    new Grad(1,0,1),new Grad(-1,0,1),new Grad(1,0,-1),new Grad(-1,0,-1),\n    new Grad(0,1,1),new Grad(0,-1,1),new Grad(0,1,-1),new Grad(0,-1,-1)];\n\nlet p = [151,160,137,91,90,15,\n    131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,\n    190, 6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,\n    88,237,149,56,87,174,20,125,136,171,168, 68,175,74,165,71,134,139,48,27,166,\n    77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,\n    102,143,54, 65,25,63,161, 1,216,80,73,209,76,132,187,208, 89,18,169,200,196,\n    135,130,116,188,159,86,164,100,109,198,173,186, 3,64,52,217,226,250,124,123,\n    5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,\n    223,183,170,213,119,248,152, 2,44,154,163, 70,221,153,101,155,167, 43,172,9,\n    129,22,39,253, 19,98,108,110,79,113,224,232,178,185, 112,104,218,246,97,228,\n    251,34,242,193,238,210,144,12,191,179,162,241, 81,51,145,235,249,14,239,107,\n    49,192,214, 31,181,199,106,157,184, 84,204,176,115,121,50,45,127, 4,150,254,\n    138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];\n// To remove the need for index wrapping, double the permutation table length\nlet perm = new Array(512);\nlet gradP = new Array(512);\n\n// This isn't a very good seeding function, but it works ok. It supports 2^16\n// different seed values. Write something better if you need more seeds.\nmyModule.seed = function(seed) {\n    if (seed > 0 && seed < 1) {\n        // Scale the seed out\n        seed *= 65536;\n    }\n\n    seed = Math.floor(seed);\n    if (seed < 256) {\n        seed |= seed << 8;\n    }\n\n    for (let i = 0; i < 256; i++) {\n        let v;\n        if (i & 1) {\n            v = p[i] ^ (seed & 255);\n        } else {\n            v = p[i] ^ ((seed>>8) & 255);\n        }\n\n        perm[i] = perm[i + 256] = v;\n        gradP[i] = gradP[i + 256] = grad3[v % 12];\n    }\n};\n\nmyModule.seed(0);\n\n/*\nfor (let i=0; i<256; i++) {\n  perm[i] = perm[i + 256] = p[i];\n  gradP[i] = gradP[i + 256] = grad3[perm[i] % 12];\n}*/\n\n// Skewing and unskewing factors for 2, 3, and 4 dimensions\nlet F2 = 0.5*(Math.sqrt(3)-1);\nlet G2 = (3-Math.sqrt(3))/6;\n\n/*let F3 = 1/3;\nlet G3 = 1/6;*/\n\n// 2D simplex noise\nmyModule.simplex2 = function(xin, yin) {\n    let n0, n1, n2; // Noise contributions from the three corners\n    // Skew the input space to determine which simplex cell we're in\n    let s = (xin+yin)*F2; // Hairy factor for 2D\n    let i = Math.floor(xin+s);\n    let j = Math.floor(yin+s);\n    let t = (i+j)*G2;\n    let x0 = xin-i+t; // The x,y distances from the cell origin, unskewed.\n    let y0 = yin-j+t;\n    // For the 2D case, the simplex shape is an equilateral triangle.\n    // Determine which simplex we are in.\n    let i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\n    if (x0>y0) { // lower triangle, XY order: (0,0)->(1,0)->(1,1)\n        i1=1; j1=0;\n    } else {    // upper triangle, YX order: (0,0)->(0,1)->(1,1)\n        i1=0; j1=1;\n    }\n    // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\n    // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\n    // c = (3-sqrt(3))/6\n    let x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\n    let y1 = y0 - j1 + G2;\n    let x2 = x0 - 1 + 2 * G2; // Offsets for last corner in (x,y) unskewed coords\n    let y2 = y0 - 1 + 2 * G2;\n    // Work out the hashed gradient indices of the three simplex corners\n    i &= 255;\n    j &= 255;\n    let gi0 = gradP[i+perm[j]];\n    let gi1 = gradP[i+i1+perm[j+j1]];\n    let gi2 = gradP[i+1+perm[j+1]];\n    // Calculate the contribution from the three corners\n    let t0 = 0.5 - x0*x0-y0*y0;\n    if (t0<0) {\n        n0 = 0;\n    } else {\n        t0 *= t0;\n        n0 = t0 * t0 * gi0.dot2(x0, y0);  // (x,y) of grad3 used for 2D gradient\n    }\n    let t1 = 0.5 - x1*x1-y1*y1;\n    if (t1<0) {\n        n1 = 0;\n    } else {\n        t1 *= t1;\n        n1 = t1 * t1 * gi1.dot2(x1, y1);\n    }\n    let t2 = 0.5 - x2*x2-y2*y2;\n    if (t2<0) {\n        n2 = 0;\n    } else {\n        t2 *= t2;\n        n2 = t2 * t2 * gi2.dot2(x2, y2);\n    }\n    // Add contributions from each corner to get the final noise value.\n    // The result is scaled to return values in the interval [-1,1].\n    return 70 * (n0 + n1 + n2);\n};\n/*\n// 3D simplex noise\nmyModule.simplex3 = function(xin, yin, zin) {\n    let n0, n1, n2, n3; // Noise contributions from the four corners\n\n    // Skew the input space to determine which simplex cell we're in\n    let s = (xin+yin+zin)*F3; // Hairy factor for 2D\n    let i = Math.floor(xin+s);\n    let j = Math.floor(yin+s);\n    let k = Math.floor(zin+s);\n\n    let t = (i+j+k)*G3;\n    let x0 = xin-i+t; // The x,y distances from the cell origin, unskewed.\n    let y0 = yin-j+t;\n    let z0 = zin-k+t;\n\n    // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\n    // Determine which simplex we are in.\n    let i1, j1, k1; // Offsets for second corner of simplex in (i,j,k) coords\n    let i2, j2, k2; // Offsets for third corner of simplex in (i,j,k) coords\n    if (x0 >= y0) {\n        if (y0 >= z0)      { i1=1; j1=0; k1=0; i2=1; j2=1; k2=0; }\n        else if (x0 >= z0) { i1=1; j1=0; k1=0; i2=1; j2=0; k2=1; }\n        else              { i1=0; j1=0; k1=1; i2=1; j2=0; k2=1; }\n    } else {\n        if (y0 < z0)      { i1=0; j1=0; k1=1; i2=0; j2=1; k2=1; }\n        else if (x0 < z0) { i1=0; j1=1; k1=0; i2=0; j2=1; k2=1; }\n        else             { i1=0; j1=1; k1=0; i2=1; j2=1; k2=0; }\n    }\n    // A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z),\n    // a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and\n    // a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where\n    // c = 1/6.\n    let x1 = x0 - i1 + G3; // Offsets for second corner\n    let y1 = y0 - j1 + G3;\n    let z1 = z0 - k1 + G3;\n\n    let x2 = x0 - i2 + 2 * G3; // Offsets for third corner\n    let y2 = y0 - j2 + 2 * G3;\n    let z2 = z0 - k2 + 2 * G3;\n\n    let x3 = x0 - 1 + 3 * G3; // Offsets for fourth corner\n    let y3 = y0 - 1 + 3 * G3;\n    let z3 = z0 - 1 + 3 * G3;\n\n    // Work out the hashed gradient indices of the four simplex corners\n    i &= 255;\n    j &= 255;\n    k &= 255;\n    let gi0 = gradP[i+   perm[j+   perm[k   ]]];\n    let gi1 = gradP[i+i1+perm[j+j1+perm[k+k1]]];\n    let gi2 = gradP[i+i2+perm[j+j2+perm[k+k2]]];\n    let gi3 = gradP[i+ 1+perm[j+ 1+perm[k+ 1]]];\n\n    // Calculate the contribution from the four corners\n    let t0 = 0.6 - x0*x0 - y0*y0 - z0*z0;\n    if (t0<0) {\n        n0 = 0;\n    } else {\n        t0 *= t0;\n        n0 = t0 * t0 * gi0.dot3(x0, y0, z0);  // (x,y) of grad3 used for 2D gradient\n    }\n    let t1 = 0.6 - x1*x1 - y1*y1 - z1*z1;\n    if (t1<0) {\n        n1 = 0;\n    } else {\n        t1 *= t1;\n        n1 = t1 * t1 * gi1.dot3(x1, y1, z1);\n    }\n    let t2 = 0.6 - x2*x2 - y2*y2 - z2*z2;\n    if (t2<0) {\n        n2 = 0;\n    } else {\n        t2 *= t2;\n        n2 = t2 * t2 * gi2.dot3(x2, y2, z2);\n    }\n    let t3 = 0.6 - x3*x3 - y3*y3 - z3*z3;\n    if (t3<0) {\n        n3 = 0;\n    } else {\n        t3 *= t3;\n        n3 = t3 * t3 * gi3.dot3(x3, y3, z3);\n    }\n    // Add contributions from each corner to get the final noise value.\n    // The result is scaled to return values in the interval [-1,1].\n    return 32 * (n0 + n1 + n2 + n3);\n\n};\n*/\n// ##### Perlin noise stuff\n/*\nfunction fade(t) {\n    return t*t*t*(t*(t*6-15)+10);\n}\n\nfunction lerp(a, b, t) {\n    return (1-t)*a + t*b;\n}\n\n// 2D Perlin Noise\nmyModule.perlin2 = function(x, y) {\n    // Find unit grid cell containing point\n    let X = Math.floor(x), Y = Math.floor(y);\n    // Get relative xy coordinates of point within that cell\n    x = x - X; y = y - Y;\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\n    X = X & 255; Y = Y & 255;\n\n    // Calculate noise contributions from each of the four corners\n    let n00 = gradP[X+perm[Y]].dot2(x, y);\n    let n01 = gradP[X+perm[Y+1]].dot2(x, y-1);\n    let n10 = gradP[X+1+perm[Y]].dot2(x-1, y);\n    let n11 = gradP[X+1+perm[Y+1]].dot2(x-1, y-1);\n\n    // Compute the fade curve value for x\n    let u = fade(x);\n\n    // Interpolate the four results\n    return lerp(\n        lerp(n00, n10, u),\n        lerp(n01, n11, u),\n        fade(y));\n};*/\n/*\n// 3D Perlin Noise\nmyModule.perlin3 = function(x, y, z) {\n    // Find unit grid cell containing point\n    let X = Math.floor(x), Y = Math.floor(y), Z = Math.floor(z);\n    // Get relative xyz coordinates of point within that cell\n    x = x - X; y = y - Y; z = z - Z;\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\n    X = X & 255; Y = Y & 255; Z = Z & 255;\n\n    // Calculate noise contributions from each of the eight corners\n    let n000 = gradP[X+  perm[Y+  perm[Z  ]]].dot3(x,   y,     z);\n    let n001 = gradP[X+  perm[Y+  perm[Z+1]]].dot3(x,   y,   z-1);\n    let n010 = gradP[X+  perm[Y+1+perm[Z  ]]].dot3(x,   y-1,   z);\n    let n011 = gradP[X+  perm[Y+1+perm[Z+1]]].dot3(x,   y-1, z-1);\n    let n100 = gradP[X+1+perm[Y+  perm[Z  ]]].dot3(x-1,   y,   z);\n    let n101 = gradP[X+1+perm[Y+  perm[Z+1]]].dot3(x-1,   y, z-1);\n    let n110 = gradP[X+1+perm[Y+1+perm[Z  ]]].dot3(x-1, y-1,   z);\n    let n111 = gradP[X+1+perm[Y+1+perm[Z+1]]].dot3(x-1, y-1, z-1);\n\n    // Compute the fade curve value for x, y, z\n    let u = fade(x);\n    let v = fade(y);\n    let w = fade(z);\n\n    // Interpolate\n    return lerp(\n        lerp(\n            lerp(n000, n100, u),\n            lerp(n001, n101, u), w),\n        lerp(\n            lerp(n010, n110, u),\n            lerp(n011, n111, u), w),\n        v);\n};*/\n\nexport const noise = myModule;","import {BB} from '../../bb/bb';\nimport {IRGB, IRGBA} from '../kl.types';\nimport {IBounds, IPressureInput} from '../../bb/bb.types';\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\n\nconst cellSize = 256;\n\ninterface IDrawBufferItem {\n    x: number;\n    y: number;\n    size: number;\n    opacity: number;\n    x1: number;\n    y1: number;\n    x2: number;\n    y2: number;\n    r: number;\n    g: number;\n    b: number;\n}\n\n// faster than using BB.clamp somehow (in chrome)\nfunction clamp(num, min, max) {\n    return num <= min\n        ? min\n        : num >= max\n            ? max\n            : num\n}\n\nexport class BlendBrush {\n\n    private isTesting: boolean = false; // testing mode - context only gets updated when line is finished\n\n    private context: CanvasRenderingContext2D;\n    private color: IRGB;\n    private size: number = 29; // radius - 0.5 - 99999\n    private opacity: number = 0.6; // 0-1\n    private blending: number = 0.65; // 0-1\n\n    private settingLockLayerAlpha: boolean = false;\n    private settingSizePressure: boolean = true;\n    private settingOpacityPressure: boolean = false;\n\n    private blendCol: IRGBA = {r: 0, g: 0, b: 0, a: 1}; // todo docs\n    private blendMix: number = 0.45; // todo docs\n    private mixr: number; // todo docs\n    private mixg: number; // todo docs\n    private mixb: number; // todo docs\n    private localColOld: IRGBA; // todo docs\n\n    private isDrawing: boolean = false;\n    private lastInput: IPressureInput = {x: 0, y: 0, pressure: 0}; // todo docs\n    private lastInput2: IPressureInput = {x: 0, y: 0, pressure: 0}; // todo docs\n    private bezierLine: any; // todo type\n\n    private history: KlHistoryInterface | null;\n    private historyEntry: IHistoryEntry;\n    private redrawBounds: IBounds;\n    private cells: (ImageData | null)[];\n    private drawBuffer: IDrawBufferItem[];\n\n    private updateRedrawBounds (bounds: IBounds): void {\n        this.redrawBounds = BB.updateBounds(this.redrawBounds, bounds);\n    }\n\n    private getCellsWidth(): number {\n        return Math.ceil(this.context.canvas.width / cellSize);\n    }\n\n    /**\n     * draw changed cells (changed by brushstroke) onto context\n     * @private\n     */\n    private drawChangedCells(): void {\n        const cells = this.cells.map(item => null);\n        const touchedCells = this.getTouchedCells(this.redrawBounds);\n        touchedCells.forEach((isTouched, index) => {\n            if (isTouched) {\n                cells[index] = this.cells[index];\n            }\n        });\n        this.drawCells(cells);\n        this.redrawBounds = null;\n    }\n\n    private getTouchedCells(bounds: IBounds): boolean[] {\n        const touchedCells = this.cells.map(item => false);\n        const cellsW = this.getCellsWidth();\n        bounds = {\n            x1: Math.floor(bounds.x1 / cellSize),\n            y1: Math.floor(bounds.y1 / cellSize),\n            x2: Math.floor(bounds.x2 / cellSize),\n            y2: Math.floor(bounds.y2 / cellSize),\n        };\n        for (let i = bounds.x1; i <= bounds.x2; i++) {\n            for (let e = bounds.y1; e <= bounds.y2; e++) {\n                touchedCells[e * cellsW + i] = true;\n            }\n        }\n        return touchedCells;\n    }\n\n    /**\n     * Slice up bounds accordings to cells\n     * @param bounds\n     * @private\n     */\n    private sliceBounds(bounds: IBounds): {index: number; bounds: IBounds}[] {\n        const cellsW = this.getCellsWidth();\n        const result: {index: number; bounds: IBounds}[] = [];\n        const touchedCells = this.getTouchedCells(bounds);\n\n        touchedCells.forEach((cell, i) => {\n            if (!cell) {\n                return;\n            }\n\n            const cellOffsetX = (i % cellsW) * cellSize;\n            const cellOffsetY = Math.floor(i / cellsW) * cellSize;\n            const cellWidth = this.cells[i].width;\n            const cellHeight = this.cells[i].height;\n\n            const inCellBounds = {\n                x1: Math.max(0, bounds.x1 - cellOffsetX),\n                y1: Math.max(0, bounds.y1 - cellOffsetY),\n                x2: Math.min(cellWidth - 1, bounds.x2 - cellOffsetX),\n                y2: Math.min(cellHeight - 1, bounds.y2 - cellOffsetY),\n            }\n            if (inCellBounds.x1 > inCellBounds.x2 || inCellBounds.y1 > inCellBounds.y2) {\n                return;\n            }\n            result.push({\n                index: i,\n                bounds: inCellBounds,\n            });\n        });\n\n        return result;\n    }\n\n    /**\n     * update copyImageData. copy over new regions if needed\n     */\n    private copyFromCanvas(bounds: IBounds) {\n        if (!bounds) {\n            return;\n        }\n\n        const touchedCells = this.getTouchedCells(bounds);\n        const cellsW = this.getCellsWidth();\n\n        touchedCells.forEach((item, i) => {\n            if (!item || this.cells[i]) {\n                // not touched, or already copied\n                return;\n            }\n            const x = i % cellsW;\n            const y = Math.floor(i / cellsW);\n            const w = (Math.min(x * cellSize + cellSize, this.context.canvas.width) - 1) % cellSize + 1;\n            const h = (Math.min(y * cellSize + cellSize, this.context.canvas.height) - 1) % cellSize + 1;\n\n            // temp canvas to prevent main canvas from getting slowed down in chrome\n            const tmpCanvas = BB.canvas(w, h);\n            const tmpCtx = tmpCanvas.getContext('2d');\n            tmpCtx.drawImage(this.context.canvas, -x * cellSize, -y * cellSize);\n\n            this.cells[i] = tmpCtx.getImageData(0, 0, w, h);\n        });\n    }\n\n    private getAverage (x, y, size): IRGBA {\n\n        size = Math.max(0.5, size * 0.75);\n        const x1 = Math.max(0, Math.floor(x - size));\n        const y1 = Math.max(0, Math.floor(y - size));\n        const x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\n        const y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\n        if (x1 > x2 || y1 > y2) {\n            return {\n                r: 0,\n                g: 0,\n                b: 0,\n                a: 0,\n            };\n        }\n\n        let ar = 0, ag = 0, ab = 0, aa = 0, alpha;\n\n        const slicedBounds = this.sliceBounds({ x1, y1, x2, y2 });\n        slicedBounds.forEach(slice => {\n            const width = this.cells[slice.index].width;\n            const data = this.cells[slice.index].data;\n            const bounds = slice.bounds;\n\n            for (let i = bounds.y1; i <= bounds.y2; i += 4) {\n                for (let e = bounds.x1, e2 = i * width * 4 + bounds.x1 * 4; e <= bounds.x2; e += 4, e2 += 4 * 4) {\n                    alpha = data[e2 + 3];\n                    ar += data[e2] * alpha;\n                    ag += data[e2 + 1] * alpha;\n                    ab += data[e2 + 2] * alpha;\n                    aa += alpha;\n                }\n            }\n        });\n\n        if (aa !== 0) {\n            ar /= aa;\n            ag /= aa;\n            ab /= aa;\n            aa = Math.min(1, aa);\n        }\n        return {\n            r: ar,\n            g: ag,\n            b: ab,\n            a: aa\n        };\n    }\n\n    private prepDot (x: number, y: number, size: number): IBounds {\n        size = Math.max(0.5, size);\n        let x1 = Math.max(0, Math.floor(x - size));\n        let y1 = Math.max(0, Math.floor(y - size));\n        let x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\n        let y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\n        if (x1 > x2 || y1 > y2) {\n            return null;\n        }\n        return { x1, y1, x2, y2 };\n    }\n\n    private drawDot (params: IDrawBufferItem): void {\n        // array with random numbers. faster than Math.random()\n        let randI = 0;\n        const randLen = params.size > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\n        const randArr = [];\n        for (let i = 0; i < randLen; i++) {\n            randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\n        }\n\n        // thin lines take more than just 1 sample\n        const sampleArr = [8,4,4,4,2,2,2,2,2,2]; // <0.5, 0.5, 1, 1.5, etc.\n        const samples = sampleArr[Math.floor(params.size * 2)];\n        const samplesSquared: number = samples ? samples * samples : 0;\n        const sampleOffsets = [];\n        if (samples) {\n            let i = 0;\n            for (let n = 0; n < samples; n++) {\n                for (let m = 0; m < samples; m++, i += 2) {\n                    sampleOffsets[i] = (n + 1) / samples; // x offset\n                    sampleOffsets[i + 1] = (m + 1) / samples; // y offset\n                }\n            }\n        }\n\n        const sharpness = Math.pow(params.opacity, 2) * 0.8;\n        // to optimize calculations\n        const invSharpness = 1 - sharpness;\n        const sharpnessSubtrahend = sharpness / invSharpness;\n        const sizeSquared = params.size * params.size;\n        const distDivisor = sizeSquared * invSharpness / params.opacity;\n        const alphaMinuend = (1 + sharpnessSubtrahend) * params.opacity;\n\n\n        const slicedBounds = this.sliceBounds({\n            x1: params.x1,\n            y1: params.y1,\n            x2: params.x2,\n            y2: params.y2,\n        });\n\n        const cellsW = this.getCellsWidth();\n        slicedBounds.forEach(slice => {\n            const cellOffsetX = (slice.index % cellsW) * cellSize;\n            const cellOffsetY = Math.floor(slice.index / cellsW) * cellSize;\n            const cellWidth = this.cells[slice.index].width;\n            const data = this.cells[slice.index].data;\n\n            // i - y index within cell\n            // e - x index within cell\n\n            // e2 - index in image data\n\n            // ri - y index within image relative to dot-center\n            // re - x index within image relative to dot-center\n\n            for (let i = slice.bounds.y1, ri = i + cellOffsetY - params.y; i <= slice.bounds.y2; i++, ri++) {\n                for (\n                    let e = slice.bounds.x1,\n                        e2 = i * cellWidth * 4 + slice.bounds.x1 * 4,\n                        re = e + cellOffsetX - params.x;\n                    e <= slice.bounds.x2;\n                    e++,\n                        e2 += 4,\n                        re++\n                ) {\n                    // O = over -> brush-dot\n                    // U = under -> image\n\n                    let alphaO = 0;\n                    if (samplesSquared) {\n                        for (let f = 0; f < sampleOffsets.length; f += 2) {\n                            const dist = BB.lenSquared(re + sampleOffsets[f], ri + sampleOffsets[f + 1]);\n                            if (dist >= sizeSquared) {\n                                continue;\n                            }\n                            alphaO += clamp(alphaMinuend - dist / distDivisor, 0, params.opacity);\n                        }\n                        if (!alphaO) {\n                            continue;\n                        }\n                        alphaO /= samplesSquared;\n                    } else {\n                        // technically needs + 0.5 offset, but not noticeable with large brush\n                        const dist = Math.pow(re, 2) + Math.pow(ri, 2);\n                        if (dist >= sizeSquared) {\n                            continue;\n                        }\n                        alphaO = clamp(alphaMinuend - dist / distDivisor, 0, params.opacity);\n                    }\n\n                    const invAlphaO = 1 - alphaO;\n                    const alphaU =data[e2 + 3] / 255;\n\n                    if (this.settingLockLayerAlpha) {\n                        const underR = (params.r * alphaO) + ((data[e2]) * invAlphaO);\n                        const underG = (params.g * alphaO) + ((data[e2 + 1]) * invAlphaO);\n                        const underB = (params.b * alphaO) + ((data[e2 + 2]) * invAlphaO);\n                        if (alphaU) {\n                            data[e2] = Math.floor(underR + randArr[randI]);\n                            data[e2 + 1] = Math.floor(underG + randArr[randI]);\n                            data[e2 + 2] = Math.floor(underB + randArr[randI]);\n                        }\n                    } else {\n                        const underR = (params.r * alphaO) + ((data[e2] * alphaU) * invAlphaO);\n                        const underG = (params.g * alphaO) + ((data[e2 + 1] * alphaU) * invAlphaO);\n                        const underB = (params.b * alphaO) + ((data[e2 + 2] * alphaU) * invAlphaO);\n\n                        let newAlpha = 1 - invAlphaO * (1 - alphaU);\n                        data[e2 + 3] = Math.floor(Math.min(255, newAlpha * 255) + 0.5);\n                        if (newAlpha) {\n                            data[e2] = Math.floor(underR / (newAlpha) + randArr[randI]);\n                            data[e2 + 1] = Math.floor(underG / (newAlpha) + randArr[randI]);\n                            data[e2 + 2] = Math.floor(underB / (newAlpha) + randArr[randI]);\n                        }\n                    }\n                    randI = (randI + 1) % randLen;\n\n                }\n            }\n\n        });\n    }\n\n    private calcSpacing (size: number): number {\n        return BB.mix(\n            (size * 2) / 2, // until size 5.3\n            (size * 2) / 9, // at size 24\n            BB.clamp((size - 2.7) / (12 - 2.7), 0, 1)\n        );\n    }\n\n    private continueLine (x: number, y: number, p: number, isCoalesced: boolean): void {\n\n        this.drawBuffer = [];\n\n        let localPressure;\n        let localOpacity;\n        let localSize = (this.settingSizePressure) ? Math.max(1, p * this.size) : Math.max(1, this.size);\n\n        let bdist = this.calcSpacing(localSize);\n\n        let avgX = x;\n        let avgY = y;\n        if (x === null) {\n            avgX = this.lastInput.x;\n            avgY = this.lastInput.y;\n        }\n\n        let localColNew;\n\n        if (this.blending === 0) {\n            this.mixr = this.color.r;\n            this.mixg = this.color.g;\n            this.mixb = this.color.b;\n        } else {\n            let average;\n            if (isCoalesced) {\n                average = {r: this.localColOld.r, g: this.localColOld.g, b: this.localColOld.b, a: 0};\n            } else {\n                const avgParams = [avgX, avgY, ((this.settingSizePressure) ? Math.max(0.5, p * this.size) : Math.max(0.5, this.size))];\n                const bounds = this.prepDot(avgParams[0], avgParams[1], avgParams[2]);\n                this.copyFromCanvas(bounds);\n                average = this.getAverage(avgParams[0], avgParams[1], avgParams[2]);\n            }\n            localColNew = {r: 0, g: 0, b: 0, a: 0};\n\n            if (average.a > 0 && this.blendCol.a === 0) {\n                this.blendCol.r = average.r;\n                this.blendCol.g = average.g;\n                this.blendCol.b = average.b;\n                this.blendCol.a = average.a;\n                localColNew.r = this.blendCol.r;\n                localColNew.g = this.blendCol.g;\n                localColNew.b = this.blendCol.b;\n                localColNew.a = this.blendCol.a;\n\n            } else {\n                if (average.a === 0) {\n                    average.r = this.color.r;\n                    average.g = this.color.g;\n                    average.b = this.color.b;\n                    average.a = 1 - this.blending;\n                }\n\n                this.blendCol.r = BB.mix(this.blendCol.r, BB.mix(this.blendCol.r, average.r, this.blendMix), average.a);\n                this.blendCol.g = BB.mix(this.blendCol.g, BB.mix(this.blendCol.g, average.g, this.blendMix), average.a);\n                this.blendCol.b = BB.mix(this.blendCol.b, BB.mix(this.blendCol.b, average.b, this.blendMix), average.a);\n                this.blendCol.a = Math.min(1, this.blendCol.a + average.a);\n                localColNew.r = this.blendCol.r;\n                localColNew.g = this.blendCol.g;\n                localColNew.b = this.blendCol.b;\n                localColNew.a = this.blendCol.a;\n            }\n\n        }\n\n\n        const bezierCallback = (val) => {\n            if (this.blending >= 1 && this.blendCol.a <= 0) {\n                return;\n            }\n            let factor = val.t;\n            localPressure = this.lastInput2.pressure * (1 - factor) + p * factor;\n            localOpacity = (this.settingOpacityPressure) ? (this.opacity * localPressure * localPressure) : this.opacity;\n            localSize = (this.settingSizePressure) ? Math.max(0.1, localPressure * this.size) : Math.max(0.1, this.size);\n            if (this.blending != 0) {\n                this.mixr = BB.mix(this.localColOld.r, localColNew.r, factor);\n                this.mixg = BB.mix(this.localColOld.g, localColNew.g, factor);\n                this.mixb = BB.mix(this.localColOld.b, localColNew.b, factor);\n            }\n            if (this.blending === 1 && this.localColOld.a === 0) {\n                this.mixr = localColNew.r;\n                this.mixg = localColNew.g;\n                this.mixb = localColNew.b;\n            }\n            const bounds = this.prepDot(val.x, val.y, localSize);\n            if (bounds) {\n                this.updateRedrawBounds(bounds);\n                this.drawBuffer.push({\n                    x: val.x,\n                    y: val.y,\n                    size: localSize,\n                    opacity: localOpacity,\n                    x1: bounds.x1,\n                    y1: bounds.y1,\n                    x2: bounds.x2,\n                    y2: bounds.y2,\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\n                })\n            }\n        };\n\n        if (x === null) {\n            this.bezierLine.addFinal(bdist, bezierCallback);\n        } else {\n            this.bezierLine.add(x, y, bdist, bezierCallback);\n        }\n\n        this.copyFromCanvas(this.redrawBounds);\n        this.drawBuffer.forEach(item => {\n            this.drawDot(item);\n        });\n        this.drawBuffer = [];\n\n        this.localColOld = localColNew;\n    }\n\n\n\n\n\n    // --- public ----\n    constructor () {\n    }\n\n    setHistory (h: KlHistoryInterface): void {\n        this.history = h;\n    }\n\n    getSize (): number {\n        return this.size;\n    }\n\n    setSize (s: number): void {\n        this.size = s;\n    }\n\n    getOpacity (): number {\n        return this.opacity;\n    }\n\n    setOpacity (o: number): void {\n        this.opacity = o;\n    }\n\n    getBlending (): number {\n        return this.blending;\n    }\n\n    setBlending (b: number) {\n        this.blending = b;\n    }\n\n    setColor (c: IRGB): void {\n        this.color = BB.copyObj(c);\n    }\n\n    setContext (c: CanvasRenderingContext2D) {\n        this.context = c;\n    }\n\n    setSizePressure (b: boolean): void {\n        this.settingSizePressure = !!b;\n    }\n\n    setOpacityPressure (b: boolean): void {\n        this.settingOpacityPressure = !!b;\n    }\n\n    getLockAlpha (): boolean {\n        return this.settingLockLayerAlpha;\n    }\n\n    setLockAlpha (b: boolean): void {\n        this.settingLockLayerAlpha = !!b;\n    }\n\n    getIsDrawing (): boolean {\n        return this.isDrawing;\n    }\n\n    setIsTesting (b: boolean): void {\n        this.isTesting = !!b;\n    }\n\n    startLine (x: number, y: number, p: number): void {\n        this.historyEntry = {\n            tool: [\"brush\", \"BlendBrush\"],\n            actions: []\n        };\n\n\n        const totalCells = Math.ceil(this.context.canvas.width / cellSize) * Math.ceil(this.context.canvas.height / cellSize);\n        this.cells = '0'.repeat(totalCells).split('').map(item => null);\n\n        this.isDrawing = true;\n\n        p = Math.max(0, Math.min(1, p));\n        let localOpacity = (this.settingOpacityPressure) ? (this.opacity * p * p) : this.opacity;\n        let localSize = (this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\n        if (this.blending === 0) {\n            this.mixr = this.color.r;\n            this.mixg = this.color.g;\n            this.mixb = this.color.b;\n        } else {\n            this.copyFromCanvas(this.prepDot(x, y, localSize));\n\n            let average = this.getAverage(\n                x,\n                y,\n                ((this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size))\n            );\n            if (average.a === 0) {\n                this.blendCol = {\n                    r: this.color.r,\n                    g: this.color.g,\n                    b: this.color.b,\n                    a: 1 - this.blending,\n                };\n            } else {\n                this.blendCol = {\n                    r: average.r,\n                    g: average.g,\n                    b: average.b,\n                    a: average.a,\n                };\n            }\n\n            this.mixr = this.blendCol.r;\n            this.mixg = this.blendCol.g;\n            this.mixb = this.blendCol.b;\n        }\n\n        this.localColOld = {r: this.mixr, g: this.mixg, b: this.mixb, a: this.blendCol.a};\n\n        this.redrawBounds = null;\n        this.drawBuffer = [];\n\n        if (this.blending < 1 || this.blendCol.a > 0) {\n            const bounds = this.prepDot(x, y, localSize);\n            if (bounds) {\n                this.updateRedrawBounds(bounds);\n                this.drawBuffer.push({\n                    x: x,\n                    y: y,\n                    size: localSize,\n                    opacity: localOpacity,\n                    x1: bounds.x1,\n                    y1: bounds.y1,\n                    x2: bounds.x2,\n                    y2: bounds.y2,\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\n                })\n            }\n        }\n\n        this.copyFromCanvas(this.redrawBounds);\n        this.drawBuffer.forEach(item => {\n            this.drawDot(item);\n        });\n        this.drawBuffer = [];\n\n        this.bezierLine = new BB.BezierLine();\n        this.bezierLine.add(x, y, 0, function () {\n        });\n\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n        this.lastInput2 = BB.copyObj(this.lastInput);\n\n        if (this.redrawBounds && !this.isTesting) {\n            this.drawChangedCells();\n        }\n    }\n\n    goLine (x: number, y: number, p: number, isCoalesced: boolean): void {\n        if (!this.isDrawing) {\n            return;\n        }\n        this.continueLine(x, y, this.lastInput.pressure, isCoalesced);\n\n        this.lastInput2 = BB.copyObj(this.lastInput);\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n\n        if (this.redrawBounds && !this.isTesting) {\n            this.drawChangedCells();\n        }\n    }\n\n    endLine (): void {\n        if (this.bezierLine) {\n            this.continueLine(null, null, this.lastInput.pressure, false);\n        }\n\n        this.isDrawing = false;\n        this.bezierLine = null;\n\n        if (this.redrawBounds) {\n            this.drawChangedCells();\n        }\n\n        if (this.historyEntry && this.history && this.cells.find(item => !!item)) {\n            this.historyEntry.actions.push({\n                action: \"drawCells\",\n                params: [this.cells],\n            });\n            this.history.push(this.historyEntry);\n            this.historyEntry = null;\n        }\n        this.cells = null;\n    }\n\n    /**\n     * draw cells onto context\n     * @param cells\n     */\n    drawCells (cells: (ImageData | null)[]): void {\n        const cellsW = this.getCellsWidth();\n        cells.forEach((imageData, index) => {\n            if (!imageData) {\n                return;\n            }\n            const cellOffsetX = (index % cellsW) * cellSize;\n            const cellOffsetY = Math.floor(index / cellsW) * cellSize;\n            this.context.putImageData(imageData, cellOffsetX, cellOffsetY);\n        });\n    }\n\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\n        this.lastInput.x = x2;\n        this.lastInput.y = y2;\n\n        if (this.isDrawing || x1 === undefined) {\n            return;\n        }\n\n        const totalCells = Math.ceil(this.context.canvas.width / cellSize) * Math.ceil(this.context.canvas.height / cellSize);\n        this.cells = '0'.repeat(totalCells).split('').map(item => null);\n        this.redrawBounds = null;\n        this.drawBuffer = [];\n\n        this.copyFromCanvas(this.prepDot(x1, y1, Math.max(0.1, this.size)));\n        let average = this.getAverage(x1, y1, Math.max(0.1, this.size));\n\n        if (average.a === 0) {\n            this.blendCol = {\n                r: this.color.r,\n                g: this.color.g,\n                b: this.color.b,\n                a: 1 - this.blending,\n            };\n        } else {\n            this.blendCol = {\n                r: average.r,\n                g: average.g,\n                b: average.b,\n                a: average.a,\n            };\n        }\n\n        this.mixr = this.color.r * (1 - this.blendCol.a) + (this.blending * this.blendCol.r + this.color.r * (1 - this.blending)) * this.blendCol.a;\n        this.mixg = this.color.g * (1 - this.blendCol.a) + (this.blending * this.blendCol.g + this.color.g * (1 - this.blending)) * this.blendCol.a;\n        this.mixb = this.color.b * (1 - this.blendCol.a) + (this.blending * this.blendCol.b + this.color.b * (1 - this.blending)) * this.blendCol.a;\n\n\n        const p = 1;\n        const localOpacity = (this.settingOpacityPressure) ? (this.opacity * p * p) : this.opacity;\n        const localSize = (this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\n\n\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n        const eX = (x2 - x1) / mouseDist;\n        const eY = (y2 - y1) / mouseDist;\n        const bdist = this.calcSpacing(localSize);\n        for (let loopDist = 0; loopDist <= mouseDist; loopDist += bdist) {\n            const bounds = this.prepDot(x1 + eX * loopDist, y1 + eY * loopDist, localSize);\n            if (bounds) {\n                this.copyFromCanvas(bounds);\n                this.drawBuffer.push({\n                    x: x1 + eX * loopDist,\n                    y: y1 + eY * loopDist,\n                    size: localSize,\n                    opacity: localOpacity,\n                    x1: bounds.x1,\n                    y1: bounds.y1,\n                    x2: bounds.x2,\n                    y2: bounds.y2,\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\n                })\n            }\n        }\n        this.drawBuffer.forEach(item => {\n            this.drawDot(item);\n        });\n        this.drawBuffer = [];\n\n        if (this.history && this.cells.find(item => !!item)) {\n            this.drawCells(this.cells);\n            this.historyEntry = {\n                tool: [\"brush\", \"BlendBrush\"],\n                actions: [{\n                    action: \"drawCells\",\n                    params: [this.cells],\n                }],\n            };\n            this.history.push(this.historyEntry);\n            this.historyEntry = null;\n        }\n        this.cells = null;\n    }\n}\n","import {BB} from '../../bb/bb';\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\nimport {KL} from '../kl';\n\nconst sampleCanvas = BB.canvas(32, 32);\nconst sampleCtx = sampleCanvas.getContext('2d');\n\nexport function SketchyBrush() {\n    let context;\n    let settingColor;\n\n    let settingSize = 1, settingOpacity = 0.2;\n    let settingBlending = 0.5;\n    let settingScale = 1;\n\n    let lastX, lastY;\n    let isDrawing = false;\n    let lastInput = {x: 0, y: 0, pressure: 0};\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\n    let historyEntry: IHistoryEntry;\n    let sketchySeed = 0;\n    this.setHistory = function (l: KlHistoryInterface) {\n        history = l;\n    };\n    this.setSeed = function (s) {\n        sketchySeed = parseInt(s);\n    };\n    this.getSeed = function () {\n        return parseInt('' + sketchySeed);\n    };\n\n    function rand() {\n        sketchySeed++;\n        return Math.sin(6324634.2345 * Math.cos(sketchySeed * 5342.3423)) * 0.5 + 0.5;\n    }\n\n    let points = [];\n    let count = 0;\n    let mixmode = [\n        function (c1, c2) {\n            return c1;\n        },\n        function (c1, c2) {\n            let result = new BB.RGB(c1.r, c1.g, c1.b);\n            result.r *= c2.r / 255;\n            result.g *= c2.g / 255;\n            result.b *= c2.b / 255;\n            return result;\n        },\n        function (c1, c2) {\n            let result = new BB.RGB(c1.r, c1.g, c1.b);\n            result.r *= c2.r / 255;\n            result.g *= c2.g / 255;\n            result.b *= c2.b / 255;\n            return result;\n        }\n    ];\n\n    this.getSize = function () {\n        return settingSize / 2;\n    };\n    this.setColor = function (c) {\n        settingColor = c;\n    };\n    this.getOpacity = function () {\n        return settingOpacity;\n    };\n    this.setOpacity = function (o) {\n        settingOpacity = o;\n    };\n    this.getBlending = function () {\n        return settingBlending;\n    };\n    this.setBlending = function (b) {\n        settingBlending = b;\n    };\n    this.setSize = function (s) {\n        settingSize = s * 2;\n    };\n    this.getScale = function () {\n        return settingScale;\n    };\n    this.setScale = function (s) {\n        settingScale = s;\n    };\n    this.setContext = function (c) {\n        context = c;\n    };\n    this.startLine = function (x, y, pressure, shift) {\n        if (shift && lastInput.x) {\n            let lx = lastInput.x, ly = lastInput.y;\n            isDrawing = true;\n            //this.goLine(x,y,pressure);\n            this.endLine();\n        } else {\n            isDrawing = true;\n            lastX = x;\n            lastY = y;\n            lastInput.x = x;\n            lastInput.y = y;\n            historyEntry = {\n                tool: [\"brush\", \"SketchyBrush\"],\n                actions: []\n            };\n            historyEntry.actions.push({\n                action: \"setScale\",\n                params: [settingScale]\n            });\n            historyEntry.actions.push({\n                action: \"setSize\",\n                params: [settingSize / 2]\n            });\n            historyEntry.actions.push({\n                action: \"setOpacity\",\n                params: [settingOpacity]\n            });\n            historyEntry.actions.push({\n                action: \"setColor\",\n                params: [settingColor]\n            });\n            historyEntry.actions.push({\n                action: \"setBlending\",\n                params: [settingBlending]\n            });\n            historyEntry.actions.push({\n                action: \"startLine\",\n                params: [x, y, pressure]\n            });\n        }\n\n    };\n    this.goLine = function (p_x, p_y, pressure, preMixedColor) {\n        if (!isDrawing || (p_x === lastInput.x && p_y === lastInput.y)) {\n            return;\n        }\n\n        let e, b, a, g;\n        let x = parseInt(p_x);\n        let y = parseInt(p_y);\n        points.push([x, y]);\n\n        let mixr = settingColor.r;\n        let mixg = settingColor.g;\n        let mixb = settingColor.b;\n\n        if (preMixedColor !== null) {\n            mixr = preMixedColor.r;\n            mixg = preMixedColor.g;\n            mixb = preMixedColor.b;\n        } else {\n            if (settingBlending !== 0) {\n                if (x + 5 >= 0 && y + 5 >= 0 && x - 5 < context.canvas.width - 1 && y - 5 < context.canvas.height - 1) {\n                    mixr = 0;\n                    mixg = 0;\n                    mixb = 0;\n                    let mixx = Math.min(context.canvas.width - 1, Math.max(0, x - 5));\n                    let mixy = Math.min(context.canvas.height - 1, Math.max(0, y - 5));\n                    let mixw = Math.min(context.canvas.width - 1, Math.max(0, x + 5));\n                    let mixh = Math.min(context.canvas.height - 1, Math.max(0, y + 5));\n                    mixw -= mixx;\n                    mixh -= mixy;\n\n                    if (mixw > 0 && mixh > 0) {\n                        let imdat = context.getImageData(mixx, mixy, mixw, mixh);\n                        let countmix = 0;\n                        for (let i = 0; i < imdat.data.length; i += 4) {\n                            mixr += imdat.data[i + 0];\n                            mixg += imdat.data[i + 1];\n                            mixb += imdat.data[i + 2];\n                            countmix++;\n                        }\n                        mixr /= countmix;\n                        mixg /= countmix;\n                        mixb /= countmix;\n                    }\n\n                    let mixed = mixmode[0](new BB.RGB(mixr, mixg, mixb), settingColor);\n                    mixr = parseInt('' + BB.mix(settingColor.r, mixed.r, settingBlending));\n                    mixg = parseInt('' + BB.mix(settingColor.g, mixed.g, settingBlending));\n                    mixb = parseInt('' + BB.mix(settingColor.b, mixed.b, settingBlending));\n                }\n            }\n        }\n\n        context.save();\n        context.strokeStyle = \"rgba(\" + mixr + \", \" + mixg + \", \" + mixb + \", \" + settingOpacity + \")\";\n        context.lineWidth = settingSize;\n\n        context.beginPath();\n        context.moveTo(lastX, lastY);\n        context.lineTo(x, y);\n\n        for (e = 0; e < points.length; e++) {\n            b = points[e][0] - points[count][0];\n            a = points[e][1] - points[count][1];\n            g = b * b + a * a;\n            if (g < 4000 * settingScale * settingScale && rand() > g / 2000 / settingScale / settingScale) {\n                context.moveTo(points[count][0] + (b * 0.3), points[count][1] + (a * 0.3));\n                context.lineTo(points[e][0] - (b * 0.3), points[e][1] - (a * 0.3));\n            }\n        }\n\n        context.stroke();\n        context.restore();\n\n\n        count++;\n        lastX = x;\n        lastY = y;\n        lastInput.x = x;\n        lastInput.y = y;\n        historyEntry.actions.push({\n            action: \"goLine\",\n            params: [p_x, p_y, pressure, {r: mixr, g: mixg, b: mixb}]\n        });\n    };\n    this.endLine = function () {\n        isDrawing = false;\n        count = 0;\n        points = [];\n        if (historyEntry) {\n            historyEntry.actions.push({\n                action: \"endLine\",\n                params: []\n            });\n            history.push(historyEntry);\n            historyEntry = undefined;\n        }\n    };\n    //cheap n' ugly\n    this.drawLineSegment = function (x1, y1, x2, y2) {\n        lastInput.x = x2;\n        lastInput.y = y2;\n\n        if (isDrawing || x1 === undefined) {\n            return;\n        }\n\n\n        context.save();\n        context.lineWidth = settingSize;\n\n        let mixr = settingColor.r, mixg = settingColor.g, mixb = settingColor.b;\n        if (x1 + 5 >= 0 && y1 + 5 >= 0 && x1 - 5 < context.canvas.width - 1 && y1 - 5 < context.canvas.height - 1) {\n            mixr = 0;\n            mixg = 0;\n            mixb = 0;\n            let mixx = Math.min(context.canvas.width - 1, Math.max(0, x1 - 5));\n            let mixy = Math.min(context.canvas.height - 1, Math.max(0, y1 - 5));\n            let mixw = Math.min(context.canvas.width - 1, Math.max(0, x1 + 5));\n            let mixh = Math.min(context.canvas.height - 1, Math.max(0, y1 + 5));\n            mixw -= mixx;\n            mixh -= mixy;\n            if (mixw > 0 && mixh > 0) {\n                let w = Math.min(sampleCanvas.width, mixw);\n                let h = Math.min(sampleCanvas.height, mixh);\n                sampleCtx.save();\n                sampleCtx.globalCompositeOperation = 'copy';\n                sampleCtx.drawImage(context.canvas, mixx, mixy, mixw, mixh, 0, 0, w, h);\n                sampleCtx.restore();\n\n                let imdat = sampleCtx.getImageData(mixx, mixy, mixw, mixh);\n                let countmix = 0;\n                for (let i = 0; i < imdat.data.length; i += 4) {\n                    mixr += imdat.data[i + 0];\n                    mixg += imdat.data[i + 1];\n                    mixb += imdat.data[i + 2];\n                    countmix++;\n                }\n                mixr /= countmix;\n                mixg /= countmix;\n                mixb /= countmix;\n            }\n        }\n        let mixed = mixmode[0](new BB.RGB(mixr, mixg, mixb), settingColor);\n        mixr = parseInt('' + (settingBlending * mixed.r + settingColor.r * (1 - settingBlending)));\n        mixg = parseInt('' + (settingBlending * mixed.g + settingColor.g * (1 - settingBlending)));\n        mixb = parseInt('' + (settingBlending * mixed.b + settingColor.b * (1 - settingBlending)));\n        context.strokeStyle = \"rgba(\" + mixr + \", \" + mixg + \", \" + mixb + \", \" + settingOpacity + \")\";\n        context.beginPath();\n        context.moveTo(x1, y1);\n        context.lineTo(x2, y2);\n        context.stroke();\n        context.strokeStyle = \"rgba(\" + mixr + \", \" + mixg + \", \" + mixb + \", \" + settingOpacity + \")\";\n        context.restore();\n\n\n        let historyEntry = {\n            tool: [\"brush\", \"SketchyBrush\"],\n            actions: []\n        };\n        historyEntry.actions.push({\n            action: \"setScale\",\n            params: [settingScale]\n        });\n        historyEntry.actions.push({\n            action: \"setSize\",\n            params: [settingSize / 2]\n        });\n        historyEntry.actions.push({\n            action: \"setOpacity\",\n            params: [settingOpacity]\n        });\n        historyEntry.actions.push({\n            action: \"setColor\",\n            params: [settingColor]\n        });\n        historyEntry.actions.push({\n            action: \"setBlending\",\n            params: [settingBlending]\n        });\n\n        historyEntry.actions.push({\n            action: \"drawLineSegment\",\n            params: [x1, y1, x2, y2]\n        });\n        history.push(historyEntry);\n    };\n\n    this.isDrawing = function () {\n        return isDrawing;\n    };\n}","import {BB} from '../../bb/bb';\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\nimport {KL} from '../kl';\n\nexport function PixelBrush() {\n\n    let context;\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\n    let historyEntry: IHistoryEntry;\n\n    let settingColor, settingSize = 0.5, settingSpacing = 0.9, settingOpacity = 1;\n    let settingColorStr;\n    let settingHasSizePressure = true, settingHasOpacityPressure = false;\n    let settingLockLayerAlpha = false;\n    let settingIsEraser = false;\n    let settingUseDither = true;\n\n    let lineToolLastDot;\n    let lastInput = {x: 0, y: 0, pressure: 0};\n    let lastInput2 = {x: 0, y: 0, pressure: 0};\n\n    let isDrawing = false;\n    let bezierLine = null;\n    let twoPI = Math.PI * 2;\n\n\n    let ditherCanvas = BB.canvas(4, 4);\n    let ditherCtx = ditherCanvas.getContext('2d');\n    let ditherPattern;\n    let ditherArr = [\n        [3, 2],\n        [1, 0],\n        [3, 0],\n        [1, 2],\n        [2, 1],\n        [0, 3],\n        [0, 1],\n        [2, 3],\n\n        [2, 0],\n        [0, 2],\n        [0, 0],\n        [2, 2],\n        [1, 1],\n        [3, 3],\n        [3, 1],\n        [1, 3]\n    ];\n\n    function updateDither() {\n        ditherCtx.clearRect(0, 0, 4, 4);\n        ditherCtx.fillStyle = settingIsEraser ? '#fff' : settingColorStr;\n        for (let i = 0; i < Math.max(1, Math.round(settingOpacity * ditherArr.length)); i++) {\n            ditherCtx.fillRect(ditherArr[i][0], ditherArr[i][1], 1, 1);\n        }\n        ditherPattern = context.createPattern(ditherCanvas, 'repeat');\n    }\n\n\n    /**\n     * Tests p1->p2 or p3->p4 deviate in their direction more than max, compared to p1->p4\n     * @param p1\n     * @param p2\n     * @param p3\n     * @param p4\n     * @param maxAngleRad\n     */\n    function cubicCurveOverThreshold(p1, p2, p3, p4, max) {\n        let d = BB.Vec2.nor({\n            x: p4.x - p1.x,\n            y: p4.y - p1.y\n        });\n        let d2 = BB.Vec2.nor({\n            x: p2.x - p1.x,\n            y: p2.y - p1.y\n        });\n        let d3 = BB.Vec2.nor({\n            x: p4.x - p3.x,\n            y: p4.y - p3.y\n        });\n        let a2 = Math.abs(BB.Vec2.angle(d, d2) % Math.PI) / Math.PI * 180;\n        let a3 = Math.abs(BB.Vec2.angle(d, d3) % Math.PI) / Math.PI * 180;\n\n        return Math.max(BB.Vec2.dist(d, d2), BB.Vec2.dist(d, d3)) > max;\n    }\n\n    //bresenheim line drawing\n    function plotLine(x0, y0, x1, y1, skipFirst) {\n        context.save();\n\n        if (settingIsEraser) {\n            context.fillStyle = settingUseDither ? ditherPattern : '#fff';\n            if (settingLockLayerAlpha) {\n                context.globalCompositeOperation = \"source-atop\";\n            } else {\n                context.globalCompositeOperation = \"destination-out\";\n            }\n        } else {\n            context.fillStyle = settingUseDither ? ditherPattern : settingColorStr;\n            if (settingLockLayerAlpha) {\n                context.globalCompositeOperation = \"source-atop\";\n            }\n        }\n        context.globalAlpha = settingUseDither ? 1 : settingOpacity;\n\n        x0 = Math.floor(x0);\n        y0 = Math.floor(y0);\n        x1 = Math.floor(x1);\n        y1 = Math.floor(y1);\n\n        let dX = Math.abs(x1 - x0);\n        let sX = x0 < x1 ? 1 : -1;\n        let dY = -Math.abs(y1 - y0);\n        let sY = y0 < y1 ? 1 : -1;\n        let err = dX + dY;\n        while (true) {\n            if (skipFirst) {\n                skipFirst = false;\n            } else {\n                context.fillRect(x0, y0, 1, 1);\n            }\n            if (x0 === x1 && y0 === y1) {\n                break;\n            }\n            let e2 = 2 * err;\n            if (e2 >= dY) {\n                err += dY;\n                x0 += sX;\n            }\n            if (e2 <= dX) {\n                err += dX;\n                y0 += sY;\n            }\n        }\n\n        context.restore();\n    }\n\n    function plotCubicBezierLine(p1, p2, p3, p4) {\n\n        let isOverThreshold = cubicCurveOverThreshold(p1, p2, p3, p4, 0.1);\n\n        p1.x = Math.floor(p1.x);\n        p1.y = Math.floor(p1.y);\n        p4.x = Math.floor(p4.x);\n        p4.y = Math.floor(p4.y);\n\n        let dist = BB.dist(p1.x, p1.y, p4.x, p4.y);\n        if (!isOverThreshold || dist < 7) {\n            plotLine(p1.x, p1.y, p4.x, p4.y, true);\n            return;\n        }\n\n        let n = Math.max(2, Math.round(dist / 4));\n        let pointArr = [];\n        for (let i = 0; i <= n; i++) {\n            let t = i / n;\n            let a = Math.pow(1 - t, 3);\n            let b = 3 * t * Math.pow(1 - t, 2);\n            let c = 3 * Math.pow(t, 2) * (1 - t);\n            let d = Math.pow(t, 3);\n            pointArr.push({\n                x: a * p1.x + b * p2.x + c * p3.x + d * p4.x,\n                y: a * p1.y + b * p2.y + c * p3.y + d * p4.y\n            });\n        }\n\n        for (let i = 0; i < n; i++) {\n            plotLine(\n                Math.round(pointArr[i].x),\n                Math.round(pointArr[i].y),\n                Math.round(pointArr[i + 1].x),\n                Math.round(pointArr[i + 1].y),\n                true\n            );\n        }\n    }\n\n    function drawDot(x, y, size, opacity, angle?) {\n        context.save();\n        if (settingIsEraser) {\n            context.fillStyle = settingUseDither ? ditherPattern : '#fff';\n            if (settingLockLayerAlpha) {\n                context.globalCompositeOperation = \"source-atop\";\n            } else {\n                context.globalCompositeOperation = \"destination-out\";\n            }\n        } else {\n            context.fillStyle = settingUseDither ? ditherPattern : settingColorStr;\n            if (settingLockLayerAlpha) {\n                context.globalCompositeOperation = \"source-atop\";\n            }\n        }\n        context.globalAlpha = settingUseDither ? 1 : opacity;\n        context.fillRect(\n            Math.round(x + -size),\n            Math.round(y + -size),\n            Math.round(size * 2),\n            Math.round(size * 2)\n        );\n        context.restore();\n    }\n\n\n    function continueLine(x, y, size, pressure) {\n        if (bezierLine === null) {\n            bezierLine = new BB.BezierLine();\n            bezierLine.add(lastInput.x, lastInput.y, 0, function () {\n            });\n        }\n\n        context.save();\n\n        function dotCallback(val) {\n            let localPressure = BB.mix(lastInput2.pressure, pressure, val.t);\n            let localOpacity = settingOpacity * (settingHasOpacityPressure ? (localPressure * localPressure) : 1);\n            let localSize = Math.max(0.5, settingSize * (settingHasSizePressure ? localPressure : 1));\n            drawDot(val.x, val.y, localSize, localOpacity, val.angle);\n        }\n\n        function controlCallback(controlObj) {\n            plotCubicBezierLine(controlObj.p1, controlObj.p2, controlObj.p3, controlObj.p4);\n        }\n\n        if (Math.round(settingSize * 2) === 1) {\n            if (x === null) {\n                bezierLine.addFinal(4, null, controlCallback);\n            } else {\n                bezierLine.add(x, y, 4, null, controlCallback);\n            }\n\n        } else {\n            let localSpacing = size * settingSpacing;\n\n            if (x === null) {\n                bezierLine.addFinal(localSpacing, dotCallback);\n            } else {\n                bezierLine.add(x, y, localSpacing, dotCallback);\n            }\n        }\n\n        context.restore();\n    }\n\n    //------------------ interface ---------------------------------------------------\n\n\n    this.startLine = function (x, y, p) {\n        historyEntry = {\n            tool: [\"brush\", \"PixelBrush\"],\n            actions: []\n        };\n        historyEntry.actions.push({\n            action: \"sizePressure\",\n            params: [settingHasSizePressure]\n        });\n        historyEntry.actions.push({\n            action: \"setSize\",\n            params: [settingSize]\n        });\n        historyEntry.actions.push({\n            action: \"setSpacing\",\n            params: [settingSpacing]\n        });\n        historyEntry.actions.push({\n            action: \"setOpacity\",\n            params: [settingOpacity]\n        });\n        historyEntry.actions.push({\n            action: \"setColor\",\n            params: [settingColor]\n        });\n        historyEntry.actions.push({\n            action: \"setLockAlpha\",\n            params: [settingLockLayerAlpha]\n        });\n        historyEntry.actions.push({\n            action: \"setIsEraser\",\n            params: [settingIsEraser]\n        });\n        historyEntry.actions.push({\n            action: \"setUseDither\",\n            params: [settingUseDither]\n        });\n\n        if (settingUseDither) {\n            updateDither();\n        }\n\n        p = Math.max(0, Math.min(1, p));\n        let localOpacity = settingHasOpacityPressure ? (settingOpacity * p * p) : settingOpacity;\n        let localSize = settingHasSizePressure ? Math.max(0.5, p * settingSize) : Math.max(0.5, settingSize);\n\n        isDrawing = true;\n        drawDot(x, y, localSize, localOpacity);\n        lineToolLastDot = localSize * settingSpacing;\n        lastInput.x = x;\n        lastInput.y = y;\n        lastInput.pressure = p;\n        lastInput2 = BB.copyObj(lastInput);\n\n        historyEntry.actions.push({\n            action: \"startLine\",\n            params: [x, y, p]\n        });\n    };\n\n    this.goLine = function (x, y, p) {\n        if (!isDrawing) {\n            return;\n        }\n        historyEntry.actions.push({\n            action: \"goLine\",\n            params: [x, y, p]\n        });\n\n        //debug\n        //drawDot(x, y, 1, 0.5);\n\n        let pressure = BB.clamp(p, 0, 1);\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\n\n        continueLine(x, y, localSize, lastInput.pressure);\n\n        lastInput2 = BB.copyObj(lastInput);\n        lastInput.x = x;\n        lastInput.y = y;\n        lastInput.pressure = pressure;\n    };\n\n    this.endLine = function (x, y) {\n\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\n        continueLine(null, null, localSize, lastInput.pressure);\n\n        //debug\n        //drawDot(lastInput.x, lastInput.y, 3, 1);\n        //drawDot(x, y, 10, 0.1);\n\n        isDrawing = false;\n\n        bezierLine = null;\n\n        if (historyEntry) {\n            historyEntry.actions.push({\n                action: \"endLine\",\n                params: [x, y]\n            });\n            history.push(historyEntry);\n            historyEntry = undefined;\n        }\n    };\n    //cheap n' ugly\n    this.drawLineSegment = function (x1, y1, x2, y2) {\n        lastInput.x = x2;\n        lastInput.y = y2;\n        lastInput.pressure = 1;\n\n        if (isDrawing || x1 === undefined) {\n            return;\n        }\n\n        if (settingUseDither) {\n            updateDither();\n        }\n\n        if (Math.round(settingSize * 2) === 1) {\n            plotLine(x1, y1, x2, y2, true);\n        } else {\n            let angle = BB.pointsToAngleDeg({x: x1, y: y1}, {x: x2, y: y2});\n            let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n            let eX = (x2 - x1) / mouseDist;\n            let eY = (y2 - y1) / mouseDist;\n            let loopDist;\n            let bdist = settingSize * settingSpacing;\n            lineToolLastDot = settingSize * settingSpacing;\n            for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\n                drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity, angle);\n            }\n        }\n\n        let historyEntry = {\n            tool: [\"brush\", \"PixelBrush\"],\n            actions: []\n        };\n        historyEntry.actions.push({\n            action: \"sizePressure\",\n            params: [settingHasSizePressure]\n        });\n        historyEntry.actions.push({\n            action: \"setSize\",\n            params: [settingSize]\n        });\n        historyEntry.actions.push({\n            action: \"setSpacing\",\n            params: [settingSpacing]\n        });\n        historyEntry.actions.push({\n            action: \"setOpacity\",\n            params: [settingOpacity]\n        });\n        historyEntry.actions.push({\n            action: \"setColor\",\n            params: [settingColor]\n        });\n        historyEntry.actions.push({\n            action: \"setLockAlpha\",\n            params: [settingLockLayerAlpha]\n        });\n        historyEntry.actions.push({\n            action: \"setIsEraser\",\n            params: [settingIsEraser]\n        });\n        historyEntry.actions.push({\n            action: \"setUseDither\",\n            params: [settingUseDither]\n        });\n\n        historyEntry.actions.push({\n            action: \"drawLineSegment\",\n            params: [x1, y1, x2, y2]\n        });\n        history.push(historyEntry);\n    };\n\n    //IS\n    this.isDrawing = function () {\n        return isDrawing;\n    };\n    //SET\n    this.setColor = function (c) {\n        if (settingColor === c) {\n            return;\n        }\n        settingColor = c;\n        settingColorStr = \"rgb(\" + settingColor.r + \",\" + settingColor.g + \",\" + settingColor.b + \")\";\n    };\n    this.setContext = function (c) {\n        context = c;\n    };\n    this.setHistory = function (l: KlHistoryInterface) {\n        history = l;\n    };\n    this.setSize = function (s) {\n        settingSize = Math.round(s * 2) / 2;\n    };\n    this.setOpacity = function (o) {\n        settingOpacity = o;\n    };\n    this.setSpacing = function (s) {\n        settingSpacing = s;\n    };\n    this.sizePressure = function (b) {\n        settingHasSizePressure = b;\n    };\n    this.opacityPressure = function (b) {\n        settingHasOpacityPressure = b;\n    };\n    this.setLockAlpha = function (b) {\n        settingLockLayerAlpha = b;\n    };\n    this.setIsEraser = function (b) {\n        settingIsEraser = !!b;\n    };\n    this.setUseDither = function (b) {\n        settingUseDither = !!b;\n    };\n    //GET\n    this.getSpacing = function () {\n        return settingSpacing;\n    };\n    this.getSize = function () {\n        return settingSize;\n    };\n    this.getOpacity = function () {\n        return settingOpacity;\n    };\n    this.getLockAlpha = function () {\n        return settingLockLayerAlpha;\n    };\n    this.getIsEraser = function () {\n        return settingIsEraser;\n    };\n    this.getUseDither = function () {\n        return settingUseDither;\n    };\n}","import {BB} from '../../bb/bb';\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\nimport {KL} from '../kl';\n\nexport function EraserBrush() {\n    let context;\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\n    let historyEntry: IHistoryEntry;\n\n    let size = 30, spacing = 0.4, opacity = 1;\n    let sizePressure = true, opacityPressure = false;\n    let lastDot, lastInput = {x: 0, y: 0, pressure: 0};\n    let lastInput2 = {x: 0, y: 0, pressure: 0};\n    let started = false;\n\n    let bezierLine;\n    let isBaseLayer = false;\n    let isTransparentBG = false;\n\n    function drawDot(x, y, size, opacity) {\n\n        context.save();\n        if (isBaseLayer) {\n            if (isTransparentBG) {\n                context.globalCompositeOperation = \"destination-out\";\n            } else {\n                context.globalCompositeOperation = \"source-atop\";\n            }\n        } else {\n            context.globalCompositeOperation = \"destination-out\";\n        }\n        let radgrad = context.createRadialGradient(size, size, 0, size, size, size);\n        let sharpness = Math.pow(opacity, 2);\n        sharpness = Math.max(0, Math.min((size - 1) / size, sharpness));\n        let oFac = Math.max(0, Math.min(1, opacity));\n        let localOpacity = 2 * oFac - oFac * oFac;\n        radgrad.addColorStop(sharpness, \"rgba(255, 255, 255, \" + localOpacity + \")\");\n        radgrad.addColorStop(1, \"rgba(255, 255, 255, 0)\");\n        context.fillStyle = radgrad;\n        context.translate(x - size, y - size);\n        context.fillRect(0, 0, size * 2, size * 2);\n        context.restore();\n    }\n\n    function continueLine(x, y, p) {\n        p = Math.max(0, Math.min(1, p));\n        let localPressure;\n        let localOpacity;\n        let localSize = (sizePressure) ? Math.max(0.1, p * size) : Math.max(0.1, size);\n\n        let bdist = Math.max(1, Math.max(0.5, 1 - opacity) * localSize * spacing);\n\n        function bezierCallback(val) {\n            let factor = val.t;\n            localPressure = lastInput2.pressure * (1 - factor) + p * factor;\n            localOpacity = (opacityPressure) ? (opacity * localPressure * localPressure) : opacity;\n            localSize = (sizePressure) ? Math.max(0.1, localPressure * size) : Math.max(0.1, size);\n\n            drawDot(val.x, val.y, localSize, localOpacity);\n        }\n\n        if (x === null) {\n            bezierLine.addFinal(bdist, bezierCallback);\n        } else {\n            bezierLine.add(x, y, bdist, bezierCallback);\n        }\n    }\n\n\n    this.startLine = function (x, y, p) {\n        historyEntry = {\n            tool: [\"brush\", \"EraserBrush\"],\n            actions: []\n        };\n        historyEntry.actions.push({\n            action: \"opacityPressure\",\n            params: [opacityPressure]\n        });\n        historyEntry.actions.push({\n            action: \"sizePressure\",\n            params: [sizePressure]\n        });\n        historyEntry.actions.push({\n            action: \"setSize\",\n            params: [size]\n        });\n        historyEntry.actions.push({\n            action: \"setOpacity\",\n            params: [opacity]\n        });\n        historyEntry.actions.push({\n            action: \"setTransparentBG\",\n            params: [isTransparentBG]\n        });\n\n        isBaseLayer = 0 === context.canvas.index;\n\n        p = Math.max(0, Math.min(1, p));\n        let localOpacity = (opacityPressure) ? (opacity * p * p) : opacity;\n        let localSize = (sizePressure) ? Math.max(0.1, p * size) : Math.max(0.1, size);\n\n        started = true;\n        if (localSize > 1) {\n            drawDot(x, y, localSize, localOpacity);\n        }\n        lastDot = localSize * spacing;\n        lastInput.x = x;\n        lastInput.y = y;\n        lastInput.pressure = p;\n        lastInput2 = BB.copyObj(lastInput);\n\n        bezierLine = new BB.BezierLine();\n        bezierLine.add(x, y, 0, function () {\n        });\n\n        historyEntry.actions.push({\n            action: \"startLine\",\n            params: [x, y, p]\n        });\n    };\n    this.goLine = function (x, y, p) {\n        if (!started) {\n            return;\n        }\n        historyEntry.actions.push({\n            action: \"goLine\",\n            params: [x, y, p]\n        });\n\n        continueLine(x, y, lastInput.pressure);\n\n        lastInput2 = BB.copyObj(lastInput);\n        lastInput.x = x;\n        lastInput.y = y;\n        lastInput.pressure = p;\n    };\n    this.endLine = function () {\n\n        if (bezierLine) {\n            continueLine(null, null, lastInput.pressure);\n        }\n\n        started = false;\n        bezierLine = undefined;\n\n        if (historyEntry) {\n            historyEntry.actions.push({\n                action: \"endLine\",\n                params: []\n            });\n            history.push(historyEntry);\n            historyEntry = undefined;\n        }\n    };\n    //cheap n' ugly\n    this.drawLineSegment = function (x1, y1, x2, y2) {\n\n        isBaseLayer = 0 === context.canvas.index;\n\n        lastInput.x = x2;\n        lastInput.y = y2;\n\n        if (started || x1 === undefined) {\n            return;\n        }\n\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n        let eX = (x2 - x1) / mouseDist;\n        let eY = (y2 - y1) / mouseDist;\n        let loopDist;\n        let bdist = Math.max(1, Math.max(0.5, 1 - opacity) * size * spacing);\n        lastDot = 0;\n        for (loopDist = lastDot; loopDist <= mouseDist; loopDist += bdist) {\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, size, opacity);\n        }\n\n\n        let historyEntry = {\n            tool: [\"brush\", \"EraserBrush\"],\n            actions: []\n        };\n        historyEntry.actions.push({\n            action: \"opacityPressure\",\n            params: [opacityPressure]\n        });\n        historyEntry.actions.push({\n            action: \"sizePressure\",\n            params: [sizePressure]\n        });\n        historyEntry.actions.push({\n            action: \"setSize\",\n            params: [size]\n        });\n        historyEntry.actions.push({\n            action: \"setOpacity\",\n            params: [opacity]\n        });\n        historyEntry.actions.push({\n            action: \"setTransparentBG\",\n            params: [isTransparentBG]\n        });\n\n        historyEntry.actions.push({\n            action: \"drawLineSegment\",\n            params: [x1, y1, x2, y2]\n        });\n        history.push(historyEntry);\n    };\n\n    //IS\n    this.isDrawing = function () {\n        return started;\n    };\n    //SET\n    /*this.setAlpha = function(a) {\n        lastInput = {};\n        alpha = a;\n        updateAlphaCanvas();\n    };*/\n    this.setContext = function (c) {\n        context = c;\n    };\n    this.setHistory = function (l: KlHistoryInterface) {\n        history = l;\n    };\n    this.setSize = function (s) {\n        size = s;\n    };\n    this.setOpacity = function (o) {\n        opacity = o;\n    };\n    this.sizePressure = function (b) {\n        sizePressure = b;\n    };\n    this.opacityPressure = function (b) {\n        opacityPressure = b;\n    };\n    this.setTransparentBG = function (b) {\n        isTransparentBG = b == true;\n    };\n    //GET\n    this.getSize = function () {\n        return size;\n    };\n    this.getOpacity = function () {\n        return opacity;\n    };\n}","import {BB} from '../../bb/bb';\nimport {IBounds, IPressureInput, IVector2D} from '../../bb/bb.types';\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\nimport {KL} from '../kl';\nimport {IRGB} from '../kl.types';\n\n// let statCount = 1;\n// let statAcc = 0;\n// stats on win10, chrome, size 100, opacity 80, smudge()\n// unoptimized: 1 ms\n// minimal: 0.09 ms\n// minimal + circle: 0.5ms\n// minimal + circle + ix, iy: 0.23ms\n// unoptimized + ix, iy: 0.64 ms\n// unoptimized + ix, iy + sans rounding: 0.61 ms\n// ix, iy + sans rounding + sans random: 0.32ms\n// ix, iy + sans rounding + fast random: 0.46 ms\n// ix, iy + sans rounding + fast random + offset const: 0.48 ms\n\nconst CELL_SIZE = 256;\n\ninterface ISmudgeParams {\n    aP: IVector2D;\n    bP: IVector2D;\n    size: {\n        w: number;\n        h: number;\n    };\n    brush: {\n        center: IVector2D,\n        size: number;\n        opacity: number;\n        alphaLock: boolean;\n    };\n}\n\n\n/**\n * determine bounds of smudge\n * @param imWidth\n * @param imHeight\n * @param aP\n * @param bP\n * @param size\n */\nfunction prepSmudge(\n    imWidth: number,\n    imHeight: number,\n    aP: IVector2D, // top left of source, integers\n    bP: IVector2D, // top left of dest, integers\n    size: {w: number; h: number}, // size of both rectangles, integers\n): {\n    aP: IVector2D,\n    bP: IVector2D,\n    size: {w: number; h: number},\n} {\n\n    if (aP.x === bP.x && aP.y === bP.y) {\n        return null;\n    }\n\n    aP = BB.copyObj(aP);\n    bP = BB.copyObj(bP);\n    size = BB.copyObj(size);\n\n    // corner behavior\n    // cut down rectangles, if a or b go outside\n    // i.e. if user drags partially or fully outside the canvas\n    {\n        let top = 0;\n        let right = 0;\n        let bottom = 0;\n        let left = 0;\n\n        if (aP.x < 0) {\n            left = -aP.x;\n        }\n        if (aP.y < 0) {\n            top = -aP.y;\n        }\n        if (bP.x < 0) {\n            left = Math.max(left, -bP.x);\n        }\n        if (bP.y < 0) {\n            top = Math.max(top, -bP.y);\n        }\n        if (aP.x + size.w > imWidth) {\n            right = aP.x + size.w - imWidth;\n        }\n        if (aP.y + size.h > imHeight) {\n            bottom = aP.y + size.h - imHeight;\n        }\n        if (bP.x + size.w > imWidth) {\n            right = Math.max(right, bP.x + size.w - imWidth);\n        }\n        if (bP.y + size.h > imHeight) {\n            bottom = Math.max(bottom, bP.y + size.h - imHeight);\n        }\n\n        aP.x += left;\n        bP.x += left;\n        aP.y += top;\n        bP.y += top;\n\n        size.w = size.w - left - right;\n        size.h = size.h - top - bottom;\n        if (size.w <= 0 || size.h <= 0) {\n            return null;\n        }\n    }\n\n    return {\n        aP: {\n            x: aP.x,\n            y: aP.y,\n        },\n        bP: {\n            x: bP.x,\n            y: bP.y,\n        },\n        size: {\n            w: size.w,\n            h: size.h,\n        }\n    };\n}\n\n// faster than using BB.clamp somehow (in chrome)\nfunction clamp(num, min, max) {\n    return num <= min\n        ? min\n        : num >= max\n            ? max\n            : num\n}\n\n/**\n * Pixel operations that do the smudging via ImageData\n * @param imageData\n * @param p\n */\nfunction smudge(imageData: ImageData, p : ISmudgeParams): void {\n\n    p = BB.copyObj(p);\n\n    const cSize = p.brush.size;\n    const cX = p.brush.center.x;\n    const cY = p.brush.center.y;\n\n    /*if (statCount % 1000 === 0) {\n        console.log(statAcc / 1000);\n        statAcc = 0;\n    }\n    let start = performance.now();*/\n\n\n    // determine offset\n    let aIndex = p.aP.y * imageData.width + p.aP.x;\n    let bIndex = p.bP.y * imageData.width + p.bP.x;\n    const offset = (bIndex - aIndex) * 4;\n\n    // array with random numbers. faster than Math.random()\n    let randI = 0;\n    const randLen = cSize > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\n    const randArr = [];\n    for (let i = 0; i < randLen; i++) {\n        randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\n    }\n\n    const softnessPx = Math.max(3, Math.min(8, p.brush.size - 8));\n\n    const pixel = (ai, bi, ix, iy) => {\n\n        const dist = BB.dist(cX, cY, ix, iy);\n        const fac = 1 - p.brush.opacity * (1 - clamp((dist - (cSize - softnessPx)) / softnessPx, 0, 1));\n\n        if (fac === 1) {\n            return;\n        }\n\n        if (!imageData.data[ai + 3]) {\n\n        } else if (!imageData.data[bi + 3]) { // don't mix if target fully transparent. pixel might have a strange color.\n            imageData.data[bi] = imageData.data[ai + 0];\n            imageData.data[bi + 1] = imageData.data[ai + 1];\n            imageData.data[bi + 2] = imageData.data[ai + 2];\n        } else {\n\n            // consider alpha ratio. If a has lower alpha than b, then b should be stronger, and vice versa\n            // not totally accurate. TODO same compositing as blend brush\n            let fac2;\n            if (imageData.data[ai + 3] < imageData.data[bi + 3]) {\n                fac2 = 1 - imageData.data[ai + 3] / imageData.data[bi + 3] * (1 - fac);\n            } else {\n                fac2 = imageData.data[bi + 3] / imageData.data[ai + 3] * fac;\n            }\n\n            // ImageData's Uint8ClampedArray rounds -> 0.5 becomes 1. But not in Safari, so needs to be done manually\n            // Offset mixed color by random number noise (-0.5, 0.5), so it doesn't get stuck while mixing.\n            // No +0.5, because it cancels out with rand.\n            imageData.data[bi] = Math.floor(BB.mix(imageData.data[ai], imageData.data[bi + 0], fac2) + randArr[randI]);\n            imageData.data[bi + 1] = Math.floor(BB.mix(imageData.data[ai + 1], imageData.data[bi + 1], fac2) + randArr[randI]);\n            imageData.data[bi + 2] = Math.floor(BB.mix(imageData.data[ai + 2], imageData.data[bi + 2], fac2) + randArr[randI]);\n\n            randI = (randI + 1) % randLen;\n        }\n        // Always mix alpha. unless alpha lock\n        if (!p.brush.alphaLock) {\n            imageData.data[bi + 3] = Math.floor(BB.mix(imageData.data[ai + 3], imageData.data[bi + 3], fac) + 0.5);\n        }\n\n    };\n\n    const bx1 = p.bP.x * 4;\n    const bx2 = bx1 + (p.size.w - 1) * 4;\n\n    // transfer of pixels depends on direction of smudging if there is overlap\n    if (p.aP.y < p.bP.y) {\n        for (let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--) {\n            const yStart = (y + p.bP.y) * imageData.width * 4;\n            for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\n                pixel(x2, x, ix, iy);\n            }\n        }\n    } else if (p.aP.y > p.bP.y) {\n        for (let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++) {\n            const yStart = (y + p.bP.y) * imageData.width * 4;\n            for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\n                pixel(x2, x, ix, iy);\n            }\n        }\n    } else {\n        if (p.aP.x < p.bP.x) {\n            for (let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--) {\n                const yStart = (y + p.bP.y) * imageData.width * 4;\n                for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\n                    pixel(x2, x, ix, iy);\n                }\n            }\n        } else {\n            for (let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++) {\n                const yStart = (y + p.bP.y) * imageData.width * 4;\n                for (let x = bx1 + yStart, x2 = bx1 + yStart - offset, ix = p.bP.x; x < bx2 + yStart; x += 4, x2 += 4, ix++) {\n                    pixel(x2, x, ix, iy);\n                }\n            }\n        }\n    }\n\n    //statCount++;\n    //statAcc += performance.now() - start;\n}\n\nexport class SmudgeBrush {\n\n    private context: CanvasRenderingContext2D;\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\n    private historyEntry: IHistoryEntry;\n\n    private settingColor: IRGB = {r: 0, g: 0, b: 0};\n    private settingSize: number = 35;\n    private settingSpacing: number = 0.20446882736951905;\n    private settingOpacity: number = 0.8;\n    private settingColorStr: string;\n    private settingHasSizePressure: boolean = false;\n    private settingHasOpacityPressure: boolean = false;\n    private settingLockLayerAlpha: boolean = false;\n\n    private lineToolLastDot: number;\n    private lastInput: IPressureInput = {x: 0, y: 0, pressure: 0};\n    private lastInput2: IPressureInput = {x: 0, y: 0, pressure: 0};\n    private lastDot: IVector2D;\n\n    private isDrawing: boolean = false;\n\n    private bezierLine: any = null; // todo type BezierLine\n\n    private redrawBounds: IBounds;\n    private completeRedrawBounds: IBounds;\n\n    private copyImageData: ImageData;\n\n    private drawBuffer: ISmudgeParams[] = [];\n\n    private copiedCells: boolean[];\n\n    updateRedrawBounds(bounds: IBounds): void {\n        this.redrawBounds = BB.updateBounds(this.redrawBounds, bounds);\n    }\n\n    updateCompleteRedrawBounds (x1, y1, x2, y2): void {\n        this.completeRedrawBounds = BB.updateBounds(\n            this.completeRedrawBounds,\n            { x1, y1, x2, y2 }\n        );\n    }\n\n    /**\n     * update copyImageData. copy over new regions if needed\n     */\n    copyFromCanvas(): void {\n\n        const touchedCells = this.copiedCells.map(item => false);\n\n        const bounds: IBounds[] = [];\n        const cellsW = Math.ceil(this.copyImageData.width / CELL_SIZE);\n\n        if (!this.redrawBounds) {\n            return;\n        }\n        bounds.push({\n            x1: Math.floor(this.redrawBounds.x1 / CELL_SIZE),\n            y1: Math.floor(this.redrawBounds.y1 / CELL_SIZE),\n            x2: Math.floor(this.redrawBounds.x2 / CELL_SIZE),\n            y2: Math.floor(this.redrawBounds.y2 / CELL_SIZE),\n        });\n        bounds.forEach(item => {\n            for (let i = item.x1; i <= item.x2; i++) {\n                for (let e = item.y1; e <= item.y2; e++) {\n                    touchedCells[e * cellsW + i] = true;\n                }\n            }\n        });\n\n        touchedCells.forEach((item, i) => {\n            if (!item || this.copiedCells[i]) {\n                // not touched, or already copied\n                return;\n            }\n            this.copiedCells[i] = true;\n            const x = i % cellsW;\n            const y = Math.floor(i / cellsW);\n            const w = (Math.min(x * CELL_SIZE + CELL_SIZE, this.copyImageData.width) - 1) % CELL_SIZE + 1;\n            const h = (Math.min(y * CELL_SIZE + CELL_SIZE, this.copyImageData.height) - 1) % CELL_SIZE + 1;\n\n            // temp canvas to prevent main canvas from getting slowed down in chrome\n            const tmpCanvas = BB.canvas(w, h);\n            const tmpCtx = tmpCanvas.getContext('2d');\n            tmpCtx.drawImage(this.context.canvas, -x * CELL_SIZE, -y * CELL_SIZE);\n\n            const data = tmpCtx.getImageData(0, 0, w, h);\n\n            for (let i = 0; i < h; i++) {\n                for (let e = 0, e2 = i * w * 4, e3 = ((y * CELL_SIZE + i) * this.copyImageData.width + x * CELL_SIZE) * 4; e < w; e++, e2 += 4, e3 += 4) {\n                    this.copyImageData.data[e3] = data.data[e2];\n                    this.copyImageData.data[e3 + 1] = data.data[e2 + 1];\n                    this.copyImageData.data[e3 + 2] = data.data[e2 + 2];\n                    this.copyImageData.data[e3 + 3] = data.data[e2 + 3];\n                }\n            }\n        });\n    }\n\n\n    /**\n     * fill drawBuffer with params about to be drawn\n     * @param x\n     * @param y\n     * @param size\n     * @param opacity\n     */\n    prepDot (x: number, y: number, size: number, opacity: number): void {\n        if (!this.lastDot) {\n            this.lastDot = {\n                x: x,\n                y: y,\n            };\n            return;\n        }\n\n        size = Math.round(size);\n\n\n        const w = Math.round(size * 2);\n        const h = Math.round(size * 2);\n\n        const bounds = prepSmudge(\n            this.copyImageData.width,\n            this.copyImageData.height,\n            {\n                x: Math.round(this.lastDot.x - size),\n                y: Math.round(this.lastDot.y - size),\n            },\n            {\n                x: Math.round(x - size),\n                y: Math.round(y - size),\n            },\n            {\n                w,\n                h,\n            },\n        );\n\n        if (bounds) {\n            const params: ISmudgeParams = {\n                aP: bounds.aP,\n                bP: bounds.bP,\n                size: bounds.size,\n                brush: {\n                    center: { x, y },\n                    size,\n                    opacity,\n                    alphaLock: this.settingLockLayerAlpha,\n                }\n            };\n            this.updateRedrawBounds({\n                x1: params.bP.x,\n                y1: params.bP.y,\n                x2: params.bP.x + params.brush.size * 2,\n                y2: params.bP.y + params.brush.size * 2,\n            });\n            this.drawBuffer.push(params);\n        }\n\n        this.lastDot = {\n            x: x,\n            y: y,\n        };\n    }\n\n    continueLine (x: number, y: number, size: number, pressure: number): void {\n        this.drawBuffer = [];\n\n        if (this.bezierLine === null) {\n            this.bezierLine = new BB.BezierLine();\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, function(){});\n        }\n\n        const drawArr = []; //draw instructions. will be all drawn at once\n\n        const dotCallback = (val): void => {\n            const localPressure = BB.mix(this.lastInput2.pressure, pressure, val.t);\n            const localOpacity = this.settingOpacity * (this.settingHasOpacityPressure ? (localPressure * localPressure) : 1);\n            const localSize = Math.max(0.1, this.settingSize * (this.settingHasSizePressure ? localPressure : 1));\n            drawArr.push([val.x, val.y, localSize, localOpacity, val.angle]);\n        };\n\n        const localSpacing = size * this.settingSpacing / 3;\n        if (x === null) {\n            this.bezierLine.addFinal(localSpacing, dotCallback);\n        } else {\n            this.bezierLine.add(x, y, localSpacing, dotCallback);\n        }\n\n        // execute draw instructions\n        let before;\n        for (let i = 0; i < drawArr.length; i++) {\n            const item = drawArr[i];\n            this.prepDot(item[0], item[1], item[2], item[3]);\n            before = item;\n        }\n\n        this.copyFromCanvas();\n\n        for (let i = 0; i < this.drawBuffer.length; i++) {\n            smudge(this.copyImageData, this.drawBuffer[i]);\n        }\n    }\n\n\n\n    // ---- public ----\n\n    constructor () { }\n\n    startLine (x: number, y: number, p: number): void {\n        this.historyEntry = {\n            tool: [\"brush\", \"SmudgeBrush\"],\n            actions: []\n        };\n\n        p = BB.clamp(p, 0, 1);\n        const localOpacity = this.settingHasOpacityPressure ? (this.settingOpacity * p * p) : this.settingOpacity;\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, p * this.settingSize) : Math.max(0.1, this.settingSize);\n\n        this.lastDot = null;\n        this.isDrawing = true;\n\n        this.copyImageData = new ImageData(this.context.canvas.width, this.context.canvas.height);\n        const totalCells = Math.ceil(this.context.canvas.width / CELL_SIZE) * Math.ceil(this.context.canvas.height / CELL_SIZE);\n        this.copiedCells = '0'.repeat(totalCells).split('').map(item => false);\n\n        this.prepDot(x, y, localSize, localOpacity);\n\n        this.lineToolLastDot = localSize * this.settingSpacing;\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n        this.lastInput2.pressure = p;\n\n        this.completeRedrawBounds = null;\n    }\n\n    goLine (x: number, y: number, p: number): void {\n        if (!this.isDrawing) {\n            return;\n        }\n\n        this.redrawBounds = null;\n        const pressure = BB.clamp(p, 0, 1);\n        const localSize = this.settingHasSizePressure ?\n            Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\n\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\n\n\n        if (this.redrawBounds) {\n            this.context.putImageData(\n                this.copyImageData,\n                0,\n                0,\n                this.redrawBounds.x1,\n                this.redrawBounds.y1,\n                this.redrawBounds.x2 - this.redrawBounds.x1 - 1,\n                this.redrawBounds.y2 - this.redrawBounds.y1 - 1\n            );\n            this.updateCompleteRedrawBounds(\n                this.redrawBounds.x1,\n                this.redrawBounds.y1,\n                this.redrawBounds.x2,\n                this.redrawBounds.y2\n            );\n        }\n\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput2.pressure = this.lastInput.pressure;\n        this.lastInput.pressure = pressure;\n    }\n\n    endLine (): void {\n        this.redrawBounds = null;\n        const localSize = this.settingHasSizePressure ?\n            Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\n        this.context.save();\n        this.continueLine(null, null, localSize, this.lastInput.pressure);\n        this.context.restore();\n\n        this.isDrawing = false;\n        this.bezierLine = null;\n\n        if (this.redrawBounds) {\n            this.context.putImageData(\n                this.copyImageData,\n                0,\n                0,\n                this.redrawBounds.x1,\n                this.redrawBounds.y1,\n                this.redrawBounds.x2 - this.redrawBounds.x1 - 1,\n                this.redrawBounds.y2 - this.redrawBounds.y1 - 1\n            );\n            this.updateCompleteRedrawBounds(\n                this.redrawBounds.x1,\n                this.redrawBounds.y1,\n                this.redrawBounds.x2,\n                this.redrawBounds.y2\n            );\n        }\n\n        if (this.historyEntry && this.completeRedrawBounds) {\n            let historyIm: ImageData | HTMLCanvasElement = this.copyImageData;\n            if (!(\n                this.completeRedrawBounds.x1 === 0 &&\n                this.completeRedrawBounds.y1 === 0 &&\n                this.completeRedrawBounds.x2 >= this.context.canvas.width - 1 &&\n                this.completeRedrawBounds.y2 >= this.context.canvas.height - 1\n            )) {\n\n                // temp canvas to prevent main canvas from getting slowed down in chrome\n                const tmpCanvas = BB.canvas(\n                    this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1,\n                    this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1\n                );\n                const tmpCtx = tmpCanvas.getContext('2d');\n                tmpCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\n\n                historyIm = tmpCanvas; // faster than getting image data (measured on 2018 lenovo chromebook)\n            }\n            this.historyEntry.actions.push({\n                action: \"drawImage\",\n                params: [\n                    historyIm,\n                    this.completeRedrawBounds.x1,\n                    this.completeRedrawBounds.y1,\n                ],\n            });\n            this.history.push(this.historyEntry);\n            this.historyEntry = undefined;\n        }\n        this.copyImageData = null;\n    }\n\n    drawImage (im: ImageData | HTMLCanvasElement, x: number, y: number): void {\n        if (im instanceof ImageData) {\n            this.context.putImageData(im, x, y);\n        } else {\n            this.context.clearRect(x, y, im.width, im.height);\n            this.context.drawImage(im, x, y);\n        }\n    }\n\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\n        return;\n        /*\n        // todo\n        lastInput.x = x2;\n        lastInput.y = y2;\n        lastInput.pressure = 1;\n\n        if (isDrawing || x1 === undefined) {\n            return;\n        }\n\n        let angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n        let eX = (x2 - x1) / mouseDist;\n        let eY = (y2 - y1) / mouseDist;\n        let loopDist;\n        let bdist = settingSize * settingSpacing;\n        lineToolLastDot = settingSize * settingSpacing;\n        for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity);\n        }\n\n\n        let historyEntry = {\n            tool: [\"brush\", \"SmudgeBrush\"],\n            actions: []\n        };\n        // todo\n        history.add(historyEntry);*/\n    }\n\n    getIsDrawing (): boolean {\n        return this.isDrawing;\n    }\n\n    setColor (c: IRGB): void {\n        if (this.settingColor.r === c.r && this.settingColor.g === c.g && this.settingColor.b === c.b) {\n            return;\n        }\n        this.settingColor = {r: c.r, g: c.g, b: c.b};\n        this.settingColorStr = BB.ColorConverter.toRgbStr(this.settingColor);\n    }\n\n    setContext (c: CanvasRenderingContext2D): void {\n        this.context = c;\n    }\n\n    setHistory (h: KlHistoryInterface): void {\n        this.history = h;\n    }\n\n    setSize (s: number): void {\n        this.settingSize = s;\n    }\n\n    setOpacity (o: number): void {\n        this.settingOpacity = o;\n    }\n\n    setSpacing (s: number): void {\n        this.settingSpacing = s;\n    }\n\n    sizePressure (b: boolean): void {\n        this.settingHasSizePressure = !!b;\n    }\n\n    opacityPressure (b: boolean): void {\n        this.settingHasOpacityPressure = !!b;\n    }\n\n    setLockAlpha (b: boolean): void {\n        this.settingLockLayerAlpha = !!b;\n    }\n\n    getSpacing (): number {\n        return this.settingSpacing;\n    }\n\n    getSize (): number {\n        return this.settingSize;\n    }\n\n    getOpacity (): number {\n        return this.settingOpacity;\n    }\n\n    getLockAlpha (): boolean {\n        return this.settingLockLayerAlpha;\n    }\n\n}\n","import {BB} from '../../bb/bb';\nimport {IRGB} from '../kl.types';\nimport {IBounds} from '../../bb/bb.types';\nimport {KlHistoryInterface} from '../history/kl-history';\n\ntype TChemyMode = 'fill' | 'stroke';\n\nexport class ChemyBrush {\n\n    private context: CanvasRenderingContext2D;\n    private settingColor: IRGB;\n    private settingSize: number = 0.25; // radius - 0.5 - 99999\n    private settingOpacity: number = 1; // 0-1\n    private settingLockLayerAlpha: boolean = false;\n    private settingIsEraser: boolean = false;\n    private settingMode: TChemyMode = 'fill';\n    private settingDistort: number = 0; // 0 - 1\n    private settingXSymmetry: boolean = false;\n    private settingYSymmetry: boolean = false;\n    private settingGradient: boolean = false;\n\n    private isDrawing: boolean = false;\n\n    private history: KlHistoryInterface;\n\n    private copyCanvas: HTMLCanvasElement;\n    private path: {x: number, y: number}[];\n    private minY: number;\n    private maxY: number;\n    private completeRedrawBounds: IBounds;\n\n    updateCompleteRedrawBounds (x, y): void {\n        let bounds = { x1: x, y1: y, x2: x, y2: y};\n        if (this.settingXSymmetry) {\n            bounds = BB.updateBounds(\n                bounds,\n                {\n                    x1: -x + this.copyCanvas.width,\n                    y1: y,\n                    x2: -x + this.copyCanvas.width,\n                    y2: y,\n                }\n                );\n        }\n        if (this.settingYSymmetry) {\n            bounds = BB.updateBounds(\n                bounds,\n                {\n                    x1: x,\n                    y1: -y + this.copyCanvas.height,\n                    x2: x,\n                    y2: -y + this.copyCanvas.height,\n                }\n            );\n        }\n        const buffer = this.settingMode === 'stroke' ? this.settingSize + 1 : 1;\n        bounds.x1 = Math.floor(bounds.x1 - buffer);\n        bounds.y1 = Math.floor(bounds.y1 - buffer);\n        bounds.x2 = Math.ceil(bounds.x2 + buffer);\n        bounds.y2 = Math.ceil(bounds.y2 + buffer);\n\n        this.completeRedrawBounds = BB.updateBounds(this.completeRedrawBounds, bounds);\n    }\n\n    private drawShape (): void {\n        this.context.save();\n        this.context.clearRect(0, 0, this.context.canvas.width, this.context.canvas.height);\n        this.context.drawImage(this.copyCanvas, 0, 0);\n\n        let color = {...this.settingColor};\n        if (this.settingIsEraser) {\n            color.r = 255;\n            color.g = 255;\n            color.b = 255;\n            if (this.settingLockLayerAlpha) {\n                this.context.globalCompositeOperation = \"source-atop\";\n            } else {\n                this.context.globalCompositeOperation = \"destination-out\";\n            }\n        } else {\n            if (this.settingLockLayerAlpha) {\n                this.context.globalCompositeOperation = \"source-atop\";\n            }\n        }\n\n        if (this.path) {\n\n            // path\n            const path = new Path2D();\n            this.path.forEach((item, index) => {\n                if (index === 0) {\n                    path.moveTo(item.x, item.y);\n                } else {\n                    path.lineTo(item.x, item.y);\n                }\n            });\n\n            let style: string | CanvasGradient = BB.ColorConverter.toRgbaStr({\n                r: color.r,\n                g: color.g,\n                b: color.b,\n                a: this.settingOpacity,\n            });\n            if (this.settingGradient) {\n                const startAtTop = this.path[0].x > this.path[this.path.length - 1].x;\n                const gradient = this.context.createLinearGradient(\n                    0, startAtTop ? this.minY : this.maxY,\n                    0, startAtTop ? this.maxY : this.minY,\n                );\n                gradient.addColorStop(\n                    0,\n                    BB.ColorConverter.toRgbaStr({\n                        r: color.r,\n                        g: color.g,\n                        b: color.b,\n                        a: this.settingOpacity,\n                    })\n                );\n                gradient.addColorStop(\n                    1,\n                    BB.ColorConverter.toRgbaStr({\n                        r: color.r,\n                        g: color.g,\n                        b: color.b,\n                        a: 0,\n                    })\n                );\n                style = gradient;\n            }\n\n            // setup params\n            if (this.settingMode === 'fill') {\n                this.context.fillStyle = style;\n\n            } else {\n                this.context.lineWidth = this.settingSize * 2;\n                this.context.lineJoin = 'bevel';\n                this.context.strokeStyle = style;\n            }\n\n            // draw\n            const draw = () => {\n                if (this.settingMode === 'fill') {\n                    this.context.fill(path);\n                } else {\n                    this.context.stroke(path);\n                }\n            };\n\n            draw();\n            if (this.settingXSymmetry) {\n                this.context.save();\n                this.context.translate(this.context.canvas.width / 2, 0);\n                this.context.scale(-1, 1);\n                this.context.translate(-this.context.canvas.width / 2, 0);\n                draw();\n                this.context.restore();\n            }\n            if (this.settingYSymmetry) {\n                this.context.save();\n                this.context.translate(0, this.context.canvas.height / 2);\n                this.context.scale(1, -1);\n                this.context.translate(0, -this.context.canvas.height / 2);\n                draw();\n                this.context.restore();\n                if (this.settingXSymmetry) {\n                    this.context.save();\n                    this.context.translate(this.context.canvas.width / 2, this.context.canvas.height / 2);\n                    this.context.scale(-1, -1);\n                    this.context.translate(-this.context.canvas.width / 2, -this.context.canvas.height / 2);\n                    draw();\n                    this.context.restore();\n                }\n            }\n        }\n\n        this.context.restore();\n    }\n\n    // --- public ----\n    constructor () {\n    }\n\n    setHistory (h: KlHistoryInterface): void {\n        this.history = h;\n    }\n\n    getSize (): number {\n        return this.settingMode === 'stroke' ? this.settingSize : 0;\n    }\n\n    setSize (s: number): void {\n        this.settingSize = s;\n    }\n\n    getOpacity (): number {\n        return this.settingOpacity;\n    }\n\n    setOpacity (o: number): void {\n        this.settingOpacity = o;\n    }\n\n    setColor (c: IRGB): void {\n        this.settingColor = BB.copyObj(c);\n    }\n\n    setContext (c: CanvasRenderingContext2D) {\n        this.context = c;\n    }\n\n    setMode (mode: TChemyMode): void {\n        this.settingMode = mode;\n    }\n\n    getMode (): TChemyMode {\n        return this.settingMode;\n    }\n\n    setDistort (distort: number): void {\n        this.settingDistort = BB.clamp(distort, 0, 1);\n    }\n\n    getDistort (): number {\n        return this.settingDistort;\n    }\n\n    setXSymmetry (b: boolean): void {\n        this.settingXSymmetry = !!b;\n    }\n\n    getXSymmetry (): boolean {\n        return this.settingXSymmetry;\n    }\n\n    setYSymmetry (b: boolean): void {\n        this.settingYSymmetry = !!b;\n    }\n\n    getYSymmetry (): boolean {\n        return this.settingYSymmetry;\n    }\n\n    setGradient (b: boolean): void {\n        this.settingGradient = !!b;\n    }\n\n    getGradient (): boolean {\n        return this.settingGradient;\n    }\n\n    getLockAlpha (): boolean {\n        return this.settingLockLayerAlpha;\n    }\n\n    setLockAlpha (b: boolean): void {\n        this.settingLockLayerAlpha = !!b;\n    }\n\n    getIsEraser (): boolean {\n        return this.settingIsEraser;\n    }\n\n    setIsEraser (b: boolean): void {\n        this.settingIsEraser = !!b;\n    }\n\n    getIsDrawing (): boolean {\n        return this.isDrawing;\n    }\n\n    startLine (x: number, y: number): void {\n        this.isDrawing = true;\n        this.path = [{x, y}];\n        this.minY = y;\n        this.maxY = y;\n        this.copyCanvas = BB.canvas(this.context.canvas.width, this.context.canvas.height);\n        this.copyCanvas.getContext('2d').drawImage(this.context.canvas, 0, 0);\n        this.completeRedrawBounds = null;\n        this.updateCompleteRedrawBounds(x, y);\n    }\n\n    goLine (x: number, y: number): void {\n        if (!this.isDrawing) {\n            return;\n        }\n\n        let pos = { x, y };\n        if (this.settingDistort > 0) {\n            pos.x += (Math.random() - 0.5) * this.settingDistort * 80;\n            pos.y += (Math.random() - 0.5) * this.settingDistort * 80;\n        }\n\n        this.minY = Math.min(this.minY, pos.y);\n        this.maxY = Math.max(this.maxY, pos.y);\n        this.path.push(pos);\n        this.updateCompleteRedrawBounds(x, y);\n        this.drawShape();\n    }\n\n    endLine (): void {\n        this.isDrawing = false;\n        this.completeRedrawBounds = BB.boundsInArea(this.completeRedrawBounds, this.copyCanvas.width, this.copyCanvas.height);\n        if (this.path.length > 1 && this.completeRedrawBounds) {\n            const historyCanvas = BB.canvas(\n                this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1,\n                this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1\n            );\n            const historyCtx = historyCanvas.getContext('2d');\n            historyCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\n\n            this.history.push({\n                tool: [\"brush\", \"ChemyBrush\"],\n                actions: [\n                    {\n                        action: \"drawImage\",\n                        params: [\n                            historyCanvas, // faster than getting image data (measured on 2018 lenovo chromebook)\n                            this.completeRedrawBounds.x1,\n                            this.completeRedrawBounds.y1,\n                        ],\n                    }\n                ]\n            });\n        }\n        this.path = null;\n        this.copyCanvas = null;\n    }\n\n    drawImage (im: HTMLCanvasElement, x: number, y: number): void {\n        this.context.save();\n        this.context.clearRect(x, y, im.width, im.height);\n        this.context.drawImage(im, x, y);\n        this.context.restore();\n    }\n\n    drawLineSegment (x1, y1, x2, y2): void {\n        // might make sense for stroke\n    }\n}\n","import {penBrushUi} from './pen-brush-ui';\nimport {blendBrushUi} from './blend-brush-ui';\nimport {sketchyBrushUi} from './sketchy-brush-ui';\nimport {pixelBrushUi} from './pixel-brush-ui';\nimport {eraserBrushUi} from './eraser-brush-ui';\nimport {smudgeBrushUi} from './smudge-brush-ui';\nimport {chemyBrushUi} from './chemy-brush-ui';\nimport {IBrushUi} from '../kl.types';\n\n/**\n * UI for brushes.\n * Each brush ui carries the brush with it.\n * So if you want to draw, you do it through the UI. should be changed sometime.\n */\n\nexport const brushesUI: {\n    [key: string]: IBrushUi;\n} = {\n    penBrush: penBrushUi,\n    blendBrush: blendBrushUi,\n    sketchyBrush: sketchyBrushUi,\n    pixelBrush: pixelBrushUi,\n    chemyBrush: chemyBrushUi,\n    smudgeBrush: smudgeBrushUi,\n    eraserBrush: eraserBrushUi,\n};\n","import {BB} from '../../bb/bb';\nimport {brushes} from '../brushes/brushes';\nimport {eventResMs} from './brushes-consts';\nimport {klHistory} from '../history/kl-history';\nimport {Checkbox} from '../ui/base-components/checkbox';\nimport {KlSlider} from '../ui/base-components/kl-slider';\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\n// @ts-ignore\nimport brushIconImg from 'url:~/src/app/img/ui/brush-pen.svg';\nimport {genBrushAlpha01, genBrushAlpha02} from '../brushes/alphas/brush-alphas';\nimport {IBrushUi} from '../kl.types';\nimport {LANG, languageStrings} from '../../language/language';\nimport {input} from '../ui/base-components/input';\n\nexport const penBrushUi = (function () {\n    let brushInterface: IBrushUi = {\n        image: brushIconImg,\n        tooltip: LANG('brush-pen'),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\n        },\n        opacitySlider: {\n            min: 1/100,\n            max: 1,\n            curve: [[0, 1/100], [0.5, 30/100], [1, 1]]\n        },\n        Ui: null,\n    };\n\n    let alphaNames = [\n        LANG('brush-pen-circle'),\n        LANG('brush-pen-chalk'),\n        LANG('brush-pen-calligraphy'),\n        LANG('brush-pen-square'),\n    ];\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-pen');\n        alphaNames = [\n            LANG('brush-pen-circle'),\n            LANG('brush-pen-chalk'),\n            LANG('brush-pen-calligraphy'),\n            LANG('brush-pen-square'),\n        ];\n    });\n\n    brushInterface.Ui = function (p) {\n        let div = document.createElement(\"div\"); // the gui\n        let brush = new brushes.PenBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n        let sizeSlider;\n        let opacitySlider;\n\n        let alphas = [];\n        let currentAlpha = 0;\n        for (let i = 0; i < 4; i++) {\n            (function (i) {\n                let alpha = BB.el({\n                    title: alphaNames[i],\n                    onClick: () => {\n                        alphaClick(i);\n                    }\n                });\n                let canvas = BB.canvas(70, 70);\n                let ctx = canvas.getContext('2d');\n                if (i === 0 || i === 3) {\n                    if (i === 0) {\n                        ctx.beginPath();\n                        ctx.arc(35, 35, 30, 0, 2 * Math.PI);\n                        ctx.closePath();\n                        ctx.fill();\n                    } else {\n                        ctx.fillRect(5, 5, 60, 60);\n                    }\n                } else if (i === 1) {\n                    ctx.drawImage(genBrushAlpha01(60), 5, 5);\n                } else if (i === 2) {\n                    ctx.drawImage(genBrushAlpha02(60), 5, 5);\n                }\n                alpha.style.backgroundImage = 'url(' + canvas.toDataURL('image/png') + ')';\n\n                alphas.push(alpha);\n            }(i));\n        }\n\n        function updateAlphas() {\n            for (let i = 0; i < alphas.length; i++) {\n                if (i === currentAlpha) {\n                    alphas[i].className = 'brush-alpha-selected';\n                } else {\n                    alphas[i].className = 'brush-alpha';\n                }\n            }\n        }\n\n        updateAlphas();\n\n        function alphaClick(id) {\n            currentAlpha = id;\n            brush.setAlpha(id);\n            updateAlphas();\n        }\n\n        let lockAlphaToggle = new Checkbox({\n            init: brush.getLockAlpha(),\n            label: LANG('lock-alpha'),\n            callback: function (b) {\n                brush.setLockAlpha(b);\n            },\n            doHighlight: true,\n            title: LANG('lock-alpha-title'),\n            css: {\n                cssFloat: 'right',\n                textAlign: 'right',\n            }\n        });\n\n        let spacingSpline = new BB.SplineInterpolator([[0, 15], [8, 7], [14, 4], [30, 3], [50, 2.7], [100, 2]]);\n\n        function setSize(size) {\n            brush.setSize(size);\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\n        }\n\n        function init() {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: brush.getSize(),\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 2,\n                toValue: (displayValue) => displayValue / 2,\n                onChange: (val) => {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                formatFunc: (displayValue) => {\n                    if (displayValue < 10) {\n                        return BB.round(displayValue, 1);\n                    } else {\n                        return Math.round(displayValue);\n                    }\n                },\n                manualInputRoundDigits: 1,\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brushInterface.opacitySlider.max,\n                curve: brushInterface.opacitySlider.curve,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: (val) => {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n            });\n\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\n                brush.sizePressure(b);\n            });\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\n                brush.opacityPressure(b);\n            });\n\n            div.append(\n                BB.el({\n                    content: [\n                        sizeSlider.getElement(),\n                        pressureSizeToggle\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    }\n                }),\n                BB.el({\n                    content: [\n                        opacitySlider.getElement(),\n                        pressureOpacityToggle\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                    }\n                })\n            );\n\n            let alphaWrapper = document.createElement(\"div\");\n            for (let i = 0; i < alphas.length; i++) {\n                alphaWrapper.appendChild(alphas[i]);\n            }\n            alphaWrapper.style.marginTop = \"10px\";\n            div.appendChild(alphaWrapper);\n            alphaWrapper.appendChild(lockAlphaToggle.getElement());\n\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(-f);\n            }\n        };\n\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function (x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function (x, y) {\n            brush.endLine(x, y);\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.isDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    };\n    return brushInterface;\n})();","\nexport const eventResMs = 20;","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"iiCd6\");","import {BB} from '../../bb/bb';\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\nimport {eventResMs} from './brushes-consts';\nimport {Checkbox} from '../ui/base-components/checkbox';\nimport {brushes} from '../brushes/brushes';\nimport {klHistory} from '../history/kl-history';\nimport {KlSlider} from '../ui/base-components/kl-slider';\n// @ts-ignore\nimport brushIconImg from 'url:~/src/app/img/ui/brush-blend.svg';\nimport {IBrushUi} from '../kl.types';\nimport {LANG, languageStrings} from '../../language/language';\n\nexport const blendBrushUi = (function () {\n    let brushInterface: IBrushUi = {\n        image: brushIconImg,\n        tooltip: LANG('brush-blend'),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1\n        },\n        Ui: null,\n    };\n\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-blend');\n    });\n\n    brushInterface.Ui = function (p) {\n        let div = document.createElement(\"div\"); // the gui\n        let brush = new brushes.BlendBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n\n        let sizeSlider;\n        let opacitySlider;\n\n        function setSize(size) {\n            brush.setSize(size);\n        }\n\n        function init() {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: 58,\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 2,\n                toValue: (displayValue) => displayValue / 2,\n                onChange: (val) => {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brush.getOpacity(),\n                curve: brushInterface.opacitySlider.curve,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: (val) => {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n            });\n            let blendingSlider = new KlSlider({\n                label: LANG('brush-blending'),\n                width: 225,\n                height: 30,\n                min: 0,\n                max: 1,\n                value: brush.getBlending(),\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: function (val) {\n                    brush.setBlending(val);\n                },\n            });\n            blendingSlider.getElement().style.marginTop = \"10px\";\n\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\n                brush.setSizePressure(b);\n            });\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\n                brush.setOpacityPressure(b);\n            });\n\n            let lockAlphaToggle = new Checkbox({\n                init: brush.getLockAlpha(),\n                label: LANG('lock-alpha'),\n                callback: function (b) {\n                    brush.setLockAlpha(b);\n                },\n                doHighlight: true,\n                title: LANG('lock-alpha-title'),\n                css: {\n                    marginTop: '10px',\n                    display: 'inline-block',\n                }\n            });\n\n\n            div.append(\n                BB.el({\n                    content: [\n                        sizeSlider.getElement(),\n                        pressureSizeToggle\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    }\n                }),\n                BB.el({\n                    content: [\n                        opacitySlider.getElement(),\n                        pressureOpacityToggle\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                    }\n                }),\n                blendingSlider.getElement(),\n                lockAlphaToggle.getElement()\n            );\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.getIsDrawing()) {\n                sizeSlider.changeSliderValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.getIsDrawing()) {\n                sizeSlider.changeSliderValue(-f);\n            }\n        };\n\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function (x, y, p, isCoalesced) {\n            brush.goLine(x, y, p, isCoalesced);\n        };\n        this.endLine = function () {\n            brush.endLine();\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.getIsDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    };\n\n    return brushInterface;\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6fRlX\");","import {brushes} from '../brushes/brushes';\nimport {eventResMs} from './brushes-consts';\nimport {klHistory} from '../history/kl-history';\nimport {KlSlider} from '../ui/base-components/kl-slider';\n// @ts-ignore\nimport brushIconImg from 'url:~/src/app/img/ui/brush-sketchy.png';\nimport {IBrushUi} from '../kl.types';\nimport {LANG, languageStrings} from '../../language/language';\nimport {BB} from '../../bb/bb';\n\nexport const sketchyBrushUi = (function () {\n    let brushInterface: IBrushUi = {\n        image: brushIconImg,\n        tooltip: LANG('brush-sketchy'),\n        sizeSlider: {\n            min: 0.5,\n            max: 10\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1\n        },\n        Ui: null,\n    };\n\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-sketchy');\n    });\n\n    brushInterface.Ui = function (p) {\n        let div = document.createElement(\"div\"); // the gui\n        let brush = new brushes.SketchyBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n        let sizeSlider;\n        let opacitySlider;\n\n        function setSize(size) {\n            brush.setSize(size);\n        }\n\n        function init() {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 250,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: brush.getSize() * 2,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 2,\n                toValue: (displayValue) => displayValue / 2,\n                onChange: function (val) {\n                    brush.setSize(val);\n                    p.onSizeChange(val);\n                },\n                formatFunc: (displayValue) => {\n                    if (displayValue < 10) {\n                        return BB.round(displayValue, 1);\n                    } else {\n                        return Math.round(displayValue);\n                    }\n                },\n                manualInputRoundDigits: 1,\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 250,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brush.getOpacity(),\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: (val) => {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n            });\n            let blendSlider = new KlSlider({\n                label: LANG('brush-blending'),\n                width: 250,\n                height: 30,\n                min: 0,\n                max: 1,\n                value: brush.getBlending(),\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: function (val) {\n                    brush.setBlending(val);\n                },\n            });\n            let scaleSlider = new KlSlider({\n                label: LANG('brush-sketchy-scale'),\n                width: 250,\n                height: 30,\n                min: 1,\n                max: 20,\n                value: brush.getScale(),\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    brush.setScale(val);\n                },\n            });\n            opacitySlider.getElement().style.marginTop = \"10px\";\n            blendSlider.getElement().style.marginTop = \"10px\";\n            scaleSlider.getElement().style.marginTop = \"10px\";\n            div.appendChild(sizeSlider.getElement());\n            div.appendChild(opacitySlider.getElement());\n            div.appendChild(blendSlider.getElement());\n            div.appendChild(scaleSlider.getElement());\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(-f);\n            }\n        };\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, pressure) {\n            brush.startLine(x, y, pressure);\n        };\n        this.goLine = function (x, y, pressure) {\n            brush.goLine(x, y, pressure, null);\n        };\n        this.endLine = function () {\n            brush.endLine();\n        };\n        this.getSeed = function () {\n            return parseInt(brush.getSeed());\n        };\n        this.setSeed = function (s) {\n            brush.setSeed(parseInt(s));\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.isDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    };\n\n    return brushInterface;\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hC7PC\");","import {BB} from '../../bb/bb';\nimport {brushes} from '../brushes/brushes';\nimport {eventResMs} from './brushes-consts';\nimport {klHistory} from '../history/kl-history';\nimport {Checkbox} from '../ui/base-components/checkbox';\nimport {KlSlider} from '../ui/base-components/kl-slider';\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\n// @ts-ignore\nimport brushIconImg from 'url:~/src/app/img/ui/brush-pixel.svg';\nimport {IBrushUi} from '../kl.types';\nimport {LANG, languageStrings} from '../../language/language';\n\nexport const pixelBrushUi = (function () {\n    let brushInterface: IBrushUi = {\n        image: brushIconImg,\n        tooltip: LANG('brush-pixel'),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1,\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]]\n        },\n        Ui: null,\n    };\n\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-pixel');\n    });\n\n    brushInterface.Ui = function (p) {\n        let div = document.createElement(\"div\"); // the gui\n        let brush = new brushes.PixelBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n        let sizeSlider;\n        let opacitySlider;\n\n        let lockAlphaToggle = new Checkbox({\n            init: brush.getLockAlpha(),\n            label: LANG('lock-alpha'),\n            callback: function (b) {\n                brush.setLockAlpha(b);\n            },\n            doHighlight: true,\n            title: LANG('lock-alpha-title'),\n            css: {\n                marginRight: '10px',\n            }\n        });\n\n        let eraserToggle = new Checkbox({\n            init: brush.getIsEraser(),\n            label: LANG('eraser'),\n            callback: function (b) {\n                brush.setIsEraser(b);\n            },\n            css: {\n                marginRight: '10px',\n            }\n        });\n\n        let ditherToggle = new Checkbox({\n            init: brush.getUseDither(),\n            label: LANG('brush-pixel-dither'),\n            callback: function (b) {\n                brush.setUseDither(b);\n            }\n        });\n\n        let spacingSpline = new BB.SplineInterpolator([[0.5, 0.45], [100, 4]]);\n\n        function setSize(size) {\n            brush.setSize(size);\n            brush.setSpacing(spacingSpline.interpolate(size) / size);\n        }\n\n        function init() {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: brush.getSize(),\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 2,\n                toValue: (displayValue) => displayValue / 2,\n                onChange: (val) => {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brushInterface.opacitySlider.max,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: (val) => {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n            });\n\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\n                brush.sizePressure(b);\n            });\n\n            div.append(\n                BB.el({\n                    content: [\n                        sizeSlider.getElement(),\n                        pressureSizeToggle\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    }\n                }),\n                opacitySlider.getElement()\n            );\n\n            let toggleRow = BB.el({\n                parent: div,\n                css: {\n                    display: 'flex',\n                    marginTop: '10px'\n                }\n            });\n\n            toggleRow.appendChild(lockAlphaToggle.getElement());\n            toggleRow.appendChild(eraserToggle.getElement());\n            toggleRow.appendChild(ditherToggle.getElement());\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(-f);\n            }\n        };\n\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size * 2);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity * 100);\n        };\n\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function (x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function (x, y) {\n            brush.endLine(x, y);\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.isDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    };\n    return brushInterface;\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eZgVv\");","import {BB} from '../../bb/bb';\nimport {brushes} from '../brushes/brushes';\nimport {eventResMs} from './brushes-consts';\nimport {klHistory} from '../history/kl-history';\nimport {KlSlider} from '../ui/base-components/kl-slider';\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\nimport {Checkbox} from '../ui/base-components/checkbox';\n// @ts-ignore\nimport brushIconImg from 'url:~/src/app/img/ui/brush-eraser.svg';\nimport {IBrushUi} from '../kl.types';\nimport {LANG, languageStrings} from '../../language/language';\n\nexport const eraserBrushUi = (function () {\n    let brushInterface: IBrushUi = {\n        image: brushIconImg,\n        tooltip: LANG('eraser') + ' [E]',\n        sizeSlider: {\n            min: 0.5,\n            max: 200,\n            curve: BB.quadraticSplineInput(0.5, 200, 0.1)\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1\n        },\n        Ui: null,\n    };\n\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('eraser') + ' [E]';\n    });\n\n    brushInterface.Ui = function (p) {\n        let div = document.createElement(\"div\"); // the gui\n        let brush = new brushes.EraserBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n\n        let sizeSlider;\n        let opacitySlider;\n        let isTransparentBg = false;\n\n        function setSize(size) {\n            brush.setSize(size);\n        }\n\n        function init() {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: 30,\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 2,\n                toValue: (displayValue) => displayValue / 2,\n                onChange: (val) => {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                formatFunc: (displayValue) => {\n                    if (displayValue < 10) {\n                        return BB.round(displayValue, 1);\n                    } else {\n                        return Math.round(displayValue);\n                    }\n                },\n                manualInputRoundDigits: 1,\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brushInterface.opacitySlider.max,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: (val) => {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n            });\n\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\n                brush.sizePressure(b);\n            });\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\n                brush.opacityPressure(b);\n            });\n\n            div.append(\n                BB.el({\n                    content: [\n                        sizeSlider.getElement(),\n                        pressureSizeToggle\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    }\n                }),\n                BB.el({\n                    content: [\n                        opacitySlider.getElement(),\n                        pressureOpacityToggle\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                    }\n                })\n            );\n\n            let transparencyToggle = new Checkbox({\n                init: false,\n                label: LANG('brush-eraser-transparent-bg'),\n                callback: function (b) {\n                    isTransparentBg = b;\n                    brush.setTransparentBG(b);\n                },\n                css: {\n                    marginTop: \"10px\",\n                }\n            });\n            div.appendChild(transparencyToggle.getElement());\n        }\n\n        init();\n\n        function drawDot(x, y) {\n            brush.drawDot(x, y);\n        }\n\n        this.increaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(-f);\n            }\n        };\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n        this.setColor = function (c) {\n            //brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function (x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function () {\n            brush.endLine();\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.getIsTransparentBg = function () {\n            return isTransparentBg;\n        };\n        this.isDrawing = function () {\n            return brush.isDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        }\n    };\n\n    return brushInterface;\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"fPZin\");","import {BB} from '../../bb/bb';\nimport {brushes} from '../brushes/brushes';\nimport {eventResMs} from './brushes-consts';\nimport {klHistory} from '../history/kl-history';\nimport {Checkbox} from '../ui/base-components/checkbox';\nimport {KlSlider} from '../ui/base-components/kl-slider';\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\n// @ts-ignore\nimport brushIconImg from 'url:~/src/app/img/ui/brush-smudge.svg';\nimport {IBrushUi} from '../kl.types';\nimport {LANG, languageStrings} from '../../language/language';\n\nexport const smudgeBrushUi = (function () {\n    let brushInterface: IBrushUi = {\n        image: brushIconImg,\n        tooltip: LANG('brush-smudge'),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1,\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]]\n        },\n        Ui: null,\n    };\n\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-smudge');\n    });\n\n    brushInterface.Ui = function (p) {\n        let div = document.createElement(\"div\"); // the gui\n        let brush = new brushes.SmudgeBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n        let sizeSlider;\n        let opacitySlider;\n\n        let lockAlphaToggle = new Checkbox({\n            init: brush.getLockAlpha(),\n            label: LANG('lock-alpha'),\n            callback: function (b) {\n                brush.setLockAlpha(b);\n            },\n            doHighlight: true,\n            title: LANG('lock-alpha-title'),\n        });\n\n        let spacingSpline = new BB.SplineInterpolator([[0, 15], [8, 7], [14, 4], [30, 3], [50, 2.7], [100, 2]]);\n\n        function setSize(size) {\n            brush.setSize(size);\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\n        }\n\n        function init() {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: brush.getSize(),\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 2,\n                toValue: (displayValue) => displayValue / 2,\n                onChange: (val) => {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                formatFunc: (displayValue) => {\n                    if (displayValue < 10) {\n                        return BB.round(displayValue, 1);\n                    } else {\n                        return Math.round(displayValue);\n                    }\n                },\n                manualInputRoundDigits: 1,\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brush.getOpacity(),\n                curve: brushInterface.opacitySlider.curve,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: (val) => {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n            });\n\n            let pressureSizeToggle = penPressureToggle(false, function (b) {\n                brush.sizePressure(b);\n            });\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\n                brush.opacityPressure(b);\n            });\n\n            div.append(\n                BB.el({\n                    content: [\n                        sizeSlider.getElement(),\n                        pressureSizeToggle\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    }\n                }),\n                BB.el({\n                    content: [\n                        opacitySlider.getElement(),\n                        pressureOpacityToggle\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                    }\n                })\n            );\n\n            let bottomRow = BB.el({\n                parent: div,\n                css: {\n                    marginTop: '10px',\n                }\n            });\n            bottomRow.append(lockAlphaToggle.getElement());\n\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.getIsDrawing()) {\n                sizeSlider.changeSliderValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.getIsDrawing()) {\n                sizeSlider.changeSliderValue(-f);\n            }\n        };\n\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function (x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function (x, y) {\n            brush.endLine();\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.getIsDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    };\n    return brushInterface;\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"fp7H1\");","import {BB} from '../../bb/bb';\nimport {eventResMs} from './brushes-consts';\nimport {Checkbox} from '../ui/base-components/checkbox';\nimport {brushes} from '../brushes/brushes';\nimport {klHistory} from '../history/kl-history';\nimport {KlSlider} from '../ui/base-components/kl-slider';\n// @ts-ignore\nimport brushIconImg from 'url:~/src/app/img/ui/brush-chemy.svg';\nimport {IBrushUi} from '../kl.types';\nimport {Options} from '../ui/base-components/options';\nimport {BoxToggle} from '../ui/base-components/box-toggle';\nimport {LANG, languageStrings} from '../../language/language';\n\nexport const chemyBrushUi = (function () {\n    const brushInterface: IBrushUi = {\n        image: brushIconImg,\n        tooltip: LANG('brush-chemy'),\n        sizeSlider: {\n            min: 0.25,\n            max: 25,\n            curve: BB.quadraticSplineInput(0.25, 25, 0.1),\n            isDisabled: true,\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1\n        },\n        Ui: null,\n    };\n\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-chemy');\n    });\n\n    brushInterface.Ui = function (p) {\n        const div = document.createElement(\"div\"); // the gui\n        const brush = new brushes.ChemyBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n\n        let sizeSlider: KlSlider;\n        let opacitySlider: KlSlider;\n\n        function setSize(size) {\n            brush.setSize(size);\n        }\n\n        function init() {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 250,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: brush.getSize(),\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: eventResMs,\n                isEnabled: brush.getMode() === 'stroke',\n                toDisplayValue: (val) => val * 2,\n                toValue: (displayValue) => displayValue / 2,\n                onChange: (val) => {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                formatFunc: (displayValue) => {\n                    if (displayValue < 5) {\n                        return BB.round(displayValue, 1);\n                    } else {\n                        return Math.round(displayValue);\n                    }\n                },\n                manualInputRoundDigits: 1,\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 250,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brush.getOpacity(),\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: (val) => {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n            });\n\n            BB.css(opacitySlider.getElement(), {\n                marginTop: '10px',\n            });\n\n            let eraserToggle = new Checkbox({\n                init: brush.getIsEraser(),\n                label: LANG('eraser'),\n                callback: function (b) {\n                    brush.setIsEraser(b);\n                },\n                css: {\n                    marginTop: '10px',\n                    marginLeft: '10px',\n                }\n            });\n\n            const lockAlphaToggle = new Checkbox({\n                init: brush.getLockAlpha(),\n                label: LANG('lock-alpha'),\n                callback: function (b) {\n                    brush.setLockAlpha(b);\n                },\n                doHighlight: true,\n                title: LANG('lock-alpha-title'),\n                css: {\n                    marginTop: '10px',\n                }\n            });\n\n            const toggleRow = BB.el({\n                css: {\n                    display: 'flex',\n                    marginTop: '10px',\n                }\n            });\n\n            const iconSize = 35;\n            const padding = 8;\n            const actualIconSize = iconSize - padding * 2;\n            const halfSize = actualIconSize / 2;\n\n            const modeOptions = new Options({\n                optionArr: [\n                    {\n                        id: 'fill',\n                        label: BB.createSvg({\n                            elementType: 'svg',\n                            width: iconSize + '',\n                            height: iconSize + '',\n                            childrenArr: [\n                                {\n                                    elementType: 'path',\n                                    fill: '#000',\n                                    style: `transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\n                                    d: 'M 0,0 C 1.5,0 -0.5,1 1,1',\n                                },\n                            ],\n                        }),\n                        title: LANG('brush-chemy-fill'),\n                    },\n                    {\n                        id: 'stroke',\n                        label: BB.createSvg({\n                            elementType: 'svg',\n                            width: iconSize + '',\n                            height: iconSize + '',\n                            childrenArr: [\n                                {\n                                    elementType: 'path',\n                                    fill: 'none',\n                                    stroke: '#000',\n                                    style: `stroke-width: 0.12px; transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\n                                    d: 'M 0,0 C 1.5,0 -0.5,1 1,1',\n                                },\n                            ],\n                        }),\n                        title: LANG('brush-chemy-stroke'),\n                    }\n                ],\n                initId: brush.getMode(),\n                onChange: (id: string): void => {\n                    brush.setMode(id as 'stroke' | 'fill');\n                    brushInterface.sizeSlider.isDisabled = brush.getMode() === 'fill';\n                    sizeSlider.setIsEnabled(!brushInterface.sizeSlider.isDisabled);\n\n                    const brushSize = brush.getSize();\n                    sizeSlider.setValue(brushSize);\n                    p.onSizeChange(brushSize);\n                    p.onConfigChange();\n                }\n            });\n\n            const mirrorXToggle = new BoxToggle({\n                label: BB.createSvg({\n                    elementType: 'svg',\n                    width: iconSize + '',\n                    height: iconSize + '',\n                    childrenArr: [\n                        {\n                            elementType: 'path',\n                            fill: 'none',\n                            stroke: '#000',\n                            style: 'stroke-width: 1px',\n                            d: `M ${halfSize + padding},${padding} ${halfSize + padding},${actualIconSize + padding}`,\n                        },\n                    ]\n                }),\n                title: LANG('brush-chemy-mirror-x'),\n                init: brush.getXSymmetry(),\n                onChange: (b) => {\n                    brush.setXSymmetry(b);\n                },\n            });\n\n            const mirrorYToggle = new BoxToggle({\n                label: BB.createSvg({\n                    elementType: 'svg',\n                    width: iconSize + '',\n                    height: iconSize + '',\n                    childrenArr: [\n                        {\n                            elementType: 'path',\n                            fill: 'none',\n                            stroke: '#000',\n                            style: 'stroke-width: 1px',\n                            d: `M ${padding},${halfSize + padding} ${actualIconSize + padding},${halfSize + padding}`,\n                        },\n                    ]\n                }),\n                title: LANG('brush-chemy-mirror-y'),\n                init: brush.getYSymmetry(),\n                onChange: (b) => {\n                    brush.setYSymmetry(b);\n                },\n            });\n\n            const gradientToggle = new BoxToggle({\n                label: BB.createSvg({\n                    elementType: 'svg',\n                    width: iconSize + '',\n                    height: iconSize + '',\n                    childrenArr: [\n                        {\n                            elementType: 'defs',\n                            childrenArr: [\n                                {\n                                    elementType: 'linearGradient',\n                                    id: 'gradient',\n                                    x1: '0',\n                                    y1: '0',\n                                    x2: '0',\n                                    y2: '1',\n                                    childrenArr: [\n                                        {\n                                            elementType: 'stop',\n                                            offset: '0%',\n                                            'stop-color': 'rgba(0,0,0,0)',\n                                        },\n                                        {\n                                            elementType: 'stop',\n                                            offset: '100%',\n                                            'stop-color': 'rgba(0,0,0,1)',\n                                        }\n                                    ]\n                                }\n                            ]\n                        },\n                        {\n                            elementType: 'rect',\n                            fill: \"url('#gradient')\",\n                            x: '' + padding,\n                            y: '' + padding,\n                            width: '' + actualIconSize,\n                            height: '' + actualIconSize,\n                        },\n                    ]\n                }),\n                title: LANG('brush-chemy-gradient'),\n                init: brush.getGradient(),\n                onChange: (b) => {\n                    brush.setGradient(b);\n                },\n            });\n\n            BB.css(mirrorXToggle.getElement(), {\n                marginLeft: '10px',\n            });\n            {\n                const margin = {\n                    marginLeft: '4px',\n                };\n                BB.css(mirrorYToggle.getElement(), margin);\n                BB.css(gradientToggle.getElement(), margin);\n            }\n\n            toggleRow.append(\n                modeOptions.getElement(),\n                mirrorXToggle.getElement(),\n                mirrorYToggle.getElement(),\n                gradientToggle.getElement(),\n            );\n\n            div.append(\n                sizeSlider.getElement(),\n                opacitySlider.getElement(),\n                toggleRow,\n                BB.el({\n                    content: [\n                        lockAlphaToggle.getElement(),\n                        eraserToggle.getElement(),\n                    ],\n                    css: {\n                        display: 'flex',\n                    }\n                })\n            );\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.getIsDrawing() && brush.getMode() === 'stroke') {\n                sizeSlider.changeSliderValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.getIsDrawing() && brush.getMode() === 'stroke') {\n                sizeSlider.changeSliderValue(-f);\n            }\n        };\n\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y);\n        };\n        this.goLine = function (x, y, p, isCoalesced) {\n            brush.goLine(x, y);\n        };\n        this.endLine = function () {\n            brush.endLine();\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.getIsDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    };\n\n    return brushInterface;\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eX098\");","import {BB} from '../../../bb/bb';\n\nexport class BoxToggle {\n    el: HTMLElement;\n    value: boolean;\n\n    update (): void {\n        this.el.classList.toggle('kl-box-toggle--active', this.value);\n    }\n\n    // --- public ---\n    constructor (\n        p: {\n            label: string | HTMLElement | SVGElement;\n            title?: string;\n            init?: boolean;\n            onChange: (b: boolean) => void;\n        }\n    ) {\n        this.value = !!p.init;\n        this.el = BB.el({\n            content: p.label,\n            title: p.title,\n            className: (typeof p.label === 'string') ? 'kl-box-toggle' : 'kl-box-toggle kl-box-toggle--custom-el',\n            onClick: () => {\n                this.value = !this.value;\n                this.update();\n                p.onChange(this.value);\n            },\n            css: {\n                cursor: 'pointer',\n            }\n        });\n        if (typeof p.label !== 'string') {\n            BB.css(p.label, {\n                display: 'block',\n                pointerEvents: 'none',\n            });\n        }\n        this.update();\n    }\n\n    getValue (): boolean {\n        return this.value;\n    }\n\n    setValue (b: boolean): void {\n        this.value = !!b;\n        this.update();\n    }\n\n    getElement (): HTMLElement {\n        return this.el;\n    }\n\n    destroy (): void {\n        BB.destroyEl(this.el);\n    }\n}","import {BB} from '../../../bb/bb';\nimport {Popup} from './popup';\nimport {LANG} from '../../../language/language';\n\nexport function showIframePopup(url, isEmbed) {\n    if (!isEmbed && (window.innerHeight < 500 || window.innerWidth < 700)) {\n        window.open(url);\n        return;\n    }\n\n    let iframe = BB.el({\n        tagName: 'iframe',\n        custom: {\n            src: url,\n        },\n        css: {\n            width: '100%',\n            height: '100%'\n        }\n    }) as HTMLIFrameElement;\n    let titleEl = BB.el({});\n\n    let linkEl;\n    if (!isEmbed) {\n        linkEl = BB.el({\n            tagName: 'a',\n            parent: titleEl,\n            content: LANG('modal-new-tab'),\n            custom: {\n                href: 'help',\n                target: '_blank',\n            },\n            onClick: function() {\n                popup.close();\n            }\n        }) as HTMLAnchorElement;\n        iframe.onload = function() {\n            BB.setAttributes(linkEl, {\n                href: '' + iframe.contentWindow.location,\n            });\n        };\n    }\n\n\n    let popup = new Popup({\n        title: titleEl,\n        content: iframe,\n        width: 880,\n        isMaxHeight: true,\n        onClose: () => {\n            if (linkEl) {\n                BB.destroyEl(linkEl);\n            }\n        }\n    });\n\n}","import {BB} from '../../../bb/bb';\n\nexport class RadioList {\n\n    el: HTMLDivElement;\n    inputs: HTMLInputElement[] = [];\n\n    constructor({name, init, items, ignoreFocus}: {\n        name: string;\n        init?: string;\n        items: {\n            label: string;\n            value: string;\n        }[],\n        ignoreFocus?: boolean; // default false\n    }) {\n        this.el = BB.el({\n            className: 'kl-radio'\n        }) as HTMLDivElement;\n\n        items.forEach(item => {\n            let label = BB.el({\n                tagName: 'label'\n            });\n            let input = BB.el({\n                tagName: 'input',\n                parent: label,\n                custom: {\n                    name: name,\n                    value: item.value,\n                    type: 'radio',\n                }\n            }) as HTMLInputElement;\n            if (ignoreFocus) {\n                input.setAttribute('data-ignore-focus', 'true');\n            }\n            if (init === item.value) {\n                input.checked = true;\n            }\n            label.append(item.label);\n            this.el.append(label);\n            this.inputs.push(input);\n        });\n    }\n\n\n    getValue(): string {\n        for (let i = 0; i < this.inputs.length; i++) {\n            if (this.inputs[i].checked) {\n                return this.inputs[i].value;\n            }\n        }\n        return null;\n    }\n\n    getElement() {\n        return this.el;\n    }\n\n}","import {BB} from '../../../bb/bb';\n\n// @ts-ignore\nimport removeLayerImg from 'url:~/src/app/img/ui/remove-layer.svg';\nimport {IKlProject} from '../../kl.types';\nimport {showIframePopup} from '../modals/show-iframe-popup';\nimport {SaveReminder} from './save-reminder';\nimport {IProjectStoreListener, ProjectStore} from '../../storage/project-store';\nimport {KL} from '../../kl';\nimport {LANG} from '../../../language/language';\n\nexport class BrowserStorageUi {\n\n    private previewEl: HTMLDivElement;\n    private infoEl: HTMLDivElement;\n    private ageEl: HTMLDivElement;\n    private storeButtonEl: HTMLButtonElement;\n    private clearButtonEl: HTMLButtonElement;\n    private storeListener: IProjectStoreListener;\n\n    private timestamp: number;\n\n    private updateAge() {\n        if (!this.timestamp) {\n            return;\n        }\n        let age = new Date().getTime() - this.timestamp;\n        let ageStr;\n        age = Math.floor(age / 1000 / 60);\n        ageStr = LANG('file-storage-min-ago').replace('{x}', '' + age);\n        if (age > 60) {\n            age = Math.floor(age / 60);\n            ageStr = LANG('file-storage-hours-ago').replace('{x}', '' + age);\n            if (age > 24) {\n                age = Math.floor(age / 24);\n                ageStr = LANG('file-storage-days-ago').replace('{x}', '' + age);\n                if (age > 31) {\n                    ageStr = LANG('file-storage-month-ago');\n                }\n            }\n        }\n        this.ageEl.textContent = ageStr;\n    }\n\n    private resetButtons() {\n        if (this.timestamp) {\n            this.storeButtonEl.textContent = LANG('file-storage-overwrite');\n            this.storeButtonEl.disabled = false;\n            this.clearButtonEl.disabled = false;\n        } else {\n            this.storeButtonEl.textContent = LANG('file-storage-store');\n            this.storeButtonEl.disabled = false;\n            this.clearButtonEl.disabled = true;\n        }\n    }\n\n    private updateThumb(timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) {\n        this.timestamp = timestamp;\n        if (this.timestamp) {\n            BB.css(thumbnail, {\n                display: 'block',\n                maxWidth: 'calc(100% - 2px)',\n                maxHeight: 'calc(100% - 2px)',\n                margin: '0 auto',\n                background: \"url('\" + BB.createCheckerCanvas(4).toDataURL('image/png') + \"')\",\n                boxShadow: '0 0 0 1px #aaa',\n                pointerEvents: 'none',\n            });\n            this.previewEl.innerHTML = '';\n            this.updateAge();\n            this.previewEl.append(thumbnail, this.ageEl);\n        } else {\n            this.previewEl.innerHTML = LANG('file-storage-empty');\n        }\n        this.resetButtons();\n    }\n\n    private async store() {\n        this.storeButtonEl.textContent = LANG('file-storage-storing');\n        this.storeButtonEl.disabled = true;\n        this.clearButtonEl.disabled = true;\n        await new Promise((resolve) => {\n            setTimeout(() => resolve(null), 20);\n        });\n        try {\n            await this.projectStore.store(this.getProject());\n            this.saveReminder.reset();\n        } catch (e) {\n            this.resetButtons();\n            KL.popup({\n                target: this.klRootEl,\n                type: 'error',\n                message: [\n                    `${LANG('file-storage-failed-1')}<ul>`,\n                    `<li>${LANG('file-storage-failed-2')}</li>`,\n                    `<li>${LANG('file-storage-failed-3')}</li>`,\n                    `<li>${LANG('file-storage-failed-4')}</li>`,\n                    `</ul>`,\n                ].join(''),\n                buttons: ['Ok'],\n            });\n            setTimeout(() => {\n                throw new Error('storage-ui: failed to store browser storage, ' + e);\n            }, 0);\n        }\n    }\n\n    private async clear() {\n        this.storeButtonEl.disabled = true;\n        this.clearButtonEl.disabled = true;\n        try {\n            await this.projectStore.clear();\n        } catch (e) {\n            this.resetButtons();\n            KL.popup({\n                target: this.klRootEl,\n                type: 'error',\n                message: LANG('file-storage-failed-clear'),\n                buttons: ['Ok'],\n            });\n            setTimeout(() => {\n                throw new Error('storage-ui: failed to clear browser storage, ' + e);\n            }, 0);\n        }\n    }\n\n    element: HTMLDivElement;\n\n    constructor (\n        private projectStore: ProjectStore,\n        private getProject: () => IKlProject,\n        private saveReminder: SaveReminder,\n        private klRootEl: HTMLDivElement,\n        private options?: { hideClearButton?: boolean; isFocusable?: boolean }, // isFocusable default = false\n    ) {\n        this.element = BB.el({\n            css: {\n                display: 'grid',\n                gridTemplateColumns: '1fr 0fr',\n                gridTemplateRows: '0fr 0fr 0fr',\n                gap: '0 0',\n                gridTemplateAreas: '\"title title\" \"preview store\" \"preview clear\"',\n            }\n        }) as HTMLDivElement;\n\n\n        const title = BB.el({\n            parent: this.element,\n            content: LANG('file-storage'),\n            css: {\n                gridArea: 'title',\n                display: 'flex',\n                margin: '-5px 0',\n                //background: '#f00',\n            }\n        });\n\n        this.infoEl = BB.el({\n            parent: title,\n            content: '?',\n            title: LANG('file-storage-about'),\n            css: {\n                cursor: 'pointer',\n                marginLeft: '5px',\n                width: '19px',\n                height: '19px',\n                borderRadius: '100%',\n                textAlign: 'center',\n                lineHeight: '19px',\n                fontWeight: 'bold',\n                boxShadow: 'inset 0 0 0 1px #000',\n            },\n            onClick: () => {\n                showIframePopup('./help/#help-browser-storage', false);\n            }\n        }) as HTMLDivElement;\n\n        if (this.projectStore.isBroken()) {\n            BB.el({\n                parent: this.element,\n                content: \"🔴 \" + LANG('file-storage-cant-access'),\n                css: {\n                    marginTop: '10px',\n                }\n            });\n            return;\n        }\n\n        this.previewEl = BB.el({\n            parent: this.element,\n            title: LANG('file-storage-thumb-title'),\n            css: {\n                gridArea: 'preview',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                marginTop: '10px',\n                position: 'relative',\n                boxShadow: 'inset 0 0 0 1px #aaa',\n                background: '#cdcdcd',\n                color: '#545454',\n                colorScheme: 'only light',\n                minHeight: '67px',\n            }\n        }) as HTMLDivElement;\n        this.ageEl = BB.el({\n            css: {\n                position: 'absolute',\n                right: '0',\n                bottom: '0',\n                width: '100%',\n                textAlign: 'center',\n                background: 'rgba(0,0,0,0.7)',\n                color: '#fff',\n                textSize: '13px',\n            }\n        }) as HTMLDivElement;\n        const btnCustom = options?.isFocusable ?  {} : {\n            tabIndex: -1,\n        };\n        this.storeButtonEl = BB.el({\n            parent: this.element,\n            tagName: 'button',\n            className: 'gridButton',\n            content: LANG('file-storage-store'),\n            css: {\n                gridArea: 'store',\n                //background: '#00f',\n            },\n            custom: btnCustom,\n            onClick: () => this.store(),\n        }) as HTMLButtonElement;\n        this.clearButtonEl = BB.el({\n            parent: this.element,\n            tagName: 'button',\n            className: 'gridButton',\n            content: '<img src=\"' + removeLayerImg + '\" height=\"20\"/> ' + LANG('file-storage-clear'),\n            css: {\n                gridArea: 'clear',\n                //background: '#ff0',\n            },\n            custom: btnCustom,\n            onClick: () => this.clear(),\n        }) as HTMLButtonElement;\n\n        if (this.options?.hideClearButton) {\n            this.clearButtonEl.style.visibility = 'hidden';\n        }\n\n        this.storeListener = {\n            onUpdate: (timestamp, thumbnail) => {\n                this.updateThumb(timestamp, thumbnail);\n            },\n        };\n        this.projectStore.subscribe(this.storeListener);\n\n        setInterval(() => this.updateAge(), 1000 * 60);\n\n        (async () => {\n            try {\n                const readResult = await this.projectStore.read();\n                if (readResult) {\n                    this.updateThumb(readResult.timestamp, readResult.thumbnail);\n                } else {\n                    this.updateThumb();\n                }\n            } catch (e) {\n                setTimeout(() => {\n                    throw new Error('storage-ui: failed initial read browser storage, ' + e);\n                }, 0);\n            }\n        })();\n    }\n\n\n    getElement() {\n        return this.element;\n    }\n\n    show () {\n        // todo\n    }\n\n    hide () {\n        // todo\n    }\n\n    destroy() {\n        BB.destroyEl(this.infoEl);\n        BB.destroyEl(this.storeButtonEl);\n        BB.destroyEl(this.clearButtonEl);\n        this.projectStore.unsubscribe(this.storeListener);\n    }\n}","import {IKlProject, IKlStorageProject} from '../kl.types';\nimport {ProjectConverter} from './project-converter';\nimport {clear, getKlProjectObj, storeKlProjectObj} from './indexed-db';\nimport {LocalStorage} from '../../bb/base/local-storage';\n\n\nexport interface IProjectStoreListener {\n    onUpdate: (timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) => void,\n}\n\nfunction makeAsync(func): Promise<any> {\n    return new Promise((resolve, reject) => {\n        func(resolve, reject);\n    });\n}\n\n/**\n * simplified interface for storing projects into browser storage\n */\nexport class ProjectStore {\n\n    private listeners: IProjectStoreListener[] = [];\n    private accessHasFailed: boolean = false;\n\n    async lowLevelStore (project: IKlStorageProject): Promise<any> {\n        await new Promise((resolve, reject) => {\n            storeKlProjectObj(project, resolve, reject);\n        });\n    }\n\n    async lowLevelRead (): Promise<IKlStorageProject> {\n        return await makeAsync(getKlProjectObj) as IKlStorageProject;\n    }\n\n    async lowLevelClear (): Promise<any> {\n        await makeAsync(clear);\n    }\n\n\n\n    private emit(timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) {\n        this.listeners.forEach(item => {\n            item.onUpdate(timestamp, thumbnail);\n        });\n    }\n\n    private updateTimestamp() {\n        LocalStorage.setItem('indexedDbUpdatedAt', '' + new Date().getTime());\n    }\n\n    // --- public ---\n\n    constructor () {\n        window.addEventListener('storage', (e) => {\n            if (e.key !== 'indexedDbUpdatedAt' || this.listeners.length === 0) {\n                return;\n            }\n            try {\n                ( async () => {\n                    const readResult = await this.read();\n                    if (readResult) {\n                        this.emit(readResult.timestamp, readResult.thumbnail);\n                    } else {\n                        this.emit();\n                    }\n                })();\n            } catch (e) {\n                if (e.message.indexOf('db-error') === 0) {\n                    this.accessHasFailed = true;\n                }\n            }\n\n        });\n    }\n\n    async read(): Promise<{\n        project: IKlProject,\n        timestamp: number,\n        thumbnail: HTMLImageElement | HTMLCanvasElement\n    } | null> {\n        let storageProject;\n        try {\n            storageProject = await this.lowLevelRead();\n        } catch (e) {\n            this.accessHasFailed = true;\n            throw new Error('db-error: ' + e);\n        }\n        if (!storageProject) {\n            return null;\n        }\n        let result;\n        try {\n            result = await ProjectConverter.readStorageProject(storageProject);\n        } catch (e) {\n            throw new Error('format-error: ' + e);\n        }\n        return result;\n    }\n\n    async store(project: IKlProject): Promise<void> {\n        try {\n            const storageProject = ProjectConverter.createStorageProject(project);\n            await this.lowLevelStore(storageProject);\n        } catch (e) {\n            this.accessHasFailed = true;\n            throw new Error('db-error: ' + e);\n        }\n        {\n            // immediately test if it can be read\n            const storageProject = await this.lowLevelRead();\n            let readResult = null;\n            try {\n                readResult = await ProjectConverter.readStorageProject(storageProject);\n            } catch (e) {\n                await this.lowLevelClear();\n                this.updateTimestamp();\n                setTimeout(() => this.emit(), 0);\n                throw new Error('format-error: ' + e);\n            }\n            this.updateTimestamp();\n            setTimeout(() => this.emit(readResult.timestamp, readResult.thumbnail), 0);\n        }\n    }\n\n    async clear(): Promise<void> {\n        await this.lowLevelClear();\n        this.updateTimestamp();\n        setTimeout(() => this.emit(), 0);\n    }\n\n    subscribe(listener: IProjectStoreListener) {\n        if (this.listeners.includes(listener)) {\n            return;\n        }\n        this.listeners.push(listener);\n    }\n\n    unsubscribe(listener: IProjectStoreListener) {\n        for (let i = 0; i < this.listeners.length; i++) {\n            if (listener === this.listeners[i]) {\n                this.listeners.splice(i, 1);\n                return;\n            }\n        }\n    }\n\n    isBroken() {\n        return this.accessHasFailed;\n    }\n\n}","import {IKlProject, IKlStorageProject} from '../kl.types';\nimport {BB} from '../../bb/bb';\nimport {drawProject} from '../canvas/draw-project';\nimport {base64ToBlob} from './base-64-to-blob';\n\n\nconst thumbSize = 240;\n\nfunction loadImage(blob: Blob): Promise<HTMLImageElement> {\n    return new Promise<HTMLImageElement>((resolve, reject) => {\n        const im = new Image();\n        try {\n            im.src = BB.imageBlobToUrl(blob);\n        } catch (e) {\n            reject('imageBlobToUrl, ' + e.message);\n            return;\n        }\n        im.onload = () => {\n            URL.revokeObjectURL(im.src);\n            resolve(im);\n        }\n        im.onabort = function () {\n            reject('layer image failed loading');\n        };\n        im.onerror = function () {\n            reject('layer image failed loading');\n        };\n    });\n}\n\n/**\n * for:\n * - preparing project to be stored in ProjectStore\n * - reading a project that came out of the ProjectStore\n */\nexport class ProjectConverter {\n\n    private static createThumbnail(project): HTMLCanvasElement {\n        const size = BB.fitInto(project.width, project.height, thumbSize, thumbSize);\n        const factor = size.width / project.width;\n        return drawProject(project, factor);\n    }\n\n    static createStorageProject(project: IKlProject): IKlStorageProject {\n        return {\n            id: 1,\n            timestamp: new Date().getTime(),\n            thumbnail: base64ToBlob(ProjectConverter.createThumbnail(project).toDataURL('image/png')),\n            width: project.width,\n            height: project.height,\n            layers: project.layers.map(item => {\n                let blob;\n                if (item.image instanceof HTMLCanvasElement) {\n                    blob = base64ToBlob((item.image as HTMLCanvasElement).toDataURL('image/png'));\n                } else {\n                    // todo image\n                    throw new Error('Not implemented');\n                }\n                return {\n                    name: item.name,\n                    opacity: item.opacity,\n                    mixModeStr: item.mixModeStr,\n                    blob,\n                }\n            }),\n        };\n    }\n\n    static async readStorageProject(storageProject: IKlStorageProject): Promise<{\n        project: IKlProject,\n        timestamp: number,\n        thumbnail: HTMLImageElement | HTMLCanvasElement\n    }> {\n        if (\n            !storageProject.width || !storageProject.height ||\n            isNaN(storageProject.width) || isNaN(storageProject.height) ||\n            storageProject.width < 1 || storageProject.height < 1\n        ) {\n            throw new Error('readStorageProject invalid canvas size: ' + storageProject.width + ', ' + storageProject.height);\n        }\n        const project: IKlProject = {\n            width: storageProject.width,\n            height: storageProject.height,\n            layers: (await Promise.all(storageProject.layers.map(layer => loadImage(layer.blob))))\n                .map((image, i) => {\n                    return {\n                        name: storageProject.layers[i].name,\n                        opacity: storageProject.layers[i].opacity,\n                        mixModeStr: storageProject.layers[i].mixModeStr,\n                        image,\n                    };\n                }),\n        };\n\n        let thumbnail;\n        if (storageProject.thumbnail) {\n            thumbnail = await loadImage(storageProject.thumbnail);\n        } else {\n            thumbnail = ProjectConverter.createThumbnail(project);\n        }\n\n        return {\n            project: project,\n            timestamp: storageProject.timestamp,\n            thumbnail: thumbnail,\n        };\n    }\n\n}","\nexport function base64ToBlob(base64Str: string): Blob {\n    let parts = base64Str.match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);\n    let binStr = atob(parts[3]);\n    let buf = new ArrayBuffer(binStr.length);\n    let view = new Uint8Array(buf);\n    for (let i = 0; i < view.length; i++) {\n        view[i] = binStr.charCodeAt(i);\n    }\n    return new Blob([view], {'type': parts[1]});\n}","import {BB} from '../../../bb/bb';\nimport {KL} from '../../kl';\n// @ts-ignore\nimport newImageImg from 'url:~/src/app/img/ui/new-image.svg';\n// @ts-ignore\nimport exportImg from 'url:~/src/app/img/ui/export.svg';\n// @ts-ignore\nimport shareImg from 'url:~/src/app/img/ui/share.svg';\n// @ts-ignore\nimport uploadImg from 'url:~/src/app/img/ui/upload.svg';\n// @ts-ignore\nimport importImg from 'url:~/src/app/img/ui/import.svg';\n// @ts-ignore\nimport copyImg from 'url:~/src/app/img/ui/copy.svg';\nimport {BrowserStorageUi} from '../components/browser-storage-ui';\nimport {IKlProject} from '../../kl.types';\nimport {SaveReminder} from '../components/save-reminder';\nimport {ProjectStore} from '../../storage/project-store';\nimport {LANG} from '../../../language/language';\n\nexport type exportType = 'png' | 'layers' | 'psd';\n\n\n\n\n\n\n\n\nexport class FileTab {\n\n    private readonly div: HTMLDivElement;\n    private importButton: HTMLInputElement;\n    private fileBrowserStorage: BrowserStorageUi;\n\n    constructor(\n        klRootEl,\n        projectStore: ProjectStore,\n        getProject: () => IKlProject,\n        private exportType,\n        onExportTypeChange,\n        onFileSelect,\n        onSaveImageToComputer,\n        onNewImage,\n        onShareImage,\n        onUpload,\n        onCopyToClipboard,\n        saveReminder: SaveReminder,\n    ) {\n        const _this = this;\n        this.div = document.createElement(\"div\");\n\n        const asyncCreation = () => {\n            let filemenu = document.createElement(\"div\");\n            let newButton = document.createElement(\"button\");\n            let saveButton = document.createElement(\"button\");\n            let shareButton = document.createElement(\"button\");\n            let uploadImgurButton = document.createElement(\"button\");\n            let clipboardButton = document.createElement(\"button\");\n\n            newButton.style.cssFloat = 'left';\n            BB.css(saveButton, {\n                cssFloat: 'left',\n                clear: 'both',\n            });\n            BB.css(clipboardButton, {\n                cssFloat: 'left',\n                clear: 'both',\n            });\n\n            newButton.tabIndex = -1;\n            saveButton.tabIndex = -1;\n            shareButton.tabIndex = -1;\n            uploadImgurButton.tabIndex = -1;\n            clipboardButton.tabIndex = -1;\n\n            newButton.innerHTML = `<img src='${newImageImg}' alt='icon' height='20'/>${LANG('file-new')}`;\n            saveButton.innerHTML = `<img src='${exportImg}' alt='icon' height='20'/>${LANG('file-save')}`;\n            shareButton.innerHTML = `<img src='${shareImg}' alt='icon' height='20'/>${LANG('file-share')}`;\n            uploadImgurButton.innerHTML = `<img style='float:left' src='${uploadImg}' height='20' alt='icon'/>${LANG('file-upload')}`;\n            clipboardButton.innerHTML = `<img src='${copyImg}' alt='icon' height='20'/>${LANG('file-copy')}`;\n            clipboardButton.title = LANG('file-copy-title');\n            newButton.className = \"gridButton\";\n            saveButton.className = \"gridButton\";\n            shareButton.className = \"gridButton\";\n            uploadImgurButton.className = \"gridButton\";\n            clipboardButton.className = \"gridButton\";\n\n\n            this.importButton = document.createElement(\"input\");\n            this.importButton.tabIndex = -1;\n            this.importButton.type = \"file\";\n            this.importButton.multiple = true;\n            this.importButton.accept = \"image\";\n            (this.importButton as any).size = \"71\";\n            this.importButton.textContent = \"Import\";\n            let importWrapper: any = this.importButton;\n\n            function createImportButton() {\n                importWrapper = document.createElement(\"div\");\n                importWrapper.className = \"gridButton\";\n                importWrapper.style.position = \"relative\";\n                importWrapper.style.cursor = \"pointer\";\n                importWrapper.style.cssFloat = \"left\";\n\n                let innerMask = document.createElement(\"div\");\n                innerMask.style.width = \"120px\";\n                innerMask.style.height = \"28px\";\n                innerMask.style.overflow = \"hidden\";\n                innerMask.style.cursor = \"pointer\";\n                innerMask.style.position = \"relative\";\n\n                importWrapper.appendChild(innerMask);\n                innerMask.appendChild(_this.importButton);\n\n                let importFakeButton = document.createElement(\"button\");\n                importFakeButton.innerHTML = \"<img style='float:left' height='20' src='\" + importImg + \"' alt='icon'/>\" + LANG('file-import');\n                importFakeButton.tabIndex = -1;\n\n                BB.css(importFakeButton, {\n                    width: \"120px\",\n                    display: \"box\",\n                    position: \"absolute\",\n                    left: '0',\n                    top: '0',\n                    cursor: \"pointer\"\n                });\n                BB.css(_this.importButton, {\n                    display: 'none'\n                });\n                importWrapper.appendChild(importFakeButton);\n\n                importFakeButton.onclick = function() {\n                    _this.importButton.click();\n                }\n            }\n\n            createImportButton();\n\n            this.importButton.onchange = function (e) {\n                onFileSelect(_this.importButton.files, 'default');\n                _this.importButton.value = \"\";\n\n            };\n\n\n            // --- export filetype dropdown ---\n            let exportTypeWrapper;\n            let exportTypeSelect;\n            {\n                exportTypeWrapper = BB.el({\n                    css: {\n                        fontSize: '15px',\n                        marginLeft: '10px',\n                        marginTop: '10px',\n                        cssFloat: 'left',\n                        width: 'calc(50% - 15px)',\n                        height: '30px'\n                    }\n                });\n                exportTypeSelect = new KL.Select({\n                    optionArr: [\n                        ['png', LANG('file-save-png')],\n                        ['psd', LANG('file-save-psd')],\n                        ['layers', LANG('file-save-layers')],\n                    ],\n                    initValue: exportType,\n                    onChange: function(val) {\n                        exportType = val;\n                        onExportTypeChange(exportType);\n                        onSaveImageToComputer();\n                    }\n                });\n                BB.css(exportTypeSelect.getElement(), {\n                    width: '120px',\n                    height: '30px'\n                });\n                exportTypeWrapper.appendChild(exportTypeSelect.getElement());\n\n            }\n\n\n\n            newButton.onclick = onNewImage;\n            saveButton.onclick = function () {\n                onSaveImageToComputer();\n            };\n            shareButton.onclick = function() {\n                shareButton.disabled = true;\n                onShareImage(() => {\n                    shareButton.disabled = false;\n                });\n            };\n            uploadImgurButton.onclick = function () {\n                onUpload();\n            };\n\n            clipboardButton.onclick = function() {\n                clipboardButton.blur();\n                onCopyToClipboard();\n            };\n\n            let saveNote = document.createElement(\"div\");\n            saveNote.textContent = \"⚠️ \" + LANG('file-no-autosave');\n            BB.css(saveNote, {\n                textAlign: \"center\",\n                marginTop: \"10px\",\n                background: \"rgb(243, 243, 161)\",\n                padding: \"5px 0px\",\n                color: 'rgba(0,0,0,0.65)',\n                fontSize: '15px',\n            });\n\n            function createSpacer() {\n                let el = document.createElement(\"div\");\n                let clearer = document.createElement(\"div\");\n                let line = document.createElement(\"div\");\n                el.appendChild(clearer);\n                el.appendChild(line);\n                BB.css(clearer, {\n                    clear: 'both'\n                });\n                BB.css(line, {\n                    marginLeft: \"10px\",\n                    marginRight: \"10px\",\n                    marginTop: \"10px\",\n                    borderBottom: \"1px solid rgba(0,0,0,0.2)\",\n                    clear: 'both'\n                });\n                return el;\n            }\n\n            _this.fileBrowserStorage = new BrowserStorageUi(projectStore, getProject, saveReminder, klRootEl);\n            BB.css(_this.fileBrowserStorage.getElement(), {\n                //background: 'red',\n                margin: '10px',\n            });\n\n\n            //actual structure\n            BB.append(filemenu, [\n                saveNote,\n                newButton,\n                importWrapper,\n                BB.el({css: {clear: 'both'}}),\n\n                saveButton,\n                exportTypeWrapper,\n                BB.el({css: {clear: 'both'}}),\n\n                clipboardButton,\n                BB.canShareFiles() ? shareButton : null,\n                BB.el({css: {clear: 'both'}}),\n\n                createSpacer(),\n                _this.fileBrowserStorage.getElement(),\n                createSpacer(),\n                uploadImgurButton,\n            ]);\n\n            this.div.appendChild(filemenu);\n        };\n\n        setTimeout(asyncCreation, 1);\n    }\n\n    refresh() {\n    }\n\n    getElement() {\n        return this.div;\n    }\n\n    setIsVisible(isVisible: boolean) {\n        if (isVisible) {\n            this.refresh();\n        }\n    }\n\n    triggerImport() {\n        this.importButton.click();\n    }\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"2oHM2\");","import {BB} from '../../../bb/bb';\nimport {KL} from '../../kl';\nimport {klHistory} from '../../history/kl-history';\nimport {IKeyString} from '../../../bb/bb.types';\nimport {StatusOverlay} from '../components/status-overlay';\nimport {KlCanvasWorkspace} from '../../canvas-ui/kl-canvas-workspace';\nimport {KlCanvas} from '../../canvas/kl-canvas';\nimport {LANG} from '../../../language/language';\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult} from '../../kl.types';\n\n\nexport class FilterTab {\n\n    private readonly div: HTMLDivElement;\n    private isInit = false;\n\n    constructor (\n        private klRootEl,\n        private klColorSlider,\n        private layerManager,\n        // private setCurrentLayer,\n        private klCanvasWorkspace: KlCanvasWorkspace,\n        private handUi,\n        private getCurrentColor,\n        private getKlMaxCanvasSize,\n        private getKlCanvas: () => KlCanvas,\n        private getCurrentLayerCtx,\n        private isEmbed: boolean,\n        private statusOverlay: StatusOverlay,\n    ) {\n        this.div = document.createElement(\"div\");\n    }\n\n    private init() {\n        const _this = this;\n        let filters = KL.filterLib;\n        let buttons = [];\n\n        BB.BbLog.emit({\n            type: 'init-filters',\n        });\n\n        if (!KL.filterLibStatus.isLoaded) {\n            throw new Error('filters not loaded');\n        }\n\n        function createButton(filterKey, filterArr) {\n            let button = document.createElement(\"button\");\n            let buttonLabel = LANG(filterArr[filterKey].lang.button);\n            let im = '<img height=\"20\" width=\"18\" src=\"' + filterArr[filterKey].icon + '\" alt=\"icon\" />';\n            button.innerHTML = im + buttonLabel;\n            button.className = \"gridButton\";\n            BB.css(button, {\n                lineHeight: '20px',\n                fontSize: '12px',\n            });\n            button.tabIndex = -1;\n\n            const filterName = LANG(filterArr[filterKey].lang.name);\n\n            button.onclick = function () {\n\n                function finishedDialog(result, filterDialog) {\n                    if (result == \"Cancel\") {\n                        if (filterDialog.destroy) {\n                            filterDialog.destroy();\n                        }\n                        return;\n                    }\n                    let input;\n                    try {\n                        input = filterDialog.getInput(); // also destroys\n                    } catch (e) {\n                        if (e.message.indexOf('.getInput is not a function') !== -1) {\n                            throw 'filterDialog.getInput is not a function, filter: ' + filterName;\n                        } else {\n                            throw e;\n                        }\n                    }\n                    applyFilter(input);\n                }\n\n                if (!('apply' in filterArr[filterKey])) {\n                    alert('Application not fully loaded');\n                    return;\n                }\n\n                function applyFilter(input) {\n                    let filterResult = filterArr[filterKey].apply({\n                        context: _this.getCurrentLayerCtx(),\n                        klCanvas: _this.getKlCanvas(),\n                        history: klHistory,\n                        input: input\n                    } as IFilterApply);\n                    if (filterResult === false) {\n                        alert(\"Couldn't apply the edit action\");\n                    }\n                    /*\n                     _this.setCurrentLayer(_this.getKlCanvas().getLayer(_this.layerManager.getSelected()));\n                    */\n                    if (filterArr[filterKey].updatePos === true) {\n                        _this.klCanvasWorkspace.resetView();\n                        _this.handUi.update(_this.klCanvasWorkspace.getScale(), _this.klCanvasWorkspace.getAngleDeg());\n                    }\n                    _this.layerManager.update();\n                }\n\n                if (filterArr[filterKey].isInstant){\n                    button.blur();\n                    applyFilter(null);\n                    _this.statusOverlay.out('\"' + filterName + '\" ' + LANG('filter-applied'), true);\n                } else {\n                    let secondaryColorRGB = _this.klColorSlider.getSecondaryRGB();\n                    let filterDialog = filterArr[filterKey].getDialog({\n                        context: _this.getCurrentLayerCtx(),\n                        klCanvas: _this.getKlCanvas(),\n                        maxWidth: _this.getKlMaxCanvasSize(),\n                        maxHeight: _this.getKlMaxCanvasSize(),\n                        currentColorRgb: {r: _this.getCurrentColor().r, g: _this.getCurrentColor().g, b: _this.getCurrentColor().b},\n                        secondaryColorRgb: {r: secondaryColorRGB.r, g: secondaryColorRGB.g, b: secondaryColorRGB.b}\n                    } as IFilterGetDialogParam) as IFilterGetDialogResult;\n\n                    if (!filterDialog) {\n                        return;\n                        //alert('Error: could not perform action');\n                        //throw('filter['+filterKey+'].getDialog returned '+filterDialog+'. ctx:' + currentLayerCtx + ' klCanvas:' + klCanvas);\n                    }\n\n                    let closefunc;\n                    // Todo should move into getDialogParams\n                    filterDialog.errorCallback = function(e) {\n                        setTimeout(function() {\n                            alert('Error: could not perform action');\n                            throw e;\n                        }, 0);\n                        closefunc();\n                    };\n\n\n                    let style: IKeyString = {};\n                    if ('width' in filterDialog) {\n                        style.width = filterDialog.width + 'px'\n                    }\n\n                    KL.popup({\n                        target: _this.klRootEl,\n                        message: \"<b>\" + filterName + \"</b>\",\n                        div: filterDialog.element,\n                        style: style,\n                        buttons: [\"Ok\", \"Cancel\"],\n                        clickOnEnter: 'Ok',\n                        callback: function(result) {\n                            finishedDialog(result, filterDialog);\n                        },\n                        closefunc: function (func) {\n                            closefunc = func;\n                        }\n                    });\n                }\n            }\n            buttons[buttons.length] = button;\n            return button;\n        }\n\n        function addGroup(groupArr, filterArr, targetEl) {\n            for (let filterKey in filterArr) {\n                if (filterArr.hasOwnProperty[filterKey] || !groupArr.includes(filterKey)) {\n                    continue;\n                }\n                if (_this.isEmbed && !filterArr[filterKey].inEmbed) {\n                    continue;\n                }\n                targetEl.appendChild(createButton(filterKey, filterArr));\n            }\n        }\n\n        const groupA = [\n            'cropExtend',\n            'flip',\n            'perspective',\n            'resize',\n            'rotate',\n            'transform',\n        ];\n        const groupB = [\n            'brightnessContrast',\n            'curves',\n            'distort',\n            'hueSaturation',\n            'invert',\n            'tiltShift',\n            'toAlpha',\n            'blur',\n            'unsharpMask',\n        ];\n        const groupC = [\n            'grid',\n            'noise',\n            'pattern',\n            'vanishPoint'\n        ];\n\n        addGroup(groupA, filters, _this.div);\n\n        _this.div.appendChild(BB.el({className: 'gridHr'}));\n        addGroup(groupB, filters, _this.div);\n        _this.div.appendChild(BB.el({className: 'gridHr'}));\n        addGroup(groupC, filters, _this.div);\n\n        this.isInit = true;\n    }\n\n    getElement() {\n        return this.div;\n    }\n\n    show() {\n        if (!this.isInit) {\n            this.init();\n        }\n        this.div.style.display = 'block';\n    }\n\n    hide() {\n        this.div.style.display = 'none';\n    }\n\n}","import {BB} from '../../../bb/bb';\nimport {KL} from '../../kl';\n// @ts-ignore\nimport loadingImg from 'url:~/src/app/img/ui/loading.gif';\nimport {SaveReminder} from '../components/save-reminder';\nimport {base64ToBlob} from '../../storage/base-64-to-blob';\nimport {KlCanvas} from '../../canvas/kl-canvas';\nimport {LANG} from '../../../language/language';\n\n\nasync function upload(canvas, title, description, type: 'png' | 'jpeg', imgurKey: string): Promise<{deletehash: string}> {\n    let img = base64ToBlob(canvas.toDataURL(\"image/\" + type));\n\n    let w = window.open();\n    let label = w.document.createElement(\"div\");\n    let gif = w.document.createElement(\"img\");\n    gif.src = loadingImg;\n    label.appendChild(gif);\n    BB.css(gif, {\n        filter: \"invert(1)\"\n    });\n    w.document.body.style.backgroundColor = \"#121211\";\n    w.document.body.style.backgroundImage = \"linear-gradient(#2b2b2b 0%, #121211 50%)\";\n    w.document.body.style.backgroundRepeat = \"no-repeat\";\n    let labelText = w.document.createElement(\"div\");\n    labelText.style.marginTop = \"10px\";\n    label.appendChild(labelText);\n    labelText.textContent = LANG('upload-uploading');\n\n    w.document.body.appendChild(label);\n    BB.css(label, {\n        marginLeft: \"auto\",\n        marginRight: \"auto\",\n        marginTop: \"100px\",\n        fontFamily: \"Arial, sans-serif\",\n        fontSize: \"20px\",\n        textAlign: \"center\",\n        transition: \"opacity 0.3s ease-in-out\",\n        opacity: '0',\n        color: \"#ccc\"\n    });\n    setTimeout(function () {\n        label.style.opacity = '1';\n    }, 20);\n\n    let response;\n    try {\n        const formData = new FormData();\n        formData.append('title', title);\n        formData.append('description', description);\n        formData.append('image', img);\n        response = await fetch('https://api.imgur.com/3/image',  {\n            method: 'POST',\n            headers: {\n                Authorization: 'Client-ID ' + imgurKey,\n            },\n            body: formData\n        });\n\n    } catch (e) {\n        w.close();\n        throw new Error(e);\n    }\n    if (!response.ok) {\n        w.close();\n        throw new Error();\n    }\n    let data = (await response.json()).data;\n\n    w.location.href = (data as any).link.replace(/\\.(jpg|png)/, '');\n\n    return data;\n}\n\n\nexport function imgurUpload(klCanvas: KlCanvas, klRootEl, saveReminder: SaveReminder, imgurKey: string) {\n    if (!imgurKey) {\n        throw new Error('imgur key missing');\n    }\n\n    let inputTitle = document.createElement(\"input\");\n    inputTitle.type = \"text\";\n    inputTitle.value = LANG('upload-title-untitled');\n    let inputDescription = BB.el({\n        tagName: 'textarea',\n        custom: {\n            rows: 2,\n        },\n        css: {\n            width: '100%',\n            maxWidth: '100%',\n        },\n    }) as HTMLTextAreaElement;\n\n    let labelTitle = document.createElement(\"div\");\n    labelTitle.textContent = LANG('upload-name') + \":\";\n    let labelDescription = BB.el({\n        content: LANG('upload-caption') + ':',\n        css: {\n            marginTop: '10px',\n        }\n    });\n\n    let tos = document.createElement(\"div\");\n    tos.innerHTML = `<br/><a href=\"https://imgur.com/tos\" target=\"_blank\" rel=\"noopener noreferrer\">${LANG('upload-tos')}</a> ${LANG('upload-tos-2')}`;\n\n    const typeRadio = new KL.RadioList({\n        name: 'filetype',\n        init: 'jpeg',\n        items: [\n            { label: 'JPG', value: 'jpeg' },\n            { label: 'PNG', value: 'png' },\n        ],\n        ignoreFocus: true,\n    });\n    BB.css(typeRadio.getElement(), {\n        marginBottom: '10px',\n    });\n\n\n    let outDiv = document.createElement(\"div\");\n    let infoHint = document.createElement(\"div\");\n    infoHint.className = \"info-hint\";\n    infoHint.textContent = LANG('upload-link-notice');\n    outDiv.append(\n        infoHint,\n        typeRadio.getElement(),\n        labelTitle,\n        inputTitle,\n        labelDescription,\n        inputDescription,\n        tos\n    );\n    KL.popup({\n        target: klRootEl,\n        message: `<b>${LANG('upload-title')}</b>`,\n        type: \"upload\",\n        div: outDiv,\n        buttons: [LANG('upload-submit'), \"Cancel\"],\n        clickOnEnter: LANG('upload-submit'),\n        primaries: [LANG('upload-submit')],\n        autoFocus: LANG('upload-submit'),\n        callback: async function (val) {\n            if (val === LANG('upload-submit') || val === \"Yes\" || val === \"Ok\") {\n                try {\n                    const result = await upload(\n                        klCanvas.getCompleteCanvas(1),\n                        inputTitle.value,\n                        inputDescription.value,\n                        typeRadio.getValue() as 'png' | 'jpeg',\n                        imgurKey,\n                    );\n\n                    KL.popup({\n                        target: klRootEl,\n                        type: \"ok\",\n                        message: `<h3>${LANG('upload-success')}</h3><br>${LANG('upload-delete')}<br><a target='_blank' rel=\"noopener noreferrer\" href='https://imgur.com/delete/${result.deletehash}'>imgur.com/delete/${result.deletehash}</a><br><br>`,\n                        buttons: [\"Ok\"]\n                    });\n                    saveReminder.reset();\n\n                } catch(e) {\n                    KL.popup({\n                        target: klRootEl,\n                        type: \"error\",\n                        message: LANG('upload-failed'),\n                        buttons: [\"Ok\"]\n                    });\n                }\n            }\n        }\n    });\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"iGeXe\");","import {BB} from '../../bb/bb';\n\nlet agPsdLazy;\nexport async function loadAgPsd() {\n    if (!agPsdLazy) {\n        agPsdLazy = await import('ag-psd');\n        BB.BbLog.emit({\n            type: 'loaded-agpsd',\n        });\n    }\n    return agPsdLazy;\n}","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kNYzr\"))).then(() => parcelRequire('2m2jt'));","import {KL} from '../../kl';\nimport {BB} from '../../../bb/bb';\nimport {KlHistoryInterface} from '../../history/kl-history';\nimport {LANG} from '../../../language/language';\nimport {BrowserStorageUi} from './browser-storage-ui';\nimport {ProjectStore} from '../../storage/project-store';\nimport {IKlProject} from '../../kl.types';\n\n\nconst reminderTimelimitMs = 1000 * 60 * 20; // 20 minutes\nconst unsavedActionsLimit = 100; // number of actions user did since last save\n\n\n/**\n * remind user of saving, keep user aware of save state\n */\nexport class SaveReminder {\n    private lastSavedActionNumber: number = null;\n    private lastSavedAt: number;\n\n    private lastReminderShownAt: number;\n    private unsavedInterval;\n    private closeFunc: () => void;\n\n    showPopup (): void {\n        if (!this.projectStore || !this.getProject) {\n            throw new Error('projectStore and getProject need to be set');\n        }\n\n        const min = Math.round((performance.now() - this.lastSavedAt) / 1000 / 60);\n\n        const contentEl = BB.el({});\n\n        contentEl.append(\n            BB.el({\n                content: LANG(\n                    'save-reminder-text',\n                    {\n                        a: '<strong>' + min,\n                        b: '</strong>',\n                    }\n                ),\n                css: {\n                    marginBottom: '20px',\n                }\n            }),\n        );\n\n        const psdWrapper = BB.el({\n            css: {\n                borderTop: '1px solid #aaa',\n                margin: '0 -20px',\n                padding: '20px',\n            }\n        });\n        const storageWrapper = BB.el({\n            css: {\n                borderTop: '1px solid #aaa',\n                margin: '0 -20px',\n                padding: '20px',\n                paddingBottom: '0',\n            }\n        });\n        contentEl.append(psdWrapper, storageWrapper);\n\n\n        const psdBtn = BB.el({\n            tagName: 'button',\n            className: 'kl-button',\n            content: LANG('save-reminder-save-psd'),\n            onClick: () => this.onSaveAsPsd(),\n        });\n        psdWrapper.append(\n            psdBtn,\n            BB.el({\n                content: LANG('save-reminder-psd-layers'),\n                css: {\n                    marginTop: '10px',\n                }\n            }),\n        );\n\n\n        const storageUi = new BrowserStorageUi(\n            this.projectStore,\n            this.getProject,\n            this,\n            document.body as any,\n            {\n                hideClearButton: true,\n                isFocusable: true,\n            }\n        );\n        storageWrapper.append(storageUi.getElement());\n\n\n        KL.popup({\n            target: document.body,\n            message: `<b>${LANG('save-reminder-title')}</b>`,\n            div: contentEl,\n            ignoreBackground: true,\n            callback: () => {\n                storageUi.destroy();\n                BB.destroyEl(psdBtn);\n                this.closeFunc = null;\n                this.lastReminderShownAt = performance.now();\n            },\n            closefunc: (f) => {\n                this.closeFunc = f;\n            }\n        });\n        setTimeout(() => {\n            psdBtn.focus();\n        }, 40);\n    }\n\n    constructor (\n        private history: KlHistoryInterface,\n        private showReminder: boolean,\n        private changeTitle: boolean,\n        private onSaveAsPsd: () => void,\n        private isDrawing: () => boolean,\n        private projectStore: ProjectStore | null, // needed if showReminder\n        private getProject: (() => IKlProject) | null, // needed if showReminder\n        private title: string = 'Klecks',\n    ) { }\n\n    init (): void {\n        if (this.lastSavedActionNumber !== null) { // already initialized\n            return;\n        }\n        this.lastSavedActionNumber = this.history.getActionNumber();\n        this.lastReminderShownAt = performance.now();\n        this.lastSavedAt = performance.now();\n\n        if (this.showReminder) {\n            setInterval(() => {\n                if (document.visibilityState !== 'visible') {\n                    return;\n                }\n\n                let unsavedActions = Math.abs(this.history.getActionNumber() - this.lastSavedActionNumber);\n\n                if (\n                    KL.dialogCounter.get() === 0 &&\n                    !this.isDrawing() &&\n                    this.lastReminderShownAt + reminderTimelimitMs < performance.now() &&\n                    unsavedActions >= unsavedActionsLimit\n                ) {\n                    this.showPopup();\n                }\n            }, 1000 * 5);\n        }\n\n        // confirmation dialog when closing tab\n        function onBeforeUnload(e) {\n            e.preventDefault();\n            e.returnValue = '';\n        }\n\n        this.history.addListener(() => {\n            let actionNumber = this.history.getActionNumber();\n            if (this.lastSavedActionNumber !== actionNumber) {\n                BB.setEventListener(window, 'onbeforeunload', onBeforeUnload);\n            } else {\n                BB.setEventListener(window, 'onbeforeunload', null);\n            }\n        });\n\n        if (this.changeTitle) {\n            document.addEventListener(\"visibilitychange\", () => {\n                if (document.visibilityState === 'visible') {\n                    document.title = this.title;\n                    clearInterval(this.unsavedInterval);\n                } else {\n                    let actionNumber = this.history.getActionNumber();\n                    if (this.lastSavedActionNumber !== actionNumber) {\n                        document.title = LANG('unsaved') + ' - ' + this.title;\n                        let state = 0;\n                        this.unsavedInterval = setInterval(() => {\n                            state = (state + 1) % 2;\n                            if (state === 1) {\n                                document.title = LANG('unsaved') + ' · ' + this.title;\n                            } else {\n                                document.title = LANG('unsaved') + ' - ' + this.title;\n                            }\n                        }, 1000 * 60 * 3);\n                    }\n                }\n            });\n        }\n    }\n\n    reset (): void {\n        if (this.lastSavedActionNumber === null) { // not initialized\n            return;\n        }\n\n        this.lastSavedActionNumber = this.history.getActionNumber();\n        this.lastReminderShownAt = performance.now();\n        this.lastSavedAt = performance.now();\n        BB.setEventListener(window, 'onbeforeunload', null);\n\n        if (this.closeFunc) {\n            this.closeFunc();\n        }\n    }\n}\n","import {BB} from '../../bb/bb';\nimport {KL} from '../kl';\nimport {saveAs} from 'file-saver';\nimport {KlCanvas} from '../canvas/kl-canvas';\n\nexport class SaveToComputer {\n\n    constructor(\n        private saveReminder,\n        private klRootEl,\n        private getExportType,\n        private getKlCanvas: () => KlCanvas,\n        private filenameBase: string,\n    ) {}\n\n    save(format?: 'psd' | 'layers' | 'png') {\n        const _this = this;\n\n        _this.saveReminder.reset();\n\n\n        function saveImage(canvas, filename, mimeType) {\n            let parts = canvas.toDataURL(mimeType).match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);\n            //assume base64 encoding\n            let binStr = atob(parts[3]);\n            //convert to binary in ArrayBuffer\n            let buf = new ArrayBuffer(binStr.length);\n            let view = new Uint8Array(buf);\n            for (let i = 0; i < view.length; i++) {\n                view[i] = binStr.charCodeAt(i);\n            }\n            let blob = new Blob([view], {'type': parts[1]});\n            saveAs(blob, filename);\n        }\n\n        if (!format) {\n            format = _this.getExportType();\n        }\n\n        if (format === 'png') {\n            let extension = 'png';\n            let mimeType = 'image/png';\n            let filename = BB.getDate() + this.filenameBase + \".\" + extension;\n            let fullCanvas = _this.getKlCanvas().getCompleteCanvas(1);\n\n            /*fullCanvas.toBlob(function(blob) {\n                if (blob === null) {\n                    throw 'save image error, blob is null';\n                }\n                saveAs(blob, filename);\n            }, mimetype);*/\n\n            //using old code, because saving somehow doesn't work for ipad before ios 13\n            //and it doesn't even throw an exception\n            try {\n                saveImage(fullCanvas, filename, mimeType);\n            } catch (error) { //fallback for old browsers\n                let im = new Image();\n                im.width = _this.getKlCanvas().getWidth();\n                im.height = _this.getKlCanvas().getHeight();\n                im.src = fullCanvas.toDataURL(mimeType);\n                KL.exportDialog(_this.klRootEl, im);\n            }\n        } else if (format === 'layers') {\n            let extension = 'png';\n            let mimeType = 'image/png';\n            let fileBase = BB.getDate() + this.filenameBase;\n            let layerArr = _this.getKlCanvas().getLayersFast();\n            for (let i = 0; i < layerArr.length; i++) {\n                let item = layerArr[i];\n                let fnameArr = [\n                    fileBase,\n                    '_',\n                    ('' + (i + 1)).padStart(2, '0'),\n                    '_',\n                    item.name,\n                    '.',\n                    extension\n                ];\n                saveImage(item.canvas, fnameArr.join(''), mimeType);\n            }\n        } else if (format === 'psd') {\n\n            let layerArr = _this.getKlCanvas().getLayersFast();\n\n            let psdConfig = {\n                width: _this.getKlCanvas().getWidth(),\n                height: _this.getKlCanvas().getHeight(),\n                children: [],\n                canvas: _this.getKlCanvas().getCompleteCanvas(1)\n            };\n            for (let i = 0; i < layerArr.length; i++) {\n                let item = layerArr[i];\n                psdConfig.children.push({\n                    name: item.name,\n                    opacity: item.opacity,\n                    canvas: item.canvas,\n                    blendMode: KL.PSD.blendKlToPsd(item.mixModeStr),\n                    left: 0,\n                    top: 0\n                });\n            }\n\n            KL.loadAgPsd().then((agPsdLazy) => {\n                let buffer = agPsdLazy.writePsdBuffer(psdConfig);\n                let blob = new Blob([buffer], { type: 'application/octet-stream' });\n                saveAs(blob, BB.getDate() + this.filenameBase + '.psd');\n            }).catch(() => {\n                alert('Error: failed to load PSD library');\n            });\n\n        }\n\n    }\n\n}","/*\n* FileSaver.js\n* A saveAs() FileSaver implementation.\n*\n* By Eli Grey, http://eligrey.com\n*\n* License : https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md (MIT)\n* source  : http://purl.eligrey.com/github/FileSaver.js\n*/\n\n// The one and only way of getting global scope in all environments\n// https://stackoverflow.com/q/3277182/1008999\nvar _global = typeof window === 'object' && window.window === window\n  ? window : typeof self === 'object' && self.self === self\n  ? self : typeof global === 'object' && global.global === global\n  ? global\n  : this\n\nfunction bom (blob, opts) {\n  if (typeof opts === 'undefined') opts = { autoBom: false }\n  else if (typeof opts !== 'object') {\n    console.warn('Deprecated: Expected third argument to be a object')\n    opts = { autoBom: !opts }\n  }\n\n  // prepend BOM for UTF-8 XML and text/* types (including HTML)\n  // note: your browser will automatically convert UTF-16 U+FEFF to EF BB BF\n  if (opts.autoBom && /^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(blob.type)) {\n    return new Blob([String.fromCharCode(0xFEFF), blob], { type: blob.type })\n  }\n  return blob\n}\n\nfunction download (url, name, opts) {\n  var xhr = new XMLHttpRequest()\n  xhr.open('GET', url)\n  xhr.responseType = 'blob'\n  xhr.onload = function () {\n    saveAs(xhr.response, name, opts)\n  }\n  xhr.onerror = function () {\n    console.error('could not download file')\n  }\n  xhr.send()\n}\n\nfunction corsEnabled (url) {\n  var xhr = new XMLHttpRequest()\n  // use sync to avoid popup blocker\n  xhr.open('HEAD', url, false)\n  try {\n    xhr.send()\n  } catch (e) {}\n  return xhr.status >= 200 && xhr.status <= 299\n}\n\n// `a.click()` doesn't work for all browsers (#465)\nfunction click (node) {\n  try {\n    node.dispatchEvent(new MouseEvent('click'))\n  } catch (e) {\n    var evt = document.createEvent('MouseEvents')\n    evt.initMouseEvent('click', true, true, window, 0, 0, 0, 80,\n                          20, false, false, false, false, 0, null)\n    node.dispatchEvent(evt)\n  }\n}\n\n// Detect WebView inside a native macOS app by ruling out all browsers\n// We just need to check for 'Safari' because all other browsers (besides Firefox) include that too\n// https://www.whatismybrowser.com/guides/the-latest-user-agent/macos\nvar isMacOSWebView = _global.navigator && /Macintosh/.test(navigator.userAgent) && /AppleWebKit/.test(navigator.userAgent) && !/Safari/.test(navigator.userAgent)\n\nvar saveAs = _global.saveAs || (\n  // probably in some web worker\n  (typeof window !== 'object' || window !== _global)\n    ? function saveAs () { /* noop */ }\n\n  // Use download attribute first if possible (#193 Lumia mobile) unless this is a macOS WebView\n  : ('download' in HTMLAnchorElement.prototype && !isMacOSWebView)\n  ? function saveAs (blob, name, opts) {\n    var URL = _global.URL || _global.webkitURL\n    var a = document.createElement('a')\n    name = name || blob.name || 'download'\n\n    a.download = name\n    a.rel = 'noopener' // tabnabbing\n\n    // TODO: detect chrome extensions & packaged apps\n    // a.target = '_blank'\n\n    if (typeof blob === 'string') {\n      // Support regular links\n      a.href = blob\n      if (a.origin !== location.origin) {\n        corsEnabled(a.href)\n          ? download(blob, name, opts)\n          : click(a, a.target = '_blank')\n      } else {\n        click(a)\n      }\n    } else {\n      // Support blobs\n      a.href = URL.createObjectURL(blob)\n      setTimeout(function () { URL.revokeObjectURL(a.href) }, 4E4) // 40s\n      setTimeout(function () { click(a) }, 0)\n    }\n  }\n\n  // Use msSaveOrOpenBlob as a second approach\n  : 'msSaveOrOpenBlob' in navigator\n  ? function saveAs (blob, name, opts) {\n    name = name || blob.name || 'download'\n\n    if (typeof blob === 'string') {\n      if (corsEnabled(blob)) {\n        download(blob, name, opts)\n      } else {\n        var a = document.createElement('a')\n        a.href = blob\n        a.target = '_blank'\n        setTimeout(function () { click(a) })\n      }\n    } else {\n      navigator.msSaveOrOpenBlob(bom(blob, opts), name)\n    }\n  }\n\n  // Fallback to using FileReader and a popup\n  : function saveAs (blob, name, opts, popup) {\n    // Open a popup immediately do go around popup blocker\n    // Mostly only available on user interaction and the fileReader is async so...\n    popup = popup || open('', '_blank')\n    if (popup) {\n      popup.document.title =\n      popup.document.body.innerText = 'downloading...'\n    }\n\n    if (typeof blob === 'string') return download(blob, name, opts)\n\n    var force = blob.type === 'application/octet-stream'\n    var isSafari = /constructor/i.test(_global.HTMLElement) || _global.safari\n    var isChromeIOS = /CriOS\\/[\\d]+/.test(navigator.userAgent)\n\n    if ((isChromeIOS || (force && isSafari) || isMacOSWebView) && typeof FileReader !== 'undefined') {\n      // Safari doesn't allow downloading of blob URLs\n      var reader = new FileReader()\n      reader.onloadend = function () {\n        var url = reader.result\n        url = isChromeIOS ? url : url.replace(/^data:[^;]*;/, 'data:attachment/file;')\n        if (popup) popup.location.href = url\n        else location = url\n        popup = null // reverse-tabnabbing #460\n      }\n      reader.readAsDataURL(blob)\n    } else {\n      var URL = _global.URL || _global.webkitURL\n      var url = URL.createObjectURL(blob)\n      if (popup) popup.location = url\n      else location.href = url\n      popup = null // reverse-tabnabbing #460\n      setTimeout(function () { URL.revokeObjectURL(url) }, 4E4) // 40s\n    }\n  }\n)\n\n_global.saveAs = saveAs.saveAs = saveAs\n\nif (typeof module !== 'undefined') {\n  module.exports = saveAs;\n}\n","import {KL} from '../kl';\nimport {IHistoryBroadcast, IHistoryEntry, klHistory} from './kl-history';\nimport {KlCanvasWorkspace} from '../canvas-ui/kl-canvas-workspace';\nimport {IFilterApply, IInitState} from '../kl.types';\nimport {KlCanvas} from '../canvas/kl-canvas';\n\nexport class UndoRedoCatchup {\n\n    private doIgnore = false;\n\n    /**\n     * Prevent multiple undo / redo getting triggered at once.\n     * Might be confusing if main thread is choking.\n     */\n    private ignoreTest (): boolean {\n        if (this.doIgnore) {\n            return false;\n        }\n        this.doIgnore = true;\n        setTimeout(() => {\n            this.doIgnore = false;\n        }, 0);\n        return true;\n    }\n\n    // ---- public ----\n\n    constructor (\n        private brushUiObj,\n        private layerPreview,\n        private layerManager,\n        private handUi,\n        private klCanvasWorkspace: KlCanvasWorkspace,\n        private getInitState: () => IInitState,\n        private getKlCanvas: () => KlCanvas,\n        private getCurrentLayerCtx,\n        private setCurrentLayerCtx,\n        private getCurrentBrush,\n    ) { }\n\n    undo (): boolean {\n        if (!this.ignoreTest()) {\n            return false;\n        }\n\n        if (!klHistory.canUndo()) { // || workspace.isPainting()) {\n            return false;\n        }\n        const actions: IHistoryEntry[] = klHistory.undo();\n        const klCanvas = this.getKlCanvas();\n        klHistory.pause(true);\n        const initState: IInitState = this.getInitState();\n        const oldSize = {w: klCanvas.getWidth(), h: klCanvas.getHeight()};\n        klCanvas.copy(initState.canvas);\n        let layerIndex = initState.focus;\n        this.setCurrentLayerCtx(klCanvas.getLayerContext(layerIndex));\n        const brushes: any = {};\n        for (let b in KL.brushes) {\n            if (KL.brushes.hasOwnProperty(b)) {\n                brushes[b] = new KL.brushes[b]();\n                brushes[b].setContext(this.getCurrentLayerCtx());\n            }\n        }\n        brushes.SketchyBrush.setSeed(initState.brushes.SketchyBrush.getSeed());\n        for (let i = 0; i < actions.length; i++) {\n            ((i) => {\n                if (actions[i].tool[0] === \"brush\") {\n                    const b = brushes[actions[i].tool[1]];\n                    if (actions[i].actions) {\n                        for (let e = 0; e < actions[i].actions.length; e++) {\n                            const p = actions[i].actions[e].params;\n                            b[actions[i].actions[e].action].apply(b, p);\n                        }\n                    } else {\n                        const p = actions[i].params;\n                        b[actions[i].action].apply(b, p);\n                    }\n                } else if (actions[i].tool[0] === \"canvas\") {\n                    const p = actions[i].params;\n                    const id = klCanvas[actions[i].action].apply(klCanvas, p);\n                    if (typeof id === 'number') {\n                        layerIndex = id;\n                        this.setCurrentLayerCtx(klCanvas.getLayerContext(layerIndex));\n                        for (let b in brushes) {\n                            if (brushes.hasOwnProperty(b)) {\n                                brushes[b].setContext(this.getCurrentLayerCtx());\n                            }\n                        }\n                    }\n                } else if (actions[i].tool[0] === \"filter\") {\n                    const p = [{\n                        context: this.getCurrentLayerCtx(),\n                        klCanvas,\n                        input: actions[i].params[0].input,\n                        history: new KL.DecoyKlHistory(),\n                    } as IFilterApply];\n                    KL.filterLib[actions[i].tool[1]][actions[i].action].apply(null, p);\n\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"focusLayer\") {\n                    layerIndex = actions[i].params[0];\n                    this.setCurrentLayerCtx(klCanvas.getLayerContext(actions[i].params[0]));\n                    for (let b in brushes) {\n                        if (brushes.hasOwnProperty(b)) {\n                            brushes[b].setContext(this.getCurrentLayerCtx());\n                        }\n                    }\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"importImage\") {\n                    const id = klCanvas.addLayer();\n                    if (typeof id === 'number') {\n                        layerIndex = id;\n                        if (actions[i].params[1]) {\n                            klCanvas.renameLayer(layerIndex, actions[i].params[1]);\n                        }\n                        this.setCurrentLayerCtx(klCanvas.getLayerContext(layerIndex));\n                        for (let b in brushes) {\n                            if (brushes.hasOwnProperty(b)) {\n                                brushes[b].setContext(this.getCurrentLayerCtx());\n                            }\n                        }\n                    }\n                    this.getCurrentLayerCtx().drawImage(actions[i].params[0], 0, 0);\n                }\n            })(i);\n        }\n        if (oldSize.w !== klCanvas.getWidth() || oldSize.h !== klCanvas.getHeight()) {\n            this.klCanvasWorkspace.resetView();\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n        }\n        this.layerManager.update(layerIndex);\n        this.layerPreview.setLayer(klCanvas.getLayer(layerIndex));\n        this.brushUiObj.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\n        this.getCurrentBrush().setContext(this.getCurrentLayerCtx());\n        this.klCanvasWorkspace.setLastDrawEvent(null);\n\n        klHistory.pause(false);\n        return true;\n    }\n\n    redo (): boolean {\n        if (!this.ignoreTest()) {\n            return false;\n        }\n\n        if (!klHistory.canRedo()) {\n            return false;\n        }\n        const actions = klHistory.redo();\n        const klCanvas = this.getKlCanvas();\n        klHistory.pause(true);\n        const oldSize = {w: klCanvas.getWidth(), h: klCanvas.getHeight()};\n        let layerIndex;\n        const brushes: any = {};\n        for (let b in KL.brushes) {\n            if (KL.brushes.hasOwnProperty(b)) {\n                brushes[b] = new KL.brushes[b]();\n                brushes[b].setContext(this.getCurrentLayerCtx());\n            }\n        }\n        brushes.SketchyBrush.setSeed(this.brushUiObj.sketchyBrush.getSeed());\n        for (let i = 0; i < actions.length; i++) {\n            ((i) => {\n                if (actions[i].tool[0] === \"brush\") {\n                    const b = brushes[actions[i].tool[1]];\n                    if (actions[i].actions) {\n                        for (let e = 0; e < actions[i].actions.length; e++) {\n                            const p = actions[i].actions[e].params;\n                            b[actions[i].actions[e].action].apply(b, p);\n                        }\n                    } else {\n                        const p = actions[i].params;\n                        b[actions[i].action].apply(b, p);\n                    }\n                } else if (actions[i].tool[0] === \"canvas\") {\n                    const p = actions[i].params;\n                    const id = klCanvas[actions[i].action].apply(klCanvas, p);\n                    if (typeof id === 'number') {\n                        layerIndex = id;\n                        this.setCurrentLayerCtx(klCanvas.getLayerContext(layerIndex));\n                        for (let b in brushes) {\n                            if (brushes.hasOwnProperty(b)) {\n                                brushes[b].setContext(this.getCurrentLayerCtx());\n                            }\n                        }\n                    }\n                } else if (actions[i].tool[0] === \"filter\") {\n                    const p = [{\n                        context: this.getCurrentLayerCtx(),\n                        klCanvas,\n                        input: actions[i].params[0].input,\n                        history: new KL.DecoyKlHistory(),\n                    } as IFilterApply];\n                    KL.filterLib[actions[i].tool[1]][actions[i].action].apply(null, p);\n\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"focusLayer\") {\n                    layerIndex = actions[i].params[0];\n                    this.setCurrentLayerCtx(klCanvas.getLayerContext(actions[i].params[0]));\n                    for (let b in brushes) {\n                        if (brushes.hasOwnProperty(b)) {\n                            brushes[b].setContext(this.getCurrentLayerCtx());\n                        }\n                    }\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"importImage\") {\n                    const id = klCanvas.addLayer();\n                    if (typeof id === 'number') {\n                        layerIndex = id;\n                        if (actions[i].params[1]) {\n                            klCanvas.renameLayer(layerIndex, actions[i].params[1]);\n                        }\n                        this.setCurrentLayerCtx(klCanvas.getLayerContext(layerIndex));\n                        for (let b in brushes) {\n                            if (brushes.hasOwnProperty(b)) {\n                                brushes[b].setContext(this.getCurrentLayerCtx());\n                            }\n                        }\n                    }\n                    this.getCurrentLayerCtx().drawImage(actions[i].params[0], 0, 0);\n                }\n            })(i);\n        }\n\n        if (oldSize.w !== klCanvas.getWidth() || oldSize.h !== klCanvas.getHeight()) {\n            this.klCanvasWorkspace.resetView();\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n        }\n        const currentLayerIndex = klCanvas.getLayerIndex(this.getCurrentLayerCtx().canvas);\n        this.layerManager.update(currentLayerIndex);\n        this.layerPreview.setLayer(klCanvas.getLayer(currentLayerIndex));\n        this.brushUiObj.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\n        this.getCurrentBrush().setContext(this.getCurrentLayerCtx());\n        this.klCanvasWorkspace.setLastDrawEvent(null);\n        klHistory.pause(false);\n\n        return true;\n    }\n\n    catchup (logParam: IHistoryBroadcast | null): void {\n        // const start = performance.now();\n        //play catch up (the version that is a few steps behind)\n        if (logParam && logParam.bufferUpdate) {\n            const initState: IInitState = this.getInitState();\n\n            const brushes = initState.brushes;\n            const actions = [logParam.bufferUpdate];\n            let localCurrentLayerCtx = initState.canvas.getLayerContext(initState.focus);\n            const klCanvas = initState.canvas;\n            let layerIndex = initState.focus;\n            ((i) => {\n                if (actions[i].tool[0] === \"brush\") {\n                    let b = brushes[actions[i].tool[1]];\n                    if (actions[i].actions) {\n                        for (let e = 0; e < actions[i].actions.length; e++) {\n                            const p = actions[i].actions[e].params;\n                            b[actions[i].actions[e].action].apply(b, p);\n                        }\n                    } else {\n                        const p = actions[i].params;\n                        b[actions[i].action].apply(b, p);\n                    }\n                } else if (actions[i].tool[0] === \"canvas\") {\n                    const p = actions[i].params;\n                    const id = klCanvas[actions[i].action].apply(klCanvas, p);\n                    if (typeof id === 'number') {\n                        layerIndex = id;\n                        localCurrentLayerCtx = klCanvas.getLayerContext(layerIndex);\n                        for (let b in brushes) {\n                            if (brushes.hasOwnProperty(b)) {\n                                brushes[b].setContext(localCurrentLayerCtx);\n                            }\n                        }\n                    }\n                } else if (actions[i].tool[0] === \"filter\") {\n                    const p = [{\n                        context: localCurrentLayerCtx,\n                        klCanvas,\n                        input: actions[i].params[0].input,\n                        history: new KL.DecoyKlHistory(),\n                    } as IFilterApply];\n                    KL.filterLib[actions[i].tool[1]][actions[i].action].apply(null, p);\n\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"focusLayer\") {\n                    layerIndex = actions[i].params[0];\n                    localCurrentLayerCtx = klCanvas.getLayerContext(actions[i].params[0]);\n                    for (let b in brushes) {\n                        if (brushes.hasOwnProperty(b)) {\n                            brushes[b].setContext(localCurrentLayerCtx);\n                        }\n                    }\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"importImage\") {\n                    const id = klCanvas.addLayer();\n                    if (typeof id === 'number') {\n                        layerIndex = id;\n                        if (actions[i].params[1]) {\n                            klCanvas.renameLayer(layerIndex, actions[i].params[1]);\n                        }\n                        localCurrentLayerCtx = klCanvas.getLayerContext(layerIndex);\n                        for (let b in brushes) {\n                            if (brushes.hasOwnProperty(b)) {\n                                brushes[b].setContext(localCurrentLayerCtx);\n                            }\n                        }\n                    }\n                    localCurrentLayerCtx.drawImage(actions[i].params[0], 0, 0);\n                }\n            })(0);\n            initState.focus = layerIndex;\n        }\n        // console.log('catchup', performance.now() - start);\n    }\n\n\n}","import {IRGB, ISliderConfig} from '../kl.types';\n\nexport type TBrushSettingEmit = { type: 'color'; value: IRGB } |\n    { type: 'opacity'; value: number } |\n    { type: 'size'; value: number } |\n    { type: 'sliderConfig'; value: ISliderConfig };\n\nexport type TBrushSettingSubscriber = (p : TBrushSettingEmit) => void;\n\n/**\n * Central place to update brush settings, and to subscribe to changes.\n */\nexport class BrushSettingService {\n\n    private static instance: BrushSettingService;\n    subscriberArr: TBrushSettingSubscriber[] = [];\n\n    private emit (obj: TBrushSettingEmit, skipSubscriber?: TBrushSettingSubscriber): void {\n        for (let i = 0; i < this.subscriberArr.length; i++) {\n            if (this.subscriberArr[i] === skipSubscriber) {\n                continue;\n            }\n            this.subscriberArr[i](obj);\n        }\n    }\n\n    // --- public ---\n\n    constructor (\n        private onSetColor: (rgb: IRGB) => void,\n        private onSetSize: (size: number) => void,\n        private onSetOpacity: (opacity: number) => void,\n        private onGetColor: () => IRGB,\n        private onGetSize: () => number,\n        private onGetOpacity: () => number,\n        private onGetSliderConfig: () => ISliderConfig,\n    ) {\n        if (BrushSettingService.instance) {\n            throw new Error('BrushSettingService already instantiated');\n        }\n        BrushSettingService.instance = this;\n    }\n\n    emitColor (color: IRGB, skipSubscriber?: TBrushSettingSubscriber): void {\n        this.emit(\n            {\n                type: 'color',\n                value: color\n            },\n            skipSubscriber\n        );\n    }\n\n    emitSize (size: number, skipSubscriber?: TBrushSettingSubscriber): void {\n        this.emit(\n            {\n                type: 'size',\n                value: size\n            },\n            skipSubscriber\n        );\n    }\n\n    emitOpacity (opacity: number, skipSubscriber?: TBrushSettingSubscriber): void {\n        this.emit(\n            {\n                type: 'opacity',\n                value: opacity\n            },\n            skipSubscriber\n        );\n    }\n\n    emitSliderConfig (sliderConfig: ISliderConfig, skipSubscriber?: TBrushSettingSubscriber) {\n        this.emit(\n            {\n                type: 'sliderConfig',\n                value: sliderConfig\n            },\n            skipSubscriber\n        );\n    }\n\n    /**\n     * set current brush color\n     * @param color\n     * @param skipSubscriber\n     */\n    setColor (color: IRGB, skipSubscriber?: TBrushSettingSubscriber) {\n        this.onSetColor(color);\n        this.emitColor(color, skipSubscriber);\n    }\n\n    /**\n     * set current brush size\n     * @param size\n     * @param skipSubscriber\n     */\n    setSize (size: number, skipSubscriber?: TBrushSettingSubscriber) {\n        this.onSetSize(size);\n        // why not emitting?\n    }\n\n    /**\n     * set current opacity\n     * @param opacity\n     * @param skipSubscriber\n     */\n    setOpacity (opacity: number, skipSubscriber?: TBrushSettingSubscriber) {\n        this.onSetOpacity(opacity);\n        // why not emitting?\n    }\n\n    /**\n     * get current brush color\n     */\n    getColor (): IRGB {\n        return this.onGetColor();\n    }\n\n    getSize (): number {\n        return this.onGetSize();\n    }\n\n    getOpacity (): number {\n        return this.onGetOpacity();\n    }\n\n    getSliderConfig (): ISliderConfig {\n        return this.onGetSliderConfig();\n    }\n\n    /**\n     * subscribe to changes\n     * @param func\n     */\n    subscribe (func: TBrushSettingSubscriber): void {\n        if (this.subscriberArr.includes(func)) {\n            return;\n        }\n        this.subscriberArr.push(func);\n    }\n\n    unsubscribe (func: TBrushSettingSubscriber): void {\n        for (let i = 0; i < this.subscriberArr.length; i++) {\n            if (func === this.subscriberArr[i]) {\n                this.subscriberArr.splice(i, 1);\n                i--;\n            }\n        }\n    }\n}\n\n","import {BB} from '../../../bb/bb';\nimport {LANG, languageStrings, LS_LANGUAGE_KEY} from '../../../language/language';\nimport {KL} from '../../kl';\nimport {languages} from '../../../../languages/languages';\nimport {Popup} from '../modals/popup';\n// @ts-ignore\nimport bitbofLogoImg from 'url:~/src/app/img/bitbof-logo.svg';\n// @ts-ignore\nimport klecksLogoImg from 'url:~/src/app/img/klecks-logo.png';\n// @ts-ignore\nimport uiSwapImg from 'url:~/src/app/img/ui/ui-swap-lr.svg';\nimport {LocalStorage} from '../../../bb/base/local-storage';\n\nexport class SettingsTab {\n\n    private el: HTMLElement;\n\n    // --- public ---\n    constructor (\n        onLeftRight: () => void,\n        customAbout?: HTMLElement,\n    ) {\n\n        // ---- language ----\n        const language = languageStrings.getLanguage();\n\n        this.el = BB.el({\n            content: `\n${LANG('settings-language')}: ${language.name} (${language.code})\n            `,\n            css: {\n                margin: '10px',\n            }\n        });\n\n        const preferredLanguageRow = BB.el({\n            content: LANG('settings-preferred-language') + ':<br>',\n            css: {\n                marginTop: '10px',\n            }\n        });\n        const options: [string, string][] = [\n            ['auto', LANG('auto')] as [string, string]\n        ].concat(\n            languages.map(item => {\n                return [item.code, item.name + ` (${item.code})`];\n            })\n        );\n        const languageSelect = new KL.Select({\n            initValue: LocalStorage.getItem(LS_LANGUAGE_KEY) ? LocalStorage.getItem(LS_LANGUAGE_KEY) : 'auto',\n            optionArr: options,\n            onChange: (val) => {\n                if (val === 'auto') {\n                    LocalStorage.removeItem(LS_LANGUAGE_KEY);\n                } else {\n                    LocalStorage.setItem(LS_LANGUAGE_KEY, val);\n                }\n                languageHint.style.display = 'block';\n            },\n        });\n        const languageHint = BB.el({\n            content: LANG('settings-language-reload'),\n            css: {\n                display: 'none',\n                marginTop: '5px',\n            }\n        });\n\n        preferredLanguageRow.append(\n            languageSelect.getElement(),\n            languageHint,\n        );\n\n        this.el.append(preferredLanguageRow);\n\n        // ---- flip ui ----\n        BB.el({\n            tagName: 'button',\n            parent: this.el,\n            content: '<img height=\"20\" width=\"18\" src=\"' + uiSwapImg + '\" alt=\"icon\" style=\"margin-right: 5px\"/>' + LANG('switch-ui-left-right'),\n            onClick: () => onLeftRight(),\n            css: {\n                marginTop: '20px',\n            },\n            custom: {\n                tabIndex: '-1',\n            }\n        });\n\n\n        // ---- about ----\n        this.el.append(BB.el({className: 'gridHr', css: {margin: '10px 0'}}));\n\n        function makeLicenses() {\n            return BB.el({\n                tagName: 'a',\n                content: LANG('licenses'),\n                onClick: () => {\n                    import('./licenses').then(result => {\n                        new Popup({\n                            title: BB.el({\n                                content: LANG('licenses'),\n                            }),\n                            content: BB.el({\n                                content: BB.el({\n                                    content: result.licenses.replace(/\\n/g, '<br>'),\n                                    css: {\n                                        padding: '20px',\n                                    }\n                                }),\n                                css: {\n                                    height: '100%',\n                                    overflowY: 'scroll',\n                                }\n                            }),\n                            width: 800,\n                            isMaxHeight: true,\n                        });\n                    });\n                },\n            });\n        }\n\n        if (customAbout) {\n            this.el.append(customAbout);\n            if (!customAbout.innerHTML) {\n                const minimalAbout = BB.el({\n                    parent: customAbout,\n                    css: {\n                       textAlign: 'center',\n                   }\n                });\n                minimalAbout.append(\n                    BB.el({\n                        content: `<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"${bitbofLogoImg}\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a> © 2022<br>`,\n                    }),\n                    makeLicenses(),\n                );\n            }\n        } else {\n            const versionEl = BB.el({\n                parent: this.el,\n                css: {\n                    textAlign: 'center',\n                },\n                content: `\n<img alt=\"Klecks\" height=\"25\" src=\"${klecksLogoImg}\"><br>\n<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"${bitbofLogoImg}\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a> © 2022<br>`\n            });\n\n            versionEl.append(\n                makeLicenses(),\n                document.createTextNode(' | '),\n                BB.el({\n                    tagName: 'a',\n                    content: LANG('donate'),\n                    custom: {\n                        href: 'https://kleki.com/donate/',\n                        target: '_blank',\n                    }\n                }),\n                document.createTextNode(' | '),\n                BB.el({\n                    tagName: 'a',\n                    content: LANG('source-code'),\n                    custom: {\n                        href: 'https://klecks.org',\n                        target: '_blank',\n                    }\n                }),\n            );\n\n\n        }\n\n        window.addEventListener('storage', (e) => {\n            if (e.key !== LS_LANGUAGE_KEY) {\n                return;\n            }\n            languageSelect.setValue(\n                LocalStorage.getItem(LS_LANGUAGE_KEY) ? LocalStorage.getItem(LS_LANGUAGE_KEY) : 'auto'\n            );\n        });\n\n    }\n\n    getElement (): HTMLElement {\n        return this.el;\n    }\n\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kSWIa\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"4FMUg\");","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"79hnx\"))).then(() => parcelRequire('jNQF2'));","import {BB} from '../../../bb/bb';\n// @ts-ignore\nimport caretImg from 'url:~/src/app/img/ui/caret-down.svg';\nimport {IKeyString} from '../../../bb/bb.types';\nimport {LANG} from '../../../language/language';\nimport {dialogCounter} from '../modals/modal-count';\n\n/**\n * Scroll buttons at the top and bottom of toolspace\n * Show up when window is very small.\n * Allow user to scroll up and down toolspace.\n */\nexport class ToolspaceScroller {\n\n    private toolspace: HTMLElement;\n    private upBtn: HTMLElement;\n    private downBtn: HTMLElement;\n    private downInterval: any;\n    private upInterval: any;\n\n    private update(): void {\n        if (this.toolspace.scrollHeight > this.toolspace.offsetHeight + 3) { // small buffer where it's not worth it\n            if (!this.upInterval) {\n                this.upBtn.style.display = this.toolspace.scrollTop === 0 ? 'none' : 'block';\n            }\n            if (!this.downInterval) {\n                this.downBtn.style.display = (\n                    this.toolspace.scrollTop + this.toolspace.offsetHeight + 1 >= this.toolspace.scrollHeight ?\n                        'none' : 'block'\n                );\n            }\n        } else {\n            this.upBtn.style.display = 'none';\n            this.downBtn.style.display = 'none';\n        }\n    }\n\n    // --- public ---\n    constructor(p: {toolspace: HTMLElement, uiState: 'left' | 'right'}) {\n        this.toolspace = p.toolspace;\n        this.upBtn = BB.el({\n            parent: this.toolspace,\n            title: LANG('scroll'),\n            className: 'kl-scroller',\n            css: {\n                top: '0',\n                transform: 'rotate(180deg)',\n            }\n        });\n        this.downBtn = BB.el({\n            parent: this.toolspace,\n            title: LANG('scroll'),\n            className: 'kl-scroller',\n            css: {\n                bottom: '0',\n            }\n        });\n        this.updateUiState(p.uiState);\n\n        const upListener = new BB.PointerListener({\n            target: this.upBtn,\n            onPointer: (e) => {\n                if (e.type === 'pointerdown') {\n                    this.upInterval = setInterval(() => {\n                        this.toolspace.scrollBy(0, -13);\n                        this.update();\n                    }, 20);\n                }\n                if (e.type === 'pointerup') {\n                    clearInterval(this.upInterval);\n                    setTimeout(() => { // prevent ff pressing anything underneath\n                        this.upInterval = null;\n                        this.update()\n                    }, 50);\n                }\n            },\n        });\n        const downListener = new BB.PointerListener({\n            target: this.downBtn,\n            onPointer: (e) => {\n                if (e.type === 'pointerdown') {\n                    this.downInterval = setInterval(() => {\n                        this.toolspace.scrollBy(0, 13);\n                        this.update();\n                    }, 20);\n                }\n                if (e.type === 'pointerup') {\n                    clearInterval(this.downInterval);\n                    setTimeout(() => { // prevent ff pressing anything underneath\n                        this.downInterval = null;\n                        this.update()\n                    }, 50);\n                }\n            }\n        });\n\n        const wheelListener = (e: WheelEvent) => {\n            this.toolspace.scrollBy(0, Math.round(0.7 * e.deltaY));\n            this.update();\n        };\n        this.upBtn.addEventListener('wheel', wheelListener);\n        this.downBtn.addEventListener('wheel', wheelListener);\n\n        this.update();\n\n        const observer = new MutationObserver(() => this.update());\n        observer.observe(\n            this.toolspace,\n            {\n                attributes: true,\n                childList: true,\n                subtree: true,\n            }\n        );\n        window.addEventListener('resize', () => this.update());\n\n        // hide if in dialog because that can have its own scrollbar\n        dialogCounter.subscribe((v) => {\n            // ignores the 0.5 by tool dropdown\n            this.upBtn.style.opacity = v >= 1 ? '0' : '';\n            this.downBtn.style.opacity = v >= 1 ? '0' : '';\n        });\n    }\n\n    updateUiState (uiState: 'left' | 'right'): void {\n        BB.css(this.upBtn, {\n            left: uiState === 'left' ? '0' : null,\n            right: uiState === 'right' ? '0' : null,\n        });\n        BB.css(this.downBtn, {\n            left: uiState === 'left' ? '0' : null,\n            right: uiState === 'right' ? '0' : null,\n        });\n    }\n}","import {BB} from '../../../bb/bb';\nimport {KlSlider} from '../base-components/kl-slider';\nimport {LANG} from '../../../language/language';\nimport {Checkbox} from '../base-components/checkbox';\nimport {Options} from '../base-components/options';\n\n\ninterface IGradientUiSettings {\n    opacity: number;\n    type: 'linear' | 'linear-mirror' | 'radial';\n    doLockAlpha: boolean;\n    doSnap: boolean;\n    isReversed: boolean;\n    isEraser: boolean;\n}\n\n/**\n * Gradient Tool tab contents\n *\n * p = {\n *     colorSlider: KlColorSlider// when opening tab, inserts it (snatches it from where else it was)\n * }\n *\n * @param p\n * @constructor\n */\nexport class GradientUi {\n\n    private rootEl: HTMLElement;\n    private colorDiv: HTMLElement;\n    private colorSlider: any; // todo type\n    private isVisible: boolean;\n    private iconArr: HTMLElement[];\n\n    private settings: IGradientUiSettings = {\n        opacity: 1,\n        type: 'linear',\n        doLockAlpha: false,\n        doSnap: false,\n        isReversed: false,\n        isEraser: false,\n    };\n\n    private updateIcons(): void {\n        const col1 = this.settings.isReversed ? '#0000' : '#000';\n        const col2 = this.settings.isReversed ? '#000' : '#0000';\n        this.iconArr[0].style.background = `linear-gradient(${col1}, ${col2})`;\n        this.iconArr[1].style.background = `linear-gradient(${col2}, ${col1}, ${col2})`;\n        this.iconArr[2].style.background = `radial-gradient(${col1}, ${col2})`;\n    }\n\n    // ----- public -------\n\n    constructor (\n        p: {\n            colorSlider: any; // KlColorSlider - when opening tab, inserts it (snatches it from where else it was)\n        }\n    ) {\n        this.colorSlider = p.colorSlider;\n        this.rootEl = BB.el({\n            css: {\n                margin: '10px'\n            }\n        });\n        this.isVisible = true;\n\n        this.colorDiv = BB.el({\n            parent: this.rootEl,\n            css: {\n                marginBottom: '10px'\n            }\n        });\n\n        this.iconArr = [];\n        {\n            const size = 33;\n            [0, 1, 2].forEach(item => {\n                const el = BB.el({\n                    css: {\n                        width: size + 'px',\n                        height: size + 'px',\n                        borderRadius: '3px',\n                        margin: '1px',\n                    }\n                });\n                this.iconArr.push(el);\n            });\n        }\n        this.updateIcons();\n\n        const typeOptions = new Options({\n            optionArr: [\n                {\n                    id: 'linear',\n                    label: this.iconArr[0],\n                    title: LANG('gradient-linear'),\n                },\n                {\n                    id: 'linear-mirror',\n                    label: this.iconArr[1],\n                    title: LANG('gradient-linear-mirror'),\n                },\n                {\n                    id: 'radial',\n                    label: this.iconArr[2],\n                    title: LANG('gradient-radial'),\n                }\n            ],\n            initId: 'linear',\n            onChange: (id) => {\n                this.settings.type = id;\n            },\n        });\n        this.rootEl.append(typeOptions.getElement());\n\n        const opacitySlider = new KlSlider({\n            label: LANG('opacity'),\n            width: 250,\n            height: 30,\n            min: 1 / 100,\n            max: 1,\n            value: this.settings.opacity,\n            toValue: (displayValue) => displayValue / 100,\n            toDisplayValue: (value) => value * 100,\n            onChange: (val) => {\n                this.settings.opacity = val;\n            }\n        });\n        BB.css(opacitySlider.getElement(), {\n            marginTop: '10px'\n        });\n        this.rootEl.append(opacitySlider.getElement());\n\n\n\n        const row1 = BB.el({\n            parent: this.rootEl,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                marginTop: '10px'\n            }\n        });\n\n        const reverseToggle = new Checkbox({\n            init: false,\n            label: LANG('reverse'),\n            callback: (b) => {\n                this.settings.isReversed = b;\n                this.updateIcons();\n            },\n            css: {\n                width: '50%',\n            }\n        });\n\n        const doSnapToggle = new Checkbox({\n            init: false,\n            label: LANG('angle-snap'),\n            title: LANG('angle-snap-title'),\n            callback: (b) => {\n                this.settings.doSnap = b;\n            },\n            css: {\n                width: '50%',\n            }\n        });\n\n        row1.append(\n            reverseToggle.getElement(),\n            doSnapToggle.getElement(),\n        );\n\n\n        const row2 = BB.el({\n            parent: this.rootEl,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                marginTop: '10px'\n            }\n        });\n\n        const eraserToggle = new Checkbox({\n            init: this.settings.isEraser,\n            label: LANG('eraser'),\n            callback: (b) => {\n                this.settings.isEraser = b;\n            },\n            css: {\n                width: '50%',\n            }\n        });\n\n        const lockAlphaToggle = new Checkbox({\n            init: false,\n            label: LANG('lock-alpha'),\n            title: LANG('lock-alpha-title'),\n            callback: (b) => {\n                this.settings.doLockAlpha = b;\n            },\n            doHighlight: true,\n            css: {\n                width: '50%',\n            }\n        });\n\n        row2.append(\n            eraserToggle.getElement(),\n            lockAlphaToggle.getElement(),\n        );\n\n\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    setIsVisible(isVisible: boolean): void {\n        this.isVisible = !!isVisible;\n        this.rootEl.style.display = isVisible ? 'block' : 'none';\n        if (isVisible) {\n            this.colorDiv.appendChild(this.colorSlider.getElement());\n            this.colorDiv.appendChild(this.colorSlider.getOutputElement());\n        }\n    }\n\n    getSettings(): IGradientUiSettings {\n        return BB.copyObj(this.settings);\n    }\n\n}","/**\n * Topmost row of buttons in toolspace\n *\n * p = { // button click callbacks\n *     onSubmit: function(),\n *     onLeftRight: function(),\n *     onHelp: function()\n * }\n *\n * @param p\n * @constructor\n */\nimport {BB} from \"../bb/bb\";\n// @ts-ignore\nimport uiSwapImg from 'url:~/src/app/img/ui/ui-swap-lr.svg';\n// @ts-ignore\nimport importImg from 'url:~/src/app/img/ui/import.svg';\n// @ts-ignore\nimport helpImg from 'url:~/src/app/img/ui/help.svg';\nimport {LANG} from '../language/language';\n\nexport class ToolspaceTopRow {\n    el: HTMLDivElement;\n\n    constructor(p: {onSubmit: () => void, onLeftRight: () => void, onHelp: () => void, onImport: () => void}) {\n        let div = document.createElement('div');\n        this.el = div;\n        BB.css(div, {\n            height: '36px',\n            //background: '#f00',\n            display: 'flex',\n            backgroundImage: 'linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)'\n        });\n\n        function createButton(p) {\n            let padding = 6 + (p.extraPadding ? p.extraPadding : 0);\n            let result = BB.el({\n                className: 'toolspace-row-button nohighlight',\n                title: p.title,\n                onClick: p.onClick,\n                css: {\n                    padding: p.content ? '' : (p.contain ? padding + 'px 0' : ''),\n                }\n            });\n            if (p.content) {\n                result.appendChild(p.content);\n            } else {\n                let im = BB.el({\n                    css: {\n                        backgroundImage: 'url(\\'' + p.image + '\\')',\n                        backgroundRepeat: 'no-repeat',\n                        backgroundPosition: 'center',\n                        backgroundSize: p.contain ? 'contain' : '',\n                        //filter: 'grayscale(1)',\n                        height: '100%'\n                    }\n                });\n                im.style.pointerEvents = 'none';\n                result.appendChild(im);\n            }\n            (result as any).pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\n                target: result,\n                onEnterLeave: function(isOver) {\n                    result.classList.toggle('toolspace-row-button-hover', isOver);\n                }\n            });\n            return result;\n        }\n\n        let submitButton = createButton({\n            onClick: p.onSubmit,\n            title: LANG('submit-title'),\n            content: BB.el({\n                content: LANG('submit'),\n                className: 'toolspace-row-button__submit',\n                css: {\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    width: '100%',\n                    height: '100%'\n                }\n            }),\n            contain: true\n        });\n        submitButton.style.width = '45px';\n\n        let helpButton = createButton({\n            onClick: p.onHelp,\n            title: LANG('help'),\n            image: helpImg,\n            contain: true\n        });\n\n        let leftRightButton = createButton({\n            onClick: p.onLeftRight,\n            title: LANG('switch-ui-left-right'),\n            image: uiSwapImg,\n            contain: true\n        });\n        let uploadButton = createButton({\n            onClick: p.onImport,\n            title: LANG('file-upload'),\n            image: importImg,\n            contain: true\n        });\n\n        div.appendChild(submitButton);\n        div.appendChild(leftRightButton);\n        // div.appendChild(helpButton);\n        div.appendChild(uploadButton);\n    }\n\n    getElement() {\n        return this.el;\n    }\n}\n","import {filterLib, filterLibStatus} from './filters';\nimport {filterBrightnessContrast} from './filter-brightness-contrast';\nimport {filterCropExtend} from './filter-crop-extend';\nimport {filterCurves} from './filter-curves';\nimport {filterFlip} from './filter-flip';\nimport {filterHueSaturation} from './filter-hue-saturation';\nimport {filterInvert} from './filter-invert';\nimport {filterPerspective} from './filter-perspective';\nimport {filterResize} from './filter-resize';\nimport {filterRotate} from './filter-rotate';\nimport {filterTiltShift} from './filter-tilt-shift';\nimport {filterTransform} from './filter-transform';\nimport {filterBlur} from './filter-blur';\nimport {filterUnsharpMask} from './filter-unsharp-mask';\nimport {filterToAlpha} from './filter-to-alpha';\nimport {filterGrid} from './filter-grid';\nimport {filterNoise} from './filter-noise';\nimport {filterPattern} from './filter-pattern';\nimport {filterDistort} from './filter-distort';\nimport {filterVanishPoint} from \"./filter-vanish-point\";\n\nlet embed: boolean;\nfunction importFilter(libObj, moduleObj): void {\n    if (moduleObj.getDialog) {\n        libObj.getDialog = moduleObj.getDialog;\n    }\n    libObj.apply = moduleObj.apply;\n}\n\n\nexport function importFilters(isEmbed?: boolean) {\n    if (filterLibStatus.isLoaded) {\n        return;\n    }\n    embed = isEmbed\n\n    importFilter(filterLib.brightnessContrast, filterBrightnessContrast);\n    importFilter(filterLib.cropExtend, filterCropExtend);\n    importFilter(filterLib.curves, filterCurves);\n    importFilter(filterLib.flip, filterFlip);\n    importFilter(filterLib.hueSaturation, filterHueSaturation);\n    importFilter(filterLib.invert, filterInvert);\n    importFilter(filterLib.perspective, filterPerspective);\n    importFilter(filterLib.resize, filterResize);\n    importFilter(filterLib.rotate, filterRotate);\n    importFilter(filterLib.tiltShift, filterTiltShift);\n    importFilter(filterLib.transform, filterTransform);\n    importFilter(filterLib.blur, filterBlur);\n    importFilter(filterLib.unsharpMask, filterUnsharpMask);\n    importFilter(filterLib.toAlpha, filterToAlpha);\n    importFilter(filterLib.grid, filterGrid);\n    importFilter(filterLib.noise, filterNoise);\n    importFilter(filterLib.pattern, filterPattern);\n    importFilter(filterLib.distort, filterDistort);\n    importFilter(filterLib.vanishPoint, filterVanishPoint);\n\n    filterLibStatus.isLoaded = true;\n}","import {BB} from '../../bb/bb';\nimport {KlSlider} from '../ui/base-components/kl-slider';\nimport {eventResMs} from './filters-consts';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\nimport {getSharedFx} from './shared-gl-fx';\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const filterBrightnessContrast = {\n    getDialog(params: IFilterGetDialogParam) {\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n\n\n        let context = params.context;\n        let klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        let layers = klCanvas.getLayers();\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n\n        let tempCanvas = BB.canvas(w, h);\n        {\n            const ctx = tempCanvas.getContext(\"2d\");\n            ctx.save();\n            if (tempCanvas.width > context.canvas.width) {\n                ctx.imageSmoothingEnabled = false;\n            }\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            ctx.restore();\n        }\n\n\n        function finishInit() {\n\n            let brightness = 0, contrast = 0;\n            div.innerHTML = LANG('filter-bright-contrast-description') + \"<br/><br/>\";\n\n            let glCanvas = getSharedFx();\n            if (!glCanvas) {\n                return; // todo throw?\n            }\n            let texture = glCanvas.texture(tempCanvas);\n            glCanvas.draw(texture).update(); // update glCanvas size\n\n            let brightnessSlider = new KlSlider({\n                label: LANG('filter-bright-contrast-brightness'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 100,\n                value: (brightness + 1) * 50,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    brightness = val / 50 - 1;\n                    glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\n                    klCanvasPreview.render();\n                },\n            });\n            let contrastSlider = new KlSlider({\n                label: LANG('filter-bright-contrast-contrast'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 100,\n                value: (contrast + 1) * 50,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    contrast = val / 50 - 1;\n                    glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\n                    klCanvasPreview.render();\n                },\n            });\n            brightnessSlider.getElement().style.marginBottom = \"10px\";\n            div.appendChild(brightnessSlider.getElement());\n            div.appendChild(contrastSlider.getElement());\n\n\n\n            let previewWrapper = document.createElement(\"div\");\n            BB.css(previewWrapper, {\n                width: \"340px\",\n                marginLeft: \"-20px\",\n                height: \"220px\",\n                backgroundColor: \"#9e9e9e\",\n                marginTop: \"10px\",\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n                overflow: \"hidden\",\n                position: \"relative\",\n                userSelect: 'none',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                colorScheme: 'only light',\n            });\n\n            let previewLayerArr: IKlBasicLayer[] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr\n                    });\n                }\n            }\n            let klCanvasPreview = new KlCanvasPreview({\n                width: parseInt('' + w),\n                height: parseInt('' + h),\n                layers: previewLayerArr\n            });\n\n            let previewInnerWrapper = BB.el({\n                css: {\n                    position: 'relative',\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                    width: parseInt('' + w) + 'px',\n                    height: parseInt('' + h) + 'px'\n                }\n            });\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\n            previewWrapper.appendChild(previewInnerWrapper);\n\n            div.appendChild(previewWrapper);\n\n            try {\n                glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\n                klCanvasPreview.render();\n            } catch(e) {\n                (div as any).errorCallback(e);\n            }\n\n            result.destroy = () => {\n                brightnessSlider.destroy();\n                contrastSlider.destroy();\n                texture.destroy();\n            };\n            result.getInput = function () {\n                result.destroy();\n                return {\n                    brightness: brightness,\n                    contrast: contrast\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1); // the canvas isn't ready for some reason\n\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let brightness = params.input.brightness;\n        let contrast = params.input.contrast;\n        let history = params.history;\n        if (!context || brightness === null || contrast === null || !history)\n            return false;\n        history.pause(true);\n        let glCanvas = getSharedFx();\n        if (!glCanvas) {\n            return false; // todo more specific error?\n        }\n        let texture = glCanvas.texture(context.canvas);\n        glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(glCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"brightnessContrast\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n\n        return true;\n    }\n}","\nexport const eventResMs = 60;","import {fx} from '../../../script-vendor/glfx';\n\nlet fxCanvas = null\ntry {\n    fxCanvas = fx.canvas();\n} catch (e) {\n}\n\nexport function getSharedFx() {\n    if (!fxCanvas || fxCanvas._.gl.isContextLost()) {\n        try {\n            fxCanvas = fx.canvas();\n        } catch (e) {\n        }\n    }\n    return fxCanvas;\n}","\n// @ts-ignore\nimport shaderNoise from './shader-noise.glsl';\n\n/*\n * glfx.script\n * http://evanw.github.com/glfx.js/\n *\n * Copyright 2011 Evan Wallace\n * Released under the MIT license\n *\n * modifications by bitbof\n */\nexport const fx = (function () {\n    let exports: any = {};\n\n// src/OES_texture_float_linear-polyfill.script\n// From: https://github.com/evanw/OES_texture_float_linear-polyfill\n    (function () {\n        // Uploads a 2x2 floating-point texture where one pixel is 2 and the other\n        // three pixels are 0. Linear filtering is only supported if a sample taken\n        // from the center of that texture is (2 + 0 + 0 + 0) / 4 = 0.5.\n        function supportsOESTextureFloatLinear(gl) {\n            // Need floating point textures in the first place\n            if (!gl.getExtension('OES_texture_float')) {\n                return false;\n            }\n\n            // Create a render target\n            let framebuffer = gl.createFramebuffer();\n            let byteTexture = gl.createTexture();\n            gl.bindTexture(gl.TEXTURE_2D, byteTexture);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 1, 1, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n            gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, byteTexture, 0);\n\n            // Create a simple floating-point texture with value of 0.5 in the center\n            let rgba = [\n                2, 0, 0, 0,\n                0, 0, 0, 0,\n                0, 0, 0, 0,\n                0, 0, 0, 0\n            ];\n            let floatTexture = gl.createTexture();\n            gl.bindTexture(gl.TEXTURE_2D, floatTexture);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 2, 2, 0, gl.RGBA, gl.FLOAT, new Float32Array(rgba));\n\n            // Create the test shader\n            let program = gl.createProgram();\n            let vertexShader = gl.createShader(gl.VERTEX_SHADER);\n            let fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n            gl.shaderSource(vertexShader, '\\\n      attribute vec2 vertex;\\\n      void main() {\\\n        gl_Position = vec4(vertex, 0.0, 1.0);\\\n      }\\\n    ');\n            gl.shaderSource(fragmentShader, '\\\n      uniform sampler2D texture;\\\n      void main() {\\\n        gl_FragColor = texture2D(texture, vec2(0.5));\\\n      }\\\n    ');\n            gl.compileShader(vertexShader);\n            gl.compileShader(fragmentShader);\n            gl.attachShader(program, vertexShader);\n            gl.attachShader(program, fragmentShader);\n            gl.linkProgram(program);\n\n            // Create a buffer containing a single point\n            let buffer = gl.createBuffer();\n            gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 0]), gl.STREAM_DRAW);\n            gl.enableVertexAttribArray(0);\n            gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);\n\n            // Render the point and read back the rendered pixel\n            let pixel = new Uint8Array(4);\n            gl.useProgram(program);\n            gl.viewport(0, 0, 1, 1);\n            gl.bindTexture(gl.TEXTURE_2D, floatTexture);\n            gl.drawArrays(gl.POINTS, 0, 1);\n            gl.readPixels(0, 0, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, pixel);\n\n            // The center sample will only have a value of 0.5 if linear filtering works\n            return pixel[0] === 127 || pixel[0] === 128;\n        }\n\n        // The constructor for the returned extension object\n        function OESTextureFloatLinear() {\n        }\n\n        // Cache the extension so it's specific to each context like extensions should be\n        function getOESTextureFloatLinear(gl) {\n            if (gl.$OES_texture_float_linear$ === void 0) {\n                Object.defineProperty(gl, '$OES_texture_float_linear$', {\n                    enumerable: false,\n                    configurable: false,\n                    writable: false,\n                    value: new OESTextureFloatLinear()\n                });\n            }\n            return gl.$OES_texture_float_linear$;\n        }\n\n        // This replaces the real getExtension()\n        function getExtension(name) {\n            return name === 'OES_texture_float_linear'\n                ? getOESTextureFloatLinear(this)\n                : oldGetExtension.call(this, name);\n        }\n\n        // This replaces the real getSupportedExtensions()\n        function getSupportedExtensions() {\n            let extensions = oldGetSupportedExtensions.call(this);\n            if (extensions.indexOf('OES_texture_float_linear') === -1) {\n                extensions.push('OES_texture_float_linear');\n            }\n            return extensions;\n        }\n\n        // Get a WebGL context\n        try {\n            let gl = document.createElement('canvas').getContext('experimental-webgl');\n        } catch (e) {\n        }\n\n        // Don't install the polyfill if the browser already supports it or doesn't have WebGL\n        if (!gl || (gl as any).getSupportedExtensions().indexOf('OES_texture_float_linear') !== -1) {\n            return;\n        }\n\n        // Install the polyfill if linear filtering works with floating-point textures\n        let oldGetExtension;\n        let oldGetSupportedExtensions;\n        if (supportsOESTextureFloatLinear(gl)) {\n            oldGetExtension = WebGLRenderingContext.prototype.getExtension;\n            oldGetSupportedExtensions = WebGLRenderingContext.prototype.getSupportedExtensions;\n            WebGLRenderingContext.prototype.getExtension = getExtension;\n            WebGLRenderingContext.prototype.getSupportedExtensions = getSupportedExtensions;\n        }\n    }());\n\n// src/core\\canvas.script\n    var gl;\n\n    function clamp(lo, value, hi) {\n        return Math.max(lo, Math.min(value, hi));\n    }\n\n    function wrapTexture(texture) {\n        return {\n            _: texture,\n            loadContentsOf: function (element) {\n                // Make sure that we're using the correct global WebGL context\n                gl = this._.gl;\n                this._.loadContentsOf(element);\n            },\n            destroy: function () {\n                // Make sure that we're using the correct global WebGL context\n                gl = this._.gl;\n                this._.destroy();\n            }\n        };\n    }\n\n    function texture(element) {\n        return wrapTexture(Texture.fromElement(element));\n    }\n\n    function initialize(width, height) {\n        let type = gl.UNSIGNED_BYTE;\n\n        // Go for floating point buffer textures if we can, it'll make the bokeh\n        // filter look a lot better. Note that on Windows, ANGLE does not let you\n        // render to a floating-point texture when linear filtering is enabled.\n        // See http://crbug.com/172278 for more information.\n        if (gl.getExtension('OES_texture_float') && gl.getExtension('OES_texture_float_linear')) {\n            let testTexture = new Texture(100, 100, gl.RGBA, gl.FLOAT);\n            try {\n                // Only use gl.FLOAT if we can render to it\n                testTexture.drawTo(function () {\n                    type = gl.FLOAT;\n                });\n            } catch (e) {\n            }\n            testTexture.destroy();\n        }\n\n        if (this._.texture) this._.texture.destroy();\n        if (this._.spareTexture) this._.spareTexture.destroy();\n        this.width = width;\n        this.height = height;\n        this._.texture = new Texture(width, height, gl.RGBA, type);\n        this._.spareTexture = new Texture(width, height, gl.RGBA, type);\n        this._.extraTexture = this._.extraTexture || new Texture(0, 0, gl.RGBA, type);\n        this._.flippedShader = this._.flippedShader || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            gl_FragColor = texture2D(texture, vec2(texCoord.x, 1.0 - texCoord.y));\\\n        }\\\n    ', 'flippedShader');\n        this._.isInitialized = true;\n    }\n\n    /*\n       Draw a texture to the canvas, with an optional width and height to scale to.\n       If no width and height are given then the original texture width and height\n       are used.\n    */\n    function draw(texture, width, height) {\n        if (!this._.isInitialized || texture._.width != this.width || texture._.height != this.height) {\n            initialize.call(this, width ? width : texture._.width, height ? height : texture._.height);\n        }\n\n        texture._.use();\n        this._.texture.drawTo(function () {\n            Shader.getDefaultShader().drawRect();\n        });\n\n        return this;\n    }\n\n    function update() {\n        this._.texture.use();\n        this._.flippedShader.drawRect();\n        return this;\n    }\n\n    function simpleShader(shader, uniforms, textureIn, textureOut) {\n        (textureIn || this._.texture).use();\n        this._.spareTexture.drawTo(function () {\n            shader.uniforms(uniforms).drawRect();\n        });\n        this._.spareTexture.swapWith(textureOut || this._.texture);\n    }\n\n    function replace(node) {\n        node.parentNode.insertBefore(this, node);\n        node.parentNode.removeChild(node);\n        return this;\n    }\n\n    function contents() {\n        let texture = new Texture(this._.texture.width, this._.texture.height, gl.RGBA, gl.UNSIGNED_BYTE);\n        this._.texture.use();\n        texture.drawTo(function () {\n            Shader.getDefaultShader().drawRect();\n        });\n        return wrapTexture(texture);\n    }\n\n    /*\n       Get a Uint8 array of pixel values: [r, g, b, a, r, g, b, a, ...]\n       Length of the array will be width * height * 4.\n    */\n    function getPixelArray() {\n        let w = this._.texture.width;\n        let h = this._.texture.height;\n        let array = new Uint8Array(w * h * 4);\n        this._.texture.drawTo(function () {\n            gl.readPixels(0, 0, w, h, gl.RGBA, gl.UNSIGNED_BYTE, array);\n        });\n        return array;\n    }\n\n    function wrap(func) {\n        return function () {\n            // Make sure that we're using the correct global WebGL context\n            gl = this._.gl;\n\n            // Now that the context has been switched, we can call the wrapped function\n            return func.apply(this, arguments);\n        };\n    }\n\n    exports.canvas = function () {\n        let canvas: any = document.createElement('canvas');\n        try {\n            gl = canvas.getContext('experimental-webgl', {premultipliedAlpha: false});\n        } catch (e) {\n            gl = null;\n        }\n        if (!gl) {\n            throw 'This browser does not support WebGL';\n        }\n        canvas._ = {\n            gl: gl,\n            isInitialized: false,\n            texture: null,\n            spareTexture: null,\n            flippedShader: null\n        };\n\n        // Core methods\n        canvas.texture = wrap(texture);\n        canvas.draw = wrap(draw);\n        canvas.update = wrap(update);\n        canvas.replace = wrap(replace);\n        canvas.contents = wrap(contents);\n        canvas.getPixelArray = wrap(getPixelArray);\n\n        // Filter methods\n        canvas.brightnessContrast = wrap(brightnessContrast);\n        canvas.hexagonalPixelate = wrap(hexagonalPixelate);\n        canvas.hueSaturation = wrap(hueSaturation);\n        canvas.colorHalftone = wrap(colorHalftone);\n        canvas.triangleBlur = wrap(triangleBlur);\n        canvas.unsharpMask = wrap(unsharpMask);\n        canvas.perspective = wrap(perspective);\n        canvas.matrixWarp = wrap(matrixWarp);\n        canvas.bulgePinch = wrap(bulgePinch);\n        canvas.tiltShift = wrap(tiltShift);\n        canvas.dotScreen = wrap(dotScreen);\n        canvas.edgeWork = wrap(edgeWork);\n        canvas.lensBlur = wrap(lensBlur);\n        canvas.zoomBlur = wrap(zoomBlur);\n        canvas.noise = wrap(noise);\n        canvas.denoise = wrap(denoise);\n        canvas.curves = wrap(curves);\n        canvas.swirl = wrap(swirl);\n        canvas.ink = wrap(ink);\n        canvas.vignette = wrap(vignette);\n        canvas.vibrance = wrap(vibrance);\n        canvas.sepia = wrap(sepia);\n        canvas.invert = wrap(invert);\n        canvas.multiplyAlpha = wrap(multiplyAlpha);\n        canvas.unmultiplyAlpha = wrap(unmultiplyAlpha);\n        canvas.toAlpha = wrap(toAlpha);\n        canvas.distort = wrap(distort);\n\n        return canvas;\n    };\n    exports.splineInterpolate = splineInterpolate;\n\n// src/core\\matrix.script\n// from javax.media.jai.PerspectiveTransform\n\n    function getSquareToQuad(x0, y0, x1, y1, x2, y2, x3, y3) {\n        let dx1 = x1 - x2;\n        let dy1 = y1 - y2;\n        let dx2 = x3 - x2;\n        let dy2 = y3 - y2;\n        let dx3 = x0 - x1 + x2 - x3;\n        let dy3 = y0 - y1 + y2 - y3;\n        let det = dx1 * dy2 - dx2 * dy1;\n        let a = (dx3 * dy2 - dx2 * dy3) / det;\n        let b = (dx1 * dy3 - dx3 * dy1) / det;\n        return [\n            x1 - x0 + a * x1, y1 - y0 + a * y1, a,\n            x3 - x0 + b * x3, y3 - y0 + b * y3, b,\n            x0, y0, 1\n        ];\n    }\n\n    function getInverse(m) {\n        let a = m[0], b = m[1], c = m[2];\n        let d = m[3], e = m[4], f = m[5];\n        let g = m[6], h = m[7], i = m[8];\n        let det = a * e * i - a * f * h - b * d * i + b * f * g + c * d * h - c * e * g;\n        return [\n            (e * i - f * h) / det, (c * h - b * i) / det, (b * f - c * e) / det,\n            (f * g - d * i) / det, (a * i - c * g) / det, (c * d - a * f) / det,\n            (d * h - e * g) / det, (b * g - a * h) / det, (a * e - b * d) / det\n        ];\n    }\n\n    function multiply(a, b) {\n        return [\n            a[0] * b[0] + a[1] * b[3] + a[2] * b[6],\n            a[0] * b[1] + a[1] * b[4] + a[2] * b[7],\n            a[0] * b[2] + a[1] * b[5] + a[2] * b[8],\n            a[3] * b[0] + a[4] * b[3] + a[5] * b[6],\n            a[3] * b[1] + a[4] * b[4] + a[5] * b[7],\n            a[3] * b[2] + a[4] * b[5] + a[5] * b[8],\n            a[6] * b[0] + a[7] * b[3] + a[8] * b[6],\n            a[6] * b[1] + a[7] * b[4] + a[8] * b[7],\n            a[6] * b[2] + a[7] * b[5] + a[8] * b[8]\n        ];\n    }\n\n// src/core\\shader.script\n    var Shader = (function () {\n        function isArray(obj) {\n            return Object.prototype.toString.call(obj) == '[object Array]';\n        }\n\n        function isNumber(obj) {\n            return Object.prototype.toString.call(obj) == '[object Number]';\n        }\n\n        function compileSource(type, source, nameStr) {\n            let shader = gl.createShader(type);\n            gl.shaderSource(shader, source.replace(/#define.*/, '')); // glslify adds a line add the beginning that breaks it\n            gl.compileShader(shader);\n            if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n                throw 'compile error: ' + nameStr + ' - ' + gl.getShaderInfoLog(shader);\n            }\n            return shader;\n        }\n\n        let defaultVertexSource = '\\\n    attribute vec2 vertex;\\\n    attribute vec2 _texCoord;\\\n    varying vec2 texCoord;\\\n    void main() {\\\n        texCoord = _texCoord;\\\n        gl_Position = vec4(vertex * 2.0 - 1.0, 0.0, 1.0);\\\n    }';\n\n        let defaultFragmentSource = '\\\n    uniform sampler2D texture;\\\n    varying vec2 texCoord;\\\n    void main() {\\\n        gl_FragColor = texture2D(texture, texCoord);\\\n    }';\n\n        // added test 2020-04-27 bitbof\n        let floatPrecision = null;\n\n        function testPrecisionSupport(precisionType) {\n            let format = gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, precisionType);\n            return format !== null && format.precision !== 0;\n        }\n\n        function Shader(vertexSource?, fragmentSource?, nameStr?) {\n            this.vertexAttribute = null;\n            this.texCoordAttribute = null;\n            this.program = gl.createProgram();\n            vertexSource = vertexSource || defaultVertexSource;\n            fragmentSource = fragmentSource || defaultFragmentSource;\n            if (floatPrecision === null) {\n                floatPrecision = testPrecisionSupport(gl.HIGH_FLOAT) ? 'highp' : (testPrecisionSupport(gl.MEDIUM_FLOAT) ? 'mediump' : 'lowp');\n            }\n            fragmentSource = 'precision ' + floatPrecision + ' float;' + fragmentSource; // annoying requirement is annoying\n            gl.attachShader(this.program, compileSource(gl.VERTEX_SHADER, vertexSource, nameStr + '(vertex)'));\n            gl.attachShader(this.program, compileSource(gl.FRAGMENT_SHADER, fragmentSource, nameStr + '(fragment)'));\n            gl.linkProgram(this.program);\n            if (!gl.getProgramParameter(this.program, gl.LINK_STATUS)) {\n                throw 'link error: ' + gl.getProgramInfoLog(this.program);\n            }\n        }\n\n        Shader.prototype.destroy = function () {\n            gl.deleteProgram(this.program);\n            this.program = null;\n        };\n\n        Shader.prototype.uniforms = function (uniforms) {\n            gl.useProgram(this.program);\n            for (var name in uniforms) {\n                if (!uniforms.hasOwnProperty(name)) continue;\n                let location = gl.getUniformLocation(this.program, name);\n                if (location === null) continue; // will be null if the uniform isn't used in the shader\n                let value = uniforms[name];\n                if (isArray(value)) {\n                    switch (value.length) {\n                        case 1:\n                            gl.uniform1fv(location, new Float32Array(value));\n                            break;\n                        case 2:\n                            gl.uniform2fv(location, new Float32Array(value));\n                            break;\n                        case 3:\n                            gl.uniform3fv(location, new Float32Array(value));\n                            break;\n                        case 4:\n                            gl.uniform4fv(location, new Float32Array(value));\n                            break;\n                        case 9:\n                            gl.uniformMatrix3fv(location, false, new Float32Array(value));\n                            break;\n                        case 16:\n                            gl.uniformMatrix4fv(location, false, new Float32Array(value));\n                            break;\n                        default:\n                            throw 'dont\\'t know how to load uniform \"' + name + '\" of length ' + value.length;\n                    }\n                } else if (isNumber(value)) {\n                    gl.uniform1f(location, value);\n                } else {\n                    throw 'attempted to set uniform \"' + name + '\" to invalid value ' + (value || 'undefined').toString();\n                }\n            }\n            // allow chaining\n            return this;\n        };\n\n        // textures are uniforms too but for some reason can't be specified by gl.uniform1f,\n        // even though floating point numbers represent the integers 0 through 7 exactly\n        Shader.prototype.textures = function (textures) {\n            gl.useProgram(this.program);\n            for (var name in textures) {\n                if (!textures.hasOwnProperty(name)) continue;\n                gl.uniform1i(gl.getUniformLocation(this.program, name), textures[name]);\n            }\n            // allow chaining\n            return this;\n        };\n\n        Shader.prototype.drawRect = function (left, top, right, bottom) {\n            let undefined;\n            let viewport = gl.getParameter(gl.VIEWPORT);\n            top = top !== undefined ? (top - viewport[1]) / viewport[3] : 0;\n            left = left !== undefined ? (left - viewport[0]) / viewport[2] : 0;\n            right = right !== undefined ? (right - viewport[0]) / viewport[2] : 1;\n            bottom = bottom !== undefined ? (bottom - viewport[1]) / viewport[3] : 1;\n            if (gl.vertexBuffer == null) {\n                gl.vertexBuffer = gl.createBuffer();\n            }\n            gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\n            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([left, top, left, bottom, right, top, right, bottom]), gl.STATIC_DRAW);\n            if (gl.texCoordBuffer == null) {\n                gl.texCoordBuffer = gl.createBuffer();\n                gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\n                gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 0, 0, 1, 1, 0, 1, 1]), gl.STATIC_DRAW);\n            }\n            if (this.vertexAttribute == null) {\n                this.vertexAttribute = gl.getAttribLocation(this.program, 'vertex');\n                gl.enableVertexAttribArray(this.vertexAttribute);\n            }\n            if (this.texCoordAttribute == null) {\n                this.texCoordAttribute = gl.getAttribLocation(this.program, '_texCoord');\n                gl.enableVertexAttribArray(this.texCoordAttribute);\n            }\n            gl.useProgram(this.program);\n            gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\n            gl.vertexAttribPointer(this.vertexAttribute, 2, gl.FLOAT, false, 0, 0);\n            gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\n            gl.vertexAttribPointer(this.texCoordAttribute, 2, gl.FLOAT, false, 0, 0);\n            gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n        };\n\n        Shader.getDefaultShader = function () {\n            gl.defaultShader = gl.defaultShader || new Shader();\n            return gl.defaultShader;\n        };\n\n        return Shader;\n    })();\n\n// src/core\\spline.script\n// from SplineInterpolator.cs in the Paint.NET source code\n\n    function SplineInterpolator(points) {\n        let n = points.length;\n        this.xa = [];\n        this.ya = [];\n        this.u = [];\n        this.y2 = [];\n\n        points.sort(function (a, b) {\n            return a[0] - b[0];\n        });\n        for (var i = 0; i < n; i++) {\n            this.xa.push(points[i][0]);\n            this.ya.push(points[i][1]);\n        }\n\n        this.u[0] = 0;\n        this.y2[0] = 0;\n\n        for (var i = 1; i < n - 1; ++i) {\n            // This is the decomposition loop of the tridiagonal algorithm.\n            // y2 and u are used for temporary storage of the decomposed factors.\n            let wx = this.xa[i + 1] - this.xa[i - 1];\n            let sig = (this.xa[i] - this.xa[i - 1]) / wx;\n            let p = sig * this.y2[i - 1] + 2.0;\n\n            this.y2[i] = (sig - 1.0) / p;\n\n            let ddydx =\n                (this.ya[i + 1] - this.ya[i]) / (this.xa[i + 1] - this.xa[i]) -\n                (this.ya[i] - this.ya[i - 1]) / (this.xa[i] - this.xa[i - 1]);\n\n            this.u[i] = (6.0 * ddydx / wx - sig * this.u[i - 1]) / p;\n        }\n\n        this.y2[n - 1] = 0;\n\n        // This is the backsubstitution loop of the tridiagonal algorithm\n        for (var i = n - 2; i >= 0; --i) {\n            this.y2[i] = this.y2[i] * this.y2[i + 1] + this.u[i];\n        }\n    }\n\n    SplineInterpolator.prototype.interpolate = function (x) {\n        let n = this.ya.length;\n        let klo = 0;\n        let khi = n - 1;\n\n        // We will find the right place in the table by means of\n        // bisection. This is optimal if sequential calls to this\n        // routine are at random values of x. If sequential calls\n        // are in order, and closely spaced, one would do better\n        // to store previous values of klo and khi.\n        while (khi - klo > 1) {\n            let k = (khi + klo) >> 1;\n\n            if (this.xa[k] > x) {\n                khi = k;\n            } else {\n                klo = k;\n            }\n        }\n\n        let h = this.xa[khi] - this.xa[klo];\n        let a = (this.xa[khi] - x) / h;\n        let b = (x - this.xa[klo]) / h;\n\n        // Cubic spline polynomial is now evaluated.\n        return a * this.ya[klo] + b * this.ya[khi] +\n            ((a * a * a - a) * this.y2[klo] + (b * b * b - b) * this.y2[khi]) * (h * h) / 6.0;\n    };\n\n// src/core\\texture.script\n    var Texture = (function () {\n        Texture.fromElement = function (element) {\n            let texture = new Texture(0, 0, gl.RGBA, gl.UNSIGNED_BYTE);\n            texture.loadContentsOf(element);\n            return texture;\n        };\n\n        function Texture(width, height, format, type) {\n            this.gl = gl;\n            this.id = gl.createTexture();\n            this.width = width;\n            this.height = height;\n            this.format = format;\n            this.type = type;\n\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n            if (width && height) gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\n        }\n\n        Texture.prototype.loadContentsOf = function (element) {\n            this.width = element.width || element.videoWidth;\n            this.height = element.height || element.videoHeight;\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\n            gl.texImage2D(gl.TEXTURE_2D, 0, this.format, this.format, this.type, element);\n        };\n\n        Texture.prototype.initFromBytes = function (width, height, data) {\n            this.width = width;\n            this.height = height;\n            this.format = gl.RGBA;\n            this.type = gl.UNSIGNED_BYTE;\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, this.type, new Uint8Array(data));\n        };\n\n        Texture.prototype.destroy = function () {\n            gl.deleteTexture(this.id);\n            this.id = null;\n        };\n\n        Texture.prototype.use = function (unit) {\n            gl.activeTexture(gl.TEXTURE0 + (unit || 0));\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\n        };\n\n        Texture.prototype.unuse = function (unit) {\n            gl.activeTexture(gl.TEXTURE0 + (unit || 0));\n            gl.bindTexture(gl.TEXTURE_2D, null);\n        };\n\n        Texture.prototype.ensureFormat = function (width, height, format, type) {\n            // allow passing an existing texture instead of individual arguments\n            if (arguments.length == 1) {\n                let texture = arguments[0];\n                width = texture.width;\n                height = texture.height;\n                format = texture.format;\n                type = texture.type;\n            }\n\n            // change the format only if required\n            if (width != this.width || height != this.height || format != this.format || type != this.type) {\n                this.width = width;\n                this.height = height;\n                this.format = format;\n                this.type = type;\n                gl.bindTexture(gl.TEXTURE_2D, this.id);\n                gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\n            }\n        };\n\n        Texture.prototype.drawTo = function (callback) {\n            // start rendering to this texture\n            gl.framebuffer = gl.framebuffer || gl.createFramebuffer();\n            gl.bindFramebuffer(gl.FRAMEBUFFER, gl.framebuffer);\n            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.id, 0);\n            if (gl.checkFramebufferStatus(gl.FRAMEBUFFER) !== gl.FRAMEBUFFER_COMPLETE) {\n                throw new Error('incomplete framebuffer');\n            }\n            gl.viewport(0, 0, this.width, this.height);\n\n            // do the drawing\n            callback();\n\n            // stop rendering to this texture\n            gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n        };\n\n        let canvas = null;\n\n        function getCanvas(texture) {\n            if (canvas == null) canvas = document.createElement('canvas');\n            canvas.width = texture.width;\n            canvas.height = texture.height;\n            let c = canvas.getContext('2d');\n            c.clearRect(0, 0, canvas.width, canvas.height);\n            return c;\n        }\n\n        Texture.prototype.fillUsingCanvas = function (callback) {\n            callback(getCanvas(this));\n            this.format = gl.RGBA;\n            this.type = gl.UNSIGNED_BYTE;\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, canvas);\n            return this;\n        };\n\n        Texture.prototype.toImage = function (image) {\n            this.use();\n            Shader.getDefaultShader().drawRect();\n            let size = this.width * this.height * 4;\n            let pixels = new Uint8Array(size);\n            let c = getCanvas(this);\n            let data = c.createImageData(this.width, this.height);\n            gl.readPixels(0, 0, this.width, this.height, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\n            for (var i = 0; i < size; i++) {\n                data.data[i] = pixels[i];\n            }\n            c.putImageData(data, 0, 0);\n            image.src = canvas.toDataURL();\n        };\n\n        Texture.prototype.swapWith = function (other) {\n            let temp;\n            temp = other.id;\n            other.id = this.id;\n            this.id = temp;\n            temp = other.width;\n            other.width = this.width;\n            this.width = temp;\n            temp = other.height;\n            other.height = this.height;\n            this.height = temp;\n            temp = other.format;\n            other.format = this.format;\n            this.format = temp;\n        };\n\n        return Texture;\n    })();\n\n// src/filters\\common.script\n    function warpShader(uniforms, warp) {\n        return new Shader(null, uniforms + '\\\n    uniform sampler2D texture;\\\n    uniform vec2 texSize;\\\n    varying vec2 texCoord;\\\n    void main() {\\\n        vec2 coord = texCoord * texSize;\\\n        ' + warp + '\\\n        gl_FragColor = texture2D(texture, coord / texSize);\\\n        vec2 clampedCoord = clamp(coord, vec2(0.0), texSize);\\\n        if (coord != clampedCoord) {\\\n            /* fade to transparent if we are outside the image */\\\n            gl_FragColor.a *= max(0.0, 1.0 - length(coord - clampedCoord));\\\n        }\\\n    }', 'warp');\n    }\n\n// returns a random number between 0 and 1\n    var randomShaderFunc = '\\\n    float random(vec3 scale, float seed) {\\\n        /* use the fragment position for a different seed per-pixel */\\\n        return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\\\n    }\\\n';\n\n// src/filters\\adjust\\brightnesscontrast.script\n    /**\n     * @filter           Brightness / Contrast\n     * @description      Provides additive brightness and multiplicative contrast control.\n     * @param brightness -1 to 1 (-1 is solid black, 0 is no change, and 1 is solid white)\n     * @param contrast   -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\n     */\n    function brightnessContrast(brightness, contrast) {\n        gl.brightnessContrast = gl.brightnessContrast || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float brightness;\\\n        uniform float contrast;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            color.rgb += brightness;\\\n            if (contrast > 0.0) {\\\n                color.rgb = (color.rgb - 0.5) / (1.0 - contrast) + 0.5;\\\n            } else {\\\n                color.rgb = (color.rgb - 0.5) * (1.0 + contrast) + 0.5;\\\n            }\\\n            gl_FragColor = color;\\\n        }\\\n    ', 'brightnessContrast');\n\n        simpleShader.call(this, gl.brightnessContrast, {\n            brightness: clamp(-1, brightness, 1),\n            contrast: clamp(-1, contrast, 1)\n        });\n\n        return this;\n    }\n\n// src/filters\\adjust\\curves.script\n    function splineInterpolate(points) {\n        let interpolator = new SplineInterpolator(points);\n        let array = [];\n        for (var i = 0; i < 256; i++) {\n            array.push(clamp(0, Math.floor(interpolator.interpolate(i / 255) * 256), 255));\n        }\n        return array;\n    }\n\n    /**\n     * @filter      Curves\n     * @description A powerful mapping tool that transforms the colors in the image\n     *              by an arbitrary function. The function is interpolated between\n     *              a set of 2D points using splines. The curves filter can take\n     *              either one or three arguments which will apply the mapping to\n     *              either luminance or RGB values, respectively.\n     * @param red   A list of points that define the function for the red channel.\n     *              Each point is a list of two values: the value before the mapping\n     *              and the value after the mapping, both in the range 0 to 1. For\n     *              example, [[0,1], [1,0]] would invert the red channel while\n     *              [[0,0], [1,1]] would leave the red channel unchanged. If green\n     *              and blue are omitted then this argument also applies to the\n     *              green and blue channels.\n     * @param green (optional) A list of points that define the function for the green\n     *              channel (just like for red).\n     * @param blue  (optional) A list of points that define the function for the blue\n     *              channel (just like for red).\n     */\n    function curves(red, green, blue) {\n        // Create the ramp texture\n        red = splineInterpolate(red);\n        if (arguments.length == 1) {\n            green = blue = red;\n        } else {\n            green = splineInterpolate(green);\n            blue = splineInterpolate(blue);\n        }\n        let array = [];\n        for (var i = 0; i < 256; i++) {\n            array.splice(array.length, 0, red[i], green[i], blue[i], 255);\n        }\n        this._.extraTexture.initFromBytes(256, 1, array);\n        this._.extraTexture.use(1);\n\n        gl.curves = gl.curves || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform sampler2D map;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            color.r = texture2D(map, vec2(color.r)).r;\\\n            color.g = texture2D(map, vec2(color.g)).g;\\\n            color.b = texture2D(map, vec2(color.b)).b;\\\n            gl_FragColor = color;\\\n        }\\\n    ', 'curves');\n\n        gl.curves.textures({\n            map: 1\n        });\n        simpleShader.call(this, gl.curves, {});\n\n        return this;\n    }\n\n// src/filters\\adjust\\denoise.script\n    /**\n     * @filter         Denoise\n     * @description    Smooths over grainy noise in dark images using an 9x9 box filter\n     *                 weighted by color intensity, similar to a bilateral filter.\n     * @param exponent The exponent of the color intensity difference, should be greater\n     *                 than zero. A value of zero just gives an 9x9 box blur and high values\n     *                 give the original image, but ideal values are usually around 10-20.\n     */\n    function denoise(exponent) {\n        // Do a 9x9 bilateral box filter\n        gl.denoise = gl.denoise || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float exponent;\\\n        uniform float strength;\\\n        uniform vec2 texSize;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 center = texture2D(texture, texCoord);\\\n            vec4 color = vec4(0.0);\\\n            float total = 0.0;\\\n            for (float x = -4.0; x <= 4.0; x += 1.0) {\\\n                for (float y = -4.0; y <= 4.0; y += 1.0) {\\\n                    vec4 sample = texture2D(texture, texCoord + vec2(x, y) / texSize);\\\n                    float weight = 1.0 - abs(dot(sample.rgb - center.rgb, vec3(0.25)));\\\n                    weight = pow(weight, exponent);\\\n                    color += sample * weight;\\\n                    total += weight;\\\n                }\\\n            }\\\n            gl_FragColor = color / total;\\\n        }\\\n    ', 'denoise');\n\n        // Perform two iterations for stronger results\n        for (var i = 0; i < 2; i++) {\n            simpleShader.call(this, gl.denoise, {\n                exponent: Math.max(0, exponent),\n                texSize: [this.width, this.height]\n            });\n        }\n\n        return this;\n    }\n\n// src/filters\\adjust\\huesaturation.script\n    /**\n     * @filter           Hue / Saturation\n     * @description      Provides rotational hue and multiplicative saturation control. RGB color space\n     *                   can be imagined as a cube where the axes are the red, green, and blue color\n     *                   values. Hue changing works by rotating the color vector around the grayscale\n     *                   line, which is the straight line from black (0, 0, 0) to white (1, 1, 1).\n     *                   Saturation is implemented by scaling all color channel values either toward\n     *                   or away from the average color channel value.\n     * @param hue        -1 to 1 (-1 is 180 degree rotation in the negative direction, 0 is no change,\n     *                   and 1 is 180 degree rotation in the positive direction)\n     * @param saturation -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\n     */\n    function hueSaturation(hue, saturation) {\n        gl.hueSaturation = gl.hueSaturation || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float hue;\\\n        uniform float saturation;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            \\\n            /* hue adjustment, wolfram alpha: RotationTransform[angle, {1, 1, 1}][{x, y, z}] */\\\n            float angle = hue * 3.14159265;\\\n            float s = sin(angle), c = cos(angle);\\\n            vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\\\n            float len = length(color.rgb);\\\n            color.rgb = vec3(\\\n                dot(color.rgb, weights.xyz),\\\n                dot(color.rgb, weights.zxy),\\\n                dot(color.rgb, weights.yzx)\\\n            );\\\n            \\\n            /* saturation adjustment */\\\n            float average = (color.r + color.g + color.b) / 3.0;\\\n            if (saturation > 0.0) {\\\n                color.rgb += (average - color.rgb) * (1.0 - 1.0 / (1.001 - saturation));\\\n            } else {\\\n                color.rgb += (average - color.rgb) * (-saturation);\\\n            }\\\n            \\\n            gl_FragColor = color;\\\n        }\\\n    ', 'hueSaturation');\n\n        simpleShader.call(this, gl.hueSaturation, {\n            hue: clamp(-1, hue, 1),\n            saturation: clamp(-1, saturation, 1)\n        });\n\n        return this;\n    }\n\n// src/filters\\adjust\\noise.script\n    /**\n     * @filter         Noise\n     * @description    draws noise, completely replaces original image\n     * @param seed\n     * @param type\n     * @param scale\n     * @param offset\n     * @param octaves\n     * @param samples\n     * @param peaks\n     * @param brightness\n     * @param contrast\n     * @param isReversed\n     * @param colA\n     * @param colB\n     * @param channels\n     */\n    function noise(\n        seed: number, // float, any value okay\n        type: number, // 1 value, 2 simplex, 3 cellular\n        scale: [number, number], // float, small scale will show repeating patterns\n        offset: [number, number], // offset x, y - large offsets will show repeating patterns\n        octaves: number, // int 0 - 4\n        samples: number, // 1 | 4 | 8 -> super-sampling\n        peaks: number, // how often it will ramp *additionally* from 0 to 1\n        brightness: number, // range [-1, 1]\n        contrast: number, // range [-1, 1]\n        isReversed: boolean, // reverse 0-1 range\n        colA: {r: number, g: number, b: number}, // which color at 0, if rgb\n        colB: {r: number, g: number, b: number}, // which color at 1, if rgb\n        channels: 'rgb' | 'alpha', // which channel to target\n    ) {\n        gl.noise = gl.noise || new Shader(null, shaderNoise.replace(/#define.*/, ''), 'noise');\n        simpleShader.call(this, gl.noise, {\n            seed,\n            type,\n            scale: [scale[0], scale[1]],\n            offset,\n            octaves,\n            samples,\n            texSize: [this.width, this.height],\n            peaks,\n            brightness,\n            contrast,\n            isReversed: isReversed ? 1.0 : 0.0,\n            colA: colA ? [colA.r / 255, colA.g / 255, colA.b / 255] : [0, 0, 0],\n            colB: colB ? [colB.r / 255, colB.g / 255, colB.b / 255] : [1, 1, 1],\n            channels: channels === 'rgb' ? 0 : 1,\n        });\n\n        return this;\n    }\n\n// src/filters\\adjust\\sepia.script\n    /**\n     * @filter         Sepia\n     * @description    Gives the image a reddish-brown monochrome tint that imitates an old photograph.\n     * @param amount   0 to 1 (0 for no effect, 1 for full sepia coloring)\n     */\n    function sepia(amount) {\n        gl.sepia = gl.sepia || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float amount;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            float r = color.r;\\\n            float g = color.g;\\\n            float b = color.b;\\\n            \\\n            color.r = min(1.0, (r * (1.0 - (0.607 * amount))) + (g * (0.769 * amount)) + (b * (0.189 * amount)));\\\n            color.g = min(1.0, (r * 0.349 * amount) + (g * (1.0 - (0.314 * amount))) + (b * 0.168 * amount));\\\n            color.b = min(1.0, (r * 0.272 * amount) + (g * 0.534 * amount) + (b * (1.0 - (0.869 * amount))));\\\n            \\\n            gl_FragColor = color;\\\n        }\\\n    ', 'sepia');\n\n        simpleShader.call(this, gl.sepia, {\n            amount: clamp(0, amount, 1)\n        });\n\n        return this;\n    }\n\n// src/filters\\adjust\\unsharpmask.script\n    /**\n     * @filter         Unsharp Mask\n     * @description    A form of image sharpening that amplifies high-frequencies in the image. It\n     *                 is implemented by scaling pixels away from the average of their neighbors.\n     * @param radius   The blur radius that calculates the average of the neighboring pixels.\n     * @param strength A scale factor where 0 is no effect and higher values cause a stronger effect.\n     */\n    function unsharpMask(radius, strength) {\n        gl.unsharpMask = gl.unsharpMask || new Shader(null, '\\\n        uniform sampler2D blurredTexture;\\\n        uniform sampler2D originalTexture;\\\n        uniform float strength;\\\n        uniform float threshold;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 blurred = texture2D(blurredTexture, texCoord);\\\n            vec4 original = texture2D(originalTexture, texCoord);\\\n            gl_FragColor = mix(blurred, original, 1.0 + strength);\\\n        }\\\n    ', 'unsharpMask');\n\n        // Store a copy of the current texture in the second texture unit\n        this._.extraTexture.ensureFormat(this._.texture);\n        this._.texture.use();\n        this._.extraTexture.drawTo(function () {\n            Shader.getDefaultShader().drawRect();\n        });\n\n        // Blur the current texture, then use the stored texture to detect edges\n        this._.extraTexture.use(1);\n        this.triangleBlur(radius);\n        gl.unsharpMask.textures({\n            originalTexture: 1\n        });\n        simpleShader.call(this, gl.unsharpMask, {\n            strength: strength\n        });\n        this._.extraTexture.unuse(1);\n\n        return this;\n    }\n\n// src/filters\\adjust\\vibrance.script\n    /**\n     * @filter       Vibrance\n     * @description  Modifies the saturation of desaturated colors, leaving saturated colors unmodified.\n     * @param amount -1 to 1 (-1 is minimum vibrance, 0 is no change, and 1 is maximum vibrance)\n     */\n    function vibrance(amount) {\n        gl.vibrance = gl.vibrance || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float amount;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            float average = (color.r + color.g + color.b) / 3.0;\\\n            float mx = max(color.r, max(color.g, color.b));\\\n            float amt = (mx - average) * (-amount * 3.0);\\\n            color.rgb = mix(color.rgb, vec3(mx), amt);\\\n            gl_FragColor = color;\\\n        }\\\n    ', 'vibrance');\n\n        simpleShader.call(this, gl.vibrance, {\n            amount: clamp(-1, amount, 1)\n        });\n\n        return this;\n    }\n\n// src/filters\\adjust\\vignette.script\n    /**\n     * @filter         Vignette\n     * @description    Adds a simulated lens edge darkening effect.\n     * @param size     0 to 1 (0 for center of frame, 1 for edge of frame)\n     * @param amount   0 to 1 (0 for no effect, 1 for maximum lens darkening)\n     */\n    function vignette(size, amount) {\n        gl.vignette = gl.vignette || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float size;\\\n        uniform float amount;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            \\\n            float dist = distance(texCoord, vec2(0.5, 0.5));\\\n            color.rgb *= smoothstep(0.8, size * 0.799, dist * (amount + size));\\\n            \\\n            gl_FragColor = color;\\\n        }\\\n    ', 'vignette');\n\n        simpleShader.call(this, gl.vignette, {\n            size: clamp(0, size, 1),\n            amount: clamp(0, amount, 1)\n        });\n\n        return this;\n    }\n\n// src/filters\\blur\\lensblur.script\n    /**\n     * @filter           Lens Blur\n     * @description      Imitates a camera capturing the image out of focus by using a blur that generates\n     *                   the large shapes known as bokeh. The polygonal shape of real bokeh is due to the\n     *                   blades of the aperture diaphragm when it isn't fully open. This blur renders\n     *                   bokeh from a 6-bladed diaphragm because the computation is more efficient. It\n     *                   can be separated into three rhombi, each of which is just a skewed box blur.\n     *                   This filter makes use of the floating point texture WebGL extension to implement\n     *                   the brightness parameter, so there will be severe visual artifacts if brightness\n     *                   is non-zero and the floating point texture extension is not available. The\n     *                   idea was from John White's SIGGRAPH 2011 talk but this effect has an additional\n     *                   brightness parameter that fakes what would otherwise come from a HDR source.\n     * @param radius     the radius of the hexagonal disk convolved with the image\n     * @param brightness -1 to 1 (the brightness of the bokeh, negative values will create dark bokeh)\n     * @param angle      the rotation of the bokeh in radians\n     */\n    function lensBlur(radius, brightness, angle) {\n        // All averaging is done on values raised to a power to make more obvious bokeh\n        // (we will raise the average to the inverse power at the end to compensate).\n        // Without this the image looks almost like a normal blurred image. This hack is\n        // obviously not realistic, but to accurately simulate this we would need a high\n        // dynamic range source photograph which we don't have.\n        gl.lensBlurPrePass = gl.lensBlurPrePass || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float power;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            color = pow(color, vec4(power));\\\n            gl_FragColor = vec4(color);\\\n        }\\\n    ', 'lensBlurPrePass');\n\n        let common = '\\\n        uniform sampler2D texture0;\\\n        uniform sampler2D texture1;\\\n        uniform vec2 delta0;\\\n        uniform vec2 delta1;\\\n        uniform float power;\\\n        varying vec2 texCoord;\\\n        ' + randomShaderFunc + '\\\n        vec4 sample(vec2 delta) {\\\n            /* randomize the lookup values to hide the fixed number of samples */\\\n            float offset = random(vec3(delta, 151.7182), 0.0);\\\n            \\\n            vec4 color = vec4(0.0);\\\n            float total = 0.0;\\\n            for (float t = 0.0; t <= 30.0; t++) {\\\n                float percent = (t + offset) / 30.0;\\\n                color += texture2D(texture0, texCoord + delta * percent);\\\n                total += 1.0;\\\n            }\\\n            return color / total;\\\n        }\\\n    ';\n\n        gl.lensBlur0 = gl.lensBlur0 || new Shader(null, common + '\\\n        void main() {\\\n            gl_FragColor = sample(delta0);\\\n        }\\\n    ', 'lensBlur0');\n        gl.lensBlur1 = gl.lensBlur1 || new Shader(null, common + '\\\n        void main() {\\\n            gl_FragColor = (sample(delta0) + sample(delta1)) * 0.5;\\\n        }\\\n    ', 'lensBlur1');\n        gl.lensBlur2 = gl.lensBlur2 || new Shader(null, common + '\\\n        void main() {\\\n            vec4 color = (sample(delta0) + 2.0 * texture2D(texture1, texCoord)) / 3.0;\\\n            gl_FragColor = pow(color, vec4(power));\\\n        }\\\n    ', 'lensBlur2').textures({texture1: 1});\n\n        // Generate\n        let dir = [];\n        for (var i = 0; i < 3; i++) {\n            let a = angle + i * Math.PI * 2 / 3;\n            dir.push([radius * Math.sin(a) / this.width, radius * Math.cos(a) / this.height]);\n        }\n        let power = Math.pow(10, clamp(-1, brightness, 1));\n\n        // Remap the texture values, which will help make the bokeh effect\n        simpleShader.call(this, gl.lensBlurPrePass, {\n            power: power\n        });\n\n        // Blur two rhombi in parallel into extraTexture\n        this._.extraTexture.ensureFormat(this._.texture);\n        simpleShader.call(this, gl.lensBlur0, {\n            delta0: dir[0]\n        }, this._.texture, this._.extraTexture);\n        simpleShader.call(this, gl.lensBlur1, {\n            delta0: dir[1],\n            delta1: dir[2]\n        }, this._.extraTexture, this._.extraTexture);\n\n        // Blur the last rhombus and combine with extraTexture\n        simpleShader.call(this, gl.lensBlur0, {\n            delta0: dir[1]\n        });\n        this._.extraTexture.use(1);\n        simpleShader.call(this, gl.lensBlur2, {\n            power: 1 / power,\n            delta0: dir[2]\n        });\n\n        return this;\n    }\n\n// src/filters\\blur\\tiltshift.script\n    /**\n     * @filter               Tilt Shift\n     * @description          Simulates the shallow depth of field normally encountered in close-up\n     *                       photography, which makes the scene seem much smaller than it actually\n     *                       is. This filter assumes the scene is relatively planar, in which case\n     *                       the part of the scene that is completely in focus can be described by\n     *                       a line (the intersection of the focal plane and the scene). An example\n     *                       of a planar scene might be looking at a road from above at a downward\n     *                       angle. The image is then blurred with a blur radius that starts at zero\n     *                       on the line and increases further from the line.\n     * @param startX         The x coordinate of the start of the line segment.\n     * @param startY         The y coordinate of the start of the line segment.\n     * @param endX           The x coordinate of the end of the line segment.\n     * @param endY           The y coordinate of the end of the line segment.\n     * @param blurRadius     The maximum radius of the pyramid blur.\n     * @param gradientRadius The distance from the line at which the maximum blur radius is reached.\n     */\n    function tiltShift(startX, startY, endX, endY, blurRadius, gradientRadius) {\n        gl.tiltShift = gl.tiltShift || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float blurRadius;\\\n        uniform float gradientRadius;\\\n        uniform vec2 start;\\\n        uniform vec2 end;\\\n        uniform vec2 delta;\\\n        uniform vec2 texSize;\\\n        varying vec2 texCoord;\\\n        ' + randomShaderFunc + '\\\n        void main() {\\\n            vec4 color = vec4(0.0);\\\n            float total = 0.0;\\\n            \\\n            /* randomize the lookup values to hide the fixed number of samples */\\\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\n            \\\n            vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));\\\n            float radius = smoothstep(0.0, 1.0, abs(dot(texCoord * texSize - start, normal)) / gradientRadius) * blurRadius;\\\n            for (float t = -30.0; t <= 30.0; t++) {\\\n                float percent = (t + offset - 0.5) / 30.0;\\\n                float weight = 1.0 - abs(percent);\\\n                vec4 sample = texture2D(texture, texCoord + delta / texSize * percent * radius);\\\n                \\\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\n                sample.rgb *= sample.a;\\\n                \\\n                color += sample * weight;\\\n                total += weight;\\\n            }\\\n            \\\n            gl_FragColor = color / total;\\\n            \\\n            /* switch back from pre-multiplied alpha */\\\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\n        }\\\n    ', 'tiltShift');\n\n        let dx = endX - startX;\n        let dy = endY - startY;\n        let d = Math.sqrt(dx * dx + dy * dy);\n        simpleShader.call(this, gl.tiltShift, {\n            blurRadius: blurRadius,\n            gradientRadius: gradientRadius,\n            start: [startX, startY],\n            end: [endX, endY],\n            delta: [dx / d, dy / d],\n            texSize: [this.width, this.height]\n        });\n        simpleShader.call(this, gl.tiltShift, {\n            blurRadius: blurRadius,\n            gradientRadius: gradientRadius,\n            start: [startX, startY],\n            end: [endX, endY],\n            delta: [-dy / d, dx / d],\n            texSize: [this.width, this.height]\n        });\n\n        return this;\n    }\n\n// src/filters\\blur\\triangleblur.script\n    /**\n     * @filter       Triangle Blur\n     * @description  This is the most basic blur filter, which convolves the image with a\n     *               pyramid filter. The pyramid filter is separable and is applied as two\n     *               perpendicular triangle filters.\n     * @param radius The radius of the pyramid convolved with the image.\n     */\n    function triangleBlur(radius) {\n        gl.triangleBlur = gl.triangleBlur || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform vec2 delta;\\\n        varying vec2 texCoord;\\\n        ' + randomShaderFunc + '\\\n        void main() {\\\n            vec4 color = vec4(0.0);\\\n            float total = 0.0;\\\n            \\\n            /* randomize the lookup values to hide the fixed number of samples */\\\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\n            \\\n            for (float t = -30.0; t <= 30.0; t++) {\\\n                float percent = (t + offset - 0.5) / 30.0;\\\n                float weight = 1.0 - abs(percent);\\\n                vec4 sample = texture2D(texture, texCoord + delta * percent);\\\n                \\\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\n                sample.rgb *= sample.a;\\\n                \\\n                color += sample * weight;\\\n                total += weight;\\\n            }\\\n            \\\n            gl_FragColor = color / total;\\\n            \\\n            /* switch back from pre-multiplied alpha */\\\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\n        }\\\n    ', 'triangleBlur');\n\n        simpleShader.call(this, gl.triangleBlur, {\n            delta: [radius / this.width, 0]\n        });\n        simpleShader.call(this, gl.triangleBlur, {\n            delta: [0, radius / this.height]\n        });\n\n        return this;\n    }\n\n// src/filters\\blur\\zoomblur.script\n    /**\n     * @filter         Zoom Blur\n     * @description    Blurs the image away from a certain point, which looks like radial motion blur.\n     * @param centerX  The x coordinate of the blur origin.\n     * @param centerY  The y coordinate of the blur origin.\n     * @param strength The strength of the blur. Values in the range 0 to 1 are usually sufficient,\n     *                 where 0 doesn't change the image and 1 creates a highly blurred image.\n     */\n    function zoomBlur(centerX, centerY, strength) {\n        gl.zoomBlur = gl.zoomBlur || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform vec2 center;\\\n        uniform float strength;\\\n        uniform vec2 texSize;\\\n        varying vec2 texCoord;\\\n        ' + randomShaderFunc + '\\\n        void main() {\\\n            vec4 color = vec4(0.0);\\\n            float total = 0.0;\\\n            vec2 toCenter = center - texCoord * texSize;\\\n            \\\n            /* randomize the lookup values to hide the fixed number of samples */\\\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\n            \\\n            for (float t = 0.0; t <= 40.0; t++) {\\\n                float percent = (t + offset) / 40.0;\\\n                float weight = 4.0 * (percent - percent * percent);\\\n                vec4 sample = texture2D(texture, texCoord + toCenter * percent * strength / texSize);\\\n                \\\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\n                sample.rgb *= sample.a;\\\n                \\\n                color += sample * weight;\\\n                total += weight;\\\n            }\\\n            \\\n            gl_FragColor = color / total;\\\n            \\\n            /* switch back from pre-multiplied alpha */\\\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\n        }\\\n    ', 'zoomBlur');\n\n        simpleShader.call(this, gl.zoomBlur, {\n            center: [centerX, centerY],\n            strength: strength,\n            texSize: [this.width, this.height]\n        });\n\n        return this;\n    }\n\n// src/filters\\fun\\colorhalftone.script\n    /**\n     * @filter        Color Halftone\n     * @description   Simulates a CMYK halftone rendering of the image by multiplying pixel values\n     *                with a four rotated 2D sine wave patterns, one each for cyan, magenta, yellow,\n     *                and black.\n     * @param centerX The x coordinate of the pattern origin.\n     * @param centerY The y coordinate of the pattern origin.\n     * @param angle   The rotation of the pattern in radians.\n     * @param size    The diameter of a dot in pixels.\n     */\n    function colorHalftone(centerX, centerY, angle, size) {\n        gl.colorHalftone = gl.colorHalftone || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform vec2 center;\\\n        uniform float angle;\\\n        uniform float scale;\\\n        uniform vec2 texSize;\\\n        varying vec2 texCoord;\\\n        \\\n        float pattern(float angle) {\\\n            float s = sin(angle), c = cos(angle);\\\n            vec2 tex = texCoord * texSize - center;\\\n            vec2 point = vec2(\\\n                c * tex.x - s * tex.y,\\\n                s * tex.x + c * tex.y\\\n            ) * scale;\\\n            return (sin(point.x) * sin(point.y)) * 4.0;\\\n        }\\\n        \\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            vec3 cmy = 1.0 - color.rgb;\\\n            float k = min(cmy.x, min(cmy.y, cmy.z));\\\n            cmy = (cmy - k) / (1.0 - k);\\\n            cmy = clamp(cmy * 10.0 - 3.0 + vec3(pattern(angle + 0.26179), pattern(angle + 1.30899), pattern(angle)), 0.0, 1.0);\\\n            k = clamp(k * 10.0 - 5.0 + pattern(angle + 0.78539), 0.0, 1.0);\\\n            gl_FragColor = vec4(1.0 - cmy - k, color.a);\\\n        }\\\n    ', 'colorHalftone');\n\n        simpleShader.call(this, gl.colorHalftone, {\n            center: [centerX, centerY],\n            angle: angle,\n            scale: Math.PI / size,\n            texSize: [this.width, this.height]\n        });\n\n        return this;\n    }\n\n// src/filters\\fun\\dotscreen.script\n    /**\n     * @filter        Dot Screen\n     * @description   Simulates a black and white halftone rendering of the image by multiplying\n     *                pixel values with a rotated 2D sine wave pattern.\n     * @param centerX The x coordinate of the pattern origin.\n     * @param centerY The y coordinate of the pattern origin.\n     * @param angle   The rotation of the pattern in radians.\n     * @param size    The diameter of a dot in pixels.\n     */\n    function dotScreen(centerX, centerY, angle, size) {\n        gl.dotScreen = gl.dotScreen || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform vec2 center;\\\n        uniform float angle;\\\n        uniform float scale;\\\n        uniform vec2 texSize;\\\n        varying vec2 texCoord;\\\n        \\\n        float pattern() {\\\n            float s = sin(angle), c = cos(angle);\\\n            vec2 tex = texCoord * texSize - center;\\\n            vec2 point = vec2(\\\n                c * tex.x - s * tex.y,\\\n                s * tex.x + c * tex.y\\\n            ) * scale;\\\n            return (sin(point.x) * sin(point.y)) * 4.0;\\\n        }\\\n        \\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            float average = (color.r + color.g + color.b) / 3.0;\\\n            gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);\\\n        }\\\n    ', 'dotScreen');\n\n        simpleShader.call(this, gl.dotScreen, {\n            center: [centerX, centerY],\n            angle: angle,\n            scale: Math.PI / size,\n            texSize: [this.width, this.height]\n        });\n\n        return this;\n    }\n\n// src/filters\\fun\\edgework.script\n    /**\n     * @filter       Edge Work\n     * @description  Picks out different frequencies in the image by subtracting two\n     *               copies of the image blurred with different radii.\n     * @param radius The radius of the effect in pixels.\n     */\n    function edgeWork(radius) {\n        gl.edgeWork1 = gl.edgeWork1 || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform vec2 delta;\\\n        varying vec2 texCoord;\\\n        ' + randomShaderFunc + '\\\n        void main() {\\\n            vec2 color = vec2(0.0);\\\n            vec2 total = vec2(0.0);\\\n            \\\n            /* randomize the lookup values to hide the fixed number of samples */\\\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\n            \\\n            for (float t = -30.0; t <= 30.0; t++) {\\\n                float percent = (t + offset - 0.5) / 30.0;\\\n                float weight = 1.0 - abs(percent);\\\n                vec3 sample = texture2D(texture, texCoord + delta * percent).rgb;\\\n                float average = (sample.r + sample.g + sample.b) / 3.0;\\\n                color.x += average * weight;\\\n                total.x += weight;\\\n                if (abs(t) < 15.0) {\\\n                    weight = weight * 2.0 - 1.0;\\\n                    color.y += average * weight;\\\n                    total.y += weight;\\\n                }\\\n            }\\\n            gl_FragColor = vec4(color / total, 0.0, 1.0);\\\n        }\\\n    ', 'edgeWork1');\n        gl.edgeWork2 = gl.edgeWork2 || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform vec2 delta;\\\n        varying vec2 texCoord;\\\n        ' + randomShaderFunc + '\\\n        void main() {\\\n            vec2 color = vec2(0.0);\\\n            vec2 total = vec2(0.0);\\\n            \\\n            /* randomize the lookup values to hide the fixed number of samples */\\\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\n            \\\n            for (float t = -30.0; t <= 30.0; t++) {\\\n                float percent = (t + offset - 0.5) / 30.0;\\\n                float weight = 1.0 - abs(percent);\\\n                vec2 sample = texture2D(texture, texCoord + delta * percent).xy;\\\n                color.x += sample.x * weight;\\\n                total.x += weight;\\\n                if (abs(t) < 15.0) {\\\n                    weight = weight * 2.0 - 1.0;\\\n                    color.y += sample.y * weight;\\\n                    total.y += weight;\\\n                }\\\n            }\\\n            float c = clamp(10000.0 * (color.y / total.y - color.x / total.x) + 0.5, 0.0, 1.0);\\\n            gl_FragColor = vec4(c, c, c, 1.0);\\\n        }\\\n    ', 'edgeWork2');\n\n        simpleShader.call(this, gl.edgeWork1, {\n            delta: [radius / this.width, 0]\n        });\n        simpleShader.call(this, gl.edgeWork2, {\n            delta: [0, radius / this.height]\n        });\n\n        return this;\n    }\n\n// src/filters\\fun\\hexagonalpixelate.script\n    /**\n     * @filter        Hexagonal Pixelate\n     * @description   Renders the image using a pattern of hexagonal tiles. Tile colors\n     *                are nearest-neighbor sampled from the centers of the tiles.\n     * @param centerX The x coordinate of the pattern center.\n     * @param centerY The y coordinate of the pattern center.\n     * @param scale   The width of an individual tile, in pixels.\n     */\n    function hexagonalPixelate(centerX, centerY, scale) {\n        gl.hexagonalPixelate = gl.hexagonalPixelate || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform vec2 center;\\\n        uniform float scale;\\\n        uniform vec2 texSize;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec2 tex = (texCoord * texSize - center) / scale;\\\n            tex.y /= 0.866025404;\\\n            tex.x -= tex.y * 0.5;\\\n            \\\n            vec2 a;\\\n            if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) a = vec2(floor(tex.x), floor(tex.y));\\\n            else a = vec2(ceil(tex.x), ceil(tex.y));\\\n            vec2 b = vec2(ceil(tex.x), floor(tex.y));\\\n            vec2 c = vec2(floor(tex.x), ceil(tex.y));\\\n            \\\n            vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\\\n            vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);\\\n            vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);\\\n            vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);\\\n            \\\n            float alen = length(TEX - A);\\\n            float blen = length(TEX - B);\\\n            float clen = length(TEX - C);\\\n            \\\n            vec2 choice;\\\n            if (alen < blen) {\\\n                if (alen < clen) choice = a;\\\n                else choice = c;\\\n            } else {\\\n                if (blen < clen) choice = b;\\\n                else choice = c;\\\n            }\\\n            \\\n            choice.x += choice.y * 0.5;\\\n            choice.y *= 0.866025404;\\\n            choice *= scale / texSize;\\\n            gl_FragColor = texture2D(texture, choice + center / texSize);\\\n        }\\\n    ', 'hexagonalPixelate');\n\n        simpleShader.call(this, gl.hexagonalPixelate, {\n            center: [centerX, centerY],\n            scale: scale,\n            texSize: [this.width, this.height]\n        });\n\n        return this;\n    }\n\n// src/filters\\fun\\ink.script\n    /**\n     * @filter         Ink\n     * @description    Simulates outlining the image in ink by darkening edges stronger than a\n     *                 certain threshold. The edge detection value is the difference of two\n     *                 copies of the image, each blurred using a blur of a different radius.\n     * @param strength The multiplicative scale of the ink edges. Values in the range 0 to 1\n     *                 are usually sufficient, where 0 doesn't change the image and 1 adds lots\n     *                 of black edges. Negative strength values will create white ink edges\n     *                 instead of black ones.\n     */\n    function ink(strength) {\n        gl.ink = gl.ink || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float strength;\\\n        uniform vec2 texSize;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec2 dx = vec2(1.0 / texSize.x, 0.0);\\\n            vec2 dy = vec2(0.0, 1.0 / texSize.y);\\\n            vec4 color = texture2D(texture, texCoord);\\\n            float bigTotal = 0.0;\\\n            float smallTotal = 0.0;\\\n            vec3 bigAverage = vec3(0.0);\\\n            vec3 smallAverage = vec3(0.0);\\\n            for (float x = -2.0; x <= 2.0; x += 1.0) {\\\n                for (float y = -2.0; y <= 2.0; y += 1.0) {\\\n                    vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;\\\n                    bigAverage += sample;\\\n                    bigTotal += 1.0;\\\n                    if (abs(x) + abs(y) < 2.0) {\\\n                        smallAverage += sample;\\\n                        smallTotal += 1.0;\\\n                    }\\\n                }\\\n            }\\\n            vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);\\\n            gl_FragColor = vec4(color.rgb - dot(edge, edge) * strength * 100000.0, color.a);\\\n        }\\\n    ', 'ink');\n\n        simpleShader.call(this, gl.ink, {\n            strength: strength * strength * strength * strength * strength,\n            texSize: [this.width, this.height]\n        });\n\n        return this;\n    }\n\n// src/filters\\warp\\bulgepinch.script\n    /**\n     * @filter         Bulge / Pinch\n     * @description    Bulges or pinches the image in a circle.\n     * @param centerX  The x coordinate of the center of the circle of effect.\n     * @param centerY  The y coordinate of the center of the circle of effect.\n     * @param radius   The radius of the circle of effect.\n     * @param strength -1 to 1 (-1 is strong pinch, 0 is no effect, 1 is strong bulge)\n     */\n    function bulgePinch(centerX, centerY, radius, strength) {\n        gl.bulgePinch = gl.bulgePinch || warpShader('\\\n        uniform float radius;\\\n        uniform float strength;\\\n        uniform vec2 center;\\\n    ', '\\\n        coord -= center;\\\n        float distance = length(coord);\\\n        if (distance < radius) {\\\n            float percent = distance / radius;\\\n            if (strength > 0.0) {\\\n                coord *= mix(1.0, smoothstep(0.0, radius / distance, percent), strength * 0.75);\\\n            } else {\\\n                coord *= mix(1.0, pow(percent, 1.0 + strength * 0.75) * radius / distance, 1.0 - percent);\\\n            }\\\n        }\\\n        coord += center;\\\n    ');\n\n        simpleShader.call(this, gl.bulgePinch, {\n            radius: radius,\n            strength: clamp(-1, strength, 1),\n            center: [centerX, centerY],\n            texSize: [this.width, this.height]\n        });\n\n        return this;\n    }\n\n// src/filters\\warp\\matrixwarp.script\n    /**\n     * @filter                Matrix Warp\n     * @description           Transforms an image by a 2x2 or 3x3 matrix. The coordinates used in\n     *                        the transformation are (x, y) for a 2x2 matrix or (x, y, 1) for a\n     *                        3x3 matrix, where x and y are in units of pixels.\n     * @param matrix          A 2x2 or 3x3 matrix represented as either a list or a list of lists.\n     *                        For example, the 3x3 matrix [[2,0,0],[0,3,0],[0,0,1]] can also be\n     *                        represented as [2,0,0,0,3,0,0,0,1] or just [2,0,0,3].\n     * @param inverse         A boolean value that, when true, applies the inverse transformation\n     *                        instead. (optional, defaults to false)\n     * @param useTextureSpace A boolean value that, when true, uses texture-space coordinates\n     *                        instead of screen-space coordinates. Texture-space coordinates range\n     *                        from -1 to 1 instead of 0 to width - 1 or height - 1, and are easier\n     *                        to use for simple operations like flipping and rotating.\n     */\n    function matrixWarp(matrix, inverse, useTextureSpace) {\n        gl.matrixWarp = gl.matrixWarp || warpShader('\\\n        uniform mat3 matrix;\\\n        uniform bool useTextureSpace;\\\n    ', '\\\n        if (useTextureSpace) coord = coord / texSize * 2.0 - 1.0;\\\n        vec3 warp = matrix * vec3(coord, 1.0);\\\n        coord = warp.xy / warp.z;\\\n        if (useTextureSpace) coord = (coord * 0.5 + 0.5) * texSize;\\\n    ');\n\n        // Flatten all members of matrix into one big list\n        matrix = Array.prototype.concat.apply([], matrix);\n\n        // Extract a 3x3 matrix out of the arguments\n        if (matrix.length == 4) {\n            matrix = [\n                matrix[0], matrix[1], 0,\n                matrix[2], matrix[3], 0,\n                0, 0, 1\n            ];\n        } else if (matrix.length != 9) {\n            throw 'can only warp with 2x2 or 3x3 matrix';\n        }\n\n        simpleShader.call(this, gl.matrixWarp, {\n            matrix: inverse ? getInverse(matrix) : matrix,\n            texSize: [this.width, this.height],\n            useTextureSpace: useTextureSpace | 0\n        });\n\n        return this;\n    }\n\n// src/filters\\warp\\perspective.script\n    /**\n     * @filter       Perspective\n     * @description  Warps one quadrangle to another with a perspective transform. This can be used to\n     *               make a 2D image look 3D or to recover a 2D image captured in a 3D environment.\n     * @param before The x and y coordinates of four points before the transform in a flat list. This\n     *               would look like [ax, ay, bx, by, cx, cy, dx, dy] for four points (ax, ay), (bx, by),\n     *               (cx, cy), and (dx, dy).\n     * @param after  The x and y coordinates of four points after the transform in a flat list, just\n     *               like the other argument.\n     */\n    function perspective(before, after) {\n        let a = getSquareToQuad.apply(null, after);\n        let b = getSquareToQuad.apply(null, before);\n        let c = multiply(getInverse(a), b);\n        return this.matrixWarp(c);\n    }\n\n// src/filters\\warp\\swirl.script\n    /**\n     * @filter        Swirl\n     * @description   Warps a circular region of the image in a swirl.\n     * @param centerX The x coordinate of the center of the circular region.\n     * @param centerY The y coordinate of the center of the circular region.\n     * @param radius  The radius of the circular region.\n     * @param angle   The angle in radians that the pixels in the center of\n     *                the circular region will be rotated by.\n     */\n    function swirl(centerX, centerY, radius, angle) {\n        gl.swirl = gl.swirl || warpShader('\\\n        uniform float radius;\\\n        uniform float angle;\\\n        uniform vec2 center;\\\n    ', '\\\n        coord -= center;\\\n        float distance = length(coord);\\\n        if (distance < radius) {\\\n            float percent = (radius - distance) / radius;\\\n            float theta = percent * percent * angle;\\\n            float s = sin(theta);\\\n            float c = cos(theta);\\\n            coord = vec2(\\\n                coord.x * c - coord.y * s,\\\n                coord.x * s + coord.y * c\\\n            );\\\n        }\\\n        coord += center;\\\n    ');\n\n        simpleShader.call(this, gl.swirl, {\n            radius: radius,\n            center: [centerX, centerY],\n            angle: angle,\n            texSize: [this.width, this.height]\n        });\n\n        return this;\n    }\n\n    /**\n     * @filter        Invert\n     * @description   Inverts color of each pixel\n     */\n    function invert() {\n        gl.invert = gl.invert || new Shader(null, '\\\n    uniform sampler2D texture;\\\n    uniform vec2 texSize;\\\n    varying vec2 texCoord;\\\n    \\\n    void main() {\\\n        vec4 color = texture2D(texture, texCoord);\\\n        color.rgb = 1.0 - color.rgb;\\\n        gl_FragColor = color;\\\n    }\\\n', 'invert');\n\n        simpleShader.call(this, gl.invert, {\n            texSize: [this.width, this.height]\n        });\n\n        return this;\n    }\n\n    /**\n     * @filter        multiplyAlpha\n     * @description   applies alpha multiply\n     */\n    function multiplyAlpha() {\n        gl.multiplyAlpha = gl.multiplyAlpha || new Shader(null, '\\\n    uniform sampler2D texture;\\\n    uniform vec2 texSize;\\\n    varying vec2 texCoord;\\\n    \\\n    void main() {\\\n        vec4 color = texture2D(texture, texCoord);\\\n        color.rgb *= color.a;\\\n        gl_FragColor = color;\\\n    }\\\n', 'multiplyAlpha');\n\n        simpleShader.call(this, gl.multiplyAlpha, {\n            texSize: [this.width, this.height]\n        });\n\n        return this;\n    }\n\n    /**\n     * @filter        unmultiplyAlpha\n     * @description   reverses alpha multiply\n     */\n    function unmultiplyAlpha() {\n        gl.unmultiplyAlpha = gl.unmultiplyAlpha || new Shader(null, '\\\n    uniform sampler2D texture;\\\n    uniform vec2 texSize;\\\n    varying vec2 texCoord;\\\n    \\\n    void main() {\\\n        vec4 color = texture2D(texture, texCoord);\\\n        if(color.a > 0.0) {\\\n            color.rgb /= color.a;\\\n        }\\\n        gl_FragColor = color;\\\n    }\\\n', 'unmultiplyAlpha');\n\n        simpleShader.call(this, gl.unmultiplyAlpha, {\n            texSize: [this.width, this.height]\n        });\n\n        return this;\n    }\n\n    /**\n     * @filter        To Alpha\n     * @description   Generates alpha channel from luminance (r+g+b)\n     * @param isInverted    boolean - invert luminance\n     * @param replaceRGBA    rgba - color to replace rgb with. if a = 0 -> keep orig color\n     */\n    function toAlpha(isInverted, replaceRGBA) {\n        gl.toAlpha = gl.toAlpha || new Shader(null, '\\\n    uniform bool isInverted;\\\n    uniform vec4 replace;\\\n    uniform sampler2D texture;\\\n    uniform vec2 texSize;\\\n    varying vec2 texCoord;\\\n    \\\n    void main() {\\\n        vec4 color = texture2D(texture, texCoord);\\\n        float alpha = (color.r + color.g + color.b) / 3.0;\\\n        if (isInverted) alpha = 1.0 - alpha;\\\n        alpha = min(color.a, alpha);\\\n        if (replace.a > 0.0) color = replace;\\\n        gl_FragColor = vec4(color.r, color.g, color.b, alpha);\\\n    }\\\n', 'toAlpha');\n\n        simpleShader.call(this, gl.toAlpha, {\n            isInverted: isInverted ? 1 : 0,\n            replace: replaceRGBA ? [replaceRGBA.r / 255, replaceRGBA.g / 255, replaceRGBA.b / 255, replaceRGBA.a] : [0, 0, 0, 0],\n            texSize: [this.width, this.height]\n        });\n\n        return this;\n    }\n\n    /**\n     * @filter        Distort\n     * @description   Distorts image (moves pixels around)\n     */\n    function distort(settings: {\n        stepSize: number; // [1, inf]\n        distortType: 0 | 1 | 2;\n        scale: { x: number; y: number };\n        strength: { x: number; y: number };\n        phase: { x: number; y: number };\n    }) {\n        gl.distort = gl.distort || warpShader('\\\n        uniform float stepSize;\\\n        uniform vec2 scale;\\\n        uniform vec2 strength;\\\n        uniform vec2 phase;\\\n        uniform float type;\\\n        ', '\\\n        const float PI = 3.14159265;\\\n        float x = coord.x;\\\n        float y = coord.y;\\\n        if (stepSize > 1.0) {\\\n            x = floor(x / stepSize) * stepSize;\\\n            y = floor(y / stepSize) * stepSize;\\\n        }\\\n        float distortX = sin((x/scale.x + phase.x) * PI * 2.0) * strength.x;\\\n        float distortY = sin((y/scale.y + phase.y) * PI * 2.0) * strength.y;\\\n        if (type == 0.0) {\\\n            coord.y += distortX;\\\n            coord.x += distortY;\\\n        } else if (type == 1.0) {\\\n            coord.x += distortX;\\\n            coord.y += distortY;\\\n        } else if (type == 2.0) {\\\n            gl_FragColor = texture2D(texture, vec2(x, y) / texSize);\\\n            coord.y += sin(gl_FragColor.r/scale.x*200.0 + phase.x * PI * 2.0) * strength.x;\\\n            coord.x += cos(gl_FragColor.g/scale.y*200.0 + phase.y * PI * 2.0) * strength.y;\\\n        }\\\n        coord.x = mod(coord.x, texSize.x);\\\n        coord.y = mod(coord.y, texSize.y);\\\n        \\\n        ');\n\n        simpleShader.call(this, gl.distort, {\n            stepSize: settings.stepSize,\n            type: settings.distortType,\n            scale: [settings.scale.x, settings.scale.y],\n            strength: [settings.strength.x, settings.strength.y],\n            phase: [settings.phase.x, settings.phase.y],\n            texSize: [this.width, this.height]\n        });\n\n        return this;\n    }\n\n    return exports;\n})();\n","uniform sampler2D texture;\nvarying vec2 texCoord;\nuniform vec2 texSize;\n\nuniform float seed;\nuniform float type;\nuniform vec2 scale;\nuniform vec2 offset;\nuniform float octaves;\nuniform float samples;\n\nuniform float peaks;\nuniform float contrast;\nuniform float brightness;\nuniform float isReversed;\n\nuniform vec3 colA;\nuniform vec3 colB;\n\nuniform float channels; // 0 - rgb, 1 - alpha\n\n// fbm, cellular_noise based on\n// https://github.com/Gonkee/Gonkees-Shaders\n// MIT, Copyright © Gonkee\n\n// hash & simplex based on\n// https://www.shadertoy.com/view/Msf3WH\n// MIT, Copyright © 2013 Inigo Quilez\n// https://www.youtube.com/c/InigoQuilez\n// https://iquilezles.org\n\n\n\nfloat rand(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nfloat value_noise(vec2 coord){\n    return rand(floor(coord) / 100.0);\n}\n\nfloat cellular_noise(vec2 coord) {\n    vec2 i = floor(coord);\n    vec2 f = fract(coord);\n\n    float min_dist = 99999.0;\n    for (float x = -1.0; x <= 1.0; x++) {\n        for (float y = -1.0; y <= 1.0; y++) {\n            vec2 node = rand(i + vec2(x, y)) + vec2(x, y);\n            float dist = sqrt((f - node).x * (f - node).x + (f - node).y * (f - node).y);\n            min_dist = min(min_dist, dist);\n        }\n    }\n    return min_dist;\n}\n\n// ---------- Simplex Alternative _--------------------\n\nvec3 hash(vec3 p)\n{ p=vec3(dot(p, vec3(127.1, 311.7, 74.7))\n, dot(p, vec3(269.5, 183.3, 246.1))\n, dot(p, vec3(113.5, 271.9, 124.6)))\n;return fract(sin(p)*43758.5453123)*2.-1.; }\n\nmat3 hash(mat3 p)\n{ return mat3(hash(p[0]), hash(p[1]), hash(p[2])); }\n\nvec3 dots(mat3 a, vec3 w, mat3 b){ return vec3\n(dot(a[0], w-b[0]), dot(a[1], w-b[1]), dot(a[2], w-b[2])); }\n\n//return noiseGra13dx as .x, and its derivatives as .yzw\n// https://www.shadertoy.com/view/llByD1\nvec3 noiseGra13dx(in vec3 x) {\n    vec3 p=floor(x), w=fract(x)\n    #if 1\n    , u=w*w*w*(w*(w*6.-15.)+10.), v=30.*w*w*(w*(w-2.)+1.)//quintic hermite\n    #else\n    , u=w*w*(3.-2.*w), v=6.*w*(1.-w)//cubic hermite\n    #endif\n    //gradients\n    , G=hash(p+vec3(0)), F=hash(p+vec3(1))\n    ;mat3 D=hash(mat3(p, p, p)+mat3(1)), E=hash(mat3(p, p, p)+1.-mat3(1));\n    //projections\n    vec3 d=dots(D, w, mat3(1)), e=dots(E, w, 1.-mat3(1));\n    //interpolations\n    float g=dot(G, w), f=dot(F, w-vec3(1));\n    vec3 h=u.yzx*(g-d.xyx-d.yzz+e.zxy)+d-g, U=u*h, a=d-e;\n    mat3 S=D-mat3(G, G, G), W=D-E;\n    a.x=(a.x+a.y+a.z)+f-g;\n    ;float b=u.x*u.y*u.z;\n\n    vec4 result = vec4(g+U.x+U.y+U.z+a.x*b// value\n    , G*(1.-b)+b*(W[0]+W[1]+W[2]+F)//https://www.shadertoy.com/view/llByD1\n    +u.x*(S[0]+u.y*(G-D[0]-D[1]+E[2]))// derivatives\n    +u.y*(S[1]+u.z*(G-D[1]-D[2]+E[0]))\n    +u.z*(S[2]+u.x*(G-D[0]-D[2]+E[1]))\n    +v*(u.zxy*(g-d.xxy-d.zyz+e.yzx)+h+u.yzx*u.zxy*a.x));\n    return 0.5 + 0.5 * result.xxx;\n}\n\nfloat fbm(vec2 coord) {\n    float normalize_factor = 0.0;\n    float value = 0.0;\n    float scale = 0.5;\n\n    for (float i = 0.0; i < 7.0; i++){\n        if (i < octaves) {\n            if (type == 0.0) {\n                value += value_noise(coord) * scale;\n            } else if (type == 1.0) {\n                value += noiseGra13dx(vec3(coord.x, coord.y, 0.0)).r * scale;\n            } else if (type == 2.0) {\n                value += cellular_noise(coord) * scale;\n            }\n            normalize_factor += scale;\n            coord *= 2.0;\n            scale *= 0.5;\n        }\n    }\n    return value / normalize_factor;\n}\n\nfloat render (vec2 pos) {\n    float result = fbm(pos);\n    //\n\n    if (peaks > 0.0) {\n        result = abs(mod(result * peaks - 0.5, 1.0) - 0.5) * 2.0;// triangle\n        //result = mod(result * (peaks + 1.0), 1.0); // sawtooth\n    }\n\n    result += brightness;\n    if (contrast > 0.0) {\n        result = clamp((result - 0.5) / (1.0 - contrast) + 0.5, 0.0, 1.0);\n    } else if (contrast < 0.0) {\n        result = clamp((result - 0.5) * (1.0 + contrast) + 0.5, 0.0, 1.0);\n    }\n\n    if (isReversed == 1.0) {\n        result = 1.0 - result;\n    }\n    return result;\n}\n\n\nvoid main() {\n    vec4 color;\n\n    vec2 seedOffset;\n    seedOffset.x = (rand(vec2(seed, 0.0)) * 100.0 - 50.0);\n    seedOffset.y = (rand(vec2(0.0, seed)) * 100.0 - 50.0);\n\n    float val = 0.0;\n    vec2 basePos = texCoord * texSize / scale - offset / scale + seedOffset;\n\n    if (samples == 1.0) {\n        val = render(basePos);\n\n    }/* else if (samples == 4.0) {\n        for (float i = 0.0; i < 2.0; i++) {\n            for (float e = 0.0; e < 2.0; e++) {\n                val += render(basePos + (vec2(i, e) - 0.5) * 0.5 / scale);\n            }\n        }\n        val /= 4.0;\n\n    }*/ else if (samples == 16.0) {\n        for (float i = 0.0; i < 4.0; i++) {\n            for (float e = 0.0; e < 4.0; e++) {\n                val += render(basePos + (vec2(i, e) - 0.25) * 0.25 / scale);\n            }\n        }\n        val /= 16.0;\n    }\n\n    if (channels == 0.0) {\n        gl_FragColor = vec4(vec3(mix(colA, colB, val)), 1.0);\n    } else {\n        gl_FragColor = vec4(vec3(1.0), val);\n    }\n}","import {BB} from '../../bb/bb';\nimport {input} from '../ui/base-components/input';\nimport {Checkbox} from '../ui/base-components/checkbox';\nimport {ColorOptions} from '../ui/base-components/color-options';\nimport {Cropper} from '../ui/components/cropper';\nimport {IFilterApply, IFilterGetDialogParam} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const filterCropExtend = {\n\n    getDialog(params: IFilterGetDialogParam) {\n        const klCanvas = params.klCanvas;\n        if (!klCanvas)\n            return false;\n        const tempCanvas = BB.canvas();\n        {\n            let fit = BB.fitInto(klCanvas.getWidth(), klCanvas.getHeight(), 560, 400, 1);\n            let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n            let previewFactor = w / klCanvas.getWidth();\n            tempCanvas.width = w;\n            tempCanvas.height = h;\n            tempCanvas.style.display = 'block';\n            tempCanvas.getContext(\"2d\").drawImage(klCanvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\n        }\n\n        const div = document.createElement(\"div\");\n        const result: any = {\n            element: div\n        };\n        div.innerHTML = LANG('filter-crop-description') + \"<br/><br/>\";\n        let left = 0, right = 0, top = 0, bottom = 0;\n        let leftChanged = false, rightChanged = false, topChanged = false, bottomChanged = false;\n        const maxWidth = params.maxWidth, maxHeight = params.maxHeight;\n        let scale;\n\n\n\n        // --- input elements ---\n\n        const lrWrapper = BB.el({\n            css: {lineHeight: '30px', height: '35px'}\n        });\n        const tbWrapper = BB.el({\n            css: {lineHeight: '30px', height: '35px'}\n        });\n        div.appendChild(lrWrapper);\n        div.appendChild(tbWrapper);\n\n        const leftInput = input({\n            init: 0,\n            type: 'number',\n            min: -klCanvas.getWidth(),\n            max: maxWidth,\n            css: {width: '75px', marginRight: '20px'},\n            callback: function(v) {\n                leftChanged = true;\n                updateInput();\n            }\n        });\n        const rightInput = input({\n            init: 0,\n            type: 'number',\n            min: -klCanvas.getWidth(),\n            max: maxWidth,\n            css: {width: '75px'},\n            callback: function(v) {\n                rightChanged = true;\n                updateInput();\n            }\n        });\n        const topInput = input({\n            init: 0,\n            type: 'number',\n            min: -klCanvas.getHeight(),\n            max: maxHeight,\n            css: {width: '75px', marginRight: '20px'},\n            callback: function(v) {\n                topChanged = true;\n                updateInput();\n            }\n        });\n        const bottomInput = input({\n            init: 0,\n            type: 'number',\n            min: -klCanvas.getHeight(),\n            max: maxHeight,\n            css: {width: '75px'},\n            callback: function(v) {\n                bottomChanged = true;\n                updateInput();\n            }\n        });\n\n        const labelStyle = {\n            display: 'inline-block',\n            width: '60px'\n        };\n        lrWrapper.append(\n            BB.el({content: LANG('filter-crop-left') + ':', css: labelStyle}),\n            leftInput,\n            BB.el({content: LANG('filter-crop-right') + ':', css: labelStyle}),\n            rightInput\n        );\n        tbWrapper.append(\n            BB.el({content: LANG('filter-crop-top') + ':', css: labelStyle}),\n            topInput,\n            BB.el({content: LANG('filter-crop-bottom') + ':', css: labelStyle}),\n            bottomInput\n        );\n\n        function updateInput() {\n            left = parseInt(leftInput.value);\n            right = parseInt(rightInput.value);\n            top = parseInt(topInput.value);\n            bottom = parseInt(bottomInput.value);\n            let newWidth = klCanvas.getWidth() + left + right;\n            let newHeight = klCanvas.getHeight() + top + bottom;\n\n            if (newWidth <= 0) {\n                if (leftChanged) {\n                    left = -klCanvas.getWidth() - right + 1;\n                    leftInput.value = '' + left;\n                }\n                if (rightChanged) {\n                    right = -klCanvas.getWidth() - left + 1;\n                    rightInput.value = '' + right;\n                }\n                newWidth = 1;\n            }\n            if (newWidth > maxWidth) {\n                if (leftChanged) {\n                    left = -klCanvas.getWidth() - right + maxWidth;\n                    leftInput.value = '' + left;\n                }\n                if (rightChanged) {\n                    right = -klCanvas.getWidth() - left + maxWidth;\n                    rightInput.value = '' + right;\n                }\n                newWidth = maxWidth;\n            }\n            if (newHeight <= 0) {\n                if (topChanged) {\n                    top = -klCanvas.getHeight() - bottom + 1;\n                    topInput.value = '' + top;\n                }\n                if (bottomChanged) {\n                    bottom = -klCanvas.getHeight() - top + 1;\n                    bottomInput.value = '' + bottom;\n                }\n                newHeight = 1;\n            }\n            if (newHeight > maxHeight) {\n                if (topChanged) {\n                    top = -klCanvas.getHeight() - bottom + maxHeight;\n                    topInput.value = '' + top;\n                }\n                if (bottomChanged) {\n                    bottom = -klCanvas.getHeight() - top + maxHeight;\n                    bottomInput.value = '' + bottom;\n                }\n                newHeight = maxHeight;\n            }\n            cropper.setTransform({\n                x: -left,\n                y: -top,\n                width: newWidth,\n                height: newHeight\n            });\n\n\n            leftChanged = false;\n            rightChanged = false;\n            topChanged = false;\n            bottomChanged = false;\n        }\n\n        let useRuleOfThirds = true;\n        let ruleOThirdsCheckbox = new Checkbox({\n            init: true,\n            label: LANG('filter-crop-rule-thirds'),\n            allowTab: true,\n            callback: function(b) {\n                useRuleOfThirds = b;\n                cropper.showThirds(useRuleOfThirds);\n            }\n        });\n        div.appendChild(BB.el({\n            css: {\n                clear: 'both'\n            }\n        }));\n\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 0};\n        const colorOptionsArr = [\n            {r: 0, g: 0, b: 0, a: 0},\n            {r: 255, g: 255, b: 255, a: 1},\n            {r: 0, g: 0, b: 0, a: 1}\n        ];\n        colorOptionsArr.push({\n            r: params.currentColorRgb.r,\n            g: params.currentColorRgb.g,\n            b: params.currentColorRgb.b,\n            a: 1,\n        });\n        colorOptionsArr.push({\n            r: params.secondaryColorRgb.r,\n            g: params.secondaryColorRgb.g,\n            b: params.secondaryColorRgb.b,\n            a: 1,\n        });\n\n        const colorOptions = new ColorOptions({\n            label: LANG('filter-crop-fill'),\n            colorArr: colorOptionsArr,\n            onChange: function(rgbaObj) {\n                selectedRgbaObj = rgbaObj;\n                updateBg(rgbaObj);\n            }\n        });\n\n\n        const flexRow = BB.el({\n            css: {\n                display: 'flex',\n                justifyContent: 'space-between'\n            }\n        });\n        div.appendChild(flexRow);\n        flexRow.appendChild(ruleOThirdsCheckbox.getElement());\n        flexRow.appendChild(colorOptions.getElement());\n\n\n        // when input field changed, or dragging in preview finished\n        // adjusts the zoom\n        function update(transform) {\n            const fit = BB.fitInto(transform.width, transform.height, 260, 180, 1);\n            scale = fit.width / transform.width;\n\n            const offset = BB.centerWithin(340, 220, fit.width, fit.height);\n\n            tempCanvas.style.width = klCanvas.getWidth() * scale + \"px\";\n            tempCanvas.style.height = klCanvas.getHeight() * scale + \"px\";\n\n            offsetWrapper.style.left = (offset.x - transform.x * scale) + \"px\";\n            offsetWrapper.style.top = (offset.y - transform.y * scale) + \"px\";\n\n            left = parseInt('' + -transform.x);\n            top = parseInt('' + -transform.y);\n            right = parseInt('' + (transform.x + transform.width - klCanvas.getWidth()));\n            bottom = parseInt('' + (transform.y + transform.height - klCanvas.getHeight()));\n            leftInput.value = '' + left;\n            topInput.value = '' + top;\n            rightInput.value = '' + right;\n            bottomInput.value = '' + bottom;\n\n            BB.createCheckerDataUrl(parseInt('' + (50 * scale)), function (url) {\n                previewWrapper.style.background = \"url(\" + url + \")\";\n                if (selectedRgbaObj.a !== 0) {\n                    tempCanvas.style.background = \"url(\" + url + \")\";\n                }\n            });\n            previewWrapper.style.backgroundPosition = (offset.x) + \"px \" + (offset.y) + \"px\";\n\n            cropper.setScale(scale);\n        }\n\n        const previewWrapper = BB.el({\n            css: {\n                width: \"340px\",\n                marginTop: '10px',\n                marginLeft: \"-20px\",\n                height: \"220px\",\n                backgroundColor: \"#9e9e9e\",\n                position: \"relative\",\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n                overflow: \"hidden\",\n                userSelect: 'none',\n                colorScheme: 'only light',\n                touchAction: 'none',\n            }\n        });\n        previewWrapper.oncontextmenu = function () {\n            return false;\n        };\n        const bgColorOverlay = BB.el({\n            css: {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n                bottom: '0',\n                right: '0'\n            }\n        });\n        previewWrapper.appendChild(bgColorOverlay);\n\n        const offsetWrapper = document.createElement(\"div\");\n        offsetWrapper.style.position = \"absolute\";\n        offsetWrapper.style.left = \"0px\";\n        offsetWrapper.style.top = \"0px\";\n        previewWrapper.appendChild(offsetWrapper);\n\n\n        const canvasWrapper = BB.appendTextDiv(offsetWrapper, \"\");\n        canvasWrapper.appendChild(tempCanvas);\n        //tempCanvas.style.width = w + \"px\";\n        //tempCanvas.style.height = h + \"px\";\n        tempCanvas.style.boxShadow = \"0 0 3px 1px rgba(0,0,0,0.5)\";\n        tempCanvas.style.position = \"absolute\";\n        tempCanvas.style.left = \"0px\";\n        tempCanvas.style.top = \"0px\";\n\n        div.appendChild(previewWrapper);\n        const cropper = new Cropper({\n            x: 0,\n            y: 0,\n            width: klCanvas.getWidth(),\n            height: klCanvas.getHeight(),\n            scale: scale,\n            callback: update,\n            maxW: maxWidth,\n            maxH: maxHeight\n        });\n        update(cropper.getTransform());\n        offsetWrapper.appendChild(cropper.getElement());\n\n        function updateBg(rgbaObj) {\n\n            let borderColor;\n            if (rgbaObj.a === 0) {\n                borderColor = 'rgba(0,0,0,0.5)';\n                bgColorOverlay.style.background = '';\n                tempCanvas.style.background = '';\n            } else {\n                borderColor = (rgbaObj.r + rgbaObj.g + rgbaObj.b < 255 * 3 / 2) ? 'rgba(255,255,255,0.5)' : 'rgba(0,0,0,0.5)'\n                bgColorOverlay.style.background = BB.ColorConverter.toRgbStr(rgbaObj);\n\n                BB.createCheckerDataUrl(parseInt('' + (50 * scale)), function (url) {\n                    tempCanvas.style.background = \"url(\" + url + \")\";\n                });\n            }\n            tempCanvas.style.boxShadow = \"0 0 3px 1px \" + borderColor;\n        }\n\n        result.destroy = () => {\n            cropper.destroy();\n            ruleOThirdsCheckbox.destroy();\n        };\n        result.getInput = function () {\n            result.destroy();\n            return {\n                left: left,\n                right: right,\n                top: top,\n                bottom: bottom,\n                fillColor: selectedRgbaObj.a === 0 ? null : selectedRgbaObj\n            };\n        };\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        const klCanvas = params.klCanvas;\n        const history = params.history;\n        if (!klCanvas || !history || isNaN(params.input.left) || isNaN(params.input.right) || isNaN(params.input.top) || isNaN(params.input.bottom)) {\n            return false;\n        }\n        history.pause(true);\n        klCanvas.resizeCanvas(params.input);\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"cropExtend\"],\n            action: \"apply\",\n            params: [{\n                input: JSON.parse(JSON.stringify(params.input))\n            }]\n        });\n        return true;\n    }\n\n};","import {BB} from '../../bb/bb';\nimport {Options} from '../ui/base-components/options';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\nimport {getSharedFx} from './shared-gl-fx';\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const filterCurves = {\n\n    getDialog(params: IFilterGetDialogParam) {\n\n        let context = params.context;\n        let klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        let layers = klCanvas.getLayers();\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n\n        let tempCanvas = BB.canvas(w, h);\n        {\n            const ctx = tempCanvas.getContext(\"2d\");\n            ctx.save();\n            if (tempCanvas.width > context.canvas.width) {\n                ctx.imageSmoothingEnabled = false;\n            }\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            ctx.restore();\n        }\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div,\n        };\n        let klCanvasPreview;\n\n        function finishInit() {\n\n            let previewFactor = w / context.canvas.width;\n            let brightness = 0, contrast = 0;\n\n            div.innerHTML = LANG('filter-curves-description') + \"<br/><br/>\";\n\n            let curves = {\n                r: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\n                g: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\n                b: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\n            };\n\n            let glCanvas = getSharedFx();\n            if (!glCanvas) {\n                return; // todo throw?\n            }\n            let texture = glCanvas.texture(tempCanvas);\n            glCanvas.draw(texture).update(); // update glCanvas size\n\n            function update() {\n                try {\n                    glCanvas.draw(texture).curves(curves.r, curves.g, curves.b).update();\n                    if (klCanvasPreview) {\n                        klCanvasPreview.render();\n                    }\n                } catch(e) {\n                    (div as any).errorCallback(e);\n                }\n            }\n\n            let modeButtons;\n\n            function CurvesInput(p) {\n                let div = document.createElement(\"div\");\n                div.oncontextmenu = function () {\n                    return false;\n                };\n                div.style.position = \"relative\";\n                div.style.marginBottom = \"10px\";\n                let mode = \"All\";\n                let curves = p.curves;\n                modeButtons = new Options( {\n                    optionArr: [\n                        {\n                            id: 'All',\n                            label: LANG('filter-curves-all')\n                        },\n                        {\n                            id: 'Red',\n                            label: LANG('red')\n                        },\n                        {\n                            id: 'Green',\n                            label: LANG('green')\n                        },\n                        {\n                            id: 'Blue',\n                            label: LANG('blue')\n                        },\n                    ],\n                    initialId: 'All',\n                    onChange: function(id) {\n                        mode = id;\n                        if (mode === \"All\") {\n                            curves = {\n                                r: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\n                                g: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\n                                b: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\n                            };\n                        }\n                        let curve = curves.r;\n                        if (mode === \"Green\") {\n                            curve = curves.g;\n                        }\n                        if (mode === \"Blue\") {\n                            curve = curves.b;\n                        }\n                        (p0 as any).setPos(0, areah - curve[0][1] * areah);\n                        (p1 as any).setPos(curve[1][0] * areaw, areah - curve[1][1] * areah);\n                        (p2 as any).setPos(curve[2][0] * areaw, areah - curve[2][1] * areah);\n                        (p3 as any).setPos(areaw, areah - curve[3][1] * areah);\n\n                        update();\n                    }\n                });\n                div.appendChild(modeButtons.getElement());\n\n                let curveArea = document.createElement(\"div\");\n                BB.css(curveArea, {\n                    position: 'relative',\n                    marginTop: '10px',\n                    colorScheme: 'only light',\n                })\n                div.appendChild(curveArea);\n\n                let areaw = 300, areah = 100;\n                let canvas = BB.canvas(areaw, areah);\n                BB.css(canvas, {\n                    background: \"#c6c6c6\",\n                    boxShadow: \"0 0 0 1px rgba(0,0,0,0.3)\"\n                });\n                let ctx = canvas.getContext(\"2d\");\n                curveArea.appendChild(canvas);\n\n                let points = {\n                    r: [],\n                    g: [],\n                    b: []\n                };\n\n                function fit(v) {\n                    return Math.max(0, Math.min(1, v));\n                }\n\n                function createPoint(x, y, callback, lock?) {\n                    let gripSize = 14;\n                    let internalY = y, internalX = x;\n                    let point = document.createElement(\"div\");\n                    BB.css(point, {\n                        position: \"absolute\",\n                        left: (x - gripSize / 2) + \"px\",\n                        top: (y - gripSize / 2) + \"px\",\n                        width: gripSize + \"px\",\n                        height: gripSize + \"px\",\n                        background: \"#fff\",\n                        cursor: \"move\",\n                        borderRadius: gripSize + \"px\",\n                        boxShadow: \"inset 0 0 0 2px #000\",\n                        userSelect: 'none',\n                        touchAction: 'none',\n                    });\n\n                    function update() {\n                        BB.css(point, {\n                            left: (x - gripSize / 2) + \"px\",\n                            top: (y - gripSize / 2) + \"px\"\n                        });\n                    }\n\n                    (point as any).pointerListener = new BB.PointerListener({\n                        target: point,\n                        maxPointers: 1,\n                        onPointer: function(event) {\n                            event.eventPreventDefault();\n                            if (event.type === 'pointerdown') {\n                                internalX = x;\n                                internalY = y;\n                            }\n                            if (event.button === 'left' && event.type === 'pointermove') {\n                                if (!lock) {\n                                    internalX += event.dX;\n                                }\n                                x = Math.max(0, Math.min(areaw, internalX));\n                                internalY += event.dY;\n                                y = Math.max(0, Math.min(areah, internalY));\n                                update();\n                                callback({\n                                    x: x,\n                                    y: y\n                                });\n                            }\n                        }\n                    });\n\n                    curveArea.appendChild(point);\n\n                    (point as any).setPos = function (newX, newY) {\n                        x = newX;\n                        y = newY;\n                        internalY = y;\n                        internalX = x;\n                        BB.css(point, {\n                            left: (x - gripSize / 2) + \"px\",\n                            top: (y - gripSize / 2) + \"px\"\n                        });\n                    };\n\n                    return point;\n                }\n\n                function updateControl(i, x, y) {\n                    if (mode === \"All\") {\n                        curves.r[i] = [fit(x / areaw), fit(1 - y / areah)];\n                        curves.g[i] = [fit(x / areaw), fit(1 - y / areah)];\n                        curves.b[i] = [fit(x / areaw), fit(1 - y / areah)];\n                    }\n                    if (mode === \"Red\") {\n                        curves.r[i] = [fit(x / areaw), fit(1 - y / areah)];\n                    }\n                    if (mode === \"Green\") {\n                        curves.g[i] = [fit(x / areaw), fit(1 - y / areah)];\n                    }\n                    if (mode === \"Blue\") {\n                        curves.b[i] = [fit(x / areaw), fit(1 - y / areah)];\n                    }\n                }\n\n                let p0 = createPoint(0, areah, function (val) {\n                    updateControl(0, val.x, val.y);\n                    update();\n                }, true);\n                let p1 = createPoint(areaw / 3, areah / 3 * 2, function (val) {\n                    updateControl(1, val.x, val.y);\n                    update();\n                });\n                let p2 = createPoint(areaw / 3 * 2, areah / 3, function (val) {\n                    updateControl(2, val.x, val.y);\n                    update();\n                });\n                let p3 = createPoint(areaw, 0, function (val) {\n                    updateControl(3, val.x, val.y);\n                    update();\n                }, true);\n\n\n                function update() {\n                    canvas.width = canvas.width;\n                    ctx = canvas.getContext(\"2d\");\n\n                    let outCurves = {\n                        r: [],\n                        g: [],\n                        b: []\n                    };\n                    for (let i = 0; i < curves.r.length; i++) {\n                        outCurves.r.push(curves.r[i]);\n                        outCurves.g.push(curves.g[i]);\n                        outCurves.b.push(curves.b[i]);\n                    }\n\n                    function drawCurve(curve) {\n                        ctx.beginPath();\n                        let spline = new BB.SplineInterpolator(curve);\n                        for (let i = 0; i < 100; i++) {\n                            let y = spline.interpolate(i / 100);\n                            y = Math.max(0, Math.min(1, y));\n\n                            if (i === 0) {\n                                ctx.moveTo(i / 100 * areaw, areah - y * areah);\n                            } else {\n                                ctx.lineTo(i / 100 * areaw, areah - y * areah);\n                            }\n                        }\n                        ctx.stroke();\n                    }\n\n                    ctx.save();\n                    if (mode === \"All\") {\n                        ctx.strokeStyle = \"black\";\n                        drawCurve(outCurves.r);\n                    } else {\n                        ctx.globalAlpha = 0.5;\n                        ctx.strokeStyle = \"red\";\n                        drawCurve(outCurves.r);\n                        ctx.strokeStyle = \"green\";\n                        drawCurve(outCurves.g);\n                        ctx.strokeStyle = \"blue\";\n                        drawCurve(outCurves.b);\n                    }\n                    ctx.restore();\n                    p.callback(outCurves);\n                }\n\n                update();\n\n\n                this.getDiv = function () {\n                    return div;\n                };\n                this.destroy = function() {\n                    (p0 as any).pointerListener.destroy();\n                    (p1 as any).pointerListener.destroy();\n                    (p2 as any).pointerListener.destroy();\n                    (p3 as any).pointerListener.destroy();\n                };\n            }\n\n            let input = new CurvesInput({\n                curves: curves,\n                callback: function (val) {\n                    curves = val;\n                    update();\n                }\n            });\n\n\n            div.appendChild(input.getDiv());\n\n\n\n            let previewWrapper = document.createElement(\"div\");\n            BB.css(previewWrapper, {\n                width: \"340px\",\n                marginLeft: \"-20px\",\n                height: \"220px\",\n                backgroundColor: \"#9e9e9e\",\n                marginTop: \"10px\",\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n                overflow: \"hidden\",\n                position: \"relative\",\n                userSelect: 'none',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                colorScheme: 'only light',\n            });\n\n            let previewLayerArr: IKlBasicLayer[] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr\n                    });\n                }\n            }\n            klCanvasPreview = new KlCanvasPreview({\n                width: parseInt('' + w),\n                height: parseInt('' + h),\n                layers: previewLayerArr\n            });\n\n            let previewInnerWrapper = BB.el({\n                css: {\n                    position: 'relative',\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                    width: parseInt('' + w) + 'px',\n                    height: parseInt('' + h) + 'px'\n                }\n            });\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\n            previewWrapper.appendChild(previewInnerWrapper);\n\n\n            div.appendChild(previewWrapper);\n\n            result.destroy = () => {\n                input.destroy();\n                texture.destroy();\n                modeButtons.destroy();\n            };\n            result.getInput = function () {\n                result.destroy();\n                return {\n                    curves: curves\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let curves = params.input.curves;\n        let history = params.history;\n        if (!context || curves === null || !history)\n            return false;\n        history.pause(true);\n        let glCanvas = getSharedFx();\n        if (!glCanvas) {\n            return false; // todo more specific error?\n        }\n        let texture = glCanvas.texture(context.canvas);\n        glCanvas.draw(texture).curves(curves.r, curves.g, curves.b).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(glCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"curves\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n\n        return true;\n    }\n\n\n};","import {BB} from '../../bb/bb';\nimport {Checkbox} from '../ui/base-components/checkbox';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\n// @ts-ignore\nimport checkmarkImg from 'url:~/src/app/img/ui/checkmark.svg';\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer, IMixMode} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const filterFlip = {\n\n    getDialog(params: IFilterGetDialogParam) {\n        let context = params.context;\n        let klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        let layers = klCanvas.getLayers();\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n        let isHorizontal = true;\n        let isVertical = false;\n        let doFlipCanvas = true;\n        div.innerHTML = LANG('filter-flip-description') + \"<br/><br/>\";\n\n\n        let horizontalCheckbox = new Checkbox({\n            init: isHorizontal,\n            label: LANG('filter-flip-horizontal') + ' ⟷',\n            allowTab: true,\n            callback: function(v) {\n                isHorizontal = v;\n                updatePreview();\n            },\n            css: {\n                marginBottom: '10px'\n            }\n        });\n        let verticalCheckbox = new Checkbox({\n            init: isVertical,\n            label: LANG('filter-flip-vertical') + ' ↕',\n            allowTab: true,\n            callback: function(v) {\n                isVertical = v;\n                updatePreview();\n            },\n            css: {\n                marginBottom: '10px'\n            }\n        });\n        div.appendChild(horizontalCheckbox.getElement());\n        div.appendChild(verticalCheckbox.getElement());\n\n\n\n\n\n        let fcOption = document.createElement(\"div\");\n        BB.setEventListener(fcOption, 'onpointerdown', function () {\n            return false;\n        });\n        fcOption.textContent = LANG('filter-flip-image');\n        fcOption.style.width = \"150px\";\n        fcOption.style.height = \"30px\";\n        fcOption.style.paddingTop = \"10px\";\n        fcOption.style.textAlign = \"center\";\n        fcOption.style.cssFloat = \"left\";\n        fcOption.style.paddingBottom = \"0px\";\n        fcOption.style.borderTopLeftRadius = \"10px\";\n        fcOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\n        fcOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\n        fcOption.style.backgroundSize = '8%';\n        fcOption.style.backgroundColor = \"#9e9e9e\";\n\n        let flOption = document.createElement(\"div\");\n        BB.setEventListener(flOption, 'onpointerdown', function () {\n            return false;\n        });\n        flOption.textContent = LANG('filter-flip-layer');\n        flOption.style.width = \"150px\";\n        flOption.style.height = \"30px\";\n        flOption.style.paddingTop = \"10px\";\n        flOption.style.textAlign = \"center\";\n        flOption.style.cssFloat = \"left\";\n        flOption.style.paddingBottom = \"0px\";\n        flOption.style.borderTopRightRadius = \"10px\";\n        flOption.style.cursor = \"pointer\";\n        flOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\n        flOption.style.backgroundSize = '8%';\n\n        BB.setEventListener(fcOption, 'onpointerover', function () {\n            if (doFlipCanvas === false)\n                fcOption.style.backgroundColor = \"#ccc\";\n        });\n        BB.setEventListener(fcOption, 'onpointerout', function () {\n            if (doFlipCanvas === false)\n                fcOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\n        });\n        BB.setEventListener(flOption, 'onpointerover', function () {\n            if (doFlipCanvas === true)\n                flOption.style.backgroundColor = \"#ccc\";\n        });\n        BB.setEventListener(flOption, 'onpointerout', function () {\n            if (doFlipCanvas === true)\n                flOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\n        });\n\n        fcOption.onclick = function () {\n            doFlipCanvas = true;\n\n            flOption.style.background = \"\";\n            flOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\n            flOption.style.boxShadow = \"\";\n            flOption.style.cursor = \"pointer\";\n\n            fcOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\n            fcOption.style.backgroundSize = '8%';\n            fcOption.style.backgroundColor = \"#9e9e9e\";\n            fcOption.style.cursor = \"default\";\n            fcOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\n\n            updatePreview();\n        };\n        flOption.onclick = function () {\n            doFlipCanvas = false;\n\n            fcOption.style.background = \"\";\n            fcOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\n            fcOption.style.boxShadow = \"\";\n            fcOption.style.cursor = \"pointer\";\n\n            flOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\n            flOption.style.backgroundSize = '8%';\n            flOption.style.backgroundColor = \"#9e9e9e\";\n            flOption.style.cursor = \"default\";\n            flOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\n\n            updatePreview();\n        };\n\n        let optionWrapper = document.createElement(\"div\");\n        optionWrapper.appendChild(fcOption);\n        optionWrapper.appendChild(flOption);\n        div.appendChild(optionWrapper);\n\n\n        let previewWrapper = document.createElement(\"div\");\n        BB.css(previewWrapper, {\n            width: \"340px\",\n            marginLeft: \"-20px\",\n            height: \"220px\",\n            backgroundColor: \"#9e9e9e\",\n            marginTop: \"10px\",\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n            overflow: \"hidden\",\n            position: \"relative\",\n            userSelect: 'none',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            colorScheme: 'only light',\n        });\n\n        let previewLayer: IKlBasicLayer = {\n            image: BB.canvas(Math.round(w), Math.round(h)),\n            opacity: 1,\n            mixModeStr: 'source-over' as IMixMode,\n        };\n        let klCanvasPreview = new KlCanvasPreview({\n            width: Math.round(w),\n            height: Math.round(h),\n            layers: [previewLayer]\n        });\n\n        let previewInnerWrapper = BB.el({\n            css: {\n                position: 'relative',\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                width: parseInt('' + w) + 'px',\n                height: parseInt('' + h) + 'px'\n            }\n        });\n        previewInnerWrapper.appendChild(klCanvasPreview.getElement());\n        previewWrapper.appendChild(previewInnerWrapper);\n\n        function updatePreview() {\n            let ctx = (previewLayer.image as HTMLCanvasElement).getContext('2d');\n            ctx.save();\n            ctx.clearRect(0, 0, previewLayer.image.width, previewLayer.image.height);\n\n            if (doFlipCanvas) {\n                if (isHorizontal) {\n                    ctx.translate(previewLayer.image.width, 0);\n                    ctx.scale(-1, 1);\n                }\n                if (isVertical) {\n                    ctx.translate(0, previewLayer.image.height);\n                    ctx.scale(1, -1);\n                }\n            }\n\n            for (let i = 0; i < layers.length; i++) {\n                ctx.save();\n                if (!doFlipCanvas && selectedLayerIndex === i) {\n                    if (isHorizontal) {\n                        ctx.translate(previewLayer.image.width, 0);\n                        ctx.scale(-1, 1);\n                    }\n                    if (isVertical) {\n                        ctx.translate(0, previewLayer.image.height);\n                        ctx.scale(1, -1);\n                    }\n                }\n                if (ctx.canvas.width > layers[i].context.canvas.width) {\n                    ctx.imageSmoothingEnabled = false;\n                }\n                ctx.globalAlpha = layers[i].opacity;\n                ctx.globalCompositeOperation = layers[i].mixModeStr;\n                ctx.drawImage(layers[i].context.canvas, 0, 0, previewLayer.image.width, previewLayer.image.height);\n                ctx.restore();\n            }\n            klCanvasPreview.render();\n            ctx.restore();\n        }\n        setTimeout(updatePreview, 0);\n\n\n        div.appendChild(previewWrapper);\n        result.destroy = () => {\n            horizontalCheckbox.destroy();\n            verticalCheckbox.destroy();\n        };\n        result.getInput = function () {\n            result.destroy();\n            return {\n                horizontal: isHorizontal,\n                vertical: isVertical,\n                flipCanvas: doFlipCanvas\n            };\n        };\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let klCanvas = params.klCanvas;\n        let history = params.history;\n        let horizontal = params.input.horizontal;\n        let vertical = params.input.vertical;\n        let flipCanvas = params.input.flipCanvas;\n        if (!context || !klCanvas || !history) {\n            return false;\n        }\n\n        history.pause(true);\n        klCanvas.flip(horizontal, vertical, flipCanvas ? null : klCanvas.getLayerIndex(context.canvas));\n        history.pause(false);\n\n        history.push({\n            tool: [\"filter\", \"flip\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    },\n\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eFiVD\");","import {BB} from '../../bb/bb';\nimport {eventResMs} from './filters-consts';\nimport {KlSlider} from '../ui/base-components/kl-slider';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\nimport {getSharedFx} from './shared-gl-fx';\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const filterHueSaturation = {\n\n    getDialog(params: IFilterGetDialogParam) {\n\n        let context = params.context;\n        let klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        let layers = klCanvas.getLayers();\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height,280, 200,  1);\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n\n        let tempCanvas = BB.canvas(w, h);\n        {\n            const ctx = tempCanvas.getContext(\"2d\");\n            ctx.save();\n            if (tempCanvas.width > context.canvas.width) {\n                ctx.imageSmoothingEnabled = false;\n            }\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            ctx.restore();\n        }\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n\n        function finishInit() {\n            let hue = 0, saturation = 0;\n            div.innerHTML = LANG('filter-hue-sat-description') + \"<br/><br/>\";\n\n            let glCanvas = getSharedFx();\n            if (!glCanvas) {\n                return; // todo throw?\n            }\n            let texture = glCanvas.texture(tempCanvas);\n            glCanvas.draw(texture).update(); // update glCanvas size\n\n            let hueSlider = new KlSlider({\n                label: LANG('filter-hue-sat-hue'),\n                width: 300,\n                height: 30,\n                min: -100,\n                max: 100,\n                value: hue * 100,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    hue = val / 100;\n                    glCanvas.draw(texture).hueSaturation(hue, saturation).update();\n                    klCanvasPreview.render();\n                },\n            });\n            let saturationSlider = new KlSlider({\n                label: LANG('filter-hue-sat-saturation'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 100,\n                value: (saturation + 1) * 50,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    saturation = val / 50 - 1;\n                    glCanvas.draw(texture).hueSaturation(hue, saturation).update();\n                    klCanvasPreview.render();\n                },\n            });\n            hueSlider.getElement().style.marginBottom = \"10px\";\n            div.appendChild(hueSlider.getElement());\n            div.appendChild(saturationSlider.getElement());\n\n\n            let previewWrapper = document.createElement(\"div\");\n            BB.css(previewWrapper, {\n                width: \"340px\",\n                marginLeft: \"-20px\",\n                height: \"220px\",\n                backgroundColor: \"#9e9e9e\",\n                marginTop: \"10px\",\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n                overflow: \"hidden\",\n                position: \"relative\",\n                userSelect: 'none',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                colorScheme: 'only light',\n            });\n\n            let previewLayerArr: IKlBasicLayer[] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr\n                    });\n                }\n            }\n            let klCanvasPreview = new KlCanvasPreview({\n                width: parseInt('' + w),\n                height: parseInt('' + h),\n                layers: previewLayerArr\n            });\n\n            let previewInnerWrapper = BB.el({\n                css: {\n                    position: 'relative',\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                    width: parseInt('' + w) + 'px',\n                    height: parseInt('' + h) + 'px'\n                }\n            });\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\n            previewWrapper.appendChild(previewInnerWrapper);\n\n\n            div.appendChild(previewWrapper);\n\n            try {\n                glCanvas.draw(texture).hueSaturation(hue, saturation).update();\n                klCanvasPreview.render();\n            } catch(e) {\n                (div as any).errorCallback(e);\n            }\n\n            result.destroy = () => {\n                hueSlider.destroy();\n                saturationSlider.destroy();\n                texture.destroy();\n            };\n            result.getInput = function () {\n                result.destroy();\n                return {\n                    hue: hue,\n                    Saturation: saturation\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let hue = params.input.hue;\n        let history = params.history;\n        let Saturation = params.input.Saturation;\n        if (!context || hue === null || Saturation === null || !history)\n            return false;\n        history.pause(true);\n        let glCanvas = getSharedFx();\n        if (!glCanvas) {\n            return false; // todo more specific error?\n        }\n        let texture = glCanvas.texture(context.canvas);\n        glCanvas.draw(texture).hueSaturation(hue, Saturation).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(glCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"hueSaturation\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    }\n\n};","import {getSharedFx} from './shared-gl-fx';\nimport {IFilterApply} from '../kl.types';\n\nexport const filterInvert = {\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let history = params.history;\n        if (!context || !history) {\n            return false;\n        }\n        history.pause(true);\n\n        let glCanvas = getSharedFx();\n        if (!glCanvas) {\n            return false;\n        }\n        let texture = glCanvas.texture(context.canvas);\n        glCanvas.draw(texture).invert().update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(glCanvas, 0, 0);\n        texture.destroy();\n\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"invert\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    }\n\n};","import {BB} from '../../bb/bb';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\nimport {getSharedFx} from './shared-gl-fx';\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\nimport {LANG} from '../../language/language';\nimport {TwoTabs} from '../ui/components/two-tabs';\n\nexport const filterPerspective = {\n\n    getDialog(params: IFilterGetDialogParam) {\n        let context = params.context;\n        let klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        let isSmall = window.innerWidth < 550;\n        let layers = klCanvas.getLayers();\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\n        let w = Math.min(displayW, context.canvas.width);\n        let h = Math.min(displayH, context.canvas.height);\n\n        let tempCanvas = BB.canvas(w, h);\n        {\n            const ctx = tempCanvas.getContext(\"2d\");\n            ctx.save();\n            if (w > context.canvas.width) {\n                ctx.imageSmoothingEnabled = false;\n            }\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            ctx.restore();\n        }\n        let displayPreviewFactor = displayW / context.canvas.width;\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n        if (!isSmall) {\n            result.width = 500;\n        }\n\n        let pointerListenerArr = [];\n\n        function finishInit() {\n            div.innerHTML = LANG('filter-perspective-description') + \"<br/><br/>\";\n\n            let glCanvas = getSharedFx();\n            if (!glCanvas) {\n                return; // todo throw?\n            }\n            let texture = glCanvas.texture(tempCanvas);\n            glCanvas.draw(texture).update(); // update glCanvas size\n            let ba, bb, bc, bd; //before\n            let aa, ab, ac, ad; //after\n            function update() {\n                try {\n                    glCanvas.draw(texture).multiplyAlpha().perspective(\n                        [ba.x, ba.y, bb.x, bb.y, bc.x, bc.y, bd.x, bd.y].map((item, i) => {\n                            if (i % 2 === 0) {\n                                return item / displayW * w;\n                            } else {\n                                return item / displayH * h;\n                            }\n                        }),\n                        [aa.x, aa.y, ab.x, ab.y, ac.x, ac.y, ad.x, ad.y].map((item, i) => {\n                            if (i % 2 === 0) {\n                                return item / displayW * w;\n                            } else {\n                                return item / displayH * h;\n                            }\n                        })\n                    ).unmultiplyAlpha().update();\n                    klCanvasPreview.render();\n                } catch(e) {\n                    (div as any).errorCallback(e);\n                }\n            }\n\n            function nob(x, y, callback?) {\n                let nobSize = 14;\n                let div = document.createElement(\"div\");\n                (div as any).x = x;\n                (div as any).y = y;\n                BB.css(div, {\n                    width: nobSize + \"px\",\n                    height: nobSize + \"px\",\n                    backgroundColor: \"#fff\",\n                    boxShadow: \"inset 0 0 0 2px #000\",\n                    borderRadius: nobSize + \"px\",\n                    position: \"absolute\",\n                    cursor: \"move\",\n                    left: ((div as any).x - nobSize / 2) + \"px\",\n                    top: ((div as any).y - nobSize / 2) + \"px\",\n                    userSelect: 'none',\n                    touchAction: 'none',\n                });\n\n                let pointerListener = new BB.PointerListener({\n                    target: div,\n                    maxPointers: 1,\n                    onPointer: function(event) {\n                        event.eventPreventDefault();\n                        if (event.button === 'left' && event.type === 'pointermove') {\n                            (div as any).x += event.dX;\n                            (div as any).y += event.dY;\n                            div.style.left = ((div as any).x - nobSize / 2) + \"px\";\n                            div.style.top = ((div as any).y - nobSize / 2) + \"px\";\n                            if (callback) {\n                                callback();\n                            }\n                            update();\n                        }\n                    }\n                });\n                (div as any).copy = function (p) {\n                    (div as any).x = p.x;\n                    (div as any).y = p.y;\n                    div.style.left = ((div as any).x - nobSize / 2) + \"px\";\n                    div.style.top = ((div as any).y - nobSize / 2) + \"px\";\n                };\n                pointerListenerArr.push(pointerListener);\n                return div;\n            }\n\n            function updateAfter() {\n                aa.copy(ba);\n                ab.copy(bb);\n                ac.copy(bc);\n                ad.copy(bd);\n            }\n\n            ba = nob(0, 0, updateAfter);\n            bb = nob(displayW, 0, updateAfter);\n            bc = nob(displayW, displayH, updateAfter);\n            bd = nob(0, displayH, updateAfter);\n            aa = nob(0, 0);\n            ab = nob(displayW, 0);\n            ac = nob(displayW, displayH);\n            ad = nob(0, displayH);\n\n            let before = false;\n\n            const beforeAfterTabs = new TwoTabs({\n                left: LANG('compare-before'),\n                right: LANG('compare-after'),\n                init: 1,\n                onChange: (val: number) => {\n                    before = val === 0;\n                    if (before) {\n                        aa.style.display = \"none\";\n                        ab.style.display = \"none\";\n                        ac.style.display = \"none\";\n                        ad.style.display = \"none\";\n\n                        ba.style.display = \"block\";\n                        bb.style.display = \"block\";\n                        bc.style.display = \"block\";\n                        bd.style.display = \"block\";\n                        ba.copy(aa);\n                        bb.copy(ab);\n                        bc.copy(ac);\n                        bd.copy(ad);\n                    } else {\n                        ba.style.display = \"none\";\n                        bb.style.display = \"none\";\n                        bc.style.display = \"none\";\n                        bd.style.display = \"none\";\n\n                        aa.style.display = \"block\";\n                        ab.style.display = \"block\";\n                        ac.style.display = \"block\";\n                        ad.style.display = \"block\";\n                        aa.copy(ba);\n                        ab.copy(bb);\n                        ac.copy(bc);\n                        ad.copy(bd);\n                    }\n                    update();\n                },\n            });\n            div.append(beforeAfterTabs.getElement());\n\n            let previewWrapper = document.createElement(\"div\");\n            previewWrapper.oncontextmenu = function () {\n                return false;\n            };\n            BB.css(previewWrapper, {\n                width: isSmall ? '340px' : '540px',\n                marginLeft: \"-20px\",\n                height: isSmall ? '260px' : '300px',\n                backgroundColor: \"#9e9e9e\",\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n                overflow: \"hidden\",\n                position: \"relative\",\n                userSelect: 'none',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                colorScheme: 'only light',\n            });\n\n            let previewLayerArr: IKlBasicLayer[] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    let canvas = i === selectedLayerIndex ? glCanvas : layers[i].context.canvas;\n                    previewLayerArr.push({\n                        image: canvas,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr\n                    });\n                }\n            }\n            let klCanvasPreview = new KlCanvasPreview({\n                width: parseInt('' + displayW),\n                height: parseInt('' + displayH),\n                layers: previewLayerArr\n            });\n\n            let previewInnerWrapper = BB.el({\n                css: {\n                    position: 'relative',\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                    width: parseInt('' + displayW) + 'px',\n                    height: parseInt('' + displayH) + 'px'\n                }\n            });\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\n            previewWrapper.appendChild(previewInnerWrapper);\n\n            previewInnerWrapper.appendChild(aa);\n            previewInnerWrapper.appendChild(ab);\n            previewInnerWrapper.appendChild(ac);\n            previewInnerWrapper.appendChild(ad);\n\n            ba.style.display = \"none\";\n            bb.style.display = \"none\";\n            bc.style.display = \"none\";\n            bd.style.display = \"none\";\n            previewInnerWrapper.appendChild(ba);\n            previewInnerWrapper.appendChild(bb);\n            previewInnerWrapper.appendChild(bc);\n            previewInnerWrapper.appendChild(bd);\n\n\n            div.appendChild(previewWrapper);\n            update();\n            result.destroy = () => {\n                for (let i = 0; i < pointerListenerArr.length; i++) {\n                    pointerListenerArr[i].destroy();\n                }\n                texture.destroy();\n            };\n            result.getInput = function () {\n                result.destroy();\n                return {\n                    before: [\n                        ba.x / displayPreviewFactor,\n                        ba.y / displayPreviewFactor,\n\n                        bb.x / displayPreviewFactor,\n                        bb.y / displayPreviewFactor,\n\n                        bc.x / displayPreviewFactor,\n                        bc.y / displayPreviewFactor,\n\n                        bd.x / displayPreviewFactor,\n                        bd.y / displayPreviewFactor,\n                    ],\n                    after: [\n                        aa.x / displayPreviewFactor,\n                        aa.y / displayPreviewFactor,\n\n                        ab.x / displayPreviewFactor,\n                        ab.y / displayPreviewFactor,\n\n                        ac.x / displayPreviewFactor,\n                        ac.y / displayPreviewFactor,\n\n                        ad.x / displayPreviewFactor,\n                        ad.y / displayPreviewFactor,\n                    ]\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let history = params.history;\n        let before = params.input.before;\n        let after = params.input.after;\n        if (!context || !before || !after || !history)\n            return false;\n        history.pause(true);\n        let glCanvas = getSharedFx();\n        if (!glCanvas) {\n            return false; // todo more specific error?\n        }\n        let texture = glCanvas.texture(context.canvas);\n        glCanvas.draw(texture).multiplyAlpha().perspective(before, after).unmultiplyAlpha().update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(glCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"perspective\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    }\n\n};","import {BB} from '../../../bb/bb';\n// @ts-ignore\nimport checkmarkImg from 'url:~/src/app/img/ui/checkmark.svg';\n\nconst activeColor = '#9e9e9e';\nconst inactiveColor = 'rgba(0,0,0,0.1)';\nconst hoverColor = '#ccc';\n\nexport class TwoTabs {\n\n    private rootEl: HTMLElement;\n    private leftTab: HTMLElement;\n    private rightTab: HTMLElement;\n    private value: number;\n\n    private update(): void {\n        if (this.value === 0) {\n            BB.css(this.leftTab, {\n                background: \"url(\" + checkmarkImg + \") no-repeat 12px 16px\",\n                backgroundColor: activeColor,\n                backgroundSize: '8%',\n                boxShadow: 'inset 0px 5px 10px rgba(0,0,0,0.5)',\n                cursor: 'default',\n            });\n            BB.css(this.rightTab, {\n                background: '',\n                backgroundColor: inactiveColor,\n                backgroundSize: '8%',\n                boxShadow: '',\n                cursor: 'pointer',\n            });\n        } else {\n            BB.css(this.rightTab, {\n                background: \"url(\" + checkmarkImg + \") no-repeat 12px 16px\",\n                backgroundColor: activeColor,\n                backgroundSize: '8%',\n                boxShadow: 'inset 0px 5px 10px rgba(0,0,0,0.5)',\n                cursor: 'default',\n            });\n            BB.css(this.leftTab, {\n                background: '',\n                backgroundColor: inactiveColor,\n                backgroundSize: '8%',\n                boxShadow: '',\n                cursor: 'pointer',\n            });\n        }\n    }\n\n\n    // ---- public ----\n    constructor(params: {\n        left: string;\n        right: string;\n        init: number; //0, 1\n        onChange: (val: number) => void;\n    }) {\n        this.value = params.init;\n\n        this.rootEl = BB.el({\n            css: {\n                display: 'flex',\n                justifyContent: 'center',\n            }\n        });\n\n        this.leftTab = BB.el({\n            parent: this.rootEl,\n            content: params.left,\n            css: {\n                width: '150px',\n                height: '30px',\n                paddingTop: '10px',\n                textAlign: 'center',\n                paddingBottom: '0',\n                borderTopLeftRadius: '10px',\n                backgroundSize: '8%',\n            }\n        });\n        BB.setEventListener(this.leftTab, 'onpointerdown', function () {\n            return false;\n        });\n\n        this.rightTab = BB.el({\n            parent: this.rootEl,\n            content: params.right,\n            css: {\n                width: '150px',\n                height: '30px',\n                paddingTop: '10px',\n                textAlign: 'center',\n                paddingBottom: '0',\n                borderTopRightRadius: '10px',\n                backgroundSize: '8%',\n            }\n        });\n        BB.setEventListener(this.rightTab, 'onpointerdown', () => {\n            return false;\n        });\n\n        this.update();\n\n        BB.setEventListener(this.leftTab, 'onpointerover', () => {\n            if (this.value !== 0) {\n                this.leftTab.style.backgroundColor = hoverColor;\n            }\n        });\n        BB.setEventListener(this.leftTab, 'onpointerout', () => {\n            if (this.value !== 0) {\n                this.leftTab.style.backgroundColor = inactiveColor;\n            }\n        });\n        BB.setEventListener(this.rightTab, 'onpointerover', () => {\n            if (this.value !== 1) {\n                this.rightTab.style.backgroundColor = hoverColor;\n            }\n        });\n        BB.setEventListener(this.rightTab, 'onpointerout', () => {\n            if (this.value !== 1) {\n                this.rightTab.style.backgroundColor = inactiveColor;\n            }\n        });\n\n        this.leftTab.onclick = () => {\n            if (this.value === 0) {\n                return;\n            }\n            this.value = 0;\n            this.update();\n            params.onChange(this.value);\n        };\n\n        this.rightTab.onclick = () => {\n            if (this.value === 1) {\n                return;\n            }\n            this.value = 1;\n            this.update();\n            params.onChange(this.value);\n        };\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n}","import {BB} from '../../bb/bb';\nimport {Checkbox} from '../ui/base-components/checkbox';\nimport {Select} from '../ui/base-components/select';\n// @ts-ignore\nimport constrainImg from 'url:~/src/app/img/ui/constrain.svg';\nimport {IFilterApply, IFilterGetDialogParam} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const filterResize = {\n\n    getDialog(params: IFilterGetDialogParam) {\n        //BB.centerWithin\n        let klCanvas = params.klCanvas;\n        if (!klCanvas)\n            return false;\n\n        let fit = BB.fitInto( klCanvas.getWidth(), klCanvas.getHeight(), 280, 200,1);\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n\n        let previewFactor = w / klCanvas.getWidth();\n        let tempCanvas = klCanvas.getCompleteCanvas(1);\n\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n        let newWidth = klCanvas.getWidth(), newHeight = klCanvas.getHeight();\n\n        div.innerHTML = LANG('filter-resize-description') + \"<br/><br/>\";\n\n\n        let maxWidth = params.maxWidth, maxHeight = params.maxHeight;\n\n        let widthWrapper = BB.el({\n            css: {\n                width: '150px',\n                height: '35px',\n                lineHeight: '30px',\n            }\n        });\n        let heightWrapper = BB.el({\n            css: {\n                width: '150px',\n                height: '35px',\n                lineHeight: '30px',\n            }\n        });\n        let widthInput = BB.el({\n            tagName: 'input',\n            css: {\n                cssFloat: 'right',\n                width: '90px',\n            },\n            custom: {\n                type: 'number',\n                min: '1',\n                max: '' + maxWidth,\n                value: '' + klCanvas.getWidth(),\n            }\n        }) as HTMLInputElement;\n        let heightInput = BB.el({\n            tagName: 'input',\n            css: {\n                cssFloat: 'right',\n                width: '90px',\n            },\n            custom: {\n                type: 'number',\n                min: '1',\n                max: '' + maxHeight,\n                value: '' + klCanvas.getHeight(),\n            }\n        }) as HTMLInputElement;\n        widthInput.onclick = function () {\n            (this as any).focus();\n            widthChanged = true;\n            update();\n        };\n        heightInput.onclick = function () {\n            (this as any).focus();\n            heightChanged = true;\n            update();\n        };\n        widthInput.onchange = function () {\n            widthChanged = true;\n            update();\n        };\n        heightInput.onchange = function () {\n            heightChanged = true;\n            update();\n        };\n        widthWrapper.append(LANG('width') + \": \", widthInput);\n        heightWrapper.append(LANG('height') + \": \", heightInput);\n        let inputWrapper = BB.el({\n            css: {\n                background: \"url(\" + constrainImg + \") no-repeat 140px 5px\",\n                backgroundSize: '50px 52px',\n            }\n        });\n        inputWrapper.append(widthWrapper, heightWrapper);\n        div.appendChild(inputWrapper);\n\n        //contrain checkbox\n        let heightChanged = false, widthChanged = false;\n        let ratio = klCanvas.getWidth() / klCanvas.getHeight();\n\n        function updateConstrain() {\n            if (isConstrained) {\n                widthInput.value = '' + klCanvas.getWidth();\n                heightInput.value = '' + klCanvas.getHeight();\n                inputWrapper.style.background = \"url(\" + constrainImg + \") no-repeat 140px 5px\";\n                inputWrapper.style.backgroundSize = '50px 52px';\n                update();\n            } else {\n                inputWrapper.style.background = \"\";\n            }\n        }\n\n        let isConstrained = true;\n        let constrainCheckbox = new Checkbox({\n            init: true,\n            label: LANG('constrain-proportions'),\n            allowTab: true,\n            callback: function(b) {\n                isConstrained = b;\n                updateConstrain();\n            }\n        });\n        div.appendChild(BB.el({\n            css: {\n                clear: 'both'\n            }\n        }));\n\n\n        let algorithmSelect = new Select({\n            isFocusable: true,\n            optionArr: [\n                ['smooth', LANG('algorithm-smooth')],\n                ['pixelated', LANG('algorithm-pixelated')]\n            ],\n            title: LANG('scaling-algorithm'),\n            initValue: 'smooth',\n            onChange: function() {\n                update();\n            },\n        });\n\n        let secondRowElement = BB.el({\n            parent: div,\n            css: {\n                display: 'flex',\n                justifyContent: 'space-between'\n            }\n        });\n        secondRowElement.appendChild(constrainCheckbox.getElement());\n        secondRowElement.appendChild(algorithmSelect.getElement());\n\n        let previewCanvas = BB.canvas(w, h);\n        previewCanvas.style.imageRendering = 'pixelated';\n\n\n        let previewCtx = previewCanvas.getContext('2d');\n\n\n        function draw() {\n            if (algorithmSelect.getValue() === 'smooth') {\n                previewCanvas.style.imageRendering = previewFactor > 1 ? 'pixelated' : '';\n\n                previewCanvas.width = klCanvas.getWidth();\n                previewCanvas.height = klCanvas.getHeight();\n\n                previewCtx.save();\n                previewCtx.imageSmoothingQuality = 'high';\n                previewCtx.drawImage(tempCanvas, 0, 0);\n                BB.resizeCanvas(previewCanvas, newWidth, newHeight);\n                previewCtx.restore();\n\n            } else {\n                previewCanvas.style.imageRendering = 'pixelated';\n\n                previewCanvas.width = newWidth;\n                previewCanvas.height = newHeight;\n                previewCtx.save();\n                previewCtx.imageSmoothingEnabled = false;\n                previewCtx.drawImage(tempCanvas, 0, 0, previewCanvas.width, previewCanvas.height);\n                previewCtx.restore();\n            }\n\n        }\n\n        function update() {\n            if ((widthInput.value.length === 0 && widthChanged) || (heightInput.value.length === 0 && heightChanged)) {\n                heightChanged = false;\n                widthChanged = false;\n                return;\n            }\n            widthInput.value = '' + Math.max(1, parseInt(widthInput.value));\n            heightInput.value = '' + Math.max(1, parseInt(heightInput.value));\n            if (isConstrained) {\n                if (heightChanged) {\n                    widthInput.value = '' + parseInt('' + (parseInt(heightInput.value) * ratio));\n                }\n                if (widthChanged) {\n                    heightInput.value = '' + parseInt('' + (parseInt(widthInput.value) / ratio));\n                }\n\n                if (parseInt(widthInput.value) > maxWidth || parseInt(heightInput.value) > maxHeight) {\n                    let fit = BB.fitInto(parseInt(widthInput.value), parseInt(heightInput.value), maxWidth, maxHeight, 1);\n                    widthInput.value = '' + parseInt('' + fit.width);\n                    heightInput.value = '' + parseInt('' + fit.height);\n                }\n            }\n\n            if (parseInt(widthInput.value) > maxWidth) {\n                widthInput.value = '' + maxWidth;\n            }\n            if (parseInt(heightInput.value) > maxHeight) {\n                heightInput.value = '' + maxHeight;\n            }\n\n            heightChanged = false;\n            widthChanged = false;\n\n            newWidth = parseInt(widthInput.value);\n            newHeight = parseInt(heightInput.value);\n\n            let preview = BB.fitInto(newWidth, newHeight, 280, 200, 1);\n            let previewW = parseInt('' + preview.width), previewH = parseInt('' + preview.height);\n            previewFactor = previewW / newWidth;\n\n            let offset = BB.centerWithin(340, 220, previewW, previewH);\n\n            draw();\n\n            previewCanvas.style.width = Math.max(1, previewW) + \"px\";\n            previewCanvas.style.height = Math.max(1, previewH) + \"px\";\n            canvasWrapper.style.left = offset.x + \"px\";\n            canvasWrapper.style.top = offset.y + \"px\";\n            canvasWrapper.style.width = Math.max(1, previewW) + \"px\";\n            canvasWrapper.style.height = Math.max(1, previewH) + \"px\";\n        }\n\n        let previewWrapper = document.createElement(\"div\");\n        BB.css(previewWrapper, {\n            width: \"340px\",\n            marginLeft: \"-20px\",\n            height: \"220px\",\n            display: \"table\",\n            backgroundColor: \"#9e9e9e\",\n            marginTop: \"10px\",\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n            position: \"relative\",\n            userSelect: 'none',\n            colorScheme: 'only light',\n        });\n\n\n        let canvasWrapper = BB.appendTextDiv(previewWrapper, \"\");\n        canvasWrapper.appendChild(previewCanvas);\n        canvasWrapper.style.width = w + \"px\";\n        canvasWrapper.style.height = h + \"px\";\n        canvasWrapper.style.position = \"absolute\";\n        canvasWrapper.style.overflow = \"hidden\";\n        canvasWrapper.style.boxShadow = \"0 0 5px rgba(0,0,0,0.8)\";\n        canvasWrapper.style.overflow = \"hidden\";\n        BB.createCheckerDataUrl(8, function (url) {\n            previewWrapper.style.background = \"url(\" + url + \")\";\n        });\n\n        div.appendChild(previewWrapper);\n        update();\n\n        result.destroy = () => {\n            constrainCheckbox.destroy();\n        };\n        result.getInput = function () {\n            result.destroy();\n            return {\n                width: newWidth,\n                height: newHeight,\n                algorithm: algorithmSelect.getValue()\n            };\n        };\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        let klCanvas = params.klCanvas;\n        let history = params.history;\n        let width = params.input.width;\n        let height = params.input.height;\n        let algorithm = params.input.algorithm;\n        if (!klCanvas || !history) {\n            return false;\n        }\n        history.pause(true);\n        klCanvas.resize(width, height, algorithm);\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"resize\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    }\n\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"2BZYe\");","import {BB} from '../../bb/bb';\nimport {IFilterApply, IFilterGetDialogParam} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const filterRotate = {\n\n    getDialog(params: IFilterGetDialogParam) {\n        let klCanvas = params.klCanvas;\n        if (!klCanvas)\n            return false;\n\n        let fit = BB.fitInto(klCanvas.getWidth(), klCanvas.getHeight(), 280, 200, 1);\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n\n        let previewFactor = w / klCanvas.getWidth();\n        let tempCanvas = BB.canvas(w, h);\n        tempCanvas.style.display = 'block';\n        tempCanvas.getContext(\"2d\").drawImage(klCanvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\n\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n        let deg = 0;\n        div.innerHTML = LANG('filter-rotate-description') + \"<br/><br/>\";\n\n        let first = true;\n\n        function update() {\n            (canvasWrapper.style as any).WebkitTransform = \"rotate(\" + deg + \"deg)\";\n            (canvasWrapper.style as any).MozTransform = \"rotate(\" + deg + \"deg)\";\n            (canvasWrapper.style as any).OTransform = \"rotate(\" + deg + \"deg)\";\n            (canvasWrapper.style as any).msTransform = \"rotate(\" + deg + \"deg)\";\n            if (Math.abs(deg % 180) === 90) {\n                //height has to fit width because of rotation\n                let fit = BB.fitInto(h, w, 280, 200, 1);\n                let scale = parseInt('' + fit.height) / w;\n                (canvasWrapper.style as any).WebkitTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\n                (canvasWrapper.style as any).MozTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\n                (canvasWrapper.style as any).OTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\n                (canvasWrapper.style as any).msTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\n            }\n        }\n\n        let btnPlus = document.createElement(\"button\");\n        btnPlus.innerHTML = \"<span style='font-size: 1.3em'>⟳</span> 90°\";\n        let btnMinus = document.createElement(\"button\");\n        btnMinus.innerHTML = \"<span style='font-size: 1.3em'>⟲</span> 90°\";\n        btnMinus.style.marginRight = '5px';\n\n\n        btnPlus.onclick = function () {\n            deg += 90;\n            update();\n        };\n        btnMinus.onclick = function () {\n            deg -= 90;\n            update();\n        };\n\n        div.appendChild(btnMinus);\n        div.appendChild(btnPlus);\n\n        let previewWrapper = document.createElement(\"div\");\n        BB.css(previewWrapper, {\n            width: \"340px\",\n            marginLeft: \"-20px\",\n            height: \"220px\",\n            display: \"table\",\n            backgroundColor: \"#9e9e9e\",\n            marginTop: \"10px\",\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n            overflow: \"hidden\",\n            position: \"relative\",\n            userSelect: 'none',\n            colorScheme: 'only light',\n        });\n\n        let previewcell = document.createElement(\"div\");\n        previewcell.style.display = \"table-cell\";\n        previewcell.style.verticalAlign = \"middle\";\n        let canvasWrapper = BB.appendTextDiv(previewcell, \"\");\n        canvasWrapper.appendChild(tempCanvas);\n        previewWrapper.appendChild(previewcell);\n        canvasWrapper.style.width = w + \"px\";\n        canvasWrapper.style.height = h + \"px\";\n        canvasWrapper.style.marginLeft = \"auto\";\n        canvasWrapper.style.marginRight = \"auto\";\n        canvasWrapper.style.boxShadow = \"0 0 5px rgba(0,0,0,0.8)\";\n        canvasWrapper.style.overflow = \"hidden\";\n        BB.createCheckerDataUrl(4, function (url) {\n            canvasWrapper.style.background = \"url(\" + url + \")\";\n        });\n        canvasWrapper.style.transition = \"all 0.2s ease-out\";\n\n        div.appendChild(previewWrapper);\n        update();\n\n        result.getInput = function () {\n            return {\n                deg: deg\n            };\n        };\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        let klCanvas = params.klCanvas;\n        let history = params.history;\n        let deg = params.input.deg;\n        if (!klCanvas || !history)\n            return false;\n        history.pause(true);\n        klCanvas.rotate(deg);\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"rotate\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    }\n\n};","import {BB} from '../../bb/bb';\nimport {eventResMs} from './filters-consts';\nimport {KlSlider} from '../ui/base-components/kl-slider';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\nimport {getSharedFx} from './shared-gl-fx';\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const filterTiltShift = {\n\n    getDialog(params: IFilterGetDialogParam) {\n        let context = params.context;\n        let klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        let layers = klCanvas.getLayers();\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\n        let w = Math.min(displayW, context.canvas.width);\n        let h = Math.min(displayH, context.canvas.height);\n\n        let tempCanvas = BB.canvas(w, h);\n        {\n            const ctx = tempCanvas.getContext(\"2d\");\n            ctx.save();\n            if (w > context.canvas.width) {\n                ctx.imageSmoothingEnabled = false;\n            }\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            ctx.restore();\n        }\n        let previewFactor = w / context.canvas.width;\n        let displayPreviewFactor = displayW / context.canvas.width;\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n\n        let pointerListenerArr = [];\n\n        function finishInit() {\n            let blur = 20, gradient = 200;\n            div.innerHTML = LANG('filter-tilt-shift-description') + \"<br/><br/>\";\n\n            let glCanvas = getSharedFx();\n            if (!glCanvas) {\n                return; // todo throw?\n            }\n            let texture = glCanvas.texture(tempCanvas);\n            glCanvas.draw(texture).update(); // update glCanvas size\n            let fa, fb; // focus line\n            function update() {\n                try {\n                    glCanvas.draw(texture).tiltShift(\n                        fa.x / displayPreviewFactor * previewFactor,\n                        fa.y / displayPreviewFactor * previewFactor,\n                        fb.x / displayPreviewFactor * previewFactor,\n                        fb.y / displayPreviewFactor * previewFactor,\n                        blur * previewFactor,\n                        gradient * previewFactor\n                    ).update();\n                    klCanvasPreview.render();\n                } catch(e) {\n                    (div as any).errorCallback(e);\n                }\n            }\n\n            function nob(x, y) {\n                let nobSize = 14;\n                let div = BB.el({\n                    css: {\n                        width: nobSize + \"px\",\n                        height: nobSize + \"px\",\n                        backgroundColor: '#fff',\n                        boxShadow: \"inset 0 0 0 2px #000\",\n                        borderRadius: nobSize + \"px\",\n                        position: \"absolute\",\n                        cursor: 'move',\n                        left: (x - nobSize / 2) + \"px\",\n                        top: (y - nobSize / 2) + \"px\",\n                        userSelect: 'none',\n                        touchAction: 'none',\n                    }\n                });\n                (div as any).x = x;\n                (div as any).y = y;\n                let pointerListener = new BB.PointerListener({\n                    target: div,\n                    maxPointers: 1,\n                    onPointer: function(event) {\n                        event.eventPreventDefault();\n                        if (event.button === 'left' && event.type === 'pointermove') {\n                            (div as any).x += event.dX;\n                            (div as any).y += event.dY;\n                            div.style.left = ((div as any).x - nobSize / 2) + \"px\";\n                            div.style.top = ((div as any).y - nobSize / 2) + \"px\";\n                            update();\n                        }\n                    }\n                });\n                pointerListenerArr.push(pointerListener);\n                return div;\n            }\n\n            fa = nob(parseInt('' + (displayW / 6)), parseInt('' + (displayH / 2)));\n            fb = nob(parseInt('' + (displayW - displayW / 6)), parseInt('' + (displayH - displayH / 3)));\n\n            let blurSlider = new KlSlider({\n                label: LANG('filter-tilt-shift-blur'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 200,\n                value: blur,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    blur = val;\n                    update();\n                },\n            });\n            blurSlider.getElement().style.marginBottom = \"10px\";\n            div.appendChild(blurSlider.getElement());\n            let gradientSlider = new KlSlider({\n                label: LANG('filter-tilt-shift-gradient'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 1000,\n                value: gradient,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    gradient = val;\n                    update();\n                },\n            });\n            div.appendChild(gradientSlider.getElement());\n\n\n            let previewWrapper = document.createElement(\"div\");\n            previewWrapper.oncontextmenu = function () {\n                return false;\n            };\n            BB.css(previewWrapper, {\n                width: \"340px\",\n                marginLeft: \"-20px\",\n                height: \"220px\",\n                backgroundColor: \"#9e9e9e\",\n                marginTop: \"10px\",\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n                overflow: \"hidden\",\n                position: \"relative\",\n                userSelect: 'none',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                colorScheme: 'only light',\n            });\n\n            let previewLayerArr: IKlBasicLayer[] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr\n                    });\n                }\n            }\n            let klCanvasPreview = new KlCanvasPreview({\n                width: parseInt('' + displayW),\n                height: parseInt('' + displayH),\n                layers: previewLayerArr\n            });\n\n            let previewInnerWrapper = BB.el({\n                css: {\n                    position: 'relative',\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                    width: parseInt('' + displayW) + 'px',\n                    height: parseInt('' + displayH) + 'px'\n                }\n            });\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\n            previewWrapper.appendChild(previewInnerWrapper);\n\n            previewInnerWrapper.appendChild(fa);\n            previewInnerWrapper.appendChild(fb);\n\n\n            div.appendChild(previewWrapper);\n            update();\n            result.destroy = () => {\n                for (let i = 0; i < pointerListenerArr.length; i++) {\n                    pointerListenerArr[i].destroy();\n                }\n                blurSlider.destroy();\n                gradientSlider.destroy();\n                texture.destroy();\n            };\n            result.getInput = function () {\n                result.destroy();\n                return {\n                    a: {x: fa.x / displayPreviewFactor, y: fa.y / displayPreviewFactor},\n                    b: {x: fb.x / displayPreviewFactor, y: fb.y / displayPreviewFactor},\n                    blur: blur,\n                    gradient: gradient\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n\n\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let history = params.history;\n        let a = params.input.a;\n        let b = params.input.b;\n        let blur = params.input.blur;\n        let gradient = params.input.gradient;\n        if (!context || !history)\n            return false;\n        history.pause(true);\n        let glCanvas = getSharedFx();\n        if (!glCanvas) {\n            return false; // todo more specific error?\n        }\n        let texture = glCanvas.texture(context.canvas);\n        glCanvas.draw(texture).tiltShift(a.x, a.y, b.x, b.y, blur, gradient).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(glCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"tiltShift\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    }\n\n};","import {BB} from '../../bb/bb';\nimport {Checkbox} from '../ui/base-components/checkbox';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\nimport {FreeTransform, ITransform} from '../ui/components/free-transform';\nimport {Select} from '../ui/base-components/select';\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\nimport {LANG} from '../../language/language';\nimport {IRect} from '../../bb/bb.types';\n\ninterface IFilterTransformInput {\n    bounds: {x: number, y: number, width: number, height: number};\n    transform: ITransform;\n    isPixelated: boolean;\n}\n\nexport const filterTransform = {\n\n    getDialog(params: IFilterGetDialogParam) {\n        let context = params.context;\n        let klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        let isSmall = window.innerWidth < 550;\n        let layers = klCanvas.getLayers();\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\n        let w = Math.min(displayW, context.canvas.width);\n        let h = Math.min(displayH, context.canvas.height);\n        let freeTransform: FreeTransform;\n        let displayPreviewFactor = displayW / context.canvas.width;\n\n        // determine bounds and initial transformation\n        const boundsObj: IRect = BB.canvasBounds(context);\n        if (boundsObj === null) {\n            alert(LANG('filter-transform-empty'));\n            return false;\n        }\n        const initTransform = {\n            x: boundsObj.x + boundsObj.width / 2,\n            y: boundsObj.y + boundsObj.height / 2,\n            width: boundsObj.width,\n            height: boundsObj.height,\n            angleDeg: 0,\n        };\n\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n        if (!isSmall) {\n            result.width = 500;\n        }\n        div.innerHTML = LANG('filter-transform-description');\n\n        let keyListener = new BB.KeyListener({\n            onDown: function(keyStr) {\n                if (BB.isInputFocused(true)) {\n                    return;\n                }\n\n                if (keyStr === 'left') {\n                    inputX.value = '' + (parseFloat(inputX.value) - 1);\n                    onInputsChanged();\n                }\n                if (keyStr === 'right') {\n                    inputX.value = '' + (parseFloat(inputX.value) + 1);\n                    onInputsChanged();\n                }\n                if (keyStr === 'up') {\n                    inputY.value = '' + (parseFloat(inputY.value) - 1);\n                    onInputsChanged();\n                }\n                if (keyStr === 'down') {\n                    inputY.value = '' + (parseFloat(inputY.value) + 1);\n                    onInputsChanged();\n                }\n            }\n\n        });\n\n        let leftWrapper = document.createElement(\"div\");\n        let rightWrapper = document.createElement(\"div\");\n        let rotWrapper = document.createElement(\"div\");\n        let inputY = document.createElement(\"input\");\n        let inputX = document.createElement(\"input\");\n        let inputR = document.createElement(\"input\");\n        leftWrapper.style.width = \"100px\";\n        leftWrapper.style.height = \"30px\";\n        rightWrapper.style.width = \"100px\";\n        rightWrapper.style.height = \"30px\";\n        rightWrapper.style.display = \"inline-block\";\n        leftWrapper.style.display = \"inline-block\";\n        rotWrapper.style.display = \"inline-block\";\n        rotWrapper.style.width = \"150px\";\n        rotWrapper.style.height = \"30px\";\n        inputY.type = \"number\";\n        inputX.type = \"number\";\n        inputR.type = \"number\";\n        inputX.style.width = 70 + \"px\";\n        inputY.style.width = 70 + \"px\";\n        inputR.style.width = 70 + \"px\";\n        inputY.value = '0';\n        inputX.value = '0';\n        inputR.value = '0';\n        inputY.onclick = function () {\n            (this as any).focus();\n            onInputsChanged();\n        };\n        inputX.onclick = function () {\n            (this as any).focus();\n            onInputsChanged();\n        };\n        inputR.onclick = function () {\n            (this as any).focus();\n            onInputsChanged();\n        };\n        inputY.onchange = function () {\n            onInputsChanged();\n        };\n        inputX.onchange = function () {\n            onInputsChanged();\n        };\n        inputR.onchange = function () {\n            onInputsChanged();\n        };\n        inputY.onkeyup = function () {\n            onInputsChanged();\n        };\n        inputX.onkeyup = function () {\n            onInputsChanged();\n        };\n        inputR.onkeyup = function () {\n            onInputsChanged();\n        };\n        leftWrapper.append(\"X: \", inputX);\n        rightWrapper.append(\"Y: \", inputY);\n        rotWrapper.append(LANG('filter-transform-rotation') + ': ', inputR);\n        if (!isSmall) {\n            const inputRow = BB.el({\n                parent: div,\n                css: {\n                    marginTop: '10px',\n                }\n            });\n            inputRow.append(leftWrapper, rightWrapper, rotWrapper);\n        }\n\n        // buttons\n        const actionBtnCss = {\n            marginLeft: '10px',\n            marginTop: '10px',\n        };\n        const buttonRow = BB.el ({\n            parent: div,\n            css: {\n                display: 'flex',\n                flexWrap: 'wrap',\n                marginLeft: '-10px',\n            }\n        });\n        const flipXBtn = BB.el ({\n            parent: buttonRow,\n            tagName: 'button',\n            content: LANG('filter-transform-flip') + ' X',\n            onClick: () => {\n                const t = freeTransform.getTransform();\n                freeTransform.setSize(-t.width, t.height);\n            },\n            css: actionBtnCss,\n        });\n        const flipYBtn = BB.el ({\n            parent: buttonRow,\n            tagName: 'button',\n            content: LANG('filter-transform-flip') + ' Y',\n            onClick: () => {\n                const t = freeTransform.getTransform();\n                freeTransform.setSize(t.width, -t.height);\n            },\n            css: actionBtnCss,\n        });\n        const scaleRotLeftBtn = BB.el ({\n            parent: buttonRow,\n            tagName: 'button',\n            content: '-90°',\n            onClick: () => {\n                const t = freeTransform.getTransform();\n                t.angleDeg -= 90;\n                t.angleDeg %= 360;\n                freeTransform.setAngleDeg(t.angleDeg);\n                inputR.value = '' + Math.round(t.angleDeg);\n                updatePreview();\n            },\n            css: actionBtnCss,\n        });\n        const scaleRotRightBtn = BB.el ({\n            parent: buttonRow,\n            tagName: 'button',\n            content: '+90°',\n            onClick: () => {\n                const t = freeTransform.getTransform();\n                t.angleDeg += 90;\n                t.angleDeg %= 360;\n                freeTransform.setAngleDeg(t.angleDeg);\n                inputR.value = '' + Math.round(t.angleDeg);\n                updatePreview();\n            },\n            css: actionBtnCss,\n        });\n        const scaleDoubleBtn = BB.el ({\n            parent: buttonRow,\n            tagName: 'button',\n            content: '2x',\n            onClick: () => {\n                const t = freeTransform.getTransform();\n                if (constrainCheckbox.getValue()) {\n                    freeTransform.setSize(freeTransform.getRatio() * t.height * 2, t.height * 2);\n                } else {\n                    freeTransform.setSize(t.width * 2, t.height * 2);\n                }\n            },\n            css: actionBtnCss,\n        });\n        const scaleHalfBtn = BB.el ({\n            parent: buttonRow,\n            tagName: 'button',\n            content: '1/2x',\n            onClick: () => {\n                const t = freeTransform.getTransform();\n                freeTransform.setSize(Math.round(t.width / 2), Math.round(t.height / 2));\n            },\n            css: actionBtnCss,\n        });\n        const centerBtn = BB.el ({\n            parent: buttonRow,\n            tagName: 'button',\n            content: LANG('center'),\n            onClick: () => {\n                const t = freeTransform.getTransform();\n                freeTransform.setPos({ x: context.canvas.width / 2, y: context.canvas.height / 2 });\n                freeTransform.setAngleDeg(t.angleDeg);\n                updatePreview();\n            },\n            css: actionBtnCss,\n        });\n\n\n\n\n\n        let isConstrained = true;\n        let constrainCheckbox = new Checkbox({\n            init: true,\n            label: LANG('filter-transform-constrain'),\n            title: LANG('constrain-proportions'),\n            allowTab: true,\n            callback: function(b) {\n                isConstrained = b;\n                freeTransform.setConstrained(isConstrained);\n            },\n            css: {\n                display: 'inline-block'\n            }\n        });\n        let isSnapping = false;\n        let snappingCheckbox = new Checkbox({\n            init: true,\n            label: LANG('filter-transform-snap'),\n            title: LANG('filter-transform-snap-title'),\n            allowTab: true,\n            callback: function(b) {\n                isSnapping = b;\n                freeTransform.setSnapping(isSnapping);\n            },\n            css: {\n                display: 'inline-block',\n                marginLeft: '10px',\n            }\n        });\n        const checkboxWrapper = BB.el({});\n        checkboxWrapper.append(constrainCheckbox.getElement(), snappingCheckbox.getElement());\n\n        div.appendChild(BB.el({\n            css: {\n                clear: 'both',\n                height: '10px'\n            }\n        }));\n\n        const bottomRow = BB.el({\n            parent: div,\n            css: {\n                display: 'flex',\n                justifyContent: 'space-between',\n            }\n        });\n\n        let algorithmSelect = new Select({\n            isFocusable: true,\n            optionArr: [\n                ['smooth', LANG('algorithm-smooth')],\n                ['pixelated', LANG('algorithm-pixelated')]\n            ],\n            initValue: 'smooth',\n            title: LANG('scaling-algorithm'),\n            onChange: function() {\n                updatePreview(true);\n            },\n        });\n        bottomRow.append(checkboxWrapper, algorithmSelect.getElement());\n\n\n        let previewWrapper = document.createElement(\"div\");\n        previewWrapper.oncontextmenu = function () {\n            return false;\n        };\n        BB.css(previewWrapper, {\n            width: isSmall ? '340px' : '540px',\n            marginLeft: \"-20px\",\n            height: isSmall ? '260px' : '300px',\n            backgroundColor: \"#9e9e9e\",\n            marginTop: \"10px\",\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n            overflow: \"hidden\",\n            position: \"relative\",\n            userSelect: 'none',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            colorScheme: 'only light',\n        });\n\n        let previewLayerArr: IKlBasicLayer[] = [];\n        {\n            for (let i = 0; i < layers.length; i++) {\n                let canvas;\n                if (i === selectedLayerIndex) {\n                    canvas = BB.canvas(parseInt('' + w), parseInt('' + h));\n                    let ctx = canvas.getContext('2d');\n                    ctx.drawImage(layers[i].context.canvas, 0, 0, canvas.width, canvas.height);\n                } else {\n                    canvas = layers[i].context.canvas;\n                }\n                previewLayerArr.push({\n                    image: canvas,\n                    opacity: layers[i].opacity,\n                    mixModeStr: layers[i].mixModeStr\n                });\n            }\n        }\n        let klCanvasPreview = new KlCanvasPreview({\n            width: parseInt('' + displayW),\n            height: parseInt('' + displayH),\n            layers: previewLayerArr\n        });\n\n        let previewInnerWrapper = BB.el({\n            css: {\n                position: 'relative',\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                width: parseInt('' + displayW) + 'px',\n                height: parseInt('' + displayH) + 'px'\n            }\n        });\n        previewInnerWrapper.appendChild(klCanvasPreview.getElement());\n        previewWrapper.appendChild(previewInnerWrapper);\n\n        let lastDrawnTransformStr;\n        function updatePreview(doForce: boolean = false) {\n            if (!freeTransform) {\n                return;\n            }\n            let transform = freeTransform.getTransform();\n            if (JSON.stringify(transform) === lastDrawnTransformStr && !doForce) {\n                return;\n            }\n            lastDrawnTransformStr = JSON.stringify(transform);\n            if (displayPreviewFactor < 1) {\n                transform.x *= displayPreviewFactor;\n                transform.y *= displayPreviewFactor;\n                transform.width *= displayPreviewFactor;\n                transform.height *= displayPreviewFactor;\n            }\n            let transformLayerCanvas = previewLayerArr[selectedLayerIndex].image as HTMLCanvasElement;\n            let ctx = transformLayerCanvas.getContext('2d');\n            ctx.save();\n            ctx.clearRect(0, 0, transformLayerCanvas.width, transformLayerCanvas.height);\n            BB.drawTransformedImageWithBounds(\n                ctx,\n                layers[selectedLayerIndex].context.canvas,\n                transform,\n                boundsObj,\n                algorithmSelect.getValue() === 'pixelated' ||\n                BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\n            );\n            ctx.restore();\n            klCanvasPreview.render();\n        }\n\n        freeTransform = new FreeTransform({\n            x: initTransform.x,\n            y: initTransform.y,\n            width: initTransform.width,\n            height: initTransform.height,\n            angleDeg: initTransform.angleDeg,\n            isConstrained: true,\n            snapX: [0, context.canvas.width],\n            snapY: [0, context.canvas.height],\n            callback: function (t) {\n                inputX.value = '' + Math.round(t.x - initTransform.x);\n                inputY.value = '' + Math.round(t.y - initTransform.y);\n                inputR.value = '' + Math.round(t.angleDeg);\n                updatePreview();\n            },\n            scale: displayPreviewFactor\n        });\n        BB.css(freeTransform.getElement(), {\n            position: 'absolute',\n            left: '0',\n            top: '0'\n        });\n        previewInnerWrapper.appendChild(freeTransform.getElement());\n\n        function onInputsChanged() {\n            freeTransform.setPos({\n                x: parseInt(inputX.value) + initTransform.x,\n                y: parseInt(inputY.value) + initTransform.y}\n            );\n            freeTransform.setAngleDeg(parseInt(inputR.value));\n            updatePreview();\n        }\n\n        updatePreview();\n\n        div.appendChild(previewWrapper);\n        result.destroy = () => {\n            keyListener.destroy();\n            freeTransform.destroy();\n            constrainCheckbox.destroy();\n            snappingCheckbox.destroy();\n            BB.destroyEl(flipXBtn);\n            BB.destroyEl(flipYBtn);\n            BB.destroyEl(scaleRotLeftBtn);\n            BB.destroyEl(scaleRotRightBtn);\n            BB.destroyEl(scaleDoubleBtn);\n            BB.destroyEl(scaleHalfBtn);\n            BB.destroyEl(centerBtn);\n        };\n        result.getInput = function () {\n            const transform = freeTransform.getTransform();\n            let input = {\n                transform,\n                bounds: boundsObj,\n                isPixelated: algorithmSelect.getValue() === 'pixelated' ||\n                    BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\n            } as IFilterTransformInput;\n            result.destroy();\n            return JSON.parse(JSON.stringify(input));\n        };\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        const context = params.context;\n        const history = params.history;\n        if (!context || !history) {\n            return false;\n        }\n        history.pause(true);\n\n        const input: IFilterTransformInput = params.input;\n\n        let copyCanvas = BB.copyCanvas(context.canvas);\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        BB.drawTransformedImageWithBounds(\n            context,\n            copyCanvas,\n            input.transform,\n            input.bounds,\n            input.isPixelated,\n        );\n\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"transform\"],\n            action: \"apply\",\n            params: [{input}],\n        });\n        return true;\n    }\n\n};","import {BB} from '../../bb/bb';\nimport {KlSlider} from '../ui/base-components/kl-slider';\nimport {eventResMs} from './filters-consts';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\nimport {getSharedFx} from './shared-gl-fx';\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const filterBlur = {\n\n    getDialog(params: IFilterGetDialogParam) {\n        let klCanvas = params.klCanvas;\n        let context = params.context;\n        if (!klCanvas || !context) {\n            return false;\n        }\n\n        let layers = klCanvas.getLayers();\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\n        let w = Math.min(displayW, context.canvas.width);\n        let h = Math.min(displayH, context.canvas.height);\n\n        let tempCanvas = BB.canvas(w, h);\n        {\n            const ctx = tempCanvas.getContext(\"2d\");\n            ctx.save();\n            if (w > context.canvas.width) {\n                ctx.imageSmoothingEnabled = false;\n            }\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            ctx.restore();\n        }\n        let previewFactor = w / context.canvas.width;\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n\n\n        function finishInit() {\n            let radius = 10;\n            div.innerHTML = LANG('filter-triangle-blur-description') + \"<br/><br/>\";\n\n            let glCanvas = getSharedFx();\n            if (!glCanvas) {\n                return; // todo throw?\n            }\n            let texture = glCanvas.texture(tempCanvas);\n            glCanvas.draw(texture).update(); // update glCanvas size\n\n            let radiusSlider = new KlSlider({\n                label: LANG('radius'),\n                width: 300,\n                height: 30,\n                min: 1,\n                max: 200,\n                value: radius,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    radius = val;\n                    glCanvas.draw(texture).triangleBlur(radius * previewFactor).update();\n                    klCanvasPreview.render();\n                },\n            });\n            div.appendChild(radiusSlider.getElement());\n\n\n            let previewWrapper = document.createElement(\"div\");\n            BB.css(previewWrapper, {\n                width: \"340px\",\n                marginLeft: \"-20px\",\n                height: \"220px\",\n                backgroundColor: \"#9e9e9e\",\n                marginTop: \"10px\",\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n                overflow: \"hidden\",\n                position: \"relative\",\n                userSelect: 'none',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                colorScheme: 'only light',\n            });\n\n            let previewLayerArr: IKlBasicLayer[] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr\n                    });\n                }\n            }\n            let klCanvasPreview = new KlCanvasPreview({\n                width: parseInt('' + displayW),\n                height: parseInt('' + displayH),\n                layers: previewLayerArr\n            });\n\n            let previewInnerWrapper = BB.el({\n                css: {\n                    position: 'relative',\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                    width: parseInt('' + displayW) + 'px',\n                    height: parseInt('' + displayH) + 'px'\n                }\n            });\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\n            previewWrapper.appendChild(previewInnerWrapper);\n\n            div.appendChild(previewWrapper);\n\n            try {\n                glCanvas.draw(texture).triangleBlur(radius * previewFactor).update();\n                klCanvasPreview.render();\n            } catch(e) {\n                (div as any).errorCallback(e);\n            }\n\n            result.destroy = () => {\n                texture.destroy();\n                radiusSlider.destroy();\n            };\n            result.getInput = function () {\n                result.destroy();\n                return {\n                    radius: radius\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let history = params.history;\n        let radius = params.input.radius;\n        if (!context || !radius || !history)\n            return false;\n        history.pause(true);\n        let glCanvas = getSharedFx();\n        if (!glCanvas) {\n            return false; // todo more specific error?\n        }\n        let texture = glCanvas.texture(context.canvas);\n        glCanvas.draw(texture).triangleBlur(radius).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(glCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"blur\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    }\n\n};","import {BB} from '../../bb/bb';\nimport {eventResMs} from './filters-consts';\nimport {KlSlider} from '../ui/base-components/kl-slider';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\nimport {getSharedFx} from './shared-gl-fx';\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const filterUnsharpMask = {\n\n    getDialog(params: IFilterGetDialogParam) {\n        let context = params.context;\n        let klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        let layers = klCanvas.getLayers();\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\n        let w = Math.min(displayW, context.canvas.width);\n        let h = Math.min(displayH, context.canvas.height);\n\n        let tempCanvas = BB.canvas(w, h);\n        {\n            const ctx = tempCanvas.getContext(\"2d\");\n            ctx.save();\n            if (w > context.canvas.width) {\n                ctx.imageSmoothingEnabled = false;\n            }\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            ctx.restore();\n        }\n        let previewFactor = w / context.canvas.width;\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n\n        function finishInit() {\n            let radius = 2, strength = 5.1 / 10;\n            div.innerHTML = LANG('filter-unsharp-mask-description') + \"<br/><br/>\";\n\n            let glCanvas = getSharedFx();\n            if (!glCanvas) {\n                return; // todo throw?\n            }\n            let texture = glCanvas.texture(tempCanvas);\n            glCanvas.draw(texture).update(); // update glCanvas size\n\n            let radiusSlider = new KlSlider({\n                label: LANG('radius'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 200,\n                value: 2,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    radius = val;\n                    glCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\n                    klCanvasPreview.render();\n                },\n                curve: [[0, 0], [0.1, 2], [0.5, 50], [1, 200]],\n            });\n            let strengthSlider = new KlSlider({\n                label: LANG('filter-unsharp-mask-strength'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 50,\n                value: 5.1,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    strength = val / 10;\n                    glCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\n                    klCanvasPreview.render();\n                },\n                curve: [[0, 0], [0.1, 2], [0.5, 10], [1, 50]],\n            });\n            radiusSlider.getElement().style.marginBottom = \"10px\";\n            div.appendChild(radiusSlider.getElement());\n            div.appendChild(strengthSlider.getElement());\n\n\n            let previewWrapper = document.createElement(\"div\");\n            BB.css(previewWrapper, {\n                width: \"340px\",\n                marginLeft: \"-20px\",\n                height: \"220px\",\n                backgroundColor: \"#9e9e9e\",\n                marginTop: \"10px\",\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n                overflow: \"hidden\",\n                position: \"relative\",\n                userSelect: 'none',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                colorScheme: 'only light',\n            });\n\n            let previewLayerArr: IKlBasicLayer[] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr\n                    });\n                }\n            }\n            let klCanvasPreview = new KlCanvasPreview({\n                width: parseInt('' + displayW),\n                height: parseInt('' + displayH),\n                layers: previewLayerArr\n            });\n\n            let previewInnerWrapper = BB.el({\n                css: {\n                    position: 'relative',\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                    width: parseInt('' + displayW) + 'px',\n                    height: parseInt('' + displayH) + 'px'\n                }\n            });\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\n            previewWrapper.appendChild(previewInnerWrapper);\n\n\n            div.appendChild(previewWrapper);\n\n            try {\n                glCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\n                klCanvasPreview.render();\n            } catch(e) {\n                (div as any).errorCallback(e);\n            }\n\n            result.destroy = () => {\n                radiusSlider.destroy();\n                strengthSlider.destroy();\n                texture.destroy();\n            };\n            result.getInput = function () {\n                result.destroy();\n                return {\n                    radius: radius,\n                    strength: strength\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n\n        return result;\n    },\n\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let history = params.history;\n        let radius = params.input.radius;\n        let strength = params.input.strength;\n        if (!context || radius === null || strength === null || !history)\n            return false;\n        history.pause(true);\n        let glCanvas = getSharedFx();\n        if (!glCanvas) {\n            return false; // todo more specific error?\n        }\n        let texture = glCanvas.texture(context.canvas);\n        glCanvas.draw(texture).unsharpMask(radius, strength).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(glCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"unsharpMask\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    }\n\n};","import {BB} from '../../bb/bb';\nimport {Options} from '../ui/base-components/options';\nimport {ColorOptions} from '../ui/base-components/color-options';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\nimport {getSharedFx} from './shared-gl-fx';\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const filterToAlpha = {\n\n    getDialog(params: IFilterGetDialogParam) {\n        let context = params.context;\n        let klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        let layers = klCanvas.getLayers();\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n\n        let tempCanvas = BB.canvas(w, h);\n        {\n            const ctx = tempCanvas.getContext(\"2d\");\n            ctx.save();\n            if (tempCanvas.width > context.canvas.width) {\n                ctx.imageSmoothingEnabled = false;\n            }\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            ctx.restore();\n        }\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n\n        function finishInit() {\n            let radius = 2, strength = 5.1 / 10;\n            div.appendChild(BB.el({\n                content: LANG('filter-to-alpha-description'),\n                css: {\n                    marginBottom: '5px'\n                }\n            }));\n\n            let glCanvas = getSharedFx();\n            if (!glCanvas) {\n                return; // todo throw?\n            }\n            let texture = glCanvas.texture(tempCanvas);\n            glCanvas.draw(texture).update(); // update glCanvas size\n\n            function updatePreview() {\n                glCanvas.draw(texture).toAlpha(sourceId === 'inverted-luminance', selectedRgbaObj).update();\n                klCanvasPreview.render();\n            }\n\n            // source\n            let sourceId = 'inverted-luminance';\n            let sourceOptions = new Options({\n                optionArr: [\n                    {\n                        id: 'inverted-luminance',\n                        label: LANG('filter-to-alpha-inverted-lum')\n                    },\n                    {\n                        id: 'luminance',\n                        label: LANG('filter-to-alpha-lum')\n                    }\n                ],\n                initialId: sourceId,\n                onChange: function(id) {\n                    sourceId = id;\n                    updatePreview();\n                }\n            });\n            div.appendChild(sourceOptions.getElement());\n\n            // color\n            let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\n            let colorOptionsArr = [\n                null,\n                {r: 0, g: 0, b: 0, a: 1},\n                {r: 255, g: 255, b: 255, a: 1}\n            ];\n            colorOptionsArr.push({\n                r: params.currentColorRgb.r,\n                g: params.currentColorRgb.g,\n                b: params.currentColorRgb.b,\n                a: 1,\n            });\n            colorOptionsArr.push({\n                r: params.secondaryColorRgb.r,\n                g: params.secondaryColorRgb.g,\n                b: params.secondaryColorRgb.b,\n                a: 1,\n            });\n\n            let colorOptions = new ColorOptions({\n                label: LANG('filter-to-alpha-replace'),\n                colorArr: colorOptionsArr,\n                initialIndex: 1,\n                onChange: function(rgbaObj) {\n                    selectedRgbaObj = rgbaObj;\n                    updatePreview();\n                }\n            });\n            colorOptions.getElement().style.marginTop = '10px';\n            div.appendChild(colorOptions.getElement());\n\n\n            let previewWrapper = document.createElement(\"div\");\n            BB.css(previewWrapper, {\n                width: \"340px\",\n                marginLeft: \"-20px\",\n                height: \"220px\",\n                backgroundColor: \"#9e9e9e\",\n                marginTop: \"10px\",\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n                overflow: \"hidden\",\n                position: \"relative\",\n                userSelect: 'none',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                colorScheme: 'only light',\n            });\n\n            let previewLayerArr: IKlBasicLayer[] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr\n                    });\n                }\n            }\n            let klCanvasPreview = new KlCanvasPreview({\n                width: parseInt('' + w),\n                height: parseInt('' + h),\n                layers: previewLayerArr\n            });\n\n            let previewInnerWrapper = BB.el({\n                css: {\n                    position: 'relative',\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                    width: parseInt('' + w) + 'px',\n                    height: parseInt('' + h) + 'px'\n                }\n            });\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\n            previewWrapper.appendChild(previewInnerWrapper);\n\n\n            div.appendChild(previewWrapper);\n\n            setTimeout(function() { //ie has a problem otherwise...\n                try {\n                    updatePreview();\n                } catch(e) {\n                    (div as any).errorCallback(e);\n                }\n            }, 1);\n\n            result.destroy = () => {\n                texture.destroy();\n                sourceOptions.destroy();\n            };\n            result.getInput = function () {\n                result.destroy();\n                return {\n                    sourceId: sourceId,\n                    selectedRgbaObj: selectedRgbaObj\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n\n        return result;\n    },\n\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let history = params.history;\n        let sourceId = params.input.sourceId;\n        let selectedRgbaObj = params.input.selectedRgbaObj;\n        if (!context || !sourceId || !history)\n            return false;\n        history.pause(true);\n        let glCanvas = getSharedFx();\n        if (!glCanvas) {\n            return false; // todo more specific error?\n        }\n        let texture = glCanvas.texture(context.canvas);\n        glCanvas.draw(texture).toAlpha(sourceId === 'inverted-luminance', selectedRgbaObj).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(glCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"toAlpha\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    }\n\n};","import {BB} from '../../bb/bb';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\n// @ts-ignore\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer, IMixMode} from '../kl.types';\nimport {LANG} from '../../language/language';\nimport {input} from '../ui/base-components/input';\nimport {ColorOptions} from '../ui/base-components/color-options';\nimport {drawGrid} from '../image-operations/draw-grid';\n\n\n\nexport const filterGrid = {\n\n    getDialog(params: IFilterGetDialogParam) {\n        let context = params.context;\n        let klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        let layers = klCanvas.getLayers();\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n        const renderW = Math.min(w, context.canvas.width);\n        const renderH = Math.min(h, context.canvas.height);\n        const renderFactor = renderW / context.canvas.width;\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n        div.innerHTML = LANG('filter-grid-description') + \"<br/><br/>\";\n\n        const settingsObj = {\n            x: 2,\n            y: 2,\n            thickness: 2,\n            color: '#000',\n            opacity: 1,\n        };\n\n        let line1 = BB.el({\n            parent: div,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n            }\n        });\n        let line2 = BB.el({\n            parent: div,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                marginTop: '10px'\n            }\n        });\n        const xInput = input({\n            init: 2,\n            type: 'number',\n            min: 1,\n            css: {width: '75px', marginRight: '20px'},\n            callback: function(v) {\n                settingsObj.x = parseFloat(v);\n                updatePreview();\n            }\n        });\n        const yInput = input({\n            init: 2,\n            type: 'number',\n            min: 1,\n            css: {width: '75px', marginRight: '20px'},\n            callback: function(v) {\n                settingsObj.y = parseFloat(v);\n                updatePreview();\n            }\n        });\n        const thicknessInput = input({\n            init: 2,\n            type: 'number',\n            min: 1,\n            css: {width: '75px', marginRight: '20px'},\n            callback: function(v) {\n                settingsObj.thickness = parseFloat(v);\n                updatePreview();\n            }\n        });\n\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\n        const colorOptionsArr = [\n            {r: 0, g: 0, b: 0, a: 1},\n            {r: 255, g: 255, b: 255, a: 1},\n        ];\n        colorOptionsArr.push({\n            r: params.currentColorRgb.r,\n            g: params.currentColorRgb.g,\n            b: params.currentColorRgb.b,\n            a: 1,\n        });\n        colorOptionsArr.push({\n            r: params.secondaryColorRgb.r,\n            g: params.secondaryColorRgb.g,\n            b: params.secondaryColorRgb.b,\n            a: 1,\n        });\n        settingsObj.color = BB.ColorConverter.toRgbStr(selectedRgbaObj);\n\n        const colorOptions = new ColorOptions({\n            label: LANG('shape-stroke'),\n            colorArr: colorOptionsArr,\n            onChange: function(rgbaObj) {\n                selectedRgbaObj = rgbaObj;\n                settingsObj.color = BB.ColorConverter.toRgbStr(selectedRgbaObj);\n                updatePreview();\n            }\n        });\n\n        const labelStyle = {\n            display: 'inline-block',\n            marginRight: '5px',\n        };\n        line1.append(\n            BB.el({content: 'X:', css: labelStyle}),\n            xInput,\n            BB.el({content: 'Y:', css: labelStyle}),\n            yInput,\n        );\n        line2.append(\n            BB.el({content: LANG('shape-line-width') + ':', css: labelStyle}),\n            thicknessInput,\n            BB.el({css:{flexGrow: '1'}}),\n            colorOptions.getElement(),\n        );\n\n\n        let previewWrapper = document.createElement(\"div\");\n        BB.css(previewWrapper, {\n            width: \"340px\",\n            marginLeft: \"-20px\",\n            height: \"220px\",\n            backgroundColor: \"#9e9e9e\",\n            marginTop: \"10px\",\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n            overflow: \"hidden\",\n            position: \"relative\",\n            userSelect: 'none',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            colorScheme: 'only light',\n        });\n\n        let previewLayer: IKlBasicLayer = {\n            image: BB.canvas(renderW, renderH),\n            opacity: layers[selectedLayerIndex].opacity,\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\n        };\n        let klCanvasPreview = new KlCanvasPreview({\n            width: Math.round(w),\n            height: Math.round(h),\n            layers: layers.map((item, i) => {\n                if (i === selectedLayerIndex) {\n                    return previewLayer;\n                } else {\n                    return {\n                        image: item.context.canvas,\n                        opacity: item.opacity,\n                        mixModeStr: item.mixModeStr,\n                    };\n                }\n            })\n        });\n\n        let previewInnerWrapper = BB.el({\n            css: {\n                position: 'relative',\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                width: parseInt('' + w) + 'px',\n                height: parseInt('' + h) + 'px'\n            }\n        });\n        previewInnerWrapper.appendChild(klCanvasPreview.getElement());\n        previewWrapper.appendChild(previewInnerWrapper);\n\n        function updatePreview() {\n            let ctx = (previewLayer.image as HTMLCanvasElement).getContext('2d');\n            ctx.save();\n            ctx.clearRect(0, 0, renderW, renderH);\n            ctx.drawImage(context.canvas, 0, 0, renderW, renderH);\n            drawGrid(ctx, settingsObj.x, settingsObj.y, Math.max(settingsObj.thickness * renderFactor, 1), settingsObj.color, settingsObj.opacity);\n\n            ctx.restore();\n            klCanvasPreview.render();\n        }\n        setTimeout(updatePreview, 0);\n\n\n        div.appendChild(previewWrapper);\n        result.destroy = () => {\n        };\n        result.getInput = function () {\n            result.destroy();\n            return BB.copyObj(settingsObj);\n        };\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let klCanvas = params.klCanvas;\n        let history = params.history;\n        if (!context || !klCanvas || !history) {\n            return false;\n        }\n\n        history.pause(true);\n        drawGrid(context, params.input.x, params.input.y, params.input.thickness, params.input.color, params.input.opacity);\n        history.pause(false);\n\n        history.push({\n            tool: [\"filter\", \"grid\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    },\n\n};","\n// ideas: padding, gutter, other shapes\n\nexport function drawGrid(\n    ctx: CanvasRenderingContext2D,\n    cellsX: number,\n    cellsY: number,\n    thickness: number, // px\n    color: string,\n    opacity: number, // 0 - 1\n) {\n    ctx.save();\n    const w = ctx.canvas.width;\n    const h = ctx.canvas.height;\n    thickness = Math.round(thickness);\n    const thickIsRound = thickness % 2 === 0;\n\n    ctx.beginPath();\n    ctx.lineWidth = thickness;\n    ctx.strokeStyle = color;\n    ctx.globalAlpha = opacity;\n\n    for(let i = 0; i < cellsX - 1; i++) {\n        const cw = w / (cellsX);\n        let pos = cw * (i + 1);\n        if (thickIsRound) {\n            pos = Math.round(pos);\n        } else {\n            pos = Math.round(pos + 0.5) - 0.5;\n        }\n        ctx.moveTo(pos, 0);\n        ctx.lineTo(pos, h);\n\n    }\n    for(let i = 0; i < cellsY - 1; i++) {\n        const ch = h / (cellsY);\n        let pos = ch * (i + 1);\n        if (thickIsRound) {\n            pos = Math.round(pos);\n        } else {\n            pos = Math.round(pos + 0.5) - 0.5;\n        }\n\n        ctx.moveTo(0, pos);\n        ctx.lineTo(w, pos);\n    }\n\n    ctx.stroke();\n    ctx.restore();\n}","import {BB} from '../../bb/bb';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\n// @ts-ignore\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer, IMixMode, IRGB} from '../kl.types';\nimport {LANG} from '../../language/language';\nimport {KlSlider} from '../ui/base-components/kl-slider';\nimport {getSharedFx} from './shared-gl-fx';\nimport {Options} from '../ui/base-components/options';\nimport {eventResMs} from './filters-consts';\nimport {Select} from '../ui/base-components/select';\nimport {translateBlending} from '../canvas/translate-blending';\nimport {KL} from '../kl';\nimport {ColorConverter} from '../../bb/color/color';\n// @ts-ignore\nimport uiSwapImg from 'url:~/src/app/img/ui/ui-swap-lr.svg';\nimport {Checkbox} from '../ui/base-components/checkbox';\n\n// see noise(...) in glfx.ts\ninterface INoisePreset {\n    type: number;\n    scaleX: number;\n    scaleY: number;\n    offsetX: number;\n    offsetY: number;\n    octaves: number;\n    samples: number;\n    peaks: number;\n    brightness: number;\n    contrast: number;\n    isReversed: boolean;\n}\n\ntype TNoiseChannels = 'rgb' | 'alpha';\n\ninterface INoiseSettings extends INoisePreset {\n    seed: number;\n    colA: IRGB;\n    colB: IRGB;\n    channels: TNoiseChannels;\n}\n\ninterface INoiseFilterInput {\n    seed: number;\n    presetIndex: number; // which preset from presetArr\n    scale: number; // applies to both scaleX and scaleX\n    opacity: number; // aka strength\n    isReversed: boolean; // reverse direction of color gradient\n    channels: TNoiseChannels;\n\n    // only for channels = rgb\n    mixModeStr: GlobalCompositeOperation; // how mixed with image\n    colA: IRGB;\n    colB: IRGB;\n}\n\nconst presetArr: INoisePreset[] = [\n    // each pixel random value\n    {type: 0, scaleX: 1, scaleY: 1, offsetX: 0, offsetY: 0, octaves: 1, samples: 1, peaks: 0, brightness: 0, contrast: 0, isReversed: true},\n\n    // cloud\n    {type: 1, scaleX: 166, scaleY: 164, offsetX: 105, offsetY: 30, octaves: 6, samples: 1, peaks: 0, brightness: 0.055, contrast: 0.23, isReversed: true},\n\n    // thin lines\n    {type: 1, scaleX: 235, scaleY: 190, offsetX: 3227, offsetY: 2156, octaves: 4, samples: 16, peaks: 22, brightness: -0.375, contrast: 1, isReversed: false},\n\n    // soft large simplex, only 1 octave\n    {type: 1, scaleX: 40, scaleY: 40, offsetX: 0, offsetY: 0, octaves: 1, samples: 1, peaks: 0, brightness: 0, contrast: 0, isReversed: false},\n\n    // two value large pixels\n    {type: 0, scaleX: 26, scaleY: 26, offsetX: 557, offsetY: 365, octaves: 1, samples: 1, peaks: 0, brightness: 0.02, contrast: 1, isReversed: true},\n\n    // zebra\n    {type: 1, scaleX: 1500, scaleY: 1500, offsetX: 745, offsetY: 2871, octaves: 5, samples: 16, peaks: 156.02, brightness: 0.03, contrast: 1, isReversed: true},\n\n    // sparse dots / stars\n    {type: 1, scaleX: 11, scaleY: 11, offsetX: 2940, offsetY: 2045, octaves: 1, samples: 16, peaks: 1, brightness: -0.045, contrast: 1, isReversed: true},\n\n    // pseudo marble\n    {type: 2, scaleX: 74, scaleY: 74, offsetX: 4816, offsetY: 1304, octaves: 3, samples: 1, peaks: 2.78, brightness: 0, contrast: 0, isReversed: false},\n];\n\nfunction drawNoise(glCanvas, settings: INoiseSettings): void {\n    glCanvas.noise(\n        settings.seed  ? settings.seed : 0,\n        settings.type,\n        [settings.scaleX, settings.scaleY],\n        [glCanvas.width / 2, glCanvas.height / 2],\n        settings.octaves,\n        settings.samples,\n        settings.peaks,\n        settings.brightness,\n        settings.contrast,\n        settings.isReversed,\n        settings.colA,\n        settings.colB,\n        settings.channels ? settings.channels : 'rgb',\n    ).update();\n}\n\n\nexport const filterNoise = {\n\n    getDialog(params: IFilterGetDialogParam) {\n        let context = params.context;\n        let klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        let layers = klCanvas.getLayers();\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n        const renderW = Math.min(w, context.canvas.width);\n        const renderH = Math.min(h, context.canvas.height);\n        const renderFactor = renderW / context.canvas.width;\n\n\n        let glCanvas = getSharedFx();\n        if (!glCanvas) {\n            return; // todo throw?\n        }\n        let texture;\n\n        const thumbImgArr = [];\n        const thumbSize = 32;\n        {\n            const canvas = BB.canvas(thumbSize, thumbSize);\n            const ctx = canvas.getContext('2d');\n            texture = glCanvas.texture(canvas);\n            glCanvas.draw(texture).update(); // update glCanvas size\n            texture.destroy();\n\n            presetArr.forEach((preset, index) => {\n                const thumbImg = new Image();\n                const presetCopy = BB.copyObj(preset);\n                presetCopy.scaleX /= 10;\n                presetCopy.scaleY /= 10;\n                drawNoise(glCanvas, presetCopy);\n                ctx.drawImage(glCanvas, 0, 0);\n                thumbImg.src = canvas.toDataURL('image/png');\n                thumbImgArr.push(thumbImg);\n            });\n\n        }\n\n        let tempCanvas = BB.canvas(renderW, renderH);\n        texture = glCanvas.texture(tempCanvas);\n        glCanvas.draw(texture).update(); // update glCanvas size\n        tempCanvas = null;\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n\n        div.innerHTML = LANG('filter-noise-description') + \"<br/><br/>\";\n\n        const settingsObj: INoiseFilterInput = {\n            seed: Math.random() * 300,\n            presetIndex: 0,\n            scale: 50,\n            opacity: 0.5,\n            isReversed: false,\n            channels: 'rgb',\n            mixModeStr: 'source-over' as GlobalCompositeOperation,\n            colA: {r: 0, g: 0, b: 0},\n            colB: {r: 255, g: 255, b: 255},\n        };\n\n\n        const presetOptions = new Options({\n            optionArr: thumbImgArr.map((img, index) => {\n                BB.css(img, {\n                    margin: '1px',\n                    borderRadius: '3px',\n                    transition: 'all 0.1s ease-in-out',\n                })\n                return {\n                    id: '' + index,\n                    label: img,\n                };\n            }),\n            initialId: '0',\n            onChange: (id) => {\n                settingsObj.presetIndex = Number(id);\n                updatePreview();\n            }\n        });\n        presetOptions.getElement().style.marginBottom = '10px';\n        div.append(presetOptions.getElement());\n\n        const scaleSlider = new KlSlider({\n            label: LANG('filter-noise-scale'),\n            width: 300,\n            height: 30,\n            min: 1,\n            max: 1000,\n            value: settingsObj.scale,\n            eventResMs: eventResMs,\n            curve: BB.quadraticSplineInput(1, 1000, 0.1),\n            onChange: (value) => {\n                settingsObj.scale = value;\n                updatePreview();\n            },\n        });\n        scaleSlider.getElement().style.marginBottom = \"10px\";\n\n        const opacitySlider = new KlSlider({\n            label: LANG('opacity'),\n            width: 300,\n            height: 30,\n            min: 1 / 100,\n            max: 1,\n            value: settingsObj.opacity,\n            eventResMs: eventResMs,\n            toValue: (displayValue) => displayValue / 100,\n            toDisplayValue: (value) => value * 100,\n            onChange: (value) => {\n                settingsObj.opacity = value;\n                updatePreview();\n            },\n        });\n        opacitySlider.getElement().style.marginBottom = \"10px\";\n\n        const row1El = BB.el({\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                marginBottom: '10px',\n            }\n        });\n\n        const row2El = BB.el({\n            css: {\n                display: 'flex',\n            }\n        });\n\n        const channelsOptions = new Options({\n            optionArr: [\n                {id: 'rgb', label: 'RGB'},\n                {id: 'alpha', label: LANG('filter-noise-alpha')},\n            ],\n            initialId: 'rgb',\n            onChange: (id: TNoiseChannels) => {\n                settingsObj.channels = id;\n                if (id === 'rgb') {\n                    row2El.style.visibility = '';\n                } else {\n                    row2El.style.visibility = 'hidden';\n                }\n                updatePreview();\n            },\n        });\n\n        const reverseToggle = new Checkbox({\n            label: LANG('reverse'),\n            callback: (val) => {\n                settingsObj.isReversed = val;\n                updatePreview();\n            },\n            allowTab: true,\n        });\n\n        const blendSelect = new Select({\n            isFocusable: true,\n            optionArr: [\n                'source-over',\n                null,\n                'darken',\n                'multiply',\n                'color-burn',\n                null,\n                'lighten',\n                'screen',\n                'color-dodge',\n                null,\n                'overlay',\n                'soft-light',\n                'hard-light',\n                null,\n                'difference',\n                'exclusion',\n                null,\n                'hue',\n                'saturation',\n                'color',\n                'luminosity',\n            ].map((item: IMixMode) => {\n                return item ? [item, translateBlending(item)] : null;\n            }),\n            initValue: settingsObj.mixModeStr,\n            onChange: (val: GlobalCompositeOperation) => {\n                settingsObj.mixModeStr = val;\n                updatePreview();\n            },\n        });\n        blendSelect.getElement().title = LANG('layers-blending');\n\n        const colorWrapper = BB.el({\n            css: {\n                display: 'flex',\n            }\n        });\n\n        const colInputStyle = {\n            width: '34px',\n            height: '34px',\n            marginRight: '5px',\n        }\n        const colAInput = KL.input({\n            type: 'color',\n            init: '#' + ColorConverter.toHexString(settingsObj.colA),\n            callback: (val) => {\n                settingsObj.colA = ColorConverter.hexToRGB(val);\n                updatePreview();\n            },\n            css: colInputStyle,\n        });\n\n        const colBInput = KL.input({\n            type: 'color',\n            init: '#' + ColorConverter.toHexString(settingsObj.colB),\n            callback: (val) => {\n                settingsObj.colB = ColorConverter.hexToRGB(val);\n                updatePreview();\n            },\n            css: colInputStyle,\n        });\n\n        colorWrapper.append(\n            colAInput,\n            colBInput,\n        );\n\n\n        row1El.append(\n            channelsOptions.getElement(),\n            BB.el({css:{flexGrow: '1',}}),\n            reverseToggle.getElement(),\n        );\n\n        row2El.append(\n            blendSelect.getElement(),\n            BB.el({css:{flexGrow: '1',}}),\n            colorWrapper,\n        );\n\n        div.append(\n            scaleSlider.getElement(),\n            opacitySlider.getElement(),\n            row1El,\n            row2El,\n        );\n\n\n\n        let previewWrapper = document.createElement(\"div\");\n        BB.css(previewWrapper, {\n            width: \"340px\",\n            marginLeft: \"-20px\",\n            height: \"220px\",\n            backgroundColor: \"#9e9e9e\",\n            marginTop: \"10px\",\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n            overflow: \"hidden\",\n            position: \"relative\",\n            userSelect: 'none',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            colorScheme: 'only light',\n        });\n\n        let previewLayer: IKlBasicLayer = {\n            image: BB.canvas(renderW, renderH),\n            opacity: layers[selectedLayerIndex].opacity,\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\n        };\n        let klCanvasPreview = new KlCanvasPreview({\n            width: Math.round(w),\n            height: Math.round(h),\n            layers: layers.map((item, i) => {\n                if (i === selectedLayerIndex) {\n                    return previewLayer;\n                } else {\n                    return {\n                        image: item.context.canvas,\n                        opacity: item.opacity,\n                        mixModeStr: item.mixModeStr,\n                    };\n                }\n            })\n        });\n\n        let previewInnerWrapper = BB.el({\n            css: {\n                position: 'relative',\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                width: parseInt('' + w) + 'px',\n                height: parseInt('' + h) + 'px'\n            }\n        });\n        previewInnerWrapper.appendChild(klCanvasPreview.getElement());\n        previewWrapper.appendChild(previewInnerWrapper);\n\n        function updatePreview() {\n            let ctx = (previewLayer.image as HTMLCanvasElement).getContext('2d');\n            ctx.save();\n            ctx.clearRect(0, 0, renderW, renderH);\n            ctx.drawImage(context.canvas, 0, 0, renderW, renderH);\n\n            ctx.globalAlpha = settingsObj.opacity;\n\n            const presetCopy = BB.copyObj(presetArr[settingsObj.presetIndex]);\n            presetCopy.seed = settingsObj.seed;\n            presetCopy.scaleX = presetCopy.scaleX  * settingsObj.scale / 50 * renderFactor;\n            presetCopy.scaleY = presetCopy.scaleY  * settingsObj.scale / 50 * renderFactor;\n            presetCopy.colA = settingsObj.colA;\n            presetCopy.colB = settingsObj.colB;\n            presetCopy.isReversed = settingsObj.isReversed ? !presetCopy.isReversed : presetCopy.isReversed;\n            presetCopy.channels  = settingsObj.channels;\n            drawNoise(glCanvas, presetCopy);\n\n            if (settingsObj.channels === 'alpha') {\n                ctx.globalCompositeOperation = 'destination-out';\n            } else {\n                ctx.globalCompositeOperation = settingsObj.mixModeStr;\n            }\n\n            ctx.drawImage(glCanvas, 0, 0);\n\n            ctx.restore();\n            klCanvasPreview.render();\n        }\n        setTimeout(updatePreview, 0);\n\n        div.appendChild(previewWrapper);\n        result.destroy = () => {\n            presetOptions.destroy();\n            scaleSlider.destroy();\n            opacitySlider.destroy();\n            reverseToggle.destroy();\n            channelsOptions.destroy();\n            texture.destroy();\n            blendSelect.destroy();\n        };\n        result.getInput = function () {\n            result.destroy();\n            return BB.copyObj(settingsObj);\n        };\n\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let klCanvas = params.klCanvas;\n        let history = params.history;\n        if (!context || !klCanvas || !history) {\n            return false;\n        }\n\n        history.pause(true);\n\n        let glCanvas = getSharedFx();\n        if (!glCanvas) {\n            return false; // todo more specific error?\n        }\n        let texture = glCanvas.texture(context.canvas);\n        glCanvas.draw(texture).update();\n        texture.destroy();\n\n        const input: INoiseFilterInput = params.input;\n\n        const presetCopy = BB.copyObj(presetArr[input.presetIndex]);\n        presetCopy.seed = input.seed;\n        presetCopy.scaleX = presetCopy.scaleX  * input.scale / 50;\n        presetCopy.scaleY = presetCopy.scaleY  * input.scale / 50;\n        presetCopy.colA = input.colA;\n        presetCopy.colB = input.colB;\n        presetCopy.isReversed = input.isReversed ? !presetCopy.isReversed : presetCopy.isReversed;\n        presetCopy.channels  = input.channels;\n        drawNoise(glCanvas, presetCopy);\n\n        context.save();\n        context.globalAlpha = input.opacity;\n        if (input.channels === 'alpha') {\n            context.globalCompositeOperation = 'destination-out';\n        } else {\n            context.globalCompositeOperation = input.mixModeStr;\n        }\n        context.drawImage(glCanvas, 0, 0);\n        context.restore();\n\n        history.pause(false);\n\n        history.push({\n            tool: [\"canvas\"],\n            action: \"replaceLayer\",\n            params: [\n                klCanvas.getLayerIndex(context.canvas),\n                context.getImageData(0, 0, context.canvas.width, context.canvas.height),\n            ]\n        });\n        return true;\n    },\n\n};","import {BB} from '../../bb/bb';\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl.types';\nimport {input} from '../ui/base-components/input';\nimport {KlSlider} from '../ui/base-components/kl-slider';\nimport {LANG} from '../../language/language';\nimport {eventResMs} from './filters-consts';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\nimport {TwoTabs} from '../ui/components/two-tabs';\nimport {IVector2D} from '../../bb/bb.types';\n\n\ninterface IPatternSettings {\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n    blend?: number; // [0, 1] - 1 will blend linearly across whole length\n    offsetX: number;\n    offsetY: number;\n}\n\n/**\n * Draws pattern onto context. Pattern generated from context.\n * Can use blending for smoother transition. Will use area outside of bounds for blending.\n *\n * @param context\n * @param settings\n */\nfunction drawPattern(context: CanvasRenderingContext2D, settings: IPatternSettings): void {\n\n    // keep bounds in center via offset\n    // because blending done towards bottom right\n    const blendOffsetX = settings.blend ? Math.round(settings.blend * settings.width / 2) : 0;\n    const blendOffsetY = settings.blend ? Math.round(settings.blend * settings.height / 2) : 0;\n\n    const finalPatternCanvas = BB.canvas(settings.width, settings.height);\n\n    if (settings.blend) {\n        // construct pattern via linear blending\n\n        const blendCanvas = BB.canvas(settings.width * 2, settings.height * 2);\n        const blendCtx = blendCanvas.getContext('2d');\n        const colTransparent = '#0000';\n        const colOpaque = '#000';\n\n        // transfer source to blendCanvas\n        blendCtx.drawImage(\n            context.canvas,\n            -settings.x + blendOffsetX,\n            -settings.y + blendOffsetY,\n        );\n\n        // --- 1 cross-fade vertical ------------------------\n\n        // erase vertical gradient bottom half\n        blendCtx.save();\n        let blendGradient = blendCtx.createLinearGradient(0, settings.height, 0, settings.height * 2);\n        blendGradient.addColorStop(0, colOpaque);\n        blendGradient.addColorStop(settings.blend, colTransparent);\n        blendCtx.globalCompositeOperation = 'destination-in';\n        blendCtx.fillStyle = blendGradient;\n        blendCtx.fillRect(0, 0, blendCanvas.width, blendCanvas.height);\n        blendCtx.restore();\n\n        // erase vertical gradient top half\n        blendCtx.save();\n        blendGradient = blendCtx.createLinearGradient(0, 0, 0, settings.height);\n        blendGradient.addColorStop(0, colTransparent);\n        blendGradient.addColorStop(settings.blend, colOpaque);\n        blendCtx.globalCompositeOperation = 'destination-in';\n        blendCtx.fillStyle = blendGradient;\n        blendCtx.fillRect(0, 0, settings.width * 2, settings.height * 2);\n        blendCtx.restore();\n\n        // draw bottom half over top half\n        blendCtx.save();\n        // lighter needed for accurate cross-fade\n        blendCtx.globalCompositeOperation = 'lighter';\n        blendCtx.drawImage(blendCanvas, 0, -settings.height);\n        blendCtx.restore();\n\n\n\n        // --- 2 cross-fade horizontal ------------------------\n\n        // erase horizontal gradient right half\n        blendCtx.save();\n        blendGradient = blendCtx.createLinearGradient(settings.width, 0, settings.width * 2, 0);\n        blendGradient.addColorStop(0, colOpaque);\n        blendGradient.addColorStop(settings.blend, colTransparent);\n        blendCtx.globalCompositeOperation = 'destination-in';\n        blendCtx.fillStyle = blendGradient;\n        blendCtx.fillRect(0, 0, blendCanvas.width, blendCanvas.height);\n        blendCtx.restore();\n\n        // erase horizontal gradient left half\n        blendCtx.save();\n        blendGradient = blendCtx.createLinearGradient(0, 0, settings.width, 0);\n        blendGradient.addColorStop(0, colTransparent);\n        blendGradient.addColorStop(settings.blend, colOpaque);\n        blendCtx.globalCompositeOperation = 'destination-in';\n        blendCtx.fillStyle = blendGradient;\n        blendCtx.fillRect(0, 0, settings.width * 2, settings.height * 2);\n        blendCtx.restore();\n\n        // draw right half over left half\n        blendCtx.save();\n        // lighter needed for accurate cross-fade\n        blendCtx.globalCompositeOperation = 'lighter';\n        blendCtx.drawImage(blendCanvas, -settings.width, 0);\n        blendCtx.restore();\n\n        // transfer to pattern canvas\n        finalPatternCanvas.getContext('2d').drawImage(blendCanvas, 0, 0);\n\n    } else {\n        finalPatternCanvas.getContext('2d').drawImage(\n            context.canvas,\n            -settings.x,\n            -settings.y,\n        );\n    }\n\n    context.save();\n\n    context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n    context.translate(settings.offsetX - blendOffsetX, settings.offsetY - blendOffsetY);\n    context.fillStyle = context.createPattern(finalPatternCanvas, 'repeat');\n    context.fillRect(-settings.offsetX + blendOffsetX, -settings.offsetY + blendOffsetY, context.canvas.width, context.canvas.height);\n\n    context.restore();\n}\n\n\nexport const filterPattern = {\n\n    getDialog(params: IFilterGetDialogParam) {\n\n        const isSmall = window.innerWidth < 550;\n        const maxSize = 1024;\n        const rootEl = BB.el({\n            content: LANG('filter-pattern-description') + '<br><br>',\n        });\n        const context = params.context;\n        const width = context.canvas.width;\n        const height = context.canvas.height;\n\n        let settings: IPatternSettings = {\n            x: 0,\n            y: 0,\n            width: width <= 250 ? Math.round(width / 4) : 200,\n            height: height <= 250 ? Math.round(height / 4) : 200,\n            blend: 0,\n            offsetX: 0,\n            offsetY: 0,\n        };\n        let lastDrawnSettings = null;\n\n        // determine bounds\n        const bounds = BB.canvasBounds(context);\n        // adjust settings according to bounds\n        if ( // use layer bounds if:\n            bounds &&\n            (bounds.width <= maxSize && bounds.height <= maxSize) && // don't exceed max size\n            (bounds.width < width * 0.75 || bounds.height < height * 0.75) // aren't too large (heuristic)\n        ) {\n            settings.x = bounds.x;\n            settings.y = bounds.y;\n            settings.width = bounds.width;\n            settings.height = bounds.height;\n        } else { // otherwise use default size in center\n            settings.x = Math.round(width / 2 - settings.width / 2);\n            settings.y = Math.round(height / 2 - settings.height / 2);\n        }\n\n        // ---- controls ----\n\n        const xInput = input({\n            init: settings.x,\n            type: 'number',\n            min: 0,\n            max: width,\n            css: {width: '100%'},\n            callback: function(v) {\n                settings.x = Number(v);\n                updatePreview();\n            }\n        });\n        const yInput = input({\n            init: settings.y,\n            type: 'number',\n            min: 0,\n            max: height,\n            css: {width: '100%'},\n            callback: function(v) {\n                settings.y = Number(v);\n                updatePreview();\n            }\n        });\n        const widthInput = input({\n            init: settings.width,\n            type: 'number',\n            min: 1,\n            max: Math.min(maxSize, width),\n            css: {width: '100%'},\n            callback: function(v) {\n                settings.width = Number(v);\n                updatePreview();\n            }\n        });\n        const heightInput = input({\n            init: settings.height,\n            type: 'number',\n            min: 1,\n            max: Math.min(maxSize, height),\n            css: {width: '100%'},\n            callback: function(v) {\n                settings.height = Number(v);\n                updatePreview();\n            }\n        });\n\n        const inputStyle = {\n            marginLeft: '5px',\n            flex: '1',\n        };\n        rootEl.append(\n            BB.el({\n               content: [\n\n                   BB.el({\n                       tagName: 'label',\n                       content: [\n                           'X:',\n                           xInput,\n                       ],\n                       css: inputStyle,\n                   }),\n\n                   BB.el({\n                       tagName: 'label',\n                       content: [\n                           'Y:',\n                           yInput,\n                       ],\n                       css: inputStyle,\n                   }),\n\n                   BB.el({\n                       tagName: 'label',\n                       content: [\n                           LANG('width') + ':',\n                           widthInput,\n                       ],\n                       css: inputStyle,\n                   }),\n\n                   BB.el({\n                       tagName: 'label',\n                       content: [\n                           LANG('height') + ':',\n                           heightInput,\n                       ],\n                       css: inputStyle,\n                   }),\n               ],\n               css: {\n                   display: 'flex',\n                   marginLeft: '-5px',\n               }\n            }),\n        );\n\n\n        const blendSlider = new KlSlider({\n            label: LANG('brush-blending'),\n            width: 300,\n            height: 30,\n            min: 0,\n            max: 1,\n            value: settings.blend,\n            eventResMs: eventResMs,\n            onChange: function (val) {\n                settings.blend = val;\n                updatePreview();\n            },\n            formatFunc: (val) => {\n                return BB.round(val, 2);\n            },\n            manualInputRoundDigits: 2,\n        });\n        BB.css(blendSlider.getElement(), {\n            margin: '10px 0',\n        })\n\n        rootEl.append(\n            blendSlider.getElement(),\n        );\n\n        // ---- preview tabs ----\n        let previewMode = 1; // 0 before, 1 after\n        const beforeAfterTabs = new TwoTabs({\n            left: LANG('compare-before'),\n            right: LANG('compare-after'),\n            init: previewMode,\n            onChange: (val) => {\n                previewMode = val;\n                overlayCanvas.style.display = val === 0 ? 'block' : 'none';\n                updatePreview(true);\n            },\n        });\n        rootEl.append(beforeAfterTabs.getElement());\n\n        // ---- previews ----\n\n        const klCanvas = params.klCanvas;\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n        const renderW = Math.min(w, context.canvas.width);\n        const renderH = Math.min(h, context.canvas.height);\n        const renderFactor = renderW / context.canvas.width;\n        const previewFactor = w / context.canvas.width;\n\n        const previewWrapper = BB.el({\n            css: {\n                width: isSmall ? '340px' : '540px',\n                marginLeft: \"-20px\",\n                height: isSmall ? '260px' : '300px',\n                backgroundColor: \"#9e9e9e\",\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n                overflow: \"hidden\",\n                position: \"relative\",\n                userSelect: 'none',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                colorScheme: 'only light',\n            }\n        });\n\n        const previewLayer: IKlBasicLayer = {\n            image: BB.canvas(renderW, renderH),\n            opacity: layers[selectedLayerIndex].opacity,\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\n        };\n        const previewLayerArr = layers.map((item, i) => {\n            if (i === selectedLayerIndex) {\n                return previewLayer;\n            } else {\n                return {\n                    image: item.context.canvas,\n                    opacity: item.opacity,\n                    mixModeStr: item.mixModeStr,\n                };\n            }\n        });\n        const klCanvasPreview = new KlCanvasPreview({\n            width: Math.round(w),\n            height: Math.round(h),\n            layers: previewLayerArr,\n        });\n\n        const overlayCanvas = BB.canvas(w, h);\n        BB.css(overlayCanvas, {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n            mixBlendMode: 'difference',\n            imageRendering: 'pixelated',\n        });\n\n        const previewInnerWrapper = BB.el({\n            css: {\n                position: 'relative',\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                width: parseInt('' + w) + 'px',\n                height: parseInt('' + h) + 'px'\n            }\n        });\n        previewInnerWrapper.append(\n            klCanvasPreview.getElement(),\n            overlayCanvas\n        );\n        previewWrapper.append(previewInnerWrapper);\n        rootEl.append(previewWrapper);\n\n\n        // ---- preview input processing ----\n        const inputs: {\n            start: IVector2D;\n            end: IVector2D;\n            oldSettings: IPatternSettings;\n            state: null | 'move' | 'select';\n        } = {\n            start: null,\n            end: null,\n            oldSettings: null,\n            state: null,\n        };\n\n        function syncInputs(): void {\n            xInput.value = '' + settings.x;\n            yInput.value = '' + settings.y;\n            widthInput.value = '' + settings.width;\n            heightInput.value = '' + settings.height;\n        }\n\n        const keyListener = new BB.KeyListener({\n        });\n\n        previewWrapper.oncontextmenu = function () {\n            return false;\n        };\n        previewInnerWrapper.style.touchAction = 'none';\n        const pointerListener = new BB.PointerListener({\n            target: previewInnerWrapper,\n            onPointer: (event) => {\n                if (previewMode === 0) {\n                    if (event.type === 'pointerdown') {\n                        if (!inputs.state) {\n                            inputs.oldSettings = BB.copyObj(settings);\n\n                            const x = event.relX / previewFactor;\n                            const y = event.relY / previewFactor;\n\n                            if (BB.isInsideRect(\n                                {x, y},\n                                {x: settings.x, y: settings.y, width: settings.width, height: settings.height},\n                            )) {\n                                inputs.state = 'move';\n                            } else {\n                                inputs.state = 'select';\n                            }\n                            inputs.start = {x, y};\n                        }\n                    } else if (event.type === 'pointermove') {\n\n                        const x = event.relX / previewFactor;\n                        const y = event.relY / previewFactor;\n\n                        if (inputs.state === 'select') {\n                            inputs.end = {x, y};\n\n                            const x1 = Math.max(0, Math.min(inputs.start.x, inputs.end.x));\n                            const y1 = Math.max(0, Math.min(inputs.start.y, inputs.end.y));\n                            const x2 = Math.min(width, Math.max(inputs.start.x, inputs.end.x));\n                            const y2 = Math.min(height, Math.max(inputs.start.y, inputs.end.y));\n\n                            settings.x = Math.floor(x1);\n                            settings.y = Math.floor(y1);\n                            settings.width = Math.min(maxSize, Math.ceil(x2 - settings.x));\n                            settings.height = Math.min(maxSize, Math.ceil(y2 - settings.y));\n\n                            if (keyListener.isPressed('shift')) {\n                                settings.width = Math.min(settings.width, settings.height);\n                                settings.height = Math.min(settings.width, settings.height);\n                            }\n\n                            if (settings.width === 0 || settings.height === 0) {\n                                settings = BB.copyObj(inputs.oldSettings);\n                            }\n\n                            syncInputs();\n                            updatePreview();\n                        } else if (inputs.state === 'move') {\n                            const dX = Math.round(x - inputs.start.x);\n                            const dY = Math.round(y - inputs.start.y);\n\n                            settings.x = BB.clamp(inputs.oldSettings.x + dX, 0, width - settings.width);\n                            settings.y = BB.clamp(inputs.oldSettings.y + dY, 0, height - settings.height);\n\n                            syncInputs();\n                            updatePreview();\n                        }\n                    } else if (event.type === 'pointerup') {\n                        if (inputs.state) {\n                            inputs.state = null;\n                        }\n                    }\n                } else {\n                    if (event.type === 'pointerdown') {\n                        if (!inputs.state) {\n                            inputs.state = 'move';\n                            inputs.oldSettings = BB.copyObj(settings);\n                            inputs.start = {x: event.relX / previewFactor, y: event.relY / previewFactor};\n                            inputs.end = null;\n                        }\n                    } else if (event.type === 'pointermove') {\n                        if (inputs.state) {\n                            inputs.end = {x: event.relX / previewFactor, y: event.relY / previewFactor};\n\n                            settings.offsetX = Math.round(inputs.end.x - inputs.start.x) + inputs.oldSettings.offsetX;\n                            settings.offsetY = Math.round(inputs.end.y - inputs.start.y) + inputs.oldSettings.offsetY;\n\n                            updatePreview();\n                        }\n                    } else if (event.type === 'pointerup') {\n                        if (inputs.state) {\n                            if (!inputs.end) {\n                                settings.offsetX = 0;\n                                settings.offsetY = 0;\n                                updatePreview();\n                            }\n                            inputs.state = null;\n                        }\n                    }\n                }\n            },\n        });\n\n        // ---------- rendering ---------------------\n        const fullSizeCanvas = BB.canvas(width, height);\n        const fullSizeCtx = fullSizeCanvas.getContext('2d');\n\n        function sharpStrokeRect(\n            context: CanvasRenderingContext2D,\n            x: number,\n            y: number,\n            width: number,\n            height: number\n        ): void {\n            const drawX = Math.round(x + 0.5) - 0.5;\n            const drawY = Math.round(y + 0.5) - 0.5;\n            const drawWidth = Math.round(x + width - drawX);\n            const drawHeight = Math.round(y + height - drawY);\n            context.strokeRect(drawX, drawY, drawWidth, drawHeight);\n        }\n\n        function updatePreview(doForce?: boolean) {\n            if (!doForce && lastDrawnSettings && JSON.stringify(lastDrawnSettings) === JSON.stringify(settings)) {\n                return;\n            }\n\n            if (previewMode === 0) { // before\n                fullSizeCtx.clearRect(0, 0, width, height);\n                fullSizeCtx.drawImage(context.canvas, 0, 0);\n\n                const previewCanvas = previewLayer.image as HTMLCanvasElement;\n                const previewCtx = previewCanvas.getContext('2d');\n                previewCtx.save();\n                previewCtx.clearRect(0, 0, renderW, renderH);\n                previewCtx.drawImage(fullSizeCanvas, 0, 0, renderW, renderH);\n                previewCtx.restore();\n\n                const pW = settings.width * previewFactor;\n                const pH = settings.height * previewFactor;\n\n                const overlayCtx = overlayCanvas.getContext('2d');\n                overlayCtx.save();\n                overlayCtx.clearRect(0, 0, w, h);\n                overlayCtx.strokeStyle = '#fff';\n                sharpStrokeRect(\n                    overlayCtx,\n                    settings.x * previewFactor,\n                    settings.y * previewFactor,\n                    pW,\n                    pH\n                );\n                if (settings.blend > 0.05) {\n                    overlayCtx.strokeStyle = '#f0f';\n                    sharpStrokeRect(\n                        overlayCtx,\n                        settings.x * previewFactor - pW / 2 * settings.blend,\n                        settings.y * previewFactor - pH / 2 * settings.blend,\n                        pW * (1 + settings.blend),\n                        pH * (1 + settings.blend),\n                    );\n                }\n                overlayCtx.restore();\n\n\n\n            } else { // after\n                fullSizeCtx.clearRect(0, 0, width, height);\n                fullSizeCtx.drawImage(context.canvas, 0, 0);\n                drawPattern(fullSizeCtx, settings);\n\n                const previewCanvas = previewLayer.image as HTMLCanvasElement;\n                const previewCtx = previewCanvas.getContext('2d');\n                previewCtx.clearRect(0, 0, renderW, renderH);\n                previewCtx.drawImage(fullSizeCanvas, 0, 0, renderW, renderH);\n            }\n\n\n            klCanvasPreview.render();\n            lastDrawnSettings = BB.copyObj(settings);\n        }\n\n        updatePreview();\n\n\n        // ----- result -------------------\n        const result: IFilterGetDialogResult = {\n            element: rootEl,\n            destroy: () => {\n                blendSlider.destroy();\n                keyListener.destroy();\n                pointerListener.destroy();\n            },\n            getInput: () => BB.copyObj(settings),\n        };\n        if (!isSmall) {\n            result.width = 500;\n        }\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        const klCanvas = params.klCanvas;\n        const ctx = params.context;\n        const history = params.history;\n        if (!klCanvas || !history) {\n            return false;\n        }\n        history.pause(true);\n\n        drawPattern(ctx, params.input);\n\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"pattern\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    }\n\n};","import {BB} from '../../bb/bb';\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl.types';\nimport {KlSlider} from '../ui/base-components/kl-slider';\nimport {LANG} from '../../language/language';\nimport {eventResMs} from './filters-consts';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\nimport {getSharedFx} from './shared-gl-fx';\nimport {Options} from '../ui/base-components/options';\nimport {Checkbox} from '../ui/base-components/checkbox';\n\n\n// see glfx distort\ninterface IDistortSettings {\n    stepSize: number; // [0, inf]\n    distortType: 0 | 1 | 2;\n    scale: { x: number; y: number };\n    strength: { x: number; y: number };\n    phase: { x: number; y: number };\n}\n\n\n\nexport const filterDistort = {\n\n    getDialog(params: IFilterGetDialogParam) {\n\n        const isSmall = window.innerWidth < 550;\n        const rootEl = BB.el({\n            content: LANG('filter-distort-description') + '<br><br>',\n        });\n        const context = params.context;\n        const width = context.canvas.width;\n        const height = context.canvas.height;\n\n        let isSynced = true;\n        let settings: IDistortSettings = {\n            distortType: 0,\n            scale: {x: 100, y: 100},\n            strength: {x: 20, y: 20},\n            phase: {x: 0, y: 0},\n            stepSize: 1,\n        };\n        // let lastDrawnSettings = null;\n\n        // ---- thumb -------\n        const thumbImgArr = [];\n        const thumbSize = 32;\n        {\n            const canvas = BB.canvas(thumbSize, thumbSize);\n            const ctx = canvas.getContext('2d');\n\n            ctx.beginPath();\n            ctx.arc(thumbSize / 2, thumbSize / 2, thumbSize / 2.5, 0, Math.PI * 2);\n            ctx.fill();\n\n            let gradient = ctx.createLinearGradient(0, 0, thumbSize, thumbSize);\n            gradient.addColorStop(0, '#00f');\n            gradient.addColorStop(0.5, '#f00');\n            gradient.addColorStop(1, '#fff');\n            ctx.fillStyle = gradient;\n            ctx.globalCompositeOperation = 'source-atop';\n            ctx.fillRect(0, 0, thumbSize, thumbSize);\n\n            gradient = ctx.createLinearGradient(thumbSize, 0, 0, thumbSize);\n            gradient.addColorStop(0, '#000');\n            gradient.addColorStop(1, '#000');\n            ctx.fillStyle = gradient;\n            ctx.globalCompositeOperation = 'destination-atop';\n            ctx.fillRect(0, 0, thumbSize, thumbSize);\n\n            const glCanvas = getSharedFx();\n            const texture = glCanvas.texture(canvas);\n            glCanvas.draw(texture).update(); // update glCanvas size\n\n            const scaleFactor = 20;\n\n            [0, 1, 2].forEach(item => {\n                const thumbImg = new Image();\n                const settingsCopy = BB.copyObj(settings);\n                settingsCopy.distortType = item;\n                settingsCopy.scale.x /= scaleFactor;\n                settingsCopy.scale.y /= scaleFactor;\n                settingsCopy.strength.x /= scaleFactor;\n                settingsCopy.strength.y /= scaleFactor;\n                glCanvas.draw(texture).multiplyAlpha().distort(settingsCopy).unmultiplyAlpha().update();\n                ctx.clearRect(0, 0, thumbSize, thumbSize);\n                ctx.drawImage(glCanvas, 0, 0);\n                thumbImg.src = canvas.toDataURL('image/png');\n                thumbImgArr.push(thumbImg);\n            });\n\n            texture.destroy();\n        }\n\n\n        // ---- controls ----\n\n        const topRowEl = BB.el({\n            parent: rootEl,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n            }\n        });\n\n        const typeOptions = new Options({\n            optionArr: thumbImgArr.map((img, index) => {\n                BB.css(img, {\n                    margin: '1px',\n                    borderRadius: '3px',\n                    transition: 'all 0.1s ease-in-out',\n                })\n                return {\n                    id: '' + index,\n                    label: img,\n                };\n            }),\n            initialId: '0',\n            onChange: (id) => {\n                settings.distortType = Number(id) as any;\n                updatePreview();\n            }\n        });\n\n        function sync(from: 'x' | 'y') {\n            if (from === 'x') {\n                settings.scale.y = settings.scale.x;\n                settings.strength.y = settings.strength.x;\n                settings.phase.y = settings.phase.x;\n\n                sliderArr[3].setValue(settings.scale.y);\n                sliderArr[4].setValue(settings.strength.y);\n                sliderArr[5].setValue(settings.phase.y);\n            } else {\n                settings.scale.x = settings.scale.y;\n                settings.strength.x = settings.strength.y;\n                settings.phase.x = settings.phase.y;\n\n                sliderArr[0].setValue(settings.scale.x);\n                sliderArr[1].setValue(settings.strength.x);\n                sliderArr[2].setValue(settings.phase.x);\n            }\n            updatePreview();\n        }\n\n        const syncToggle = new Checkbox({\n            init: true,\n            label: LANG('filter-distort-sync-xy'),\n            callback: (val) => {\n                isSynced = val;\n                if (isSynced) {\n                    sync('x');\n                }\n            },\n        });\n\n        topRowEl.append(\n            typeOptions.getElement(),\n            BB.el({css: {flexGrow: '1'}}),\n            syncToggle.getElement(),\n        );\n\n        const xyRowEl = BB.el({\n            parent: rootEl,\n            css: {\n                display: 'flex',\n                flexWrap: 'wrap',\n            }\n        });\n        const leftCol = BB.el({\n            parent: xyRowEl,\n            css: {\n                marginRight: '10px',\n            }\n        });\n        const rightCol = BB.el({parent: xyRowEl});\n\n        const sliderWidth = isSmall ? 300 : 245;\n        const sliderArr: KlSlider[] = [];\n\n        ['x', 'y'].forEach((item, index) => {\n            const targetEl = index === 0 ? leftCol : rightCol;\n\n            const scaleSlider = new KlSlider({\n                label: LANG('filter-noise-scale') + ' ' + item.toUpperCase(),\n                width: sliderWidth,\n                height: 30,\n                min: 1,\n                max: 1000,\n                curve: 'quadratic',\n                value: settings.scale[item],\n                eventResMs: eventResMs,\n                onChange: (val) => {\n                    settings.scale[item] = val;\n                    if (isSynced) {\n                        sync(item as any);\n                    } else {\n                        updatePreview();\n                    }\n                }\n            });\n            scaleSlider.getElement().style.marginTop = '20px';\n            targetEl.append(scaleSlider.getElement());\n\n            const strengthSlider = new KlSlider({\n                label: LANG('filter-unsharp-mask-strength') + ' ' + item.toUpperCase(),\n                width: sliderWidth,\n                height: 30,\n                min: 0,\n                max: 200,\n                curve: 'quadratic',\n                value: settings.strength[item],\n                eventResMs: eventResMs,\n                onChange: (val) => {\n                    settings.strength[item] = val;\n                    if (isSynced) {\n                        sync(item as any);\n                    } else {\n                        updatePreview();\n                    }\n                }\n            });\n            strengthSlider.getElement().style.marginTop = '10px';\n            targetEl.append(strengthSlider.getElement());\n\n            const phaseSlider = new KlSlider({\n                label: LANG('filter-distort-phase') + ' ' + item.toUpperCase(),\n                width: sliderWidth,\n                height: 30,\n                min: 0,\n                max: 1,\n                value: settings.phase[item],\n                manualInputRoundDigits: 2,\n                eventResMs: eventResMs,\n                formatFunc: (val) => BB.round(val, 2),\n                onChange: (val) => {\n                    settings.phase[item] = val;\n                    if (isSynced) {\n                        sync(item as any);\n                    } else {\n                        updatePreview();\n                    }\n                }\n            });\n            phaseSlider.getElement().style.marginTop = '10px';\n            targetEl.append(phaseSlider.getElement());\n\n            sliderArr.push(scaleSlider);\n            sliderArr.push(strengthSlider);\n            sliderArr.push(phaseSlider);\n        });\n\n        const stepSlider = new KlSlider({\n            label: LANG('filter-distort-stepsize'),\n            width: 300,\n            height: 30,\n            min: 1,\n            max: 300,\n            curve: 'quadratic',\n            value: settings.stepSize,\n            eventResMs: eventResMs,\n            onChange: (val) => {\n                settings.stepSize = Math.round(val);\n                updatePreview();\n            }\n        });\n\n        stepSlider.getElement().style.marginTop = '20px';\n        rootEl.append(stepSlider.getElement());\n\n\n        // ---- preview ----\n\n        const klCanvas = params.klCanvas;\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n        const renderW = Math.min(w, context.canvas.width);\n        const renderH = Math.min(h, context.canvas.height);\n        const renderFactor = renderW / context.canvas.width;\n        const previewFactor = w / context.canvas.width;\n\n        const previewWrapper = BB.el({\n            css: {\n                width: isSmall ? '340px' : '540px',\n                marginLeft: \"-20px\",\n                height: isSmall ? '260px' : '300px',\n                backgroundColor: \"#9e9e9e\",\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n                overflow: \"hidden\",\n                position: \"relative\",\n                userSelect: 'none',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                colorScheme: 'only light',\n                marginTop: '10px',\n            }\n        });\n\n        let glCanvas = getSharedFx();\n        if (!glCanvas) {\n            return; // todo throw?\n        }\n        let texture = glCanvas.texture(context.canvas);\n        glCanvas.draw(texture).update(); // update glCanvas size\n\n        const previewLayer: IKlBasicLayer = {\n            image: glCanvas,\n            opacity: layers[selectedLayerIndex].opacity,\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\n        };\n        const previewLayerArr = layers.map((item, i) => {\n            if (i === selectedLayerIndex) {\n                return previewLayer;\n            } else {\n                return {\n                    image: item.context.canvas,\n                    opacity: item.opacity,\n                    mixModeStr: item.mixModeStr,\n                };\n            }\n        });\n        const klCanvasPreview = new KlCanvasPreview({\n            width: Math.round(w),\n            height: Math.round(h),\n            layers: previewLayerArr,\n        });\n\n        const previewInnerWrapper = BB.el({\n            css: {\n                position: 'relative',\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                width: parseInt('' + w) + 'px',\n                height: parseInt('' + h) + 'px'\n            }\n        });\n        previewInnerWrapper.append(klCanvasPreview.getElement());\n        previewWrapper.append(previewInnerWrapper);\n        rootEl.append(previewWrapper);\n\n        // ---------- rendering ---------------------\n\n        function updatePreview() {\n            glCanvas.draw(texture).multiplyAlpha().distort(settings).unmultiplyAlpha().update();\n            klCanvasPreview.render();\n        }\n\n        updatePreview();\n\n\n        // ----- result -------------------\n        const result: IFilterGetDialogResult = {\n            element: rootEl,\n            destroy: () => {\n                typeOptions.destroy();\n                sliderArr.forEach(item => item.destroy());\n                stepSlider.destroy();\n                syncToggle.destroy();\n                texture.destroy();\n            },\n            getInput: () => BB.copyObj(settings),\n        };\n        if (!isSmall) {\n            result.width = 500;\n        }\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        const klCanvas = params.klCanvas;\n        const context = params.context;\n        const history = params.history;\n        if (!klCanvas || !history) {\n            return false;\n        }\n        history.pause(true);\n\n        let glCanvas = getSharedFx();\n        if (!glCanvas) {\n            return false; // todo more specific error?\n        }\n        let texture = glCanvas.texture(context.canvas);\n        glCanvas.draw(texture).multiplyAlpha().distort(params.input).unmultiplyAlpha().update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(glCanvas, 0, 0);\n        texture.destroy();\n\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"distort\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    }\n\n};","import {BB} from '../../bb/bb';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\n// @ts-ignore\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer, IMixMode} from '../kl.types';\nimport {LANG} from '../../language/language';\nimport {input} from '../ui/base-components/input';\nimport {ColorOptions} from '../ui/base-components/color-options';\nimport {drawVanishPoint} from \"../image-operations/draw-vanish-point\";\nimport {KlSlider} from \"../ui/base-components/kl-slider\";\nimport {eventResMs} from \"./filters-consts\";\nimport {IVector2D} from \"../../bb/bb.types\";\n\n\n\nexport const filterVanishPoint = {\n\n    getDialog(params: IFilterGetDialogParam) {\n        let context = params.context;\n        let klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        let layers = klCanvas.getLayers();\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n        const renderW = Math.min(w, context.canvas.width);\n        const renderH = Math.min(h, context.canvas.height);\n        const renderFactor = renderW / context.canvas.width;\n        const previewFactor = w / context.canvas.width;\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n        div.innerHTML = LANG('filter-vanish-point-description') + \"<br/><br/>\";\n\n        const settingsObj = {\n            x: context.canvas.width / 2,\n            y: context.canvas.height / 2,\n            lines: 8,\n            thickness: 2,\n            color: {r: 0, g: 0, b: 0},\n            opacity: 1,\n        };\n\n        const linesSlider = new KlSlider({\n            label: LANG('filter-vanish-point-lines'),\n            width: 300,\n            height: 30,\n            min: 2,\n            max: 20,\n            value: settingsObj.lines,\n            curve: 'quadratic',\n            eventResMs: eventResMs,\n            onChange: function (val) {\n                settingsObj.lines = Math.round(val);\n                updatePreview();\n            },\n        });\n        linesSlider.getElement().style.marginBottom = '10px';\n        div.append(linesSlider.getElement());\n\n        let line1 = BB.el({\n            parent: div,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n            }\n        });\n        let line2 = BB.el({\n            parent: div,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                marginTop: '10px'\n            }\n        });\n        const xInput = input({\n            init: settingsObj.x,\n            type: 'number',\n            css: {width: '75px', marginRight: '20px'},\n            callback: function(v) {\n                settingsObj.x = parseFloat(v);\n                updatePreview();\n            }\n        });\n        const yInput = input({\n            init: settingsObj.y,\n            type: 'number',\n            css: {width: '75px', marginRight: '20px'},\n            callback: function(v) {\n                settingsObj.y = parseFloat(v);\n                updatePreview();\n            }\n        });\n        const thicknessInput = input({\n            init: 2,\n            type: 'number',\n            min: 1,\n            css: {width: '75px', marginRight: '20px'},\n            callback: function(v) {\n                settingsObj.thickness = parseFloat(v);\n                updatePreview();\n            }\n        });\n\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\n        const colorOptionsArr = [\n            {r: 0, g: 0, b: 0, a: 1},\n            {r: 255, g: 255, b: 255, a: 1},\n        ];\n        colorOptionsArr.push({\n            r: params.currentColorRgb.r,\n            g: params.currentColorRgb.g,\n            b: params.currentColorRgb.b,\n            a: 1,\n        });\n        colorOptionsArr.push({\n            r: params.secondaryColorRgb.r,\n            g: params.secondaryColorRgb.g,\n            b: params.secondaryColorRgb.b,\n            a: 1,\n        });\n        settingsObj.color = BB.copyObj(selectedRgbaObj);\n\n        const colorOptions = new ColorOptions({\n            label: LANG('shape-stroke'),\n            colorArr: colorOptionsArr,\n            onChange: function(rgbaObj) {\n                selectedRgbaObj = rgbaObj;\n                settingsObj.color = BB.copyObj(selectedRgbaObj);\n                updatePreview();\n            }\n        });\n\n        const labelStyle = {\n            display: 'inline-block',\n            marginRight: '5px',\n        };\n        line1.append(\n            BB.el({content: 'X:', css: labelStyle}),\n            xInput,\n            BB.el({content: 'Y:', css: labelStyle}),\n            yInput,\n        );\n        line2.append(\n            BB.el({content: LANG('shape-line-width') + ':', css: labelStyle}),\n            thicknessInput,\n            BB.el({css:{flexGrow: '1'}}),\n            colorOptions.getElement(),\n        );\n\n\n        let previewWrapper = document.createElement(\"div\");\n        BB.css(previewWrapper, {\n            width: \"340px\",\n            marginLeft: \"-20px\",\n            height: \"220px\",\n            backgroundColor: \"#9e9e9e\",\n            marginTop: \"10px\",\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n            overflow: \"hidden\",\n            position: \"relative\",\n            userSelect: 'none',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            colorScheme: 'only light',\n        });\n\n        let previewLayer: IKlBasicLayer = {\n            image: BB.canvas(renderW, renderH),\n            opacity: layers[selectedLayerIndex].opacity,\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\n        };\n        let klCanvasPreview = new KlCanvasPreview({\n            width: Math.round(w),\n            height: Math.round(h),\n            layers: layers.map((item, i) => {\n                if (i === selectedLayerIndex) {\n                    return previewLayer;\n                } else {\n                    return {\n                        image: item.context.canvas,\n                        opacity: item.opacity,\n                        mixModeStr: item.mixModeStr,\n                    };\n                }\n            })\n        });\n\n        let previewInnerWrapper = BB.el({\n            css: {\n                position: 'relative',\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                width: parseInt('' + w) + 'px',\n                height: parseInt('' + h) + 'px',\n                cursor: 'move',\n            }\n        });\n        previewInnerWrapper.appendChild(klCanvasPreview.getElement());\n        previewWrapper.appendChild(previewInnerWrapper);\n\n\n\n        // ---- preview input processing ----\n        const inputs: {\n            start: IVector2D;\n            end: IVector2D;\n            state: null | 'move';\n            oldSettings: any;\n        } = {\n            start: null,\n            end: null,\n            state: null,\n            oldSettings: null,\n        };\n        function syncInputs(): void {\n            xInput.value = '' + settingsObj.x;\n            yInput.value = '' + settingsObj.y;\n        }\n        previewWrapper.oncontextmenu = function () {\n            return false;\n        };\n        previewInnerWrapper.style.touchAction = 'none';\n        const pointerListener = new BB.PointerListener({\n            target: previewInnerWrapper,\n            onPointer: (event) => {\n                if (event.type === 'pointerdown') {\n                    if (!inputs.state) {\n                        inputs.state = 'move';\n                        inputs.oldSettings = BB.copyObj(settingsObj);\n                        inputs.start = {x: event.relX / previewFactor, y: event.relY / previewFactor};\n                        inputs.end = null;\n                    }\n                } else if (event.type === 'pointermove') {\n                    if (inputs.state) {\n                        inputs.end = {x: event.relX / previewFactor, y: event.relY / previewFactor};\n\n                        settingsObj.x = Math.round(inputs.end.x - inputs.start.x + inputs.oldSettings.x);\n                        settingsObj.y = Math.round(inputs.end.y - inputs.start.y + inputs.oldSettings.y);\n\n                        syncInputs();\n                        updatePreview();\n                    }\n                } else if (event.type === 'pointerup') {\n                    if (inputs.state) {\n                        inputs.state = null;\n                    }\n                }\n            },\n        });\n\n\n\n        function updatePreview() {\n            let ctx = (previewLayer.image as HTMLCanvasElement).getContext('2d');\n            ctx.save();\n            ctx.clearRect(0, 0, renderW, renderH);\n            ctx.drawImage(context.canvas, 0, 0, renderW, renderH);\n            drawVanishPoint(\n                ctx,\n                settingsObj.x * renderFactor,\n                settingsObj.y * renderFactor,\n                settingsObj.lines,\n                Math.max(settingsObj.thickness * renderFactor, 1),\n                settingsObj.color,\n                settingsObj.opacity,\n            );\n\n            ctx.restore();\n            klCanvasPreview.render();\n        }\n        setTimeout(updatePreview, 0);\n\n\n        div.appendChild(previewWrapper);\n        result.destroy = () => {\n            linesSlider.destroy();\n            pointerListener.destroy();\n        };\n        result.getInput = function () {\n            result.destroy();\n            return BB.copyObj(settingsObj);\n        };\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let klCanvas = params.klCanvas;\n        let history = params.history;\n        if (!context || !klCanvas || !history) {\n            return false;\n        }\n\n        history.pause(true);\n        drawVanishPoint(\n            context,\n            params.input.x,\n            params.input.y,\n            params.input.lines,\n            params.input.thickness,\n            params.input.color,\n            params.input.opacity\n        );\n        history.pause(false);\n\n        history.push({\n            tool: [\"filter\", \"vanishPoint\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    },\n\n};","import {drawShape} from \"./shape-tool\";\nimport {BB} from \"../../bb/bb\";\nimport {IRGB} from \"../kl.types\";\n\nexport function drawVanishPoint(\n    ctx: CanvasRenderingContext2D,\n    x: number,\n    y: number,\n    lines: number, // int, [2, inf]\n    thickness: number, // px\n    color: IRGB,\n    opacity: number, // 0 - 1\n): void {\n    ctx.save();\n\n    const degIncrement = 180 / lines;\n    for (let deg = 0; deg < 180; deg += degIncrement) {\n        const p2 = BB.rotateAround({x, y}, {x: x + 9999, y}, deg);\n        drawShape(\n            ctx,\n            {\n                type: 'line',\n                x1: x,\n                y1: y,\n                x2: p2.x,\n                y2: p2.y,\n                //angleRad: 0,\n                isOutwards: true,\n                opacity,\n                //isEraser: false,\n                strokeRgb: color,\n                lineWidth: thickness,\n                //doLockAlpha: false,\n            }\n        );\n    }\n\n    ctx.restore();\n}","import {KL} from '../kl';\nimport {KlCanvas} from '../canvas/kl-canvas';\n\nexport async function klCanvasToPsdBlob(klCanvas: KlCanvas): Promise<Blob> {\n    let layerArr = klCanvas.getLayersFast();\n\n    let psdConfig = {\n        width: klCanvas.getWidth(),\n        height: klCanvas.getHeight(),\n        //canvas: klCanvas.getCompleteCanvas(1), // preview, can be skipped\n        children: []\n    };\n    for (let i = 0; i < layerArr.length; i++) {\n        // todo - can be optimized if layer mostly empty\n        let item = layerArr[i];\n        psdConfig.children.push({\n            name: item.name,\n            opacity: item.opacity,\n            canvas: item.canvas,\n            blendMode: KL.PSD.blendKlToPsd(item.mixModeStr),\n            left: 0,\n            top: 0\n        });\n    }\n\n    let agPsd = await import('ag-psd');\n    let buffer = agPsd.writePsdBuffer(psdConfig);\n    return new Blob([buffer], { type: 'application/octet-stream' });\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"k9Nks\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"bBxqy\");"],"names":["$3kC7t","parcelRequire","$d2fa9a947070c225$export$a84540bc8b694b2d","p","klApp","agPsd","onProjectReady","project","isInitialized","Error","saveReminder","$5ngYX","SaveReminder","$gWfkn","klHistory","isDrawing","$3C7jC","KlApp","bottomBar","aboutEl","embed","url","embedUrl","onSubmit","init","loadingScreenEl","parentNode","removeChild","loadingScreenTextEl","document","body","appendChild","getEl","e","textContent","className","console","error","psdQueue","getElementById","$1mH1z","LANG","this","openProject","initError","getPNG","getPSD","default","$parcel$interopDefault","$cijLd","mark","_callee","readPSDs","psds","length","readItem","item","psd","readPsd","blob","$941rU","klPsdToKlProject","callback","forEach","_ctx","sent","shift","push","Element","prototype","Object","defineProperty","value","x","y","scrollLeft","scrollTop","window","getItem","setItem","removeItem","t","Array","slice","call","arguments","n","createDocumentFragment","Node","createTextNode","String","Document","DocumentFragment","hasOwnProperty","configurable","enumerable","writable","insertBefore","firstChild","padStart","repeat","findIndex","r","TypeError","o","i","$cf5d938ee512ebca$export$96f6458b62e4c2c","pProject","pOptions","ref","translateSmoothing","s","sizeWatcher","val","brushSettingService","emitSize","klCanvasWorkspace","setCursorSize","importFinishedLoading","importedImage","filename","optionStr","getResizedDimensions","width","height","w","parseInt","h","klMaxCanvasSize","importAsImage","canvas","resizedDimensions","tempCanvas","$eWjiX","BB","getContext","drawImage","resizeCanvas","klCanvas","reset","image","layerName","layerManager","update","setCurrentLayer","getLayer","resetView","handUi","getScale","getAngleDeg","importAsImagePsd","convertedPsdObj","cropObj","crop","targetCanvas","cropCanvas","layers","layerIndex","i1","item1","importAsLayer","$hrnUX","KL","showImportAsLayerDialog","target","klRootEl","importImage","transformObj","isPixelated","pause","addLayer","activeLayerIndex","getLayers","renameLayer","activeLayerContext","getLayerContext","drawTransformedImageWithBounds","tool","action","params","copyCanvas","isNaN","popup","type","message","buttons","showImportImageDialog","maxSize","res","handleFileSelect","files","showWarningPsdFlattened","file","hasUnsupportedFile","extension","name","split","toLowerCase","f","maxResolution","size","closeLoader","doShowLoader","loaderIsOpen","result","closefunc","reader","FileReader","onload","readerResult","loadAgPsd","then","agPsdLazy","skipLayerImageData","skipThumbnail","skipCompositeImageData","replace","convertedPsd","PSD","e1","catch","alert","readAsArrayBuffer","match","URL","webkitURL","createObjectURL","im","Image","src","loadImage","updateCollapse","uiWidth","collapseThreshold","toolspaceCollapser","getElement","style","display","setDirection","uiState","isOpen","css","left","right","toolspace","setSize","Math","max","toolWidth","uiHeight","statusOverlay","setWide","updateUi","borderLeft","borderRight","setUiState","layerPreview","toolspaceScroller","updateUiState","layer","currentLayerCtx","context","currentBrush","setContext","setLayer","showNewImageDialog","newImageDialog","currentColor","secondaryColor","klColorSlider","getSecondaryRGB","maxCanvasSize","canvasWidth","getWidth","canvasHeight","getHeight","workspaceWidth","innerWidth","workspaceHeight","onConfirm","color","a","onCancel","shareImage","shareCanvas","getCompleteCanvas","fileName","getDate","filenameBase","title","updateMainTabVisibility","mainTabRow","activeStr","toolspaceToolRow","getActive","oldTabId","getOpenedTabId","keysArr","keys","draw","hand","fill","gradient","text","shape","setIsVisible","open","copyToClipboard","showCrop","clipboardDialog","inputObj","top","bottom","filterLib","cropExtend","apply","input","history","updateBottomBar","isVisible","innerHeight","toolspaceInner","scrollHeight","bottomBarWrapper","min","screen","$6l0gQ","LocalStorage","app","projectStore","createElement","exportType","KlCanvas","projectObj","setHistory","initState","layerFill","g","b","copy","focus","getLayerCount","brushes","destroy","currentBrushId","lastNonEraserBrushId","RGB","BrushSettingService","setColor","copyObj","opacity","setOpacity","getColor","brushUiObj","getSize","getOpacity","sizeSlider","brushesUI","opacitySlider","lineSmoothing","EventChain","LineSmoothing","smoothing","lineSanitizer","LineSanitizer","drawEventChain","chainArr","setChainOut","event","pointerEvents","startLine","pressure","requestFrame","goLine","isCoalesced","setLastDrawEvent","endLine","getBrush","drawLineSegment","x0","y0","x1","y1","textToolSettings","align","isBold","isItalic","font","KlCanvasWorkspace","onDraw","chainIn","onPick","rgbObj","isDragDone","pickingDone","setMode","onFill","canvasX","canvasY","getLayerIndex","floodFill","fillUi","getIsEraser","getTolerance","getSample","getGrow","getContiguous","onGradient","typeStr","angleRad","gradientTool","onDown","onMove","onUp","onText","dialogCounter","get","textToolDialog","colorRGBA","textStr","ColorConverter","toRgbaStr","onShape","shapeTool","onViewChange","viewChangeObj","changed","includes","out","scale","angleDeg","angle","PI","setEnableZoomIn","getMaxScale","setEnableZoomOut","getMinScale","onUndo","canUndo","undoRedoCatchup","undo","onRedo","canRedo","redo","keyListener","KeyListener","keyStr","comboStr","isInputFocused","getIsDrawing","zoomByStep","isPressed","fitView","preventDefault","sameKeys","saveToComputer","save","success","store","getProject","setTimeout","t0","comboOnlyContains","translateView","setAngle","decreaseSize","increaseSize","eraserBrush","getIsTransparentBg","clearLayer","setActive","brushTabRow","prevMode","getMode","keyArr","filter","getNextBrushId","newMode","swapColors","KlImageDropper","onDrop","enabledTest","addEventListener","stopPropagation","clipboardData","pasteEvent","undefined","items","indexOf","getAsFile","retrieveImageFromClipboardAsBlob","imageBlob","img","revokeObjectURL","URLObj","getAsString","pasteStr","trim","onerror","log","crossOrigin","hexToRGB","b1","ui","Ui","onSizeChange","onOpacityChange","emitOpacity","onConfigChange","emitSliderConfig","padding","position","StatusOverlay","el","parent","oncontextmenu","onclick","handleClick","overlayToolspace","toolspaceTopRow","ToolspaceCollapser","onChange","OverlayToolspace","append","overflow","backgroundColor","userSelect","touchAction","$85H3x","ToolspaceTopRow","onHelp","$5ebUJ","showIframePopup","overlay","content","onLeftRight","onImport","fileTab","triggerImport","logoImg","onLogo","onNew","onSave","onShare","classList","add","marginBottom","ToolspaceToolRow","onActivate","onZoomIn","onZoomOut","setIsSmall","addListener","setEnableUndo","setEnableRedo","KlColorSlider","svHeight","startValue","p_color","emitColor","setHeight","setPickCallback","doPick","brushDiv","colorDiv","margin","flexWrap","justifyContent","alignItems","toolspaceStabilizerRow","ToolspaceStabilizerRow","onSelect","v","setSmoothing","getOutputElement","TabRow","initialId","useAccent","tabArr","createTab","id","tooltip","onOpen","brushId","enable","onClose","b2","HandUi","onReset","onFit","onAngleChange","isRelative","FillUi","colorSlider","gradientUi","GradientUi","textUi","TextUi","shapeUi","ShapeUi","GradientTool","isDone","x2","y2","settings","getSettings","gradientObj","color1","isReversed","doLockAlpha","isEraser","doSnap","setComposite","drawGradient","ctx","ShapeTool","shapeObj","getShape","isOutwards","getIsOutwards","getDoLockAlpha","strokeRgb","lineWidth","getLineWidth","isAngleSnap","getIsSnap","isFixedRatio","getIsFixed","fillRgb","drawShape","klLayerManager","LayerPreview","onClick","filterTab","FilterTab","UndoRedoCatchup","clctx","catchup","SaveToComputer","FileTab","imgurUpload","imgurKey","settingsTab","SettingsTab","$fxAg2","minWidth","$2dTGs","$fuF9j","$3N9oF","$adBnR","$cafM1","$23J3k","label","show","hide","$eIlXd","MutationObserver","observe","attributes","childList","subtree","ToolspaceScroller","resize","scrollY","scrollTo","msg","$2wCWz","base64ToBlob","toDataURL","$3WOmu","klCanvasToPsdBlob","swapUiLeftRight","saveAsPsd","_this","windowResizeWatcher","zIndex","ResizeObserver","prevent","$iUR3L","importFilters","$9cbe98d1fb398012$export$6e4a713ddcda1e5e","$dAXbp","$3P46L","$7pyBK","$705qg","drawProject","$aSJRf","WorkspaceSvgOverlay","$7bo3M","$lV6Vy","KlCanvasPreview","$i5nyl","filterLibStatus","$kyVjY","$6rdi0","renderText","$h20yl","floodFillBits","$30Cml","$3ujzu","$7EG77","setDbName","$9BlwZ","indexedDb","ProjectStore","$6mTnI","$lkluh","$eyygR","calcSliderFalloffFactor","$l4PqG","Checkbox","$lXqiv","$c4LUw","Select","$21VAD","ImageToggle","$jKOQl","ImageRadioList","$gmlbk","RadioList","$bHZQg","penPressureToggle","$fCJWy","KlSlider","$llzZ0","HexColorDialog","$lfHl9","$h7i9r","KlSmallColorSlider","$kzhsD","PointSlider","$bd9hB","ColorOptions","$9A7OD","Options","$iskOY","BoxToggle","$iDHln","$bmB93","CropCopy","$hRdOL","FreeTransform","$cNhNm","FreeTransformCanvas","$kEeSq","Cropper","$32CBv","$kqmpc","FittedImage","$j1kEL","$13r5y","$9p4Zp","$8jqzp","ToolDropdown","$84zxV","$9Kxky","$1Ax5m","$e4sAN","$1uc3b","BrowserStorageUi","$9pcu9","$iVHpg","$i8UFO","$ekHRj","Popup","exportDialog","$auloj","$isYih","$8ebuX","$76Qvv","$keKW3","$kDGzx","$5ENro","$khi8I","$dJXmR","$5Gc7M","$iS9xS","$9J17G","$eK8ID","$2umOB","$bIgqE","$5rdL4","DecoyKlHistory","$gFgFC","$b60fce38973759d6$var$historyInstance","$b60fce38973759d6$export$2a772a91f059c0f9","key","l","$b60fce38973759d6$export$28b6f4d98dde9845","KlHistory","$7U0Ew","state","dataArr","listeners","pauseStack","maxState","actionNumber","pop","maxBefore","broadcast","bufferUpdate","concat","$9fd01211d0fde0a8$export$63b4813c5280c707","close","isClosed","clearSelection","unfocusAnyInput","rootRootEl","decrease","destroyEl","xButton","bgEl","removeEventListener","rootEl","wheelPrevent","btnElArr","splice","increase","scrollContent","minHeight","flexDirection","ignoreBackground","tagName","$fh18w","titleHeight","lineHeight","background","boxShadow","boxClasses","boxEl","div","marginRight","join","flex","clickOnEnterBtn","click","autoFocus","buttonRowEl","marginTop","marginLeft","buttonName","iconUrl","btnClasses","primaries","$c0kqC","iconImg","custom","btn","clickOnEnter","onscroll","$9fd01211d0fde0a8$export$129a32eedafa97c5","clearInterval","updateInterval","updatePos","elW","popupEl","offsetWidth","elH","offsetHeight","animationName","animationDuration","animationTimingFunction","isCssMinMaxSupported","borderRadius","titleEl","paddingLeft","tabindex","contentEl","$dd0d395ff14a3e11$export$17eb8275e0c4cab8","DialogCounter","count","emit","listener","$h4olN","$05ec456c8871d48f$export$921068d8846a1559","eventUsesHighResTimeStamp","$6J2My","mouseEventHasMovement","hasPointerEvents","hasWebGl","getVisitor","canShareFiles","insertAfter","$7jh4K","setAttributes","fitInto","centerWithin","gcd","reduce","decToFraction","imageBlobToUrl","dateDayDifference","createSvg","BbLog","$i0uIf","mix","$eg83P","dist","distSquared","lenSquared","pointsToAngleRad","pointsToAngleDeg","isInsideRect","clamp","rotate","rotateAround","Matrix","$kVHNC","Vec2","$4toIY","intDxy","roundEven","roundUneven","round","updateBounds","boundsInArea","projectPointOnLine","$af1iA","PointLine","BezierLine","SplineInterpolator","quadraticSplineInput","$eelgW","createCanvas","$eIcQa","testShouldPixelate","drawTransformedImageOnCanvas","createCheckerCanvas","createCheckerDataUrl","convertToAlphaChannelCanvas","freeCanvas","canvasBounds","HSV","$dJ1E2","CMYK","testIsWhiteBestContrast","appendTextDiv","$72Jv0","makeUnfocusable","setEventListener","$idV3L","PointerListener","$04lDo","$exufe","$cdd5ef6b176accd6$export$d031894fc27e45","DomEl","$cdd5ef6b176accd6$export$3f65cefe8380dbea","options","$cdd5ef6b176accd6$export$8ff9f68337b520c0","hasWebgl","visitor","test","$878b1f179a521546$export$b7d78993b74f766d","navigator","userAgent","$878b1f179a521546$export$4ec3bfbae69fbb50","Event","timeStamp","$878b1f179a521546$export$ebcc19037a7ab076","mouseEvent","MouseEvent","$878b1f179a521546$export$b7b64c480b083ae0","PointerEvent","$878b1f179a521546$export$9cbe517943afd6db","premultipliedAlpha","$878b1f179a521546$export$96cd70eaafd80100","chrome","gl","JSON","parse","stringify","$878b1f179a521546$export$fe0a7220ab4eecad","offsetLeft","$878b1f179a521546$export$558f5e20caee48c2","$44dda2e48e48a872$export$cd3d1f114b139967","$2bd9b7b9bc92046d$export$c4f94c8b3850a5a9","referenceNode","newNode","nextSibling","$2bd9b7b9bc92046d$export$fe58198efe02b173","counter","check","complete","$2bd9b7b9bc92046d$export$dbf350e5966cf602","styleObj","alignContent","webkitUserSelect","$2bd9b7b9bc92046d$export$74da2cba014bdc09","attrObj","setAttribute","$2bd9b7b9bc92046d$export$10d8903dec122b9d","els","fragment","$2bd9b7b9bc92046d$export$fa55905620c22535","aw","ah","bw","bh","$2bd9b7b9bc92046d$export$76d0c1a172b67a61","$2bd9b7b9bc92046d$export$aa350b96d91cd94","date","Date","getFullYear","getMonth","toString","getHours","getMinutes","$2bd9b7b9bc92046d$export$f81847884871263e","$2bd9b7b9bc92046d$export$533b26079ad0b4b","numerator","denominator","$2bd9b7b9bc92046d$export$8215e6b900906daa","decimalNumber","len","pow","$2bd9b7b9bc92046d$export$5063ec57a23c4f2e","blobObj","Blob","constructor","fauxBlob","encoding","data","$2bd9b7b9bc92046d$export$1093707c159148e8","dateA","dateB","setHours","getTime","$2bd9b7b9bc92046d$export$af0d87255f3cfd7e","obj","$2bd9b7b9bc92046d$export$331c30fd60da0115","mimetype","err","toBlob","filesArray","File","share","$2bd9b7b9bc92046d$export$b981489921ee18cd","clickEvent","allowClick","$2bd9b7b9bc92046d$export$c54fe3b9ecaa84cf","createElementNS","elementType","childrenArr","$74d1f29ad2137b2c$var$globalKey","emitDown","c","d","listenerArr","emitUp","keyDown","code","keyCode","keyToKeyStrObj","isDownObj","comboArr","codeIsDownObj","keyUp","oldComboStr","blur","eventArr","keyToKeyStrArr","keyStrToKeyObj","space","alt","ctrl","cmd","enter","esc","backspace","delete","sqbr_open","sqbr_close","u","z","plus","minus","up","down","home","end","first","remove","last","getIsDown","getCombo","$74d1f29ad2137b2c$export$f17908c5de22d32e","onBlur","keyStrArr","$74d1f29ad2137b2c$export$e9f65b0175de4c03","comboAStr","comboBStr","sort","pointerArr","pressureNormalizeAvgCount","pressureNormalizeAvgPressure","pressureNormalizeIsComplete","pressureNormalizeFactor","$893e90c2dcf687ac$var$WheelCleaner","endSequenceTimeout","delta","deltaY","sequenceUnit","pageX","pageY","clientX","clientY","endSequence","toEmitDelta","knownUnitArr","sequenceLength","process","clearTimeout","deltaMode","absDelta","abs","$893e90c2dcf687ac$export$9371bd96776f4e82","onTouchstart","onTouchmove","onTouchend","getDragObj","pointerId","dragObjArr","removeDragObj","removedDragObj","dragPointerIdArr","normalizePressure","correctPointerEvent","corrected","correctedObj","pointerType","movementX","movementY","timeStampOffset","button","coalescedArr","eventPreventDefault","eventStopPropagation","customPressure","isFirefox","coalescedEventArr","getCoalescedEvents","pointerObj","getPointer","lastPageX","lastPageY","addPointer","totalLastX","totalLastY","eventItem","createPointerOutEvent","correctedEvent","bounds","targetElement","getBoundingClientRect","relX","relY","dX","dY","time","coalescedItem","createTouchOutEvent","touchListItem","touchEvent","identifier","destroyDocumentListeners","onGlobalPointerMove","onGlobalPointerUp","onGlobalPointerLeave","onPointerEnter","isOverCounter","onEnterLeaveCallback","onPointerLeave","onPointermove","tempLastPointerType","lastPointerType","maxPointers","didSkip","outEvent","onPointerCallback","onPointerdown","dragObj","downPageX","downPageY","lastTimeStamp","setTouchTimeout","buttonsToStr","clearTouchTimeout","outEvent1","touchTimeout","fakeEvent","performance","now","onTouchTimeout","onPointer","onWheelCallback","onWheel","onEnterLeave","wheelCleaner","wheelEvent","isDestroyed","timing","navigationStart","fixScribble","touchArr","changedTouches","touchObj","isOver","$9a5bdb07e7a7c42f$export$2c9e8a9632a706b2","$9a5bdb07e7a7c42f$export$6c4a311cc157c764","ax","ay","bx","by","sqrt","$9a5bdb07e7a7c42f$export$499eb56409f6cbc2","$9a5bdb07e7a7c42f$export$a4f99f99d3e99cfa","$9a5bdb07e7a7c42f$export$627023b405ba5028","p1","p2","atan2","$9a5bdb07e7a7c42f$export$c03a8450eabc2532","$9a5bdb07e7a7c42f$export$151bd845d70e2099","rect","$9a5bdb07e7a7c42f$export$7d15b64cf5a3a4c4","num","$9a5bdb07e7a7c42f$export$bb628a54ab399bc9","deg","theta","cs","cos","sn","sin","$9a5bdb07e7a7c42f$export$95ec0760d3d00713","center","point","rot","$9a5bdb07e7a7c42f$export$bbf9af158036c5e9","remainder","fDx","fDy","$9a5bdb07e7a7c42f$export$94cce7adf2ec2d08","above","ceil","below","floor","$9a5bdb07e7a7c42f$export$f373b6a7b0c159a","$9a5bdb07e7a7c42f$export$2077e0241d6afd3c","digits","digitMult","$9a5bdb07e7a7c42f$export$f4467a4f41373bc7","$9a5bdb07e7a7c42f$export$bbb91bbc54e7d9ac","$12950380ec51f25d$export$649a211db9812745","continueChain","chainOut","func","$12950380ec51f25d$export$db3963a21c01d803","fail","sequenceArr","timeoutObj","maxUntilSecondDown","eventQueueArr","lastSequenceItem","onDoubleTap","setupTimeout","timeoutStr","targetFunc","timeMS","diff","nowTime","minSilenceBeforeDurationMs","maxPressedDurationMs","maxPressedDistancePx","maxInbetweenDistancePx","maxUpToUpDurationMs","maxUntilSecondDownDurationMs","minSilenceAfterMs","allowedPointerTypeArr","allowedButtonArr","pointersDownIdArr","lastUpTime","isDown","isUp","processEvent","setAllowedPointerTypeArr","arr","setAllowedButtonArr","$12950380ec51f25d$export$510622b8aed00381","firstDownTime","firstLastDownTimeout","tapTimeout","fingerArr","tempLastEventTime","lastEventTime","fingers","maxFirstLastFingerDownMs","downTime","maxTapMs","fingerObj","fingerObj1","i2","allAreUp","i3","onTap","$12950380ec51f25d$export$d62358ac2d82abb3","gestureObj","doSwallow","secondFingerTimeout","touchPointerArr","isInProgress","continuePinch","index","beginPinch","otherPointerIdArr","downRelX","downRelY","untilSecondFingerDurationMs","endPinch","touchPointerObj","firstFingerMaxDistancePx","pincherArr","onPinch","actionObj","startDist","distance","startAngle","$12950380ec51f25d$export$fe11e0afe623a677","eventCopy","$12950380ec51f25d$export$71ff2f51bf1f4062","pointers","downPointerId","ignorePointerIdArr","$12950380ec51f25d$export$d429e21f52463d17","downEvent","eventQueue","direction","shiftIsPressed","pressure0","pressure1","$12950380ec51f25d$export$91dcf4209534d21f","$12950380ec51f25d$export$c57e2ed65bcf4d6a","lastMixedInput","interval","timeout","inputX","inputY","inputPressure","setInterval","$3f0e2f35371c9852$export$dd0873c0fb3ccff6","resultCanvas","$3f0e2f35371c9852$export$1555f643cc9a976","transform","scaleX","scaleY","whSwapped","$3f0e2f35371c9852$export$ded2b43392504635","destCtx","transformImage","pixelated","imageSmoothingEnabled","imageSmoothingQuality","translate","restore","$3f0e2f35371c9852$export$425a419ef9fc761f","baseCanvas","angleDegree","cache","$3f0e2f35371c9852$export$754559b36e94ea2f","fillStyle","fillRect","$3f0e2f35371c9852$export$42af33c76b681867","create","$3f0e2f35371c9852$export$59b33278b5b2fc8a","tmp1","tmp2","oldW","oldH","newW","newH","ew","eh","base2","oldWidthEx","log2","oldHeightEx","newWidthEx","newHeightEx","buffer1","buffer2","bufferCtx","globalCompositeOperation","currentWidth","currentHeight","newWidth","newHeight","tmp","canvasCtx","tmp1Ctx","$3f0e2f35371c9852$export$5a7576952c826b4f","imdat","getImageData","putImageData","$3f0e2f35371c9852$export$2384aff49c9b73c2","clearRect","$3f0e2f35371c9852$export$3db033c6ee0b8700","boundsObj","tempBounds","multiplyMatrixAndPoint","$e4df33b4b16105d5$export$5b12bf1653c0dd85","getIdentity","matrix","multiplyMatrices","matrixA","matrixB","row0","row1","row2","row3","result0","result1","result2","result3","createTranslationMatrix","createRotationMatrix","createScaleMatrix","$531c9f41f98b7ec0$export$ac4bca90992eed1","sub","nor","mul","dot","aArr","bArr","map","m","$77ae015f37ebe4f1$export$b4c5b177db876445","lineStart","lineEnd","$77ae015f37ebe4f1$export$8b36a4a83269a640","segmentArr","points","getAtDist","getLength","fac","$77ae015f37ebe4f1$export$5379d955c16d4d43","lastPoint","lastCallbackPoint","lastAngle","pointArr","lastDot","lastSpacing","spacing","controlsCallback","dir","pointM1","pointM2","pointM3","pointLine","curvePoints","p3","p4","resolution","getBezierPoints","tempSpacing","dAngle","addFinal","newP","$77ae015f37ebe4f1$export$80967b1eb9fd6eb4","xa","ya","wx","sig","ddydx","getFirstX","getLastX","interpolate","klo","khi","k","findX","tempX","tempY","tempDist","$77ae015f37ebe4f1$export$4551d4af86c1eb08","startVal","endVal","stepSize","dec","resultArr","$5e7aac2fa49b6b1f$export$d2edaecd208aed43","$5e7aac2fa49b6b1f$export$8f9ece5a47764b93","$5e7aac2fa49b6b1f$export$89d3f85304bf0767","$5e7aac2fa49b6b1f$export$fb7efcd2e153af6e","_RGBtoHSV","minVal","maxVal","del_R","del_G","del_B","_HSVtoRGB","var_h","var_i","var_1","var_2","var_3","var_r","var_g","var_b","_CMYKtoRGB","_RGBtoCMYK","toRGB","toHSV","toCMYK","toHexString","ha","hb","hc","toRgbStr","rgbaObj","hexStr","exec","$5e7aac2fa49b6b1f$export$5cf396345d1238ae","$cfe3aa45a75894cc$export$7868464f598ba79d","innerHTML","$cfe3aa45a75894cc$export$906dfdb7df31ccfc","getAll","activeElement","getAttribute","$cfe3aa45a75894cc$export$e05240ca9e0b8bd9","focusEl","select","$cfe3aa45a75894cc$export$a3d02541b0ebf605","getSelection","sel","empty","removeAllRanges","selection","preventFocus","$cfe3aa45a75894cc$export$6bd63bfceaafae0c","didFocusRelated","relatedTarget","currentTarget","$cfe3aa45a75894cc$var$els","$cfe3aa45a75894cc$export$c3da0dad1b44eea9","isArray","customKeyArr","$cfe3aa45a75894cc$export$b1da1db524e22115","$0d0e99c175410ac4$export$9860cd9e09e6f8ba","$9e5fd8359d8b22f2$export$19fffca37ef3e106","localStorage","module","exports","getBundleURL","resolve","$d82e0c66c1aaca81$export$48513f6b9f8ce62d","doHighlight","element","innerEl","checked","allowTab","tabIndex","onchange","toggle","$aa0ec58519fa7d10$export$b7e3ae3d7c15e42e","$eb01976a4bab51ce$export$ef9b1a59e592288f","selectEl","changeListener","cursor","fontSize","colorScheme","isFocusable","optionArr","option","initValue","$5cde84e643fb89d6$export$b6d053cded550773","isActive","backgroundImage","isRadio","setValue","getValue","$459eb3dcb08ae3f8$export$7cc1012a658e6ad8","activeIndex","createOption","initId","radioEl","$12a3b74a8702bb1f$export$77219f67585650fa","isChecked","changeCallback","redraw","toggleDiv","border","cssFloat","$e1Rnq","backgroundSize","backgroundRepeat","boxSizing","$cf8be10874d1afb1$export$a1855b925e534de7","isEnabled","manualInputRoundDigits","useSpline","curve","elementWidth","elementHeight","displayValueToValue","valueToDisplayValue","toValue","displayValue","toDisplayValue","isChangeOnFinal","formatFunc","eventResMs","curveArr","splineInterpolator","roolEl","sliderWrapperEl","labelFontSize","textEl","control","valueToSliderValue","controlInner","updateEnable","doubleTapper","DoubleTapper","showManualInput","virtualVal","eventChain","pointerListenerTimeout","pointerListener","sliderValue","sliderValuetoValue","updateLabel","deltaX","sliderValue1","toLocaleString","languageStrings","getCode","isFinal","emitInterval","emitValue","manualInput","setIsEnabled","$348ou","KlSliderManualInput","config","isDisabled","$0c2dd884393cffca$export$f8e41e222e32615d","isRightButton","$a36067096711f77d$export$db3d4fde05db9a5e","roundDigits","currentValue","onblur","privateOnClose","scrollBefore","scrollX","lastValue","Number","$dada52d673c8c4ac$export$cc42e119007cb939","createRgbInputRow","labelStr","attributeStr","rowEl","labelEl","inputEl","lastValidRgb","parseFloat","previewEl","hexInput","hexRowEl","hexLabel","rgbArr","copyButton","$fcsnL","execCommand","resultStr","$9eeb6c00ea2d3242$export$4e5102252876c5d7","updatePrimaryHSV","hsv","primaryColorHSV","updateSVCanvas","rgb","hueStop","updateSVPointer","pointerSV","setColPreview","divPreview","primaryColorRGB","pickerButton","hexButton","updateSecondaryColor","secondaryColorBtn","secondaryColorRGB","secondaryColorHSV","controlH","pickCallback","outputDiv","svWrapper","svSvg","DOMParser","parseFromString","documentElement","divH","SVContainer","virtualHSV","$1nsGS","backgroundPosition","isPicking","targetEl","cv","gradH","createLinearGradient","col","addColorStop","createHueBg","factor","$3ac3f56275b45315$export$dcd33f7653c95f09","updateSV","canvasSV","gradient1","colleft","colright","heightSV","updateHPointer","pointerH","canvasH","heightH","svPointerId","svPointerListener","hPointerId","hPointerListener","cleardiv","clear","$0b17443c34517974$export$ac00cea56cec3037","param","redrawPoint","sliderPoint","sliderPos","isDragging","pointSize","sliderLine","isFirst","imaginaryPos","transition","$a19b2655062f09b7$export$24ba9b81662d4366","buttonArr","setIsSelected","selectedIndex","colorArr","checkerUrl","found","sItem","initialIndex","colorButton","buttonSize","textAlign","$c8511e371b1e3768$export$c019608e5b5bb4cb","optionObj","classArr","isSmall","wrapperEl","selectedId","getIndex","changeOnInit","next","previous","$c1a93a3cd82636c9$export$5ee0af1d5c87e856","removeProperty","isWide","angleIm","$bv5Zj","verticalAlign","innerInnerEl","doPulse","animation","timeout3","timeout2","$81ac8fccf3fa43c3$export$8e17099f54853f0e","aboutDiv","closed","aniToggle","imageContainer","coverImage","coverSize","aniTimeout","boxSize","ontouchstart","ontouchmove","ontouchend","$01fcd0ed15aa4018$export$40175a5948a88a57","resetCrop","updateCroppedCanvas","croppedCanvas","croppedImage","updateSelectionRect","selectionRect","thumbX","scaleW","thumbY","scaleH","toOriginalSpace","genCrop","topLeftP","bottomRightP","origTopLeftP","origBottomRightP","isReset","eventTarget","isNotCopy","previewWrapper","thumbSize","thumbCanvas","imageRendering","thumbCtx","startP","updateCropTimeout","startCrop","didMove","doUpdate","getRect","getCroppedImage","$ffd40240385bb9f9$export$32b89bc9bb92706a","fullCanvas","cropCallback","output","toClipboard","imgURL","cropCopy","fetch","clipboard","write","ClipboardItem","clipboardItemIsSupported","topWrapper","borderTop","borderBottom","KeyEvent","rectObj","$aacd8170d7ccb1c6$export$56cc6eb0b4c43d97","p_canvas","p_func","p_rootDiv","oldHistoryState","row","clearBtn","$8yL1I","suggestions","suggestionBtns","createLayerList","updatefunc","createLayerEntry","klCanvasLayerArr","layercanvas","layerElArr","posY","innerLayer","container1","container2","spot","oldOpacity","thumbDimensions","thumb","thc","lname","whiteSpace","ondblclick","opacityLabel","isLast","layerOpacity","largeThumbCanvas","largeThumbDiv","largeThumbInDocument","largeThumbInTimeout","largeThumbTimeout","dragstart","freshSelection","lastpos","isSelected","activateLayer","updateLayersVerticalPosition","posToSpot","newSpot","oldSpot","move","selectedSpotIndex","layerListEl","getState","child","updateHeight","layerHeight","layerSpacing","newspot","posy","oldSpotIndex","newSpotIndex","moveLayer","mergeBtn","disabled","listdiv","disableButtons","enableButtons","modeWrapper","modeSelect","addnewBtn","duplicateBtn","removeBtn","renameBtn","paddingRight","$d42vI","$dKwR8","$3VpTB","$g91IK","clearboth","MAX_LAYERS","duplicateLayer","removeLayer","mixModeStr","$bBcC4","translateBlending","topCanvas","preview","spacer","alphaCanvas","bottomCanvas","globalAlpha","topOpacity","mergeDialog","mode","mergeLayers","createButtons","setMixMode","historyState","activeLayerSpotIndex","getSelected","spotIndex","stateStr","$0621fc8724f6bfac$var$allowedMixModes","$0621fc8724f6bfac$export$9f4f73b1bd7c2f26","$0621fc8724f6bfac$export$4a819bde91671014","layerNrOffset","layerCanvasArr","pickCanvas","changeListenerArr","origLayers","updateIndices","toCopyCanvas","algorithm","layerCanvas","layerContext","offX","offY","ctemp","layerCtx","fillColor","selected","isLayerLimitReached","doReturnNull","emitChange","temp","targetIndex","layerBottomIndex","layerTopIndex","isHorizontal","isVertical","tempCtx","colorObj","compositeOperation","tolerance","sampleStr","grow","isContiguous","srcCtx","srcImageData","srcData","targetCtx","targetImageData","targetData","srcCanvas","srcIndex","imageData","canvasObj","imData","compositeObj","$7069db2f5e23d00f$var$fillRect","$7069db2f5e23d00f$var$mx","$7069db2f5e23d00f$var$my","$7069db2f5e23d00f$var$moveIndex","$7069db2f5e23d00f$var$testAndFill","srcArr","targetArr","initRgba","$7069db2f5e23d00f$export$13d50f258a8034f","rgbaArr","Uint8Array","ArrayBuffer","px","py","q","tl","tr","br","bl","$7069db2f5e23d00f$var$floodFill","$01d7180c5d1d0fdf$export$27550cc14d7ae85a","downX","downY","downAngleRad","$01d7180c5d1d0fdf$export$71b514a25c47df50","defaults","property","$01d7180c5d1d0fdf$var$applyDefaults","colorRGB","strokeStyle","r1","r2","pAngleDeg","pAngleDegSnapped","rotated","r11","r21","rx","ry","rdX","rdY","x1r","y1r","x2r","y2r","x1f","y1f","x2f","y2f","beginPath","moveTo","lineTo","stroke","x1f1","y1f1","x2f1","y2f1","strokeRect","ellipse","$fdc12d72a3df9be9$export$482c90f94eb9717c","outer","fontFamily","fontWeight","fontStyle","spanStr","children","offsetTop","el1","fillText","innerText","isDebug","$089586a542a12f27$export$5f63a7b18dc4503a","$5e45fa121ba5050f$export$74d12f09ff9f1956","$5e45fa121ba5050f$export$b1f70a113e3b5c1b","baseColor","color2","createRadialGradient","$2f1281ced73ab1dc$export$6e1bedb2a6cdff30","blendMode","codes","darken","multiply","lighten","difference","exclusion","hue","saturation","luminosity","$d256278b259ca979$export$6b9252711ea5997f","rootElement","brushCircleOuter","brushCircleInner","pickerPreviewBorder","pickerPreviewCol","compassSize","compass","compassInner","compassBaseCircle","cx","cy","compassLineCircle","compassUpperTriangle","compassLowerTriangle","radius","borderColor","$d492af58f4721011$var$TMode","TMode","$d492af58f4721011$var$MIN_SCALE","$d492af58f4721011$export$6eaf6f7c0cc177fc","_this1","renderTargetCanvas","renderTargetCtx","renderWidth","renderHeight","compositeCanvas","compositeCtx","doResizeCanvas","oldTransformObj","targetTransformObj","highResTransformObj","renderedTransformObj","cursorPos","usesCssCursor","bgVisible","transformIsDirty","doAnimateTranslate","svgOverlay","emptyCanvas","isRepeat","currentInputProcessor","onKeyDown","Draw","Pick","Fill","Gradient","Text","Shape","globalMode","inputProcessorObj","spaceHand","Hand","altPicker","zoom","onKeyUp","updateChangeListener","currentMode","renderTime","lastDrawEvent","linetoolProcessor","LinetoolProcessor","getMatrix","art","getRenderedTransform","coords","matrix1","coords1","coords2","pointer","reqFrame","updateCursor","getComboStr","resetInputProcessor","coord","workspaceToCanvasCoord","HandGrabbing","Zoom","offsetX","offsetY","internalZoomByStep","lastRenderedState","picker","pickedColor","getColorAt","updateColorPreview","Rotating","Rotate","centerObj","startAngleRad","dAngleRad","minimizeAngleRad","origin","angleIsExtraSticky","pinchZoomer","PinchZoomer","snapAngleRad","mainDoubleTapper","middleDoubleTapper","twoFingerTap","NFingerTapper","threeFingerTap","pointerEventChain","OnePointerLimiter","CoalescedExploder","brushRadius","animationFrameRequested","lastRenderTime","requestAnimationFrame","updateLoop","addChangeListener","modeInt","doForce","oldMode","$hNEwm","$iOLNv","$3zTyb","$kFdtJ","oldIsHand","currentIsHand","stepNum","centerX","centerY","newStep","newScale","effectiveFactor","transformA","transformB","blendFactor","centerPosA","canvasToWorkspaceCoord","centerPosB","mixedPos","renderContext","workspacePointArr","borderSize","layerArr","getLayersFast","updateCompass","snapDegIncrement","maxDistDeg","modDeg","doRedrawCanvas","newState","doRender","elapsedFrames","checkChange","testBgVisible","mixTransformObj","start","render","klC","oldWidth","oldHeight","modeStr","diameter","hideBrushCursorTimeout","doAnimate","newAngle","canvasPointsArr","boundsWidth","boundsHeight","newTargetTransformObj","oldAngleRad","tx","ty","$6faa9d948ec87f40$export$e258ade1648009b7","$0370167ee97a20d9$var$snapToPixel","$0370167ee97a20d9$var$copyTransform","$0370167ee97a20d9$var$toTransformSpace","$0370167ee97a20d9$var$toImageSpace","$0370167ee97a20d9$export$79a74567acf241b0","corners","isConstrained","snapX","snapY","snappingEnabled","ratio","transEl","boundsEl","pointerRemainder","isInverted","boundsStartP","boundsPointerListener","snap","iP","minSnapDist","distX","distY","j","projected","dist1","updateCornerPositions","updateDOM","gripSize","virtualPos","offsetArr","tinyOffset","scaled","cornerCursors","constrainCorner","snapCorner","tP","indexes","updateTransformViaCorners","updateScaled","edges","edgeSize","angleOffset","tfD","ti","dimension","restoreRatio","angleGrip","$lQMok","anglePointerListener","offset","snapDeg","iX","iY","_x","_y","cornerIndex","flip","widthChanged","heightChanged","angle90","newHeight1","skipCallback","transformOrigin","$48f5d87739d28bf9$export$205c2dd29f8a66b5","updatePreview","freeTransform","getTransform","destCanvas","previewLayerArr","transformIndex","initTransform","klCanvasPreview","previewFit","imageWidth","imageHeight","innerWrapper","transformSize","setPos","setAngleDeg","setTransformFit","fit","setTransformCenter","getTransformation","getIsPixelated","$de496a1759b04ed9$export$71ed2b85d4ca43d3","transformTop","grips","maxH","transformRight","maxW","transformBottom","transformLeft","commit","cornerElArr","outline","thirdsHorizontal","thirdsVertical","gripCursors","outlinePointerListener","gripOverlay","edge0PointerListener","edge1PointerListener","edge2PointerListener","edge3PointerListener","corner0PointerListener","corner1PointerListener","corner2PointerListener","corner3PointerListener","setTransform","setScale","showThirds","$18e69c7d4cb991e8$export$d25420b53e16716f","layerObj","largeCanvasAnimationTimeout","isInstant","nameLabelEl","opacityEl","lastDrawnSize","canvasDimensions","canvasSize","animationCanvas","animationCanvasCtx","animationCanvasCheckerPattern","animationCount","animationLength","animate","drawLargeCanvas","lastDrawnState","largeCanvasIsVisible","largeCanvasSize","largeCanvas","largeCanvasCtx","largeCanvasCheckerPattern","largeCanvasWrapper","removeLargeCanvas","largeCanvasAnimationDurationMs","contentWrapperEl","canvasWrapperEl","nameWrapper","flexGrow","nameFadeEl","clickableEl","webkitTouchCallout","createPattern","showLargeCanvas","currentState","klCanvasLayerObj","$a29ff52bf33e0691$export$83ae33786c7b4ee5","$e3dfa43019bc3f08$export$962af7e240721d88","freeTransformCanvas","noteEl","originalSizeBtn","fitSizeBtn","centerBtn","buttonStr","$01cb8095758db224$export$e789742143ba5b1","rootCounter","optionLayerCounter","optionImageCounter","testAcceptType","dataTransfer","types","updateOptions","optionLayerEl","optionImageEl","paddingTop","textShadow","optionStyle","$d6fe881e8fc421ac$export$9f0da9b942594e99","updateColor","selectedColorEl","updateUI","mousePos","sizeObj","hHeight","sliderHeight","queuedObj","subscriptionFunc","initialColor","subscribe","sliderConfig","getSliderConfig","$6003e73b8cbb69e2$export$665d2c76b1eb8459","createButton","extraPadding","contain","logoButton","$8oUiM","newButton","$1gUFn","importButton","$gswMe","saveButton","$lLh5u","shareButton","$5xpQb","helpButton","$kS5uZ","$18c597dee53260ff$export$a0a40f8a0b8fee15","createDropdownButton","wrapper","dropdownWrapper","smallMargin","onClickDropdownBtn","closeDropdown","currentActiveIndex","updateButton","showDropdown","dropdownBtnArr","arrowButton","activeButton","titleArr","activeButtonIm","imArr","openTimeout","startX","startY","elementFromPoint","$gzZrf","borderBottomLeftRadius","borderBottomRightRadius","$a372d78c806cd0cc$export$c744a22bef9e0b97","doEmit","currentActiveStr","toolDropdown","handButton","doLighten","doMirror","createTriangleButton","svg","viewBox","preserveAspectRatio","defs","in","stdDeviation","dx","dy","in2","operator","k2","k3","svgTriangleLeft","class","onLeft","svgTriangleRight","onRight","leftPointerListener","rightPointerListener","leftIm","leftImage","rightIm","rightImage","setIsEnabledLeft","setIsEnabledRight","zoomInNOutButton","$3KoFh","$eWf2I","zoomInButton","zoomOutButton","undoNRedoButton","$fc34V","undoButton","redoButton","$90c04b5ac185bf3d$export$8162a66cd18867a7","strengthSelect","setDeltaValue","$d04d72b97d637d65$export$3c6d17ed0106bfb9","pTabObj","openedTabObj","tabDiv","roundRight","roundLeft","roundSize","$4m0AU","tabId","$9934467c988b088a$export$cf20160367bae46c","scaleEl","angleEl","resetButton","fitButton","leftRotateButton","$2n4Fs","resetAngleButton","rightRotateButton","pIsVisible","pScale","$51d47356d698ffec$export$1e63e3b0645421a2","toleranceSlider","selectRow","growWrapper","growSelect","contiguousToggle","eraserToggle","$d06987f550ff485e$export$32a22540e4b2f123","$45c003c723de07b5$export$a9387b1d4260d39c","updatePreviews","strokeWidth","lineWidthSlider","squish","rectStrokeSvgRect","rectFilledSvgRect","ellipseStrokeSvgEllipse","ellipseFilledSvgEllipse","lineSvgLine","fixedToggle","previewPadding","previewSize","snapToggle","rectStrokeSvg","rectFilledSvg","ellipseStrokeSvg","ellipseFilledSvg","lineSvg","shapeOptions","lockAlphaToggle","outwardsToggle","$4fb68589de8a8c9a$export$f77a89101d7d6586","createRatioSize","ratioX","ratioY","updateRatio","widthInput","heightInput","commonRatios","reducedArr","closestRatio","closestDistance","ratioWrapper","realw","T","U","V","HCF","newImDiv","widthWrapper","heightWrapper","widthUnit","heightUnit","templateWrapper","presetFitBtn","presetCurrentBtn","presetSquareBtn","presetLandscapeBtn","presetPortraitBtn","presetOversizeBtn","sizeObj1","backgroundRGBA","colorOptionsArr","colorOptions","previewcell","cell","onkeyup","secondRow","secondRowLeft","$3f73fb4b1b574d52$export$5b91f641162972fc","icon","directionStr","$jiQkU","dirStr","$3Rl3W","$cd9e7df6e228ea45$export$e263e067d6140649","textCtx","textCanvas","$a7ch7","textInput","alignRadioList","italicToggle","boldToggle","sizeInput","fontSelect","rotatedXY","rotatedWH","fitBounds","zoomFac","previewCanvas","layersCtx","previewCtx","checkerPattern","layersCanvas","changeZoomFac","zoomInBtn","canZoom","zoomOutBtn","onScroll","isSmallWidth","isSmallHeight","previewPointerListener","row2n3Wrapper","unshift","fontPointerListener","zoomWrapper","sizePointerListener","$2dqOY","$rk4vM","$hucjG","$cZa2s","$03Zd8","placeholder","$c8d2eb7d799b314c$export$1bf16d9bd59fd8f9","resolutionEl","updateResolution","flattenCheckbox","doFlatten","noteStyle","warningArr","psdWarningArr","contentArr","warningMap","mask","clipping","group","adjustment","showWarnings","noteEl1","cropRect","isCropped","$4c230b0de5e1a470$var$kl2PsdMap","$4c230b0de5e1a470$var$psd2KlMap","$4c230b0de5e1a470$var$init","$4c230b0de5e1a470$export$6df36f0c42d2440f","str","$4c230b0de5e1a470$export$4e3b1f7d3ad623b4","$4c230b0de5e1a470$export$3d649861c4b13fa2","psdObj","addWarning","warningStr","getMixModeStr","prepareMask","maskCanvas","defaultColor","groupMaskCtx","bitsPerChannel","maxLayers","layerCount","countWithinGroup","groupObj","convertGroup","psdGroupObj","groupCanvas","groupCtx","groupOpacity","hidden","groupMixModeStr","hasClipping","innerArr","innerItem","innerCtx","clippingCanvas","clippingCtx","clippingItem","effects","clippingCanvas1","clippingCtx1","clippingItem1","$4c230b0de5e1a470$export$56493bf279c387b3","klPsd","$41164c8aeaf53227$var$indexedDbIsSupported","indexedDB","$41164c8aeaf53227$var$dbNameStr","$41164c8aeaf53227$var$storageNameStr","$41164c8aeaf53227$export$1347f8be1f25c479","$41164c8aeaf53227$var$execIndexedDBTransaction","actionFunction","successCallback","errorCallback","onError","errorStr","hasFinished","requestObj","onupgradeneeded","createObjectStore","keyPath","createIndex","unique","onsuccess","databaseObj","transactionObj","storeObj","objectStoreNames","contains","deleteDatabase","transaction","objectStore","e2","oncomplete","$41164c8aeaf53227$export$1448a0dd0d3fde8e","query","$41164c8aeaf53227$export$21ade4eb935254aa","storageProject","put","$41164c8aeaf53227$export$42ffd38884aecdac","$8k5kH","$805be15a1e91c0ee$export$7a4e0b62a5d854bc","isLoaded","$805be15a1e91c0ee$export$395d33c8e06b92c9","brightnessContrast","lang","getDialog","inEmbed","$4UkHZ","curves","$e7LnL","distort","$bt9IQ","$iI5sC","hueSaturation","$eySuj","invert","$iPRwU","perspective","$krmR4","$92iBR","tiltShift","$bFASM","toAlpha","$9m6gZ","$4fkq2","$dPWA8","unsharpMask","$cQHFd","grid","$9vOYE","noise","$as29q","pattern","$mMv4g","vanishPoint","$5UWr6","$68QTJ","$42ac5b30ad65dabb$export$7d68cd8857639377","PenBrush","BlendBrush","$5PSXS","SketchyBrush","$ewgr9","PixelBrush","$kic4a","ChemyBrush","$6Nq1H","SmudgeBrush","$ltaBP","EraserBrush","$7cUpm","$3f0923cd3c55ea92$export$6f96c8f9e6ae7341","historyEntry","settingColor","settingColorStr","lineToolLastDot","inputArr","calcOpacity","settingOpacity","settingHasOpacityPressure","updateAlphaCanvas","settingAlphaId","ALPHA_CIRCLE","ALPHA_SQUARE","instructionArr","alphaCanvas128","alphaCanvas64","alphaCanvas32","alphaOpacityArr","$5CF7D","alphaImArr","drawDot","before","settingLockLayerAlpha","arc","twoPI","closePath","hasDrawnDot","targetMipmap","ALPHA_CHALK","continueLine","bezierLine","lastInput","drawArr","dotCallback","localPressure","lastInput2","localOpacity","localSize","settingSize","settingHasSizePressure","localSpacing","settingSpacing","actions","maxInput","loopDist","mouseDist","eX","eY","bdist","setAlpha","setSpacing","sizePressure","opacityPressure","setLockAlpha","getSpacing","getLockAlpha","$74D3O","$ff6c1f784f50f5d5$export$d116ae91f77f1f19","genBrushAlpha01","genBrushAlpha02","$f875015ce1aeb4d3$export$74a44bbc21d06a28","scaleFac","createImageData","sFac2","$gZSR2","simplex2","noisePattern","centerDist","$f875015ce1aeb4d3$var$udSegment","ba","pa","$f875015ce1aeb4d3$export$eaa218d5d17c8f1c","pDist","centerSize","transitionSize","$dfc47a34ad9bc378$var$myModule","$dfc47a34ad9bc378$var$Grad","dot2","$dfc47a34ad9bc378$var$grad3","$dfc47a34ad9bc378$var$p","$dfc47a34ad9bc378$var$perm","$dfc47a34ad9bc378$var$gradP","seed","$dfc47a34ad9bc378$var$F2","$dfc47a34ad9bc378$var$G2","xin","yin","j1","gi0","gi1","gi2","t1","t2","$dfc47a34ad9bc378$export$d3022aad56692482","$02d77b8dd5755328$var$cellSize","$02d77b8dd5755328$var$clamp","$02d77b8dd5755328$export$9659db8d01dd5313","redrawBounds","cells","getTouchedCells","isTouched","drawCells","touchedCells","cellsW","getCellsWidth","cellOffsetX","cellOffsetY","cellWidth","cellHeight","inCellBounds","tmpCtx","alpha","ar","ag","ab","aa","sliceBounds","randI","randLen","randArr","random","samples","samplesSquared","sampleOffsets","sharpness","invSharpness","sharpnessSubtrahend","sizeSquared","distDivisor","alphaMinuend","slicedBounds","ri","re","alphaO","invAlphaO","alphaU","underR","underG","underB","underR1","underG1","underB1","newAlpha","drawBuffer","localColNew","settingSizePressure","calcSpacing","avgX","avgY","blending","mixr","mixg","mixb","average","localColOld","avgParams","prepDot","copyFromCanvas","getAverage","blendCol","blendMix","bezierCallback","settingOpacityPressure","updateRedrawBounds","isTesting","totalCells","drawChangedCells","find","$c214fbe9e4fc15b0$var$sampleCanvas","$c214fbe9e4fc15b0$var$sampleCtx","$c214fbe9e4fc15b0$export$566f9061f0f5ba33","lastX","lastY","settingBlending","settingScale","sketchySeed","setSeed","getSeed","mixmode","c1","c2","getBlending","setBlending","p_x","p_y","preMixedColor","mixx","mixy","mixw","mixh","countmix","mixed","$58b45953679baa4a$export$4de5ef8eecde6f12","ditherPattern","updateDither","ditherCtx","settingIsEraser","ditherArr","ditherCanvas","plotLine","skipFirst","settingUseDither","sX","sY","plotCubicBezierLine","isOverThreshold","d2","d3","cubicCurveOverThreshold","controlCallback","controlObj","setIsEraser","setUseDither","getUseDither","$fc1a683099fb2d61$export$fe52c90afd1cf5ba","isBaseLayer","isTransparentBG","radgrad","oFac","started","setTransparentBG","$78ad817c60f81b7c$var$CELL_SIZE","$78ad817c60f81b7c$var$smudge","cSize","brush","cX","cY","aIndex","aP","bP","softnessPx","pixel","ai","bi","ix","iy","fac2","alphaLock","bx1","bx2","yStart","iy1","yStart1","x21","ix1","iy2","yStart2","x3","x22","ix2","y3","iy3","yStart3","x4","x23","ix3","$78ad817c60f81b7c$export$c9f800961903deab","completeRedrawBounds","copiedCells","copyImageData","_$i","e3","imWidth","imHeight","$78ad817c60f81b7c$var$prepSmudge","ImageData","updateCompleteRedrawBounds","historyIm","tmpCanvas","$348fcce123898af9$export$38b08aa4ea8f61c6","settingXSymmetry","settingYSymmetry","buffer","settingMode","path","Path2D","settingGradient","startAtTop","minY","maxY","lineJoin","settingDistort","pos","historyCanvas","$cVFne","$7de2f0eab7a9ead7$export$f1561c72be54c6a7","penBrush","penBrushUi","blendBrush","$9mjXI","blendBrushUi","sketchyBrush","$iYbUv","sketchyBrushUi","pixelBrush","$brjBD","pixelBrushUi","chemyBrush","$vCnsd","chemyBrushUi","smudgeBrush","$dS2qM","smudgeBrushUi","$9rc5F","eraserBrushUi","brushInterface","alphaNames","$8b6ca25eb0830594$export$a0d4983f3b0b5c8e","$7gVvp","updateAlphas","alphas","currentAlpha","spacingSpline","$7NTKy","pressureSizeToggle","pressureOpacityToggle","alphaWrapper","changeSliderValue","$e8a5c017c49bb311$export$5ec472fd0ce20d84","$2e3c50106ba150d5$export$156bb4fe8f4bcb4b","$cQSIC","blendingSlider","setSizePressure","setOpacityPressure","$94537af75923b9e3$export$ffae56164d1bde68","$bteky","blendSlider","scaleSlider","$9519e739bc9666ee$export$d001f3406562d07","$4PDnu","ditherToggle","toggleRow","$d6fc2ded7d9d56db$export$cf481ecf227135a8","$984eq","isTransparentBg","transparencyToggle","$1045b9bae2ffbbb4$export$84831662ba707e7a","$3QgTy","$18456e8104a5a825$export$80819a93636ebb04","$18kre","actualIconSize","iconSize","modeOptions","brushSize","mirrorXToggle","halfSize","getXSymmetry","setXSymmetry","mirrorYToggle","getYSymmetry","setYSymmetry","gradientToggle","getGradient","setGradient","$14dc4cf18966a4f4$export$2358c75ad3c15b2d","$6f92981a32875bca$export$5334e08b3589fc5c","isEmbed","linkEl","iframe","href","contentWindow","location","isMaxHeight","$142eacf53b1eb43d$export$3dff5655255b5729","ignoreFocus","inputs","$0e681e75eb3cab30$export$9c72cf485ef46673","gridTemplateColumns","gridTemplateRows","gap","gridTemplateAreas","gridArea","infoEl","isBroken","ageEl","textSize","btnCustom","storeButtonEl","clearButtonEl","hideClearButton","visibility","storeListener","onUpdate","timestamp","thumbnail","updateThumb","updateAge","readResult","read","ageStr","age","maxWidth","maxHeight","resetButtons","Promise","unsubscribe","$14b343f2c12ca9c5$var$makeAsync","reject","$14b343f2c12ca9c5$export$93d91060b9af7e2a","accessHasFailed","storeKlProjectObj","getKlProjectObj","lowLevelRead","$3hwQ7","ProjectConverter","readStorageProject","storageProject1","createStorageProject","lowLevelStore","lowLevelClear","updateTimestamp","$3ee249752703e788$var$loadImage","onabort","$3ee249752703e788$export$f3c1ac6650038646","createThumbnail","HTMLCanvasElement","all","$e3587a28373f51f9$export$b3fb17ae4345ac8f","base64Str","parts","binStr","atob","buf","view","charCodeAt","$01ce2e23a2667e77$export$a2647fbf5f056b0a","onExportTypeChange","onFileSelect","onSaveImageToComputer","onNewImage","onShareImage","onUpload","onCopyToClipboard","createSpacer","clearer","line","filemenu","uploadImgurButton","clipboardButton","$4xKQD","multiple","accept","exportTypeWrapper","exportTypeSelect","importWrapper","innerMask","importFakeButton","createImportButton","saveNote","fileBrowserStorage","refresh","$0d10046ca7f6fbd0$export$3f17d740ad471e50","getCurrentColor","getKlMaxCanvasSize","getKlCanvas","getCurrentLayerCtx","isInit","filterKey","filterArr","buttonLabel","filterName","applyFilter","filterDialog","currentColorRgb","secondaryColorRgb","getInput","finishedDialog","addGroup","groupArr","filters","$6349b006a6604e1b$var$upload","description","$6349b006a6604e1b$var$_upload","gif","labelText","response","formData","$j8sUl","FormData","method","headers","Authorization","ok","json","link","$6349b006a6604e1b$export$b1dd62fa0b5f32f5","inputTitle","inputDescription","rows","labelTitle","labelDescription","tos","typeRadio","outDiv","infoHint","deletehash","$ae23cd0c3e53f398$var$agPsdLazy","$ae23cd0c3e53f398$export$ab3d838b1d336b38","$ae23cd0c3e53f398$var$_loadAgPsd","$06e8423858d08972$export$befc6437ad34b28a","showReminder","changeTitle","onSaveAsPsd","lastSavedActionNumber","lastSavedAt","psdWrapper","storageWrapper","paddingBottom","psdBtn","storageUi","closeFunc","lastReminderShownAt","onBeforeUnload","returnValue","getActionNumber","visibilityState","unsavedActions","showPopup","unsavedInterval","$956d06d740fc5053$export$75e7b60500bb415b","getExportType","format","saveImage","mimeType","$98ax7","saveAs","fileBase","fnameArr","layerArr1","psdConfig","blendKlToPsd","writePsdBuffer","XMLHttpRequest","responseType","send","a1","status","dispatchEvent","createEvent","initMouseEvent","self","$parcel$global","global","HTMLAnchorElement","download","rel","msSaveOrOpenBlob","autoBom","warn","HTMLElement","safari","onloadend","readAsDataURL","define","amd","$48534f13b7192dff$export$5cebd3bb2d68229a","getInitState","setCurrentLayerCtx","getCurrentBrush","doIgnore","ignoreTest","oldSize","id1","b3","currentLayerIndex","logParam","localCurrentLayerCtx","$53cc60fd413705d6$export$272bfd3ef9ef2f48","onSetColor","onSetSize","onSetOpacity","onGetColor","onGetSize","onGetOpacity","onGetSliderConfig","subscriberArr","instance","skipSubscriber","$5562b5b6c391a7ca$export$5d396b237bd33221","customAbout","makeLicenses","licenses","overflowY","language","getLanguage","preferredLanguageRow","$fgfvl","languages","languageSelect","LS_LANGUAGE_KEY","languageHint","$7OLuX","$6qSiv","$951e508110f8a437$export$42a534af7eb650e8","upBtn","downBtn","upInterval","scrollBy","downInterval","wheelListener","$f244572c1923a3ac$export$7fa03d1ef9d3489e","iconArr","updateIcons","typeOptions","reverseToggle","doSnapToggle","col1","col2","$b37f5cd553722692$export$665d2c76b1eb8459","submitButton","leftRightButton","uploadButton","$4bb0d03ef02dc0c0$var$importFilter","libObj","moduleObj","$4bb0d03ef02dc0c0$export$4283b00eae4a6956","$iiVKq","filterBrightnessContrast","$lorQQ","filterCropExtend","$8Ri8I","filterCurves","$fADXF","filterFlip","$bIns5","filterHueSaturation","$30jcG","filterInvert","$cCks8","filterPerspective","$huXOx","filterResize","$dsRff","filterRotate","$lhchB","filterTiltShift","$lXpcU","filterTransform","$1CjeM","filterBlur","$dNWKZ","filterUnsharpMask","$94Tq7","filterToAlpha","$d8Fqy","filterGrid","$gtdB1","filterNoise","$lQzx7","filterPattern","$10iZP","filterDistort","$dteOZ","filterVanishPoint","$024aabab8b30bbfd$export$af433fb90aa90a38","selectedLayerIndex","brightness","contrast","glCanvas","$5RaQo","getSharedFx","texture","brightnessSlider","$cH2YE","contrastSlider","previewInnerWrapper","$fca35583bfaa35b6$export$5ec472fd0ce20d84","$TEtAx","$0e6e34a2063e157d$var$fxCanvas","fx","$0e6e34a2063e157d$export$8c4423af32b21158","_","isContextLost","$dVkJn","$5eb53faa48338ac6$export$68ae324f2f6c6252","lo","hi","wrapTexture","loadContentsOf","Texture","fromElement","initialize","UNSIGNED_BYTE","getExtension","testTexture","RGBA","FLOAT","drawTo","spareTexture","extraTexture","flippedShader","Shader","use","getDefaultShader","drawRect","simpleShader","shader","uniforms","textureIn","textureOut","swapWith","node","contents","getPixelArray","array","readPixels","wrap","getSquareToQuad","dx1","dy1","dx2","dy2","dx3","dy3","det","getInverse","warpShader","warp","splineInterpolate","interpolator","red","green","blue","initFromBytes","textures","denoise","exponent","texSize","octaves","peaks","colA","colB","channels","sepia","amount","strength","ensureFormat","triangleBlur","originalTexture","unuse","vibrance","vignette","lensBlur","lensBlurPrePass","common","randomShaderFunc","lensBlur0","lensBlur1","lensBlur2","texture1","power","delta0","delta1","endX","endY","blurRadius","gradientRadius","zoomBlur","colorHalftone","dotScreen","edgeWork","edgeWork1","edgeWork2","hexagonalPixelate","ink","bulgePinch","matrixWarp","inverse","useTextureSpace","after","swirl","multiplyAlpha","unmultiplyAlpha","replaceRGBA","distortType","phase","oldGetExtension","oldGetSupportedExtensions","OESTextureFloatLinear","getSupportedExtensions","framebuffer","createFramebuffer","byteTexture","createTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","texImage2D","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","floatTexture","LINEAR","Float32Array","program","createProgram","vertexShader","createShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","shaderSource","compileShader","attachShader","linkProgram","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STREAM_DRAW","enableVertexAttribArray","vertexAttribPointer","useProgram","viewport","drawArrays","POINTS","supportsOESTextureFloatLinear","WebGLRenderingContext","$OES_texture_float_linear$","getOESTextureFloatLinear","extensions","isNumber","compileSource","source","nameStr","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","testPrecisionSupport","precisionType","getShaderPrecisionFormat","precision","vertexSource","fragmentSource","vertexAttribute","texCoordAttribute","defaultVertexSource","defaultFragmentSource","floatPrecision","HIGH_FLOAT","MEDIUM_FLOAT","getProgramParameter","LINK_STATUS","getProgramInfoLog","deleteProgram","getUniformLocation","uniform1fv","uniform2fv","uniform3fv","uniform4fv","uniformMatrix3fv","uniformMatrix4fv","uniform1f","uniform1i","getParameter","VIEWPORT","vertexBuffer","STATIC_DRAW","texCoordBuffer","getAttribLocation","TRIANGLE_STRIP","defaultShader","getCanvas","videoWidth","videoHeight","deleteTexture","unit","activeTexture","TEXTURE0","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","fillUsingCanvas","toImage","pixels","other","$2680b5781517cb67$export$e5937df51b9e1d86","updateInput","leftInput","rightInput","topInput","bottomInput","leftChanged","rightChanged","topChanged","bottomChanged","cropper","offsetWrapper","selectedRgbaObj","previewFactor","lrWrapper","tbWrapper","labelStyle","useRuleOfThirds","ruleOThirdsCheckbox","bgColorOverlay","updateBg","flexRow","$4c948640eb8ef791$export$309483fcb6d5c7ca","modeButtons","p0","areah","areaw","curveArea","createPoint","lock","internalY","internalX","newX","newY","updateControl","outCurves","drawCurve","spline","getDiv","$6b01e1931d168e01$export$9b1b7b3985b9625a","previewLayer","doFlipCanvas","horizontalCheckbox","verticalCheckbox","fcOption","borderTopLeftRadius","$1RI49","flOption","borderTopRightRadius","optionWrapper","horizontal","vertical","flipCanvas","$041c656037c77a96$export$2aa46bd5587f0eb","hueSlider","saturationSlider","Saturation","$82b3d1ba61b3412f$export$b7ebcfbdc840ef76","$460859cbeb601dec$export$a76d798fa7d85e4e","displayW","displayH","displayPreviewFactor","pointerListenerArr","bb","bc","bd","ac","ad","nob","updateAfter","beforeAfterTabs","$5vheV","TwoTabs","nobSize","$8b4f5ae4fe73ff76$var$activeColor","$8b4f5ae4fe73ff76$var$inactiveColor","$8b4f5ae4fe73ff76$var$hoverColor","$8b4f5ae4fe73ff76$export$b1241e74876d9bbe","leftTab","rightTab","$63d62a20f3ba2c7d$export$5705240d31427a82","previewW","previewH","algorithmSelect","canvasWrapper","inputWrapper","$jfTWC","constrainCheckbox","secondRowElement","$878715182dcd377b$export$ac7e9efc751d5791","WebkitTransform","MozTransform","OTransform","msTransform","btnPlus","btnMinus","$aa97ed406a9700f0$export$1b8796b18b7c19ed","fa","fb","blurSlider","gradientSlider","$31a0dd41d7428d32$export$dc15474d94cdc2b3","lastDrawnTransformStr","transformLayerCanvas","onInputsChanged","inputR","leftWrapper","rightWrapper","rotWrapper","actionBtnCss","buttonRow","flipXBtn","flipYBtn","scaleRotLeftBtn","scaleRotRightBtn","scaleDoubleBtn","getRatio","scaleHalfBtn","setConstrained","isSnapping","snappingCheckbox","setSnapping","checkboxWrapper","bottomRow","$95b95646154e8218$export$55e7eb2ebd0db869","radiusSlider","$82f12ab116cea855$export$62ac74a5ea43bd5c","strengthSlider","$a535e7a374deb8f5$export$6158ed2b22ebf4d9","sourceId","sourceOptions","$bad33651972f8d2c$export$50020de79e1bc23","renderW","renderH","$1xi6g","drawGrid","settingsObj","thickness","renderFactor","line1","line2","xInput","yInput","thicknessInput","$74df8e8cd35bce4e$export$20d2db9c68afeac","cellsX","cellsY","thickIsRound","pos1","$595c9469b8f94062$var$presetArr","$595c9469b8f94062$var$drawNoise","$595c9469b8f94062$export$1dab0536099042f5","presetCopy","presetIndex","thumbImgArr","preset","thumbImg","presetOptions","row1El","row2El","channelsOptions","blendSelect","colorWrapper","colInputStyle","colAInput","colBInput","$ebbf7e5d844153e5$var$drawPattern","blendOffsetX","blend","blendOffsetY","finalPatternCanvas","blendCanvas","blendCtx","colTransparent","colOpaque","blendGradient","$ebbf7e5d844153e5$export$5b48b77a483d9b33","syncInputs","sharpStrokeRect","drawX","drawY","drawWidth","drawHeight","lastDrawnSettings","previewMode","fullSizeCtx","fullSizeCanvas","pW","pH","overlayCtx","overlayCanvas","previewCtx1","inputStyle","mixBlendMode","oldSettings","x11","y11","$67bee9819cf9d9ba$export$77c344cc65ad0ed2","sync","from","sliderArr","glCanvas1","isSynced","settingsCopy","topRowEl","syncToggle","xyRowEl","leftCol","rightCol","sliderWidth","toUpperCase","phaseSlider","stepSlider","$9939d5f20537fa4b$export$a77e8ecd2a7fa9a5","$jsIPR","drawVanishPoint","lines","linesSlider","$cd59789add31bb97$export$8f57d6bdbceb36d0","degIncrement","$40b8cea12adf584e$export$92433b641be3f7a","$40b8cea12adf584e$var$_klCanvasToPsdBlob"],"version":3,"file":"main-embed.75cbcd4c.js.map"}